<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Vectorise.Env</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-2"></a><span>  </span><a href="Vectorise.Env.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-comment">-- * Local Environments</span><span>
</span><a name="line-5"></a><span>  </span><a href="Vectorise.Env.html#LocalEnv"><span class="hs-identifier hs-type">LocalEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-6"></a><span>  </span><a href="Vectorise.Env.html#emptyLocalEnv"><span class="hs-identifier hs-var">emptyLocalEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-comment">-- * Global Environments</span><span>
</span><a name="line-9"></a><span>  </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>  </span><a href="Vectorise.Env.html#initGlobalEnv"><span class="hs-identifier hs-var">initGlobalEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>  </span><a href="Vectorise.Env.html#extendImportedVarsEnv"><span class="hs-identifier hs-var">extendImportedVarsEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>  </span><a href="Vectorise.Env.html#extendFamEnv"><span class="hs-identifier hs-var">extendFamEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>  </span><a href="Vectorise.Env.html#setPAFunsEnv"><span class="hs-identifier hs-var">setPAFunsEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>  </span><a href="Vectorise.Env.html#setPRFunsEnv"><span class="hs-identifier hs-var">setPRFunsEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>  </span><a href="Vectorise.Env.html#modVectInfo"><span class="hs-identifier hs-var">modVectInfo</span></a><span>
</span><a name="line-16"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDFM.html"><span class="hs-identifier">UniqDFM</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- |Indicates what scope something (a variable) is in.</span><span>
</span><a name="line-43"></a><span class="hs-comment">--</span><span>
</span><a name="line-44"></a><span class="hs-keyword">data</span><span> </span><a name="Scope"><a href="Vectorise.Env.html#Scope"><span class="hs-identifier">Scope</span></a></a><span> </span><a name="local-6989586621680324069"><a href="#local-6989586621680324069"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680324070"><a href="#local-6989586621680324070"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="Global"><a href="Vectorise.Env.html#Global"><span class="hs-identifier">Global</span></a></a><span> </span><a href="#local-6989586621680324069"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="Local"><a href="Vectorise.Env.html#Local"><span class="hs-identifier">Local</span></a></a><span>  </span><a href="#local-6989586621680324070"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- LocalEnv -------------------------------------------------------------------</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- |The local environment.</span><span>
</span><a name="line-52"></a><span class="hs-comment">--</span><span>
</span><a name="line-53"></a><span class="hs-keyword">data</span><span> </span><a name="LocalEnv"><a href="Vectorise.Env.html#LocalEnv"><span class="hs-identifier">LocalEnv</span></a></a><span>
</span><a name="line-54"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="LocalEnv"><a href="Vectorise.Env.html#LocalEnv"><span class="hs-identifier">LocalEnv</span></a></a><span>
</span><a name="line-55"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="local_vars"><a href="Vectorise.Env.html#local_vars"><span class="hs-identifier">local_vars</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>          </span><span class="hs-comment">-- ^Mapping from local variables to their vectorised and lifted versions.</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local_tyvars"><a href="Vectorise.Env.html#local_tyvars"><span class="hs-identifier">local_tyvars</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-59"></a><span>          </span><span class="hs-comment">-- ^In-scope type variables.</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local_tyvar_pa"><a href="Vectorise.Env.html#local_tyvar_pa"><span class="hs-identifier">local_tyvar_pa</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-62"></a><span>          </span><span class="hs-comment">-- ^Mapping from tyvars to their PA dictionaries.</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local_bind_name"><a href="Vectorise.Env.html#local_bind_name"><span class="hs-identifier">local_bind_name</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-65"></a><span>          </span><span class="hs-comment">-- ^Local binding name. This is only used to generate better names for hoisted</span><span>
</span><a name="line-66"></a><span>          </span><span class="hs-comment">-- expressions.</span><span>
</span><a name="line-67"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- |Create an empty local environment.</span><span>
</span><a name="line-70"></a><span class="hs-comment">--</span><span>
</span><a name="line-71"></a><span class="hs-identifier">emptyLocalEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Env.html#LocalEnv"><span class="hs-identifier hs-type">LocalEnv</span></a><span>
</span><a name="line-72"></a><a name="emptyLocalEnv"><a href="Vectorise.Env.html#emptyLocalEnv"><span class="hs-identifier">emptyLocalEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Env.html#LocalEnv"><span class="hs-identifier hs-var">LocalEnv</span></a><span>
</span><a name="line-73"></a><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">local_vars</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-74"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">local_tyvars</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">local_tyvar_pa</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-76"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">local_bind_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;fn&quot;</span><span>
</span><a name="line-77"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- GlobalEnv ------------------------------------------------------------------</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- |The global environment: entities that exist at top-level.</span><span>
</span><a name="line-83"></a><span class="hs-comment">--</span><span>
</span><a name="line-84"></a><span class="hs-keyword">data</span><span> </span><a name="GlobalEnv"><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier">GlobalEnv</span></a></a><span>
</span><a name="line-85"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="GlobalEnv"><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier">GlobalEnv</span></a></a><span>
</span><a name="line-86"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="global_vect_avoid"><a href="Vectorise.Env.html#global_vect_avoid"><span class="hs-identifier">global_vect_avoid</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-87"></a><span>          </span><span class="hs-comment">-- ^'True' implies to avoid vectorisation as far as possible.</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_vars"><a href="Vectorise.Env.html#global_vars"><span class="hs-identifier">global_vars</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>
</span><a name="line-90"></a><span>          </span><span class="hs-comment">-- ^Mapping from global variables to their vectorised versions &#8212; aka the /vectorisation</span><span>
</span><a name="line-91"></a><span>          </span><span class="hs-comment">-- map/.</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_parallel_vars"><a href="Vectorise.Env.html#global_parallel_vars"><span class="hs-identifier">global_parallel_vars</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#DVarSet"><span class="hs-identifier hs-type">DVarSet</span></a><span>
</span><a name="line-94"></a><span>          </span><span class="hs-comment">-- ^The domain of 'global_vars'.</span><span>
</span><a name="line-95"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-96"></a><span>          </span><span class="hs-comment">-- This information is not redundant as it is impossible to extract the domain from a</span><span>
</span><a name="line-97"></a><span>          </span><span class="hs-comment">-- 'VarEnv' (which is keyed on uniques alone). Moreover, we have mapped variables that</span><span>
</span><a name="line-98"></a><span>          </span><span class="hs-comment">-- do not involve parallelism &#8212; e.g., the workers of vectorised, but scalar data types.</span><span>
</span><a name="line-99"></a><span>          </span><span class="hs-comment">-- In addition, workers of parallel data types that we could not vectorise also need to</span><span>
</span><a name="line-100"></a><span>          </span><span class="hs-comment">-- be tracked.</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_vect_decls"><a href="Vectorise.Env.html#global_vect_decls"><span class="hs-identifier">global_vect_decls</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>          </span><span class="hs-comment">-- ^Mapping from global variables that have a vectorisation declaration to the right-hand</span><span>
</span><a name="line-104"></a><span>          </span><span class="hs-comment">-- side of that declaration and its type and mapping variables that have NOVECTORISE</span><span>
</span><a name="line-105"></a><span>          </span><span class="hs-comment">-- declarations to 'Nothing'.</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_tycons"><a href="Vectorise.Env.html#global_tycons"><span class="hs-identifier">global_tycons</span></a></a><span>               </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-108"></a><span>          </span><span class="hs-comment">-- ^Mapping from TyCons to their vectorised versions. The vectorised version will be</span><span>
</span><a name="line-109"></a><span>          </span><span class="hs-comment">-- identical to the original version if it is not changed by vectorisation. In any case,</span><span>
</span><a name="line-110"></a><span>          </span><span class="hs-comment">-- if a tycon appears in the domain of this mapping, it was successfully vectorised.</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_parallel_tycons"><a href="Vectorise.Env.html#global_parallel_tycons"><span class="hs-identifier">global_parallel_tycons</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-113"></a><span>          </span><span class="hs-comment">-- ^Type constructors whose definition directly or indirectly includes a parallel type,</span><span>
</span><a name="line-114"></a><span>          </span><span class="hs-comment">-- such as '[::]'.</span><span>
</span><a name="line-115"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-116"></a><span>          </span><span class="hs-comment">-- NB: This information is not redundant as some types have got a mapping in</span><span>
</span><a name="line-117"></a><span>          </span><span class="hs-comment">--     'global_tycons' (to a type other than themselves) and are still not parallel. An</span><span>
</span><a name="line-118"></a><span>          </span><span class="hs-comment">--     example is '(-&gt;)'. Moreover, some types have *not* got a mapping in 'global_tycons'</span><span>
</span><a name="line-119"></a><span>          </span><span class="hs-comment">--     (because they couldn't be vectorised), but still contain parallel types.</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_datacons"><a href="Vectorise.Env.html#global_datacons"><span class="hs-identifier">global_datacons</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-122"></a><span>          </span><span class="hs-comment">-- ^Mapping from DataCons to their vectorised versions.</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_pa_funs"><a href="Vectorise.Env.html#global_pa_funs"><span class="hs-identifier">global_pa_funs</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>
</span><a name="line-125"></a><span>          </span><span class="hs-comment">-- ^Mapping from TyCons to their PA dfuns.</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_pr_funs"><a href="Vectorise.Env.html#global_pr_funs"><span class="hs-identifier">global_pr_funs</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>
</span><a name="line-128"></a><span>          </span><span class="hs-comment">-- ^Mapping from TyCons to their PR dfuns.</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_inst_env"><a href="Vectorise.Env.html#global_inst_env"><span class="hs-identifier">global_inst_env</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a><span>
</span><a name="line-131"></a><span>          </span><span class="hs-comment">-- ^External package inst-env &amp; home-package inst-env for class instances.</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_fam_inst_env"><a href="Vectorise.Env.html#global_fam_inst_env"><span class="hs-identifier">global_fam_inst_env</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-134"></a><span>          </span><span class="hs-comment">-- ^External package inst-env &amp; home-package inst-env for family instances.</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="global_bindings"><a href="Vectorise.Env.html#global_bindings"><span class="hs-identifier">global_bindings</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-137"></a><span>          </span><span class="hs-comment">-- ^Hoisted bindings &#8212; temporary storage for toplevel bindings during code gen.</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- |Create an initial global environment.</span><span>
</span><a name="line-141"></a><span class="hs-comment">--</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- We add scalar variables and type constructors identified by vectorisation pragmas already here</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- to the global table, so that we can query scalarness during vectorisation, and especially, when</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- vectorising the scalar entities' definitions themselves.</span><span>
</span><a name="line-145"></a><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span class="hs-identifier">initGlobalEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-147"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#VectInfo"><span class="hs-identifier hs-type">VectInfo</span></a><span>
</span><a name="line-148"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreVect"><span class="hs-identifier hs-type">CoreVect</span></a><span class="hs-special">]</span><span>
</span><a name="line-149"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a><span>
</span><a name="line-150"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-151"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span>
</span><a name="line-152"></a><a name="initGlobalEnv"><a href="Vectorise.Env.html#initGlobalEnv"><span class="hs-identifier">initGlobalEnv</span></a></a><span> </span><a name="local-6989586621680324071"><a href="#local-6989586621680324071"><span class="hs-identifier">vectAvoid</span></a></a><span> </span><a name="local-6989586621680324072"><a href="#local-6989586621680324072"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621680324073"><a href="#local-6989586621680324073"><span class="hs-identifier">vectDecls</span></a></a><span> </span><a name="local-6989586621680324074"><a href="#local-6989586621680324074"><span class="hs-identifier">instEnvs</span></a></a><span> </span><a name="local-6989586621680324075"><a href="#local-6989586621680324075"><span class="hs-identifier">famInstEnvs</span></a></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-var">GlobalEnv</span></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">global_vect_avoid</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324071"><span class="hs-identifier hs-var">vectAvoid</span></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_vars</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="UniqDFM.html#udfmToUfm"><span class="hs-identifier hs-var">udfmToUfm</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">vectInfoVar</span><span> </span><a href="#local-6989586621680324072"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_vect_decls</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><a href="#local-6989586621680324076"><span class="hs-identifier hs-var">vects</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_parallel_vars</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vectInfoParallelVars</span><span> </span><a href="#local-6989586621680324072"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_parallel_tycons</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vectInfoParallelTyCons</span><span> </span><a href="#local-6989586621680324072"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-159"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_tycons</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mapNameEnv"><span class="hs-identifier hs-var">mapNameEnv</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">vectInfoTyCon</span><span> </span><a href="#local-6989586621680324072"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-160"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_datacons</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mapNameEnv"><span class="hs-identifier hs-var">mapNameEnv</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">vectInfoDataCon</span><span> </span><a href="#local-6989586621680324072"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_pa_funs</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_pr_funs</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_inst_env</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324074"><span class="hs-identifier hs-var">instEnvs</span></a><span>
</span><a name="line-164"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_fam_inst_env</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324075"><span class="hs-identifier hs-var">famInstEnvs</span></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">global_bindings</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-168"></a><span>    </span><a name="local-6989586621680324076"><a href="#local-6989586621680324076"><span class="hs-identifier">vects</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680324077"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680324080"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680324078"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#Vect"><span class="hs-identifier hs-var">Vect</span></a><span>   </span><a name="local-6989586621680324077"><a href="#local-6989586621680324077"><span class="hs-identifier">var</span></a></a><span>   </span><a name="local-6989586621680324078"><a href="#local-6989586621680324078"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621680324079"><a href="#local-6989586621680324079"><span class="hs-identifier">rhs_var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324073"><span class="hs-identifier hs-var">vectDecls</span></a><span>
</span><a name="line-169"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680324080"><a href="#local-6989586621680324080"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621680324079"><span class="hs-identifier hs-var">rhs_var</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-170"></a><span>                                        </span><span class="hs-comment">-- FIXME: we currently only allow RHSes consisting of a</span><span>
</span><a name="line-171"></a><span>                                        </span><span class="hs-comment">--   single variable to be able to obtain the type without</span><span>
</span><a name="line-172"></a><span>                                        </span><span class="hs-comment">--   inference &#8212; see also 'TcBinds.tcVect'</span><span>
</span><a name="line-173"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680324081"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#NoVect"><span class="hs-identifier hs-var">NoVect</span></a><span> </span><a name="local-6989586621680324081"><a href="#local-6989586621680324081"><span class="hs-identifier">var</span></a></a><span>                     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324073"><span class="hs-identifier hs-var">vectDecls</span></a><span class="hs-special">]</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- Operators on Global Environments -------------------------------------------</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- |Extend the list of global variables in an environment.</span><span>
</span><a name="line-179"></a><span class="hs-comment">--</span><span>
</span><a name="line-180"></a><span class="hs-identifier">extendImportedVarsEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span>
</span><a name="line-181"></a><a name="extendImportedVarsEnv"><a href="Vectorise.Env.html#extendImportedVarsEnv"><span class="hs-identifier">extendImportedVarsEnv</span></a></a><span> </span><a name="local-6989586621680324082"><a href="#local-6989586621680324082"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621680324083"><a href="#local-6989586621680324083"><span class="hs-identifier">genv</span></a></a><span>
</span><a name="line-182"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324083"><span class="hs-identifier hs-var">genv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">global_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnvList"><span class="hs-identifier hs-var">extendVarEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">global_vars</span><span> </span><a href="#local-6989586621680324083"><span class="hs-identifier hs-var">genv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680324082"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- |Extend the list of type family instances.</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-identifier">extendFamEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span>
</span><a name="line-187"></a><a name="extendFamEnv"><a href="Vectorise.Env.html#extendFamEnv"><span class="hs-identifier">extendFamEnv</span></a></a><span> </span><a name="local-6989586621680324084"><a href="#local-6989586621680324084"><span class="hs-identifier">new</span></a></a><span> </span><a name="local-6989586621680324085"><a href="#local-6989586621680324085"><span class="hs-identifier">genv</span></a></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324085"><span class="hs-identifier hs-var">genv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">global_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680324086"><span class="hs-identifier hs-var">g_fam_inst</span></a><span class="hs-special">,</span><span> </span><a href="FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-var">extendFamInstEnvList</span></a><span> </span><a href="#local-6989586621680324087"><span class="hs-identifier hs-var">l_fam_inst</span></a><span> </span><a href="#local-6989586621680324084"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-189"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680324086"><a href="#local-6989586621680324086"><span class="hs-identifier">g_fam_inst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680324087"><a href="#local-6989586621680324087"><span class="hs-identifier">l_fam_inst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">global_fam_inst_env</span><span> </span><a href="#local-6989586621680324085"><span class="hs-identifier hs-var">genv</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- |Set the list of PA functions in an environment.</span><span>
</span><a name="line-192"></a><span class="hs-comment">--</span><span>
</span><a name="line-193"></a><span class="hs-identifier">setPAFunsEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span>
</span><a name="line-194"></a><a name="setPAFunsEnv"><a href="Vectorise.Env.html#setPAFunsEnv"><span class="hs-identifier">setPAFunsEnv</span></a></a><span> </span><a name="local-6989586621680324088"><a href="#local-6989586621680324088"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621680324089"><a href="#local-6989586621680324089"><span class="hs-identifier">genv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324089"><span class="hs-identifier hs-var">genv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">global_pa_funs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="#local-6989586621680324088"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- |Set the list of PR functions in an environment.</span><span>
</span><a name="line-197"></a><span class="hs-comment">--</span><span>
</span><a name="line-198"></a><span class="hs-identifier">setPRFunsEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span>
</span><a name="line-199"></a><a name="setPRFunsEnv"><a href="Vectorise.Env.html#setPRFunsEnv"><span class="hs-identifier">setPRFunsEnv</span></a></a><span> </span><a name="local-6989586621680324090"><a href="#local-6989586621680324090"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621680324091"><a href="#local-6989586621680324091"><span class="hs-identifier">genv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324091"><span class="hs-identifier hs-var">genv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">global_pr_funs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="#local-6989586621680324090"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- |Compute vectorisation information that goes into 'ModGuts' (and is stored in interface files).</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- The incoming 'vectInfo' is that from the 'HscEnv' and 'EPS'.  The outgoing one contains only the</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- declarations for the currently compiled module; this includes variables, type constructors, and</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- data constructors referenced in VECTORISE pragmas, even if they are defined in an imported</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- module.</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- The variables explicitly include class selectors and dfuns.</span><span>
</span><a name="line-208"></a><span class="hs-comment">--</span><span>
</span><a name="line-209"></a><span class="hs-identifier">modVectInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Env.html#GlobalEnv"><span class="hs-identifier hs-type">GlobalEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreVect"><span class="hs-identifier hs-type">CoreVect</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#VectInfo"><span class="hs-identifier hs-type">VectInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#VectInfo"><span class="hs-identifier hs-type">VectInfo</span></a><span>
</span><a name="line-210"></a><a name="modVectInfo"><a href="Vectorise.Env.html#modVectInfo"><span class="hs-identifier">modVectInfo</span></a></a><span> </span><a name="local-6989586621680324092"><a href="#local-6989586621680324092"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621680324093"><a href="#local-6989586621680324093"><span class="hs-identifier">mg_ids</span></a></a><span> </span><a name="local-6989586621680324094"><a href="#local-6989586621680324094"><span class="hs-identifier">mg_tyCons</span></a></a><span> </span><a name="local-6989586621680324095"><a href="#local-6989586621680324095"><span class="hs-identifier">vectDecls</span></a></a><span> </span><a name="local-6989586621680324096"><a href="#local-6989586621680324096"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324096"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-212"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">vectInfoVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324106"><span class="hs-identifier hs-var">mk_denv</span></a><span> </span><a href="#local-6989586621680324100"><span class="hs-identifier hs-var">ids</span></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier">global_vars</span><span>     </span><a href="#local-6989586621680324092"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoTyCon</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324105"><span class="hs-identifier hs-var">mk_env</span></a><span> </span><a href="#local-6989586621680324101"><span class="hs-identifier hs-var">tyCons</span></a><span>   </span><span class="hs-special">(</span><span class="hs-identifier">global_tycons</span><span>   </span><a href="#local-6989586621680324092"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoDataCon</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324105"><span class="hs-identifier hs-var">mk_env</span></a><span> </span><a href="#local-6989586621680324102"><span class="hs-identifier hs-var">dataCons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">global_datacons</span><span> </span><a href="#local-6989586621680324092"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoParallelVars</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">global_parallel_vars</span><span>   </span><a href="#local-6989586621680324092"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#minusDVarSet"><span class="hs-identifier hs-var">minusDVarSet</span></a><span class="hs-special">`</span><span>  </span><span class="hs-identifier">vectInfoParallelVars</span><span>   </span><a href="#local-6989586621680324096"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>                               </span><span class="hs-special">`</span><a href="UniqDFM.html#udfmIntersectUFM"><span class="hs-identifier hs-var">udfmIntersectUFM</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="UniqSet.html#getUniqSet"><span class="hs-identifier hs-var">getUniqSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="#local-6989586621680324100"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoParallelTyCons</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">global_parallel_tycons</span><span> </span><a href="#local-6989586621680324092"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">vectInfoParallelTyCons</span><span> </span><a href="#local-6989586621680324096"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-220"></a><span>    </span><a name="local-6989586621680324097"><a href="#local-6989586621680324097"><span class="hs-identifier">vectIds</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680324108"><span class="hs-identifier hs-var">id</span></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#Vect"><span class="hs-identifier hs-var">Vect</span></a><span>     </span><a name="local-6989586621680324108"><a href="#local-6989586621680324108"><span class="hs-identifier">id</span></a></a><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324095"><span class="hs-identifier hs-var">vectDecls</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-221"></a><span>                      </span><span class="hs-special">[</span><a href="#local-6989586621680324109"><span class="hs-identifier hs-var">id</span></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#VectInst"><span class="hs-identifier hs-var">VectInst</span></a><span> </span><a name="local-6989586621680324109"><a href="#local-6989586621680324109"><span class="hs-identifier">id</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324095"><span class="hs-identifier hs-var">vectDecls</span></a><span class="hs-special">]</span><span>
</span><a name="line-222"></a><span>    </span><a name="local-6989586621680324098"><a href="#local-6989586621680324098"><span class="hs-identifier">vectTypeTyCons</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680324110"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#VectType"><span class="hs-identifier hs-var">VectType</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680324110"><a href="#local-6989586621680324110"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324095"><span class="hs-identifier hs-var">vectDecls</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-223"></a><span>                      </span><span class="hs-special">[</span><a href="#local-6989586621680324111"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#VectClass"><span class="hs-identifier hs-var">VectClass</span></a><span> </span><a name="local-6989586621680324111"><a href="#local-6989586621680324111"><span class="hs-identifier">tycon</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324095"><span class="hs-identifier hs-var">vectDecls</span></a><span class="hs-special">]</span><span>
</span><a name="line-224"></a><span>    </span><a name="local-6989586621680324099"><a href="#local-6989586621680324099"><span class="hs-identifier">vectDataCons</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621680324098"><span class="hs-identifier hs-var">vectTypeTyCons</span></a><span>
</span><a name="line-225"></a><span>    </span><a name="local-6989586621680324100"><a href="#local-6989586621680324100"><span class="hs-identifier">ids</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324093"><span class="hs-identifier hs-var">mg_ids</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680324097"><span class="hs-identifier hs-var">vectIds</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680324103"><span class="hs-identifier hs-var">dataConIds</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680324104"><span class="hs-identifier hs-var">selIds</span></a><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621680324101"><a href="#local-6989586621680324101"><span class="hs-identifier">tyCons</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680324094"><span class="hs-identifier hs-var">mg_tyCons</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680324098"><span class="hs-identifier hs-var">vectTypeTyCons</span></a><span>
</span><a name="line-227"></a><span>    </span><a name="local-6989586621680324102"><a href="#local-6989586621680324102"><span class="hs-identifier">dataCons</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621680324094"><span class="hs-identifier hs-var">mg_tyCons</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680324099"><span class="hs-identifier hs-var">vectDataCons</span></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-6989586621680324103"><a href="#local-6989586621680324103"><span class="hs-identifier">dataConIds</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a><span> </span><a href="#local-6989586621680324102"><span class="hs-identifier hs-var">dataCons</span></a><span>
</span><a name="line-229"></a><span>    </span><a name="local-6989586621680324104"><a href="#local-6989586621680324104"><span class="hs-identifier">selIds</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Class.html#classAllSelIds"><span class="hs-identifier hs-var">classAllSelIds</span></a><span> </span><a href="#local-6989586621680324113"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-230"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680324112"><a href="#local-6989586621680324112"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324101"><span class="hs-identifier hs-var">tyCons</span></a><span>
</span><a name="line-231"></a><span>                             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621680324113"><a href="#local-6989586621680324113"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680324112"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">]</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-comment">-- Produce an entry for every declaration that is mentioned in the domain of the 'inspectedEnv'</span><span>
</span><a name="line-234"></a><span>    </span><a name="local-6989586621680324105"><a href="#local-6989586621680324105"><span class="hs-identifier">mk_env</span></a></a><span> </span><a name="local-6989586621680324114"><a href="#local-6989586621680324114"><span class="hs-identifier">decls</span></a></a><span> </span><a name="local-6989586621680324115"><a href="#local-6989586621680324115"><span class="hs-identifier">inspectedEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680324107"><span class="hs-identifier hs-var">mk_assoc_env</span></a><span> </span><a href="#local-6989586621680324114"><span class="hs-identifier hs-var">decls</span></a><span> </span><a href="#local-6989586621680324115"><span class="hs-identifier hs-var">inspectedEnv</span></a><span>
</span><a name="line-235"></a><span>    </span><a name="local-6989586621680324106"><a href="#local-6989586621680324106"><span class="hs-identifier">mk_denv</span></a></a><span> </span><a name="local-6989586621680324116"><a href="#local-6989586621680324116"><span class="hs-identifier">decls</span></a></a><span> </span><a name="local-6989586621680324117"><a href="#local-6989586621680324117"><span class="hs-identifier">inspectedEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#listToUDFM"><span class="hs-identifier hs-var">listToUDFM</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680324107"><span class="hs-identifier hs-var">mk_assoc_env</span></a><span> </span><a href="#local-6989586621680324116"><span class="hs-identifier hs-var">decls</span></a><span> </span><a href="#local-6989586621680324117"><span class="hs-identifier hs-var">inspectedEnv</span></a><span>
</span><a name="line-236"></a><span>    </span><a name="local-6989586621680324107"><a href="#local-6989586621680324107"><span class="hs-identifier">mk_assoc_env</span></a></a><span> </span><a name="local-6989586621680324118"><a href="#local-6989586621680324118"><span class="hs-identifier">decls</span></a></a><span> </span><a name="local-6989586621680324119"><a href="#local-6989586621680324119"><span class="hs-identifier">inspectedEnv</span></a></a><span>
</span><a name="line-237"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680324121"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680324120"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680324122"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680324120"><a href="#local-6989586621680324120"><span class="hs-identifier">decl</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680324118"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-239"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680324121"><a href="#local-6989586621680324121"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621680324120"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-240"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680324122"><a href="#local-6989586621680324122"><span class="hs-identifier">to</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-6989586621680324119"><span class="hs-identifier hs-var">inspectedEnv</span></a><span> </span><a href="#local-6989586621680324121"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-241"></a></pre></body></html>