<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes, CPP, MultiWayIf, FlexibleContexts #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-comment">-- | Module for (a) type kinds and (b) type coercions,</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- as used in System FC. See 'CoreSyn.Expr' for</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- more on System FC and how coercions fit into it.</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- * Main data type</span><span>
</span><a name="line-13"></a><span>        </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionR"><span class="hs-identifier hs-type">CoercionR</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionP"><span class="hs-identifier hs-type">CoercionP</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- ** Functions over coercions</span><span>
</span><a name="line-19"></a><span>        </span><a href="Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coVarKind"><span class="hs-identifier hs-var">coVarKind</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coercionKinds"><span class="hs-identifier hs-var">coercionKinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>        </span><span class="hs-comment">-- ** Constructing coercions</span><span>
</span><a name="line-25"></a><span>        </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkRepReflCo"><span class="hs-identifier hs-var">mkRepReflCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkCoVarCos"><span class="hs-identifier hs-var">mkCoVarCos</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var">mkAxInstCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var">mkAxInstRHS</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier hs-var">mkUnbranchedAxInstRHS</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var">mkAxInstLHS</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier hs-var">mkUnbranchedAxInstLHS</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="Coercion.html#mkPiCo"><span class="hs-identifier hs-var">mkPiCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkPiCos"><span class="hs-identifier hs-var">mkPiCos</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkCoCast"><span class="hs-identifier hs-var">mkCoCast</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTransAppCo"><span class="hs-identifier hs-var">mkTransAppCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNthCoRole"><span class="hs-identifier hs-var">mkNthCoRole</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkFunCos"><span class="hs-identifier hs-var">mkFunCos</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkForAllCos"><span class="hs-identifier hs-var">mkForAllCos</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-var">mkHomoForAllCos_NoRefl</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHomoPhantomCo"><span class="hs-identifier hs-var">mkHomoPhantomCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Coercion.html#mkUnsafeCo"><span class="hs-identifier hs-var">mkUnsafeCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#maybeSubCo"><span class="hs-identifier hs-var">maybeSubCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAxiomRuleCo"><span class="hs-identifier hs-var">mkAxiomRuleCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier hs-var">mkCoherenceCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>        </span><a href="Coercion.html#mkHeteroCoercionType"><span class="hs-identifier hs-var">mkHeteroCoercionType</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>        </span><span class="hs-comment">-- ** Decomposition</span><span>
</span><a name="line-45"></a><span>        </span><a href="Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var">instNewTyCon_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>        </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Coercion.html#composeSteppers"><span class="hs-identifier hs-var">composeSteppers</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Coercion.html#mapStepResult"><span class="hs-identifier hs-var">mapStepResult</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var">unwrapNewTypeStepper</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-var">topNormaliseNewType_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var">topNormaliseTypeX</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>        </span><a href="Coercion.html#decomposeCo"><span class="hs-identifier hs-var">decomposeCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var">decomposeFunCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-var">getCoVar_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-var">splitFunCo_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>        </span><a href="Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>        </span><a href="BasicTypes.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>        </span><a href="Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="Coercion.html#isReflCoVar_maybe"><span class="hs-identifier hs-var">isReflCoVar_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>        </span><span class="hs-comment">-- ** Coercion variables</span><span>
</span><a name="line-65"></a><span>        </span><a href="Var.html#mkCoVar"><span class="hs-identifier hs-var">mkCoVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coVarName"><span class="hs-identifier hs-var">coVarName</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#setCoVarName"><span class="hs-identifier hs-var">setCoVarName</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#setCoVarUnique"><span class="hs-identifier hs-var">setCoVarUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><a href="Coercion.html#isCoVar_maybe"><span class="hs-identifier hs-var">isCoVar_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span>        </span><span class="hs-comment">-- ** Free variables</span><span>
</span><a name="line-69"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="TyCoRep.html#tyCoFVsOfCo"><span class="hs-identifier hs-var">tyCoFVsOfCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoFVsOfCos"><span class="hs-identifier hs-var">tyCoFVsOfCos</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoDSet"><span class="hs-identifier hs-var">tyCoVarsOfCoDSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="TyCoRep.html#coercionSize"><span class="hs-identifier hs-var">coercionSize</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>        </span><span class="hs-comment">-- ** Substitution</span><span>
</span><a name="line-74"></a><span>        </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#emptyCvSubstEnv"><span class="hs-identifier hs-var">emptyCvSubstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>        </span><a href="TyCoRep.html#lookupCoVar"><span class="hs-identifier hs-var">lookupCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>        </span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCos"><span class="hs-identifier hs-var">substCos</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoVar"><span class="hs-identifier hs-var">substCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoVars"><span class="hs-identifier hs-var">substCoVars</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoWith"><span class="hs-identifier hs-var">substCoWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>        </span><a href="TyCoRep.html#substCoVarBndr"><span class="hs-identifier hs-var">substCoVarBndr</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>        </span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- ** Lifting</span><span>
</span><a name="line-81"></a><span>        </span><a href="Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var">liftCoSubstTyVar</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-var">liftCoSubstWith</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#liftCoSubstWithEx"><span class="hs-identifier hs-var">liftCoSubstWithEx</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-var">emptyLiftingContext</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#extendLiftingContext"><span class="hs-identifier hs-var">extendLiftingContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="Coercion.html#liftCoSubstVarBndrCallback"><span class="hs-identifier hs-var">liftCoSubstVarBndrCallback</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#isMappedByLC"><span class="hs-identifier hs-var">isMappedByLC</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>        </span><a href="Coercion.html#mkSubstLiftingContext"><span class="hs-identifier hs-var">mkSubstLiftingContext</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#zapLiftingContext"><span class="hs-identifier hs-var">zapLiftingContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>        </span><a href="Coercion.html#substForAllCoBndrCallbackLC"><span class="hs-identifier hs-var">substForAllCoBndrCallbackLC</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#lcTCvSubst"><span class="hs-identifier hs-var">lcTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#lcInScopeSet"><span class="hs-identifier hs-var">lcInScopeSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>        </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var">liftEnvSubstLeft</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var">liftEnvSubstRight</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>        </span><a href="Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-var">swapLiftCoEnv</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>        </span><span class="hs-comment">-- ** Comparison</span><span>
</span><a name="line-92"></a><span>        </span><a href="Coercion.html#eqCoercion"><span class="hs-identifier hs-var">eqCoercion</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#eqCoercionX"><span class="hs-identifier hs-var">eqCoercionX</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>        </span><span class="hs-comment">-- ** Forcing evaluation of coercions</span><span>
</span><a name="line-95"></a><span>        </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>        </span><span class="hs-comment">-- * Pretty-printing</span><span>
</span><a name="line-98"></a><span>        </span><a href="TyCoRep.html#pprCo"><span class="hs-identifier hs-var">pprCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendCo"><span class="hs-identifier hs-var">pprParendCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="Coercion.html#pprCoAxiom"><span class="hs-identifier hs-var">pprCoAxiom</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var">pprCoAxBranch</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#pprCoAxBranchHdr"><span class="hs-identifier hs-var">pprCoAxBranchHdr</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>        </span><span class="hs-comment">-- * Tidying</span><span>
</span><a name="line-102"></a><span>        </span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyCos"><span class="hs-identifier hs-var">tidyCos</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>        </span><span class="hs-comment">-- * Other</span><span>
</span><a name="line-105"></a><span>        </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span>
</span><a name="line-106"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-118"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-120"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-122"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-123"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-124"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-125"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="TysPrim.html#eqPhantPrimTyCon"><span class="hs-identifier hs-var">eqPhantPrimTyCon</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-128"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-129"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html"><span class="hs-identifier">Data.Function</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
     -- The coercion arguments always *precisely* saturate
     -- arity of (that branch of) the CoAxiom.  If there are
     -- any left over, we use AppCo.  See
     -- See [Coercion axioms applied to coercions] in TyCoRep

\subsection{Coercion variables}
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">coVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-149"></a><a name="coVarName"><a href="Coercion.html#coVarName"><span class="hs-identifier">coVarName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">setCoVarUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-152"></a><a name="setCoVarUnique"><a href="Coercion.html#setCoVarUnique"><span class="hs-identifier">setCoVarUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarUnique"><span class="hs-identifier hs-var">setVarUnique</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-identifier">setCoVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-155"></a><a name="setCoVarName"><a href="Coercion.html#setCoVarName"><span class="hs-identifier">setCoVarName</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Pretty-printing CoAxioms
%*                                                                      *
%************************************************************************

Defined here to avoid module loops. CoAxiom is loaded very early on.

-}</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-identifier">pprCoAxiom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407085"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-169"></a><a name="pprCoAxiom"><a href="Coercion.html#pprCoAxiom"><span class="hs-identifier">pprCoAxiom</span></a></a><span> </span><a name="local-6989586621679407086"><a href="#local-6989586621679407086"><span class="hs-identifier">ax</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-var">CoAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_branches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407087"><a href="#local-6989586621679407087"><span class="hs-identifier">branches</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;axiom&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407086"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407086"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoAxiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a><span> </span><a href="#local-6989586621679407087"><span class="hs-identifier hs-var">branches</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-identifier">pprCoAxBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407084"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-174"></a><a name="pprCoAxBranch"><a href="Coercion.html#pprCoAxBranch"><span class="hs-identifier">pprCoAxBranch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a><span> </span><a href="#local-6989586621679407088"><span class="hs-identifier hs-var">pprRhs</span></a><span>
</span><a name="line-175"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679407088"><a href="#local-6989586621679407088"><span class="hs-identifier">pprRhs</span></a></a><span> </span><a name="local-6989586621679407089"><a href="#local-6989586621679407089"><span class="hs-identifier">fam_tc</span></a></a><span> </span><a name="local-6989586621679407090"><a href="#local-6989586621679407090"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-177"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407091"><a href="#local-6989586621679407091"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407090"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-178"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a><span> </span><a href="#local-6989586621679407089"><span class="hs-identifier hs-var">fam_tc</span></a><span>
</span><a name="line-179"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprDataCons"><span class="hs-identifier hs-var">pprDataCons</span></a><span> </span><a href="#local-6989586621679407091"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-182"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407090"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-identifier">pprCoAxBranchHdr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407083"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-185"></a><a name="pprCoAxBranchHdr"><a href="Coercion.html#pprCoAxBranchHdr"><span class="hs-identifier">pprCoAxBranchHdr</span></a></a><span> </span><a name="local-6989586621679407092"><a href="#local-6989586621679407092"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407093"><a href="#local-6989586621679407093"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var">pprCoAxBranch</span></a><span> </span><a href="#local-6989586621679407092"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621679407092"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621679407093"><span class="hs-identifier hs-var">index</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">ppr_co_ax_branch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407082"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-188"></a><a name="ppr_co_ax_branch"><a href="Coercion.html#ppr_co_ax_branch"><span class="hs-identifier">ppr_co_ax_branch</span></a></a><span> </span><a name="local-6989586621679407094"><a href="#local-6989586621679407094"><span class="hs-identifier">ppr_rhs</span></a></a><span>
</span><a name="line-189"></a><span>              </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-var">CoAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_tc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407095"><a href="#local-6989586621679407095"><span class="hs-identifier">fam_tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407096"><a href="#local-6989586621679407096"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>              </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407097"><a href="#local-6989586621679407097"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-191"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407098"><a href="#local-6989586621679407098"><span class="hs-identifier">cvs</span></a></a><span>
</span><a name="line-192"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407099"><a href="#local-6989586621679407099"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-193"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407100"><a href="#local-6989586621679407100"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-194"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407101"><a href="#local-6989586621679407101"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><a href="Outputable.html#hangNotEmpty"><span class="hs-identifier hs-var">hangNotEmpty</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="TyCoRep.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407097"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679407098"><span class="hs-identifier hs-var">cvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span> </span><a href="#local-6989586621679407095"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621679407099"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621679407094"><span class="hs-identifier hs-var">ppr_rhs</span></a><span> </span><a href="#local-6989586621679407095"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621679407100"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-198"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-- Defined&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621679407102"><span class="hs-identifier hs-var">pprLoc</span></a><span> </span><a href="#local-6989586621679407101"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>        </span><a name="local-6989586621679407102"><a href="#local-6989586621679407102"><span class="hs-identifier">pprLoc</span></a></a><span> </span><a name="local-6989586621679407103"><a href="#local-6989586621679407103"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-201"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a><span> </span><a href="#local-6989586621679407103"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-202"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a><span> </span><a href="#local-6989586621679407103"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-205"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-206"></a><span>              </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-6989586621679407096"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
        Destructing coercions
%*                                                                      *
%************************************************************************

Note [Function coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~
Remember that
  (-&gt;) :: forall r1 r2. TYPE r1 -&gt; TYPE r2 -&gt; TYPE LiftedRep

Hence
  FunCo r co1 co2 :: (s1-&gt;t1) ~r (s2-&gt;t2)
is short for
  TyConAppCo (-&gt;) co_rep1 co_rep2 co1 co2
where co_rep1, co_rep2 are the coercions on the representations.
-}</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">-- | This breaks a 'Coercion' with type @T A B C ~ T D E F@ into</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- a list of 'Coercion's of kinds @A ~ D@, @B ~ E@ and @E ~ F@. Hence:</span><span>
</span><a name="line-230"></a><span class="hs-comment">--</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- &gt; decomposeCo 3 c = [nth 0 c, nth 1 c, nth 2 c]</span><span>
</span><a name="line-232"></a><span class="hs-identifier">decomposeCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-233"></a><a name="decomposeCo"><a href="Coercion.html#decomposeCo"><span class="hs-identifier">decomposeCo</span></a></a><span> </span><a name="local-6989586621679407104"><a href="#local-6989586621679407104"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621679407105"><a href="#local-6989586621679407105"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><a href="#local-6989586621679407106"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679407105"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679407106"><a href="#local-6989586621679407106"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">(</span><a href="#local-6989586621679407104"><span class="hs-identifier hs-var">arity</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-235"></a><span>           </span><span class="hs-comment">-- Remember, Nth is zero-indexed</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">decomposeFunCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- Expects co :: (s1 -&gt; t1) ~ (s2 -&gt; t2)</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- Returns (co1 :: s1~s2, co2 :: t1~t2)</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- See Note [Function coercions] for the &quot;2&quot; and &quot;3&quot;</span><span>
</span><a name="line-241"></a><a name="decomposeFunCo"><a href="Coercion.html#decomposeFunCo"><span class="hs-identifier">decomposeFunCo</span></a></a><span> </span><a name="local-6989586621679407107"><a href="#local-6989586621679407107"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all_ok</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>                    </span><span class="hs-special">(</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679407107"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">3</span><span> </span><a href="#local-6989586621679407107"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-244"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407108"><a href="#local-6989586621679407108"><span class="hs-identifier">s1t1</span></a></a><span> </span><a name="local-6989586621679407109"><a href="#local-6989586621679407109"><span class="hs-identifier">s2t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407107"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-245"></a><span>    </span><a name="local-6989586621679407110"><a href="#local-6989586621679407110"><span class="hs-identifier">all_ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a><span> </span><a href="#local-6989586621679407108"><span class="hs-identifier hs-var">s1t1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a><span> </span><a href="#local-6989586621679407109"><span class="hs-identifier hs-var">s2t2</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- | Attempts to obtain the type variable underlying a 'Coercion'</span><span>
</span><a name="line-248"></a><span class="hs-identifier">getCoVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-249"></a><a name="getCoVar_maybe"><a href="Coercion.html#getCoVar_maybe"><span class="hs-identifier">getCoVar_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679407111"><a href="#local-6989586621679407111"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407111"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-250"></a><span class="hs-identifier">getCoVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | Attempts to tease a coercion apart into a type constructor and the application</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- of a number of coercion arguments to that constructor</span><span>
</span><a name="line-254"></a><span class="hs-identifier">splitTyConAppCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><a name="splitTyConAppCo_maybe"><a href="Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier">splitTyConAppCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407112"><a href="#local-6989586621679407112"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407113"><a href="#local-6989586621679407113"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407114"><a href="#local-6989586621679407114"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407115"><a href="#local-6989586621679407115"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407113"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-257"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407116"><a href="#local-6989586621679407116"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a><span> </span><a href="#local-6989586621679407112"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407114"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407115"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-258"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407114"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407116"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-259"></a><span class="hs-identifier">splitTyConAppCo_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407117"><a href="#local-6989586621679407117"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407118"><a href="#local-6989586621679407118"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407117"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407118"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span class="hs-identifier">splitTyConAppCo_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407119"><a href="#local-6989586621679407119"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679407120"><a href="#local-6989586621679407120"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407121"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679407121"><a href="#local-6989586621679407121"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a><span> </span><a href="#local-6989586621679407119"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a><span> </span><a href="#local-6989586621679407120"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407119"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407120"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span class="hs-identifier">splitTyConAppCo_maybe</span><span> </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- first result has role equal to input; third result is Nominal</span><span>
</span><a name="line-265"></a><span class="hs-identifier">splitAppCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- ^ Attempt to take a coercion application apart.</span><span>
</span><a name="line-267"></a><a name="splitAppCo_maybe"><a href="Coercion.html#splitAppCo_maybe"><span class="hs-identifier">splitAppCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407122"><a href="#local-6989586621679407122"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407123"><a href="#local-6989586621679407123"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407122"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407123"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span class="hs-identifier">splitAppCo_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621679407124"><a href="#local-6989586621679407124"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407125"><a href="#local-6989586621679407125"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407126"><a href="#local-6989586621679407126"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621679407125"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679407126"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621679407125"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-270"></a><span>    </span><span class="hs-comment">-- Never create unsaturated type family apps!</span><span>
</span><a name="line-271"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407127"><a href="#local-6989586621679407127"><span class="hs-identifier">args'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407128"><a href="#local-6989586621679407128"><span class="hs-identifier">arg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span> </span><a href="#local-6989586621679407126"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-272"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407129"><a href="#local-6989586621679407129"><span class="hs-identifier">arg''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407128"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-6989586621679407124"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407125"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407127"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407129"><span class="hs-identifier hs-var">arg''</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>       </span><span class="hs-comment">-- Use mkTyConAppCo to preserve the invariant</span><span>
</span><a name="line-275"></a><span>       </span><span class="hs-comment">--  that identity coercions are always represented by Refl</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-identifier">splitAppCo_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407130"><a href="#local-6989586621679407130"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407131"><a href="#local-6989586621679407131"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407132"><a href="#local-6989586621679407132"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407133"><a href="#local-6989586621679407133"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679407131"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-279"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-6989586621679407130"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407132"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621679407133"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span class="hs-identifier">splitAppCo_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-identifier">splitFunCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><a name="splitFunCo_maybe"><a href="Coercion.html#splitFunCo_maybe"><span class="hs-identifier">splitFunCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407134"><a href="#local-6989586621679407134"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679407135"><a href="#local-6989586621679407135"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407134"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407135"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span class="hs-identifier">splitFunCo_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-identifier">splitForAllCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><a name="splitForAllCo_maybe"><a href="Coercion.html#splitForAllCo_maybe"><span class="hs-identifier">splitForAllCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407136"><a href="#local-6989586621679407136"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407137"><a href="#local-6989586621679407137"><span class="hs-identifier">k_co</span></a></a><span> </span><a name="local-6989586621679407138"><a href="#local-6989586621679407138"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407136"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407137"><span class="hs-identifier hs-var">k_co</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407138"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span class="hs-identifier">splitForAllCo_maybe</span><span> </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- and some coercion kind stuff</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">coVarTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-294"></a><a name="coVarTypes"><a href="Coercion.html#coVarTypes"><span class="hs-identifier">coVarTypes</span></a></a><span> </span><a name="local-6989586621679407139"><a href="#local-6989586621679407139"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-295"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679407140"><a href="#local-6989586621679407140"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407141"><a href="#local-6989586621679407141"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a><span> </span><a href="#local-6989586621679407139"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-296"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407140"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407141"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-identifier">coVarKindsTypesRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><a name="coVarKindsTypesRole"><a href="Coercion.html#coVarKindsTypesRole"><span class="hs-identifier">coVarKindsTypesRole</span></a></a><span> </span><a name="local-6989586621679407142"><a href="#local-6989586621679407142"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-300"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407143"><a href="#local-6989586621679407143"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679407144"><a href="#local-6989586621679407144"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679407145"><a href="#local-6989586621679407145"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679407146"><a href="#local-6989586621679407146"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679407147"><a href="#local-6989586621679407147"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407142"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">role</span><span>
</span><a name="line-302"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407143"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-303"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407143"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span>
</span><a name="line-304"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;coVarKindsTypesRole&quot;</span><span>
</span><a name="line-305"></a><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407144"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><a href="#local-6989586621679407145"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><a href="#local-6989586621679407146"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><a href="#local-6989586621679407147"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span class="hs-keyword">role</span><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;coVarKindsTypesRole, non coercion variable&quot;</span><span>
</span><a name="line-307"></a><span>                        </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407142"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407142"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-identifier">coVarKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-310"></a><a name="coVarKind"><a href="Coercion.html#coVarKind"><span class="hs-identifier">coVarKind</span></a></a><span> </span><a name="local-6989586621679407149"><a href="#local-6989586621679407149"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-311"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier hs-var">cv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>    </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407149"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-identifier">coVarRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-315"></a><a name="coVarRole"><a href="Coercion.html#coVarRole"><span class="hs-identifier">coVarRole</span></a></a><span> </span><a name="local-6989586621679407150"><a href="#local-6989586621679407150"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-316"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407151"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>
</span><a name="line-317"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-318"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407151"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span>
</span><a name="line-319"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-321"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;coVarRole: unknown tycon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407150"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407150"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-324"></a><span>    </span><a name="local-6989586621679407151"><a href="#local-6989586621679407151"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407150"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407152"><a href="#local-6989586621679407152"><span class="hs-identifier">tc0</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407152"><span class="hs-identifier hs-var">tc0</span></a><span>
</span><a name="line-326"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;coVarRole: not tyconapp&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407150"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- | Makes a coercion type from two types: the types whose equality</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- is proven by the relevant 'Coercion'</span><span>
</span><a name="line-330"></a><span class="hs-identifier">mkCoercionType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-331"></a><a name="mkCoercionType"><a href="Coercion.html#mkCoercionType"><span class="hs-identifier">mkCoercionType</span></a></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span>
</span><a name="line-332"></a><span class="hs-identifier">mkCoercionType</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a><span>
</span><a name="line-333"></a><span class="hs-identifier">mkCoercionType</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679407153"><a href="#local-6989586621679407153"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407154"><a href="#local-6989586621679407154"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407155"><a href="#local-6989586621679407155"><span class="hs-identifier">ki1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407153"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-335"></a><span>      </span><a name="local-6989586621679407156"><a href="#local-6989586621679407156"><span class="hs-identifier">ki2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407154"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-336"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-337"></a><span>  </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#eqPhantPrimTyCon"><span class="hs-identifier hs-var">eqPhantPrimTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407155"><span class="hs-identifier hs-var">ki1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407156"><span class="hs-identifier hs-var">ki2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407153"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407154"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-identifier">mkHeteroCoercionType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-340"></a><a name="mkHeteroCoercionType"><a href="Coercion.html#mkHeteroCoercionType"><span class="hs-identifier">mkHeteroCoercionType</span></a></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var">mkHeteroPrimEqPred</span></a><span>
</span><a name="line-341"></a><span class="hs-identifier">mkHeteroCoercionType</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkHeteroReprPrimEqPred"><span class="hs-identifier hs-var">mkHeteroReprPrimEqPred</span></a><span>
</span><a name="line-342"></a><span class="hs-identifier">mkHeteroCoercionType</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;mkHeteroCoercionType&quot;</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-comment">-- | Given a coercion @co1 :: (a :: TYPE r1) ~ (b :: TYPE r2)@,</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- produce a coercion @rep_co :: r1 ~ r2@.</span><span>
</span><a name="line-346"></a><span class="hs-identifier">mkRuntimeRepCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-347"></a><a name="mkRuntimeRepCo"><a href="Coercion.html#mkRuntimeRepCo"><span class="hs-identifier">mkRuntimeRepCo</span></a></a><span> </span><a name="local-6989586621679407157"><a href="#local-6989586621679407157"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679407158"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-349"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-350"></a><span>    </span><a name="local-6989586621679407158"><a href="#local-6989586621679407158"><span class="hs-identifier">kind_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407157"><span class="hs-identifier hs-var">co</span></a><span>  </span><span class="hs-comment">-- kind_co :: TYPE r1 ~ TYPE r2</span><span>
</span><a name="line-351"></a><span>                           </span><span class="hs-comment">-- (up to silliness with Constraint)</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-identifier">isReflCoVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- If cv :: t~t then isReflCoVar_maybe cv = Just (Refl t)</span><span>
</span><a name="line-355"></a><a name="isReflCoVar_maybe"><a href="Coercion.html#isReflCoVar_maybe"><span class="hs-identifier">isReflCoVar_maybe</span></a></a><span> </span><a name="local-6989586621679407159"><a href="#local-6989586621679407159"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-356"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407160"><a href="#local-6989586621679407160"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407161"><a href="#local-6989586621679407161"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a><span> </span><a href="#local-6989586621679407159"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-357"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407160"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407161"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-358"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a><span> </span><a href="#local-6989586621679407159"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407160"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">-- | Tests if this coercion is obviously reflexive. Guaranteed to work</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- very quickly. Sometimes a coercion can be reflexive, but not obviously</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- so. c.f. 'isReflexiveCo'</span><span>
</span><a name="line-365"></a><span class="hs-identifier">isReflCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-366"></a><a name="isReflCo"><a href="Coercion.html#isReflCo"><span class="hs-identifier">isReflCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-367"></a><span class="hs-identifier">isReflCo</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- | Returns the type coerced if this coercion is reflexive. Guaranteed</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- to work very quickly. Sometimes a coercion can be reflexive, but not</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- obviously so. c.f. 'isReflexiveCo_maybe'</span><span>
</span><a name="line-372"></a><span class="hs-identifier">isReflCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><a name="isReflCo_maybe"><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier">isReflCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407162"><a href="#local-6989586621679407162"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407163"><a href="#local-6989586621679407163"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407163"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407162"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span class="hs-identifier">isReflCo_maybe</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">-- | Slowly checks if the coercion is reflexive. Don't call this in a loop,</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- as it walks over the entire coercion.</span><span>
</span><a name="line-378"></a><span class="hs-identifier">isReflexiveCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-379"></a><a name="isReflexiveCo"><a href="Coercion.html#isReflexiveCo"><span class="hs-identifier">isReflexiveCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-comment">-- | Extracts the coerced type from a reflexive coercion. This potentially</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- walks over the entire coercion, so avoid doing this in a loop.</span><span>
</span><a name="line-383"></a><span class="hs-identifier">isReflexiveCo_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><a name="isReflexiveCo_maybe"><a href="Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier">isReflexiveCo_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407164"><a href="#local-6989586621679407164"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407165"><a href="#local-6989586621679407165"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407165"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407164"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span class="hs-identifier">isReflexiveCo_maybe</span><span> </span><a name="local-6989586621679407166"><a href="#local-6989586621679407166"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-386"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407167"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407168"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-387"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407167"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407169"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-390"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407167"><a href="#local-6989586621679407167"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407168"><a href="#local-6989586621679407168"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407169"><a href="#local-6989586621679407169"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a><span> </span><a href="#local-6989586621679407166"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Building coercions
%*                                                                      *
%************************************************************************

These &quot;smart constructors&quot; maintain the invariants listed in the definition
of Coercion, and they perform very basic optimizations.

Note [Role twiddling functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There are a plethora of functions for twiddling roles:

mkSubCo: Requires a nominal input coercion and always produces a
representational output. This is used when you (the programmer) are sure you
know exactly that role you have and what you want.

downgradeRole_maybe: This function takes both the input role and the output role
as parameters. (The *output* role comes first!) It can only *downgrade* a
role -- that is, change it from N to R or P, or from R to P. This one-way
behavior is why there is the &quot;_maybe&quot;. If an upgrade is requested, this
function produces Nothing. This is used when you need to change the role of a
coercion, but you're not sure (as you're writing the code) of which roles are
involved.

This function could have been written using coercionRole to ascertain the role
of the input. But, that function is recursive, and the caller of downgradeRole_maybe
often knows the input role. So, this is more efficient.

downgradeRole: This is just like downgradeRole_maybe, but it panics if the
conversion isn't a downgrade.

setNominalRole_maybe: This is the only function that can *upgrade* a coercion.
The result (if it exists) is always Nominal. The input can be at any role. It
works on a &quot;best effort&quot; basis, as it should never be strictly necessary to
upgrade a coercion during compilation. It is currently only used within GHC in
splitAppCo_maybe. In order to be a proper inverse of mkAppCo, the second
coercion that splitAppCo_maybe returns must be nominal. But, it's conceivable
that splitAppCo_maybe is operating over a TyConAppCo that uses a
representational coercion. Hence the need for setNominalRole_maybe.
splitAppCo_maybe, in turn, is used only within coercion optimization -- thus,
it is not absolutely critical that setNominalRole_maybe be complete.

Note that setNominalRole_maybe will never upgrade a phantom UnivCo. Phantom
UnivCos are perfectly type-safe, whereas representational and nominal ones are
not. Indeed, `unsafeCoerce` is implemented via a representational UnivCo.
(Nominal ones are no worse than representational ones, so this function *will*
change a UnivCo Representational to a UnivCo Nominal.)

Conal Elliott also came across a need for this function while working with the
GHC API, as he was decomposing Core casts. The Core casts use representational
coercions, as they must, but his use case required nominal coercions (he was
building a GADT). So, that's why this function is exported from this module.

One might ask: shouldn't downgradeRole_maybe just use setNominalRole_maybe as
appropriate? I (Richard E.) have decided not to do this, because upgrading a
role is bizarre and a caller should have to ask for this behavior explicitly.

Note [mkTransAppCo]
~~~~~~~~~~~~~~~~~~~
Suppose we have

  co1 :: a ~R Maybe
  co2 :: b ~R Int

and we want

  co3 :: a b ~R Maybe Int

This seems sensible enough. But, we can't let (co3 = co1 co2), because
that's ill-roled! Note that mkAppCo requires a *nominal* second coercion.

The way around this is to use transitivity:

  co3 = (co1 &lt;b&gt;_N) ; (Maybe co2) :: a b ~R Maybe Int

Or, it's possible everything is the other way around:

  co1' :: Maybe ~R a
  co2' :: Int   ~R b

and we want

  co3' :: Maybe Int ~R a b

then

  co3' = (Maybe co2') ; (co1' &lt;b&gt;_N)

This is exactly what `mkTransAppCo` builds for us. Information for all
the arguments tends to be to hand at call sites, so it's quicker than
using, say, coercionKind.

-}</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-identifier">mkReflCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-490"></a><a name="mkReflCo"><a href="Coercion.html#mkReflCo"><span class="hs-identifier">mkReflCo</span></a></a><span> </span><a name="local-6989586621679407170"><a href="#local-6989586621679407170"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407171"><a href="#local-6989586621679407171"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407170"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407171"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-comment">-- | Make a representational reflexive coercion</span><span>
</span><a name="line-494"></a><span class="hs-identifier">mkRepReflCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-495"></a><a name="mkRepReflCo"><a href="Coercion.html#mkRepReflCo"><span class="hs-identifier">mkRepReflCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span class="hs-comment">-- | Make a nominal reflexive coercion</span><span>
</span><a name="line-498"></a><span class="hs-identifier">mkNomReflCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-499"></a><a name="mkNomReflCo"><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier">mkNomReflCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-comment">-- | Apply a type constructor to a list of coercions. It is the</span><span>
</span><a name="line-502"></a><span class="hs-comment">-- caller's responsibility to get the roles correct on argument coercions.</span><span>
</span><a name="line-503"></a><span class="hs-identifier">mkTyConAppCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-504"></a><a name="mkTyConAppCo"><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier">mkTyConAppCo</span></a></a><span> </span><a name="local-6989586621679407172"><a href="#local-6989586621679407172"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407173"><a href="#local-6989586621679407173"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407174"><a href="#local-6989586621679407174"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-505"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funTyConKey"><span class="hs-identifier hs-var">funTyConKey</span></a><span>
</span><a name="line-506"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679407175"><a href="#local-6989586621679407175"><span class="hs-identifier">_rep1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407176"><a href="#local-6989586621679407176"><span class="hs-identifier">_rep2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407177"><a href="#local-6989586621679407177"><span class="hs-identifier">co1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407178"><a href="#local-6989586621679407178"><span class="hs-identifier">co2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679407174"><span class="hs-identifier hs-var">cos</span></a><span>   </span><span class="hs-comment">-- See Note [Function coercions]</span><span>
</span><a name="line-507"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- (a :: TYPE ra) -&gt; (b :: TYPE rb)  ~  (c :: TYPE rc) -&gt; (d :: TYPE rd)</span><span>
</span><a name="line-508"></a><span>    </span><span class="hs-comment">-- rep1 :: ra  ~  rc        rep2 :: rb  ~  rd</span><span>
</span><a name="line-509"></a><span>    </span><span class="hs-comment">-- co1  :: a   ~  c         co2  :: b   ~  d</span><span>
</span><a name="line-510"></a><span>    </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621679407172"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407177"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407178"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span>               </span><span class="hs-comment">-- Expand type synonyms</span><span>
</span><a name="line-513"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407179"><a href="#local-6989586621679407179"><span class="hs-identifier">tv_co_prs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407180"><a href="#local-6989586621679407180"><span class="hs-identifier">rhs_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407181"><a href="#local-6989586621679407181"><span class="hs-identifier">leftover_cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a><span> </span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407174"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-514"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a><span> </span><a href="#local-6989586621679407172"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a><span> </span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var">tv_co_prs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407180"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407181"><span class="hs-identifier hs-var">leftover_cos</span></a><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407182"><a href="#local-6989586621679407182"><span class="hs-identifier">tys_roles</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span> </span><a href="#local-6989586621679407174"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-517"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407172"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621679407182"><span class="hs-identifier hs-var">tys_roles</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="#local-6989586621679407172"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407174"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | Build a function 'Coercion' from two other 'Coercion's. That is,</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- given @co1 :: a ~ b@ and @co2 :: x ~ y@ produce @co :: (a -&gt; x) ~ (b -&gt; y)@.</span><span>
</span><a name="line-523"></a><span class="hs-identifier">mkFunCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-524"></a><a name="mkFunCo"><a href="Coercion.html#mkFunCo"><span class="hs-identifier">mkFunCo</span></a></a><span> </span><a name="local-6989586621679407183"><a href="#local-6989586621679407183"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407184"><a href="#local-6989586621679407184"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407185"><a href="#local-6989586621679407185"><span class="hs-identifier">co2</span></a></a><span>
</span><a name="line-525"></a><span>    </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><a name="line-526"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407186"><a href="#local-6989586621679407186"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span> </span><a href="#local-6989586621679407184"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-527"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407187"><a href="#local-6989586621679407187"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span> </span><a href="#local-6989586621679407185"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407183"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-6989586621679407186"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407187"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a href="#local-6989586621679407183"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407184"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407185"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-comment">-- | Make nested function 'Coercion's</span><span>
</span><a name="line-532"></a><span class="hs-identifier">mkFunCos</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-533"></a><a name="mkFunCos"><a href="Coercion.html#mkFunCos"><span class="hs-identifier">mkFunCos</span></a></a><span> </span><a name="local-6989586621679407188"><a href="#local-6989586621679407188"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407189"><a href="#local-6989586621679407189"><span class="hs-identifier">cos</span></a></a><span> </span><a name="local-6989586621679407190"><a href="#local-6989586621679407190"><span class="hs-identifier">res_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621679407188"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407190"><span class="hs-identifier hs-var">res_co</span></a><span> </span><a href="#local-6989586621679407189"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-comment">-- | Apply a 'Coercion' to another 'Coercion'.</span><span>
</span><a name="line-536"></a><span class="hs-comment">-- The second coercion must be Nominal, unless the first is Phantom.</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- If the first is Phantom, then the second can be either Phantom or Nominal.</span><span>
</span><a name="line-538"></a><span class="hs-identifier">mkAppCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ :: t1 ~r t2</span><span>
</span><a name="line-539"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ :: s1 ~N s2, where s1 :: k1, s2 :: k2</span><span>
</span><a name="line-540"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ :: t1 s1 ~r t2 s2</span><span>
</span><a name="line-541"></a><a name="mkAppCo"><a href="Coercion.html#mkAppCo"><span class="hs-identifier">mkAppCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407191"><a href="#local-6989586621679407191"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407192"><a href="#local-6989586621679407192"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407193"><a href="#local-6989586621679407193"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-542"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407200"><a href="#local-6989586621679407200"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span> </span><a href="#local-6989586621679407193"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-543"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407191"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="#local-6989586621679407192"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407200"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407201"><a href="#local-6989586621679407201"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407202"><a href="#local-6989586621679407202"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407192"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-546"></a><span>    </span><span class="hs-comment">-- Expand type synonyms; a TyConAppCo can't have a type synonym (Trac #9102)</span><span>
</span><a name="line-547"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-6989586621679407191"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407201"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407194"><span class="hs-identifier hs-var">zip_roles</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a><span> </span><a href="#local-6989586621679407191"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407201"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407202"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-549"></a><span>    </span><a name="local-6989586621679407194"><a href="#local-6989586621679407194"><span class="hs-identifier">zip_roles</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407195"><a href="#local-6989586621679407195"><span class="hs-identifier">r1</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><a href="#local-6989586621679407195"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407193"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-550"></a><span>    </span><span class="hs-identifier">zip_roles</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407196"><a href="#local-6989586621679407196"><span class="hs-identifier">r1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679407197"><a href="#local-6989586621679407197"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407198"><a href="#local-6989586621679407198"><span class="hs-identifier">ty1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679407199"><a href="#local-6989586621679407199"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-6989586621679407196"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679407198"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679407194"><span class="hs-identifier hs-var">zip_roles</span></a><span> </span><a href="#local-6989586621679407197"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621679407199"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-551"></a><span>    </span><span class="hs-identifier">zip_roles</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;zip_roles&quot;</span><span> </span><span class="hs-comment">-- but the roles are infinite...</span><span>
</span><a name="line-552"></a><span>
</span><a name="line-553"></a><span class="hs-identifier">mkAppCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621679407203"><a href="#local-6989586621679407203"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407204"><a href="#local-6989586621679407204"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407205"><a href="#local-6989586621679407205"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407206"><a href="#local-6989586621679407206"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-554"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407203"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-555"></a><span>      </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407204"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407205"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407206"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-556"></a><span>      </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407204"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407205"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407208"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-557"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679407207"><a href="#local-6989586621679407207"><span class="hs-identifier">new_role</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407204"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679407205"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-558"></a><span>              </span><a name="local-6989586621679407208"><a href="#local-6989586621679407208"><span class="hs-identifier">arg'</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><a href="#local-6989586621679407207"><span class="hs-identifier hs-var">new_role</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407206"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-559"></a><span>      </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><a href="#local-6989586621679407204"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407205"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a><span> </span><a href="#local-6989586621679407206"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span class="hs-identifier">mkAppCo</span><span> </span><a name="local-6989586621679407209"><a href="#local-6989586621679407209"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407210"><a href="#local-6989586621679407210"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a href="#local-6989586621679407209"><span class="hs-identifier hs-var">co</span></a><span>  </span><a href="#local-6989586621679407210"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-561"></a><span class="hs-comment">-- Note, mkAppCo is careful to maintain invariants regarding</span><span>
</span><a name="line-562"></a><span class="hs-comment">-- where Refl constructors appear; see the comments in the definition</span><span>
</span><a name="line-563"></a><span class="hs-comment">-- of Coercion and the Note [Refl invariant] in TyCoRep.</span><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span class="hs-comment">-- | Applies multiple 'Coercion's to another 'Coercion', from left to right.</span><span>
</span><a name="line-566"></a><span class="hs-comment">-- See also 'mkAppCo'.</span><span>
</span><a name="line-567"></a><span class="hs-identifier">mkAppCos</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-568"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-569"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-570"></a><a name="mkAppCos"><a href="Coercion.html#mkAppCos"><span class="hs-identifier">mkAppCos</span></a></a><span> </span><a name="local-6989586621679407211"><a href="#local-6989586621679407211"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407212"><a href="#local-6989586621679407212"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407211"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407212"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span class="hs-comment">-- | Like `mkAppCo`, but allows the second coercion to be other than</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- nominal. See Note [mkTransAppCo]. Role r3 cannot be more stringent</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- than either r1 or r2.</span><span>
</span><a name="line-575"></a><span class="hs-identifier">mkTransAppCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>         </span><span class="hs-comment">-- ^ r1</span><span>
</span><a name="line-576"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ co1 :: ty1a ~r1 ty1b</span><span>
</span><a name="line-577"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- ^ ty1a</span><span>
</span><a name="line-578"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- ^ ty1b</span><span>
</span><a name="line-579"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>         </span><span class="hs-comment">-- ^ r2</span><span>
</span><a name="line-580"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ co2 :: ty2a ~r2 ty2b</span><span>
</span><a name="line-581"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- ^ ty2a</span><span>
</span><a name="line-582"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- ^ ty2b</span><span>
</span><a name="line-583"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>         </span><span class="hs-comment">-- ^ r3</span><span>
</span><a name="line-584"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>     </span><span class="hs-comment">-- ^ :: ty1a ty2a ~r3 ty1b ty2b</span><span>
</span><a name="line-585"></a><a name="mkTransAppCo"><a href="Coercion.html#mkTransAppCo"><span class="hs-identifier">mkTransAppCo</span></a></a><span> </span><a name="local-6989586621679407213"><a href="#local-6989586621679407213"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679407214"><a href="#local-6989586621679407214"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407215"><a href="#local-6989586621679407215"><span class="hs-identifier">ty1a</span></a></a><span> </span><a name="local-6989586621679407216"><a href="#local-6989586621679407216"><span class="hs-identifier">ty1b</span></a></a><span> </span><a name="local-6989586621679407217"><a href="#local-6989586621679407217"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679407218"><a href="#local-6989586621679407218"><span class="hs-identifier">co2</span></a></a><span> </span><a name="local-6989586621679407219"><a href="#local-6989586621679407219"><span class="hs-identifier">ty2a</span></a></a><span> </span><a name="local-6989586621679407220"><a href="#local-6989586621679407220"><span class="hs-identifier">ty2b</span></a></a><span> </span><a name="local-6989586621679407221"><a href="#local-6989586621679407221"><span class="hs-identifier">r3</span></a></a><span>
</span><a name="line-586"></a><span class="hs-comment">-- How incredibly fiddly! Is there a better way??</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407213"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407217"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407221"><span class="hs-identifier hs-var">r3</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-588"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a><span> </span><a href="#local-6989586621679407229"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="#local-6989586621679407215"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-6989586621679407219"><span class="hs-identifier hs-var">ty2a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="#local-6989586621679407216"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-6989586621679407220"><span class="hs-identifier hs-var">ty2b</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>        </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- ty1a :: k1a -&gt; k2a</span><span>
</span><a name="line-591"></a><span>              </span><span class="hs-comment">-- ty1b :: k1b -&gt; k2b</span><span>
</span><a name="line-592"></a><span>              </span><span class="hs-comment">-- ty2a :: k1a</span><span>
</span><a name="line-593"></a><span>              </span><span class="hs-comment">-- ty2b :: k1b</span><span>
</span><a name="line-594"></a><span>              </span><span class="hs-comment">-- ty1a ty2a :: k2a</span><span>
</span><a name="line-595"></a><span>              </span><span class="hs-comment">-- ty1b ty2b :: k2b</span><span>
</span><a name="line-596"></a><span>              </span><a name="local-6989586621679407228"><a href="#local-6989586621679407228"><span class="hs-identifier">kind_co1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span>        </span><span class="hs-comment">-- :: k1a -&gt; k2a ~N k1b -&gt; k2b</span><span>
</span><a name="line-597"></a><span>              </span><a name="local-6989586621679407229"><a href="#local-6989586621679407229"><span class="hs-identifier">kind_co</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679407228"><span class="hs-identifier hs-var">kind_co1</span></a><span>  </span><span class="hs-comment">-- :: k2a ~N k2b</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-600"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span> </span><a href="#local-6989586621679407213"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><span class="hs-identifier hs-var">r2</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>           </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-602"></a><span>      </span><span class="hs-special">(</span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span>          </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span>          </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span>          </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Representational</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>           </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-607"></a><span>      </span><span class="hs-special">(</span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span>          </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407222"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>                </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Representational</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">r2</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-identifier">Representational</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>           </span><a href="#local-6989586621679407222"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-612"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-613"></a><span>    </span><a name="local-6989586621679407222"><a href="#local-6989586621679407222"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679407223"><a href="#local-6989586621679407223"><span class="hs-identifier">co1_repr</span></a></a><span>
</span><a name="line-614"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407224"><a href="#local-6989586621679407224"><span class="hs-identifier">tc1b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407225"><a href="#local-6989586621679407225"><span class="hs-identifier">tys1b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407216"><span class="hs-identifier hs-var">ty1b</span></a><span>
</span><a name="line-615"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Type.html#nextRole"><span class="hs-identifier hs-var">nextRole</span></a><span> </span><a href="#local-6989586621679407216"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679407217"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-616"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407223"><span class="hs-identifier hs-var">co1_repr</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621679407219"><span class="hs-identifier hs-var">ty2a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span>
</span><a name="line-617"></a><span>        </span><span class="hs-special">(</span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407224"><span class="hs-identifier hs-var">tc1b</span></a><span>
</span><a name="line-618"></a><span>           </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407224"><span class="hs-identifier hs-var">tc1b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407225"><span class="hs-identifier hs-var">tys1b</span></a><span>
</span><a name="line-619"></a><span>            </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407226"><a href="#local-6989586621679407226"><span class="hs-identifier">tc1a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407227"><a href="#local-6989586621679407227"><span class="hs-identifier">tys1a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407215"><span class="hs-identifier hs-var">ty1a</span></a><span>
</span><a name="line-622"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Type.html#nextRole"><span class="hs-identifier hs-var">nextRole</span></a><span> </span><a href="#local-6989586621679407215"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679407217"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-623"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407226"><span class="hs-identifier hs-var">tc1a</span></a><span>
</span><a name="line-624"></a><span>           </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407226"><span class="hs-identifier hs-var">tc1a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407227"><span class="hs-identifier hs-var">tys1a</span></a><span>
</span><a name="line-625"></a><span>            </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>        </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span>
</span><a name="line-627"></a><span>        </span><span class="hs-special">(</span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621679407223"><span class="hs-identifier hs-var">co1_repr</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621679407220"><span class="hs-identifier hs-var">ty2b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-630"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;mkTransAppCo&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407213"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407215"><span class="hs-identifier hs-var">ty1a</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407216"><span class="hs-identifier hs-var">ty1b</span></a><span>
</span><a name="line-631"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407217"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407219"><span class="hs-identifier hs-var">ty2a</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407220"><span class="hs-identifier hs-var">ty2b</span></a><span>
</span><a name="line-632"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407221"><span class="hs-identifier hs-var">r3</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">-- | Make a Coercion from a tyvar, a kind coercion, and a body coercion.</span><span>
</span><a name="line-635"></a><span class="hs-comment">-- The kind of the tyvar should be the left-hand kind of the kind coercion.</span><span>
</span><a name="line-636"></a><span class="hs-identifier">mkForAllCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-637"></a><a name="mkForAllCo"><a href="Coercion.html#mkForAllCo"><span class="hs-identifier">mkForAllCo</span></a></a><span> </span><a name="local-6989586621679407230"><a href="#local-6989586621679407230"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407231"><a href="#local-6989586621679407231"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621679407232"><a href="#local-6989586621679407232"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407233"><a href="#local-6989586621679407233"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407234"><a href="#local-6989586621679407234"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679407232"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-639"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679407231"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-640"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407233"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span> </span><a href="#local-6989586621679407230"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679407234"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-642"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a href="#local-6989586621679407230"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679407231"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><a href="#local-6989586621679407232"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span class="hs-comment">-- | Make nested ForAllCos</span><span>
</span><a name="line-645"></a><span class="hs-identifier">mkForAllCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-646"></a><a name="mkForAllCos"><a href="Coercion.html#mkForAllCos"><span class="hs-identifier">mkForAllCos</span></a></a><span> </span><a name="local-6989586621679407235"><a href="#local-6989586621679407235"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407236"><a href="#local-6989586621679407236"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407237"><a href="#local-6989586621679407237"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407238"><a href="#local-6989586621679407238"><span class="hs-identifier">refls_rev'd</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407239"><a href="#local-6989586621679407239"><span class="hs-identifier">non_refls_rev'd</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621679407235"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-648"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span class="hs-special">)</span><span>
</span><a name="line-649"></a><span>          </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407236"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621679407238"><span class="hs-identifier hs-var">refls_rev'd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407237"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>          </span><a href="#local-6989586621679407239"><span class="hs-identifier hs-var">non_refls_rev'd</span></a><span>
</span><a name="line-651"></a><span class="hs-identifier">mkForAllCos</span><span> </span><a name="local-6989586621679407240"><a href="#local-6989586621679407240"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621679407241"><a href="#local-6989586621679407241"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407241"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679407240"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-comment">-- | Make a Coercion quantified over a type variable;</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- the variable has the same type in both sides of the coercion</span><span>
</span><a name="line-655"></a><span class="hs-identifier">mkHomoForAllCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-656"></a><a name="mkHomoForAllCos"><a href="Coercion.html#mkHomoForAllCos"><span class="hs-identifier">mkHomoForAllCos</span></a></a><span> </span><a name="local-6989586621679407242"><a href="#local-6989586621679407242"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407243"><a href="#local-6989586621679407243"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407244"><a href="#local-6989586621679407244"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407243"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-6989586621679407242"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407244"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span class="hs-identifier">mkHomoForAllCos</span><span> </span><a name="local-6989586621679407245"><a href="#local-6989586621679407245"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621679407246"><a href="#local-6989586621679407246"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-var">mkHomoForAllCos_NoRefl</span></a><span> </span><a href="#local-6989586621679407245"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407246"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-comment">-- | Like 'mkHomoForAllCos', but doesn't check if the inner coercion</span><span>
</span><a name="line-661"></a><span class="hs-comment">-- is reflexive.</span><span>
</span><a name="line-662"></a><span class="hs-identifier">mkHomoForAllCos_NoRefl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-663"></a><a name="mkHomoForAllCos_NoRefl"><a href="Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier">mkHomoForAllCos_NoRefl</span></a></a><span> </span><a name="local-6989586621679407247"><a href="#local-6989586621679407247"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621679407248"><a href="#local-6989586621679407248"><span class="hs-identifier">orig_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-6989586621679407249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407248"><span class="hs-identifier hs-var">orig_co</span></a><span> </span><a href="#local-6989586621679407247"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-664"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-665"></a><span>    </span><a name="local-6989586621679407249"><a href="#local-6989586621679407249"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679407250"><a href="#local-6989586621679407250"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407251"><a href="#local-6989586621679407251"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a href="#local-6989586621679407250"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679407250"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407251"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">mkCoVarCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-668"></a><span class="hs-comment">-- cv :: s ~# t</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- See Note [mkCoVarCo]</span><span>
</span><a name="line-670"></a><a name="mkCoVarCo"><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier">mkCoVarCo</span></a></a><span> </span><a name="local-6989586621679407252"><a href="#local-6989586621679407252"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="#local-6989586621679407252"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-identifier">mkCoVarCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-673"></a><a name="mkCoVarCos"><a href="Coercion.html#mkCoVarCos"><span class="hs-identifier">mkCoVarCos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span class="hs-comment">{- Note [mkCoVarCo]
~~~~~~~~~~~~~~~~~~~
In the past, mkCoVarCo optimised (c :: t~t) to (Refl t).  That is
valid (although see Note [Unbound RULE binders] in Rules), but
it's a relatively expensive test and perhaps better done in
optCoercion.  Not a big deal either way.
-}</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">-- | Extract a covar, if possible. This check is dirty. Be ashamed</span><span>
</span><a name="line-684"></a><span class="hs-comment">-- of yourself. (It's dirty because it cares about the structure of</span><span>
</span><a name="line-685"></a><span class="hs-comment">-- a coercion, which is morally reprehensible.)</span><span>
</span><a name="line-686"></a><span class="hs-identifier">isCoVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-687"></a><a name="isCoVar_maybe"><a href="Coercion.html#isCoVar_maybe"><span class="hs-identifier">isCoVar_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679407253"><a href="#local-6989586621679407253"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407253"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-688"></a><span class="hs-identifier">isCoVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-689"></a><span>
</span><a name="line-690"></a><span class="hs-identifier">mkAxInstCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407081"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-691"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-692"></a><span class="hs-comment">-- mkAxInstCo can legitimately be called over-staturated;</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- i.e. with more type arguments than the coercion requires</span><span>
</span><a name="line-694"></a><a name="mkAxInstCo"><a href="Coercion.html#mkAxInstCo"><span class="hs-identifier">mkAxInstCo</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407255"><a href="#local-6989586621679407255"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407256"><a href="#local-6989586621679407256"><span class="hs-identifier">index</span></a></a><span> </span><a name="local-6989586621679407257"><a href="#local-6989586621679407257"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679407258"><a href="#local-6989586621679407258"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-695"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407263"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679407259"><span class="hs-identifier hs-var">n_tys</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407268"><span class="hs-identifier hs-var">ax_role</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-696"></a><span>                     </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span> </span><a href="#local-6989586621679407260"><span class="hs-identifier hs-var">ax_br</span></a><span> </span><a href="#local-6989586621679407256"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407265"><span class="hs-identifier hs-var">rtys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#chkAppend"><span class="hs-identifier hs-var">chkAppend</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407258"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-697"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">arity</span><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">n_tys</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-698"></a><span>                     </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407268"><span class="hs-identifier hs-var">ax_role</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-699"></a><span>                     </span><a href="Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span> </span><a href="#local-6989586621679407260"><span class="hs-identifier hs-var">ax_br</span></a><span> </span><a href="#local-6989586621679407256"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-700"></a><span>                                             </span><span class="hs-special">(</span><a href="#local-6989586621679407266"><span class="hs-identifier hs-var">ax_args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#chkAppend"><span class="hs-identifier hs-var">chkAppend</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407258"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-701"></a><span>                              </span><a href="#local-6989586621679407267"><span class="hs-identifier hs-var">leftover_args</span></a><span>
</span><a name="line-702"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-703"></a><span>    </span><a name="local-6989586621679407259"><a href="#local-6989586621679407259"><span class="hs-identifier">n_tys</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679407257"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-704"></a><span>    </span><a name="local-6989586621679407260"><a href="#local-6989586621679407260"><span class="hs-identifier">ax_br</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#toBranchedAxiom"><span class="hs-identifier hs-var">toBranchedAxiom</span></a><span> </span><a href="#local-6989586621679407255"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-705"></a><span>    </span><a name="local-6989586621679407261"><a href="#local-6989586621679407261"><span class="hs-identifier">branch</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621679407260"><span class="hs-identifier hs-var">ax_br</span></a><span> </span><a href="#local-6989586621679407256"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-706"></a><span>    </span><a name="local-6989586621679407262"><a href="#local-6989586621679407262"><span class="hs-identifier">tvs</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a><span> </span><a href="#local-6989586621679407261"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-707"></a><span>    </span><a name="local-6989586621679407263"><a href="#local-6989586621679407263"><span class="hs-identifier">arity</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679407262"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-708"></a><span>    </span><a name="local-6989586621679407264"><a href="#local-6989586621679407264"><span class="hs-identifier">arg_roles</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchRoles"><span class="hs-identifier hs-var">coAxBranchRoles</span></a><span> </span><a href="#local-6989586621679407261"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-709"></a><span>    </span><a name="local-6989586621679407265"><a href="#local-6989586621679407265"><span class="hs-identifier">rtys</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407264"><span class="hs-identifier hs-var">arg_roles</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407257"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-710"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407266"><a href="#local-6989586621679407266"><span class="hs-identifier">ax_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407267"><a href="#local-6989586621679407267"><span class="hs-identifier">leftover_args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><a href="#local-6989586621679407263"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621679407265"><span class="hs-identifier hs-var">rtys</span></a><span>
</span><a name="line-712"></a><span>    </span><a name="local-6989586621679407268"><a href="#local-6989586621679407268"><span class="hs-identifier">ax_role</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomRole"><span class="hs-identifier hs-var">coAxiomRole</span></a><span> </span><a href="#local-6989586621679407255"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span class="hs-comment">-- worker function; just checks to see if it should produce Refl</span><span>
</span><a name="line-715"></a><span class="hs-identifier">mkAxiomInstCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Branched"><span class="hs-identifier hs-type">Branched</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-716"></a><a name="mkAxiomInstCo"><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier">mkAxiomInstCo</span></a></a><span> </span><a name="local-6989586621679407269"><a href="#local-6989586621679407269"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407270"><a href="#local-6989586621679407270"><span class="hs-identifier">index</span></a></a><span> </span><a name="local-6989586621679407271"><a href="#local-6989586621679407271"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-717"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coAxiomArity</span><span> </span><span class="hs-identifier">ax</span><span> </span><a href="CoAxiom.html#coAxiomArity"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-718"></a><span>    </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a href="#local-6989586621679407269"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621679407270"><span class="hs-identifier hs-var">index</span></a><span> </span><a href="#local-6989586621679407271"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span class="hs-comment">-- to be used only with unbranched axioms</span><span>
</span><a name="line-721"></a><span class="hs-identifier">mkUnbranchedAxInstCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a><span>
</span><a name="line-722"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-723"></a><a name="mkUnbranchedAxInstCo"><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier">mkUnbranchedAxInstCo</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407273"><a href="#local-6989586621679407273"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407274"><a href="#local-6989586621679407274"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679407275"><a href="#local-6989586621679407275"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-724"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var">mkAxInstCo</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407273"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679407274"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621679407275"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-725"></a><span>
</span><a name="line-726"></a><span class="hs-identifier">mkAxInstRHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407080"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-727"></a><span class="hs-comment">-- Instantiate the axiom with specified types,</span><span>
</span><a name="line-728"></a><span class="hs-comment">-- returning the instantiated RHS</span><span>
</span><a name="line-729"></a><span class="hs-comment">-- A companion to mkAxInstCo:</span><span>
</span><a name="line-730"></a><span class="hs-comment">--    mkAxInstRhs ax index tys = snd (coercionKind (mkAxInstCo ax index tys))</span><span>
</span><a name="line-731"></a><a name="mkAxInstRHS"><a href="Coercion.html#mkAxInstRHS"><span class="hs-identifier">mkAxInstRHS</span></a></a><span> </span><a name="local-6989586621679407276"><a href="#local-6989586621679407276"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407277"><a href="#local-6989586621679407277"><span class="hs-identifier">index</span></a></a><span> </span><a name="local-6989586621679407278"><a href="#local-6989586621679407278"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679407279"><a href="#local-6989586621679407279"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-732"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">tys1</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-733"></a><span>    </span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><a href="#local-6989586621679407285"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><a href="#local-6989586621679407284"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-734"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-735"></a><span>    </span><a name="local-6989586621679407280"><a href="#local-6989586621679407280"><span class="hs-identifier">branch</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621679407276"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621679407277"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-736"></a><span>    </span><a name="local-6989586621679407281"><a href="#local-6989586621679407281"><span class="hs-identifier">tvs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a><span> </span><a href="#local-6989586621679407280"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-737"></a><span>    </span><a name="local-6989586621679407282"><a href="#local-6989586621679407282"><span class="hs-identifier">cvs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a><span> </span><a href="#local-6989586621679407280"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-738"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407283"><a href="#local-6989586621679407283"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407284"><a href="#local-6989586621679407284"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621679407281"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407278"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-739"></a><span>    </span><a name="local-6989586621679407285"><a href="#local-6989586621679407285"><span class="hs-identifier">rhs'</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><a href="#local-6989586621679407281"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407283"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-740"></a><span>                   </span><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a><span> </span><a href="#local-6989586621679407282"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-6989586621679407279"><span class="hs-identifier hs-var">cos</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-741"></a><span>                   </span><a href="CoAxiom.html#coAxBranchRHS"><span class="hs-identifier hs-var">coAxBranchRHS</span></a><span> </span><a href="#local-6989586621679407280"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span class="hs-identifier">mkUnbranchedAxInstRHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-744"></a><a name="mkUnbranchedAxInstRHS"><a href="Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier">mkUnbranchedAxInstRHS</span></a></a><span> </span><a name="local-6989586621679407286"><a href="#local-6989586621679407286"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var">mkAxInstRHS</span></a><span> </span><a href="#local-6989586621679407286"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span class="hs-comment">-- | Return the left-hand type of the axiom, when the axiom is instantiated</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- at the types given.</span><span>
</span><a name="line-748"></a><span class="hs-identifier">mkAxInstLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621679407079"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-749"></a><a name="mkAxInstLHS"><a href="Coercion.html#mkAxInstLHS"><span class="hs-identifier">mkAxInstLHS</span></a></a><span> </span><a name="local-6989586621679407287"><a href="#local-6989586621679407287"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407288"><a href="#local-6989586621679407288"><span class="hs-identifier">index</span></a></a><span> </span><a name="local-6989586621679407289"><a href="#local-6989586621679407289"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679407290"><a href="#local-6989586621679407290"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-750"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">tys1</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-751"></a><span>    </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621679407297"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407296"><span class="hs-identifier hs-var">lhs_tys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#chkAppend"><span class="hs-identifier hs-var">chkAppend</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407295"><span class="hs-identifier hs-var">tys2</span></a><span class="hs-special">)</span><span>
</span><a name="line-752"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-753"></a><span>    </span><a name="local-6989586621679407291"><a href="#local-6989586621679407291"><span class="hs-identifier">branch</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621679407287"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621679407288"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-754"></a><span>    </span><a name="local-6989586621679407292"><a href="#local-6989586621679407292"><span class="hs-identifier">tvs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a><span> </span><a href="#local-6989586621679407291"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-755"></a><span>    </span><a name="local-6989586621679407293"><a href="#local-6989586621679407293"><span class="hs-identifier">cvs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a><span> </span><a href="#local-6989586621679407291"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-756"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407294"><a href="#local-6989586621679407294"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407295"><a href="#local-6989586621679407295"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621679407292"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407289"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-757"></a><span>    </span><a name="local-6989586621679407296"><a href="#local-6989586621679407296"><span class="hs-identifier">lhs_tys</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTysWith"><span class="hs-identifier hs-var">substTysWith</span></a><span> </span><a href="#local-6989586621679407292"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407294"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-758"></a><span>                   </span><a href="TyCoRep.html#substTysWithCoVars"><span class="hs-identifier hs-var">substTysWithCoVars</span></a><span> </span><a href="#local-6989586621679407293"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-6989586621679407290"><span class="hs-identifier hs-var">cos</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-759"></a><span>                   </span><a href="CoAxiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a><span> </span><a href="#local-6989586621679407291"><span class="hs-identifier hs-var">branch</span></a><span>
</span><a name="line-760"></a><span>    </span><a name="local-6989586621679407297"><a href="#local-6989586621679407297"><span class="hs-identifier">fam_tc</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a><span> </span><a href="#local-6989586621679407287"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-comment">-- | Instantiate the left-hand side of an unbranched axiom</span><span>
</span><a name="line-763"></a><span class="hs-identifier">mkUnbranchedAxInstLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-764"></a><a name="mkUnbranchedAxInstLHS"><a href="Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier">mkUnbranchedAxInstLHS</span></a></a><span> </span><a name="local-6989586621679407298"><a href="#local-6989586621679407298"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var">mkAxInstLHS</span></a><span> </span><a href="#local-6989586621679407298"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-comment">-- | Manufacture an unsafe coercion from thin air.</span><span>
</span><a name="line-767"></a><span class="hs-comment">--   Currently (May 14) this is used only to implement the</span><span>
</span><a name="line-768"></a><span class="hs-comment">--   @unsafeCoerce#@ primitive.  Optimise by pushing</span><span>
</span><a name="line-769"></a><span class="hs-comment">--   down through type constructors.</span><span>
</span><a name="line-770"></a><span class="hs-identifier">mkUnsafeCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-771"></a><a name="mkUnsafeCo"><a href="Coercion.html#mkUnsafeCo"><span class="hs-identifier">mkUnsafeCo</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407300"><a href="#local-6989586621679407300"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407301"><a href="#local-6989586621679407301"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407300"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407301"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-comment">-- | Make a coercion from a coercion hole</span><span>
</span><a name="line-775"></a><span class="hs-identifier">mkHoleCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-776"></a><a name="mkHoleCo"><a href="Coercion.html#mkHoleCo"><span class="hs-identifier">mkHoleCo</span></a></a><span> </span><a name="local-6989586621679407302"><a href="#local-6989586621679407302"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a href="#local-6989586621679407302"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-comment">-- | Make a universal coercion between two arbitrary types.</span><span>
</span><a name="line-779"></a><span class="hs-identifier">mkUnivCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a><span>
</span><a name="line-780"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>       </span><span class="hs-comment">-- ^ role of the built coercion, &quot;r&quot;</span><span>
</span><a name="line-781"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>       </span><span class="hs-comment">-- ^ t1 :: k1</span><span>
</span><a name="line-782"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>       </span><span class="hs-comment">-- ^ t2 :: k2</span><span>
</span><a name="line-783"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ :: t1 ~r t2</span><span>
</span><a name="line-784"></a><a name="mkUnivCo"><a href="Coercion.html#mkUnivCo"><span class="hs-identifier">mkUnivCo</span></a></a><span> </span><a name="local-6989586621679407303"><a href="#local-6989586621679407303"><span class="hs-identifier">prov</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407305"><a href="#local-6989586621679407305"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407306"><a href="#local-6989586621679407306"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-785"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407305"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407306"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407305"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="#local-6989586621679407303"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407305"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407306"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-comment">-- | Create a symmetric version of the given 'Coercion' that asserts</span><span>
</span><a name="line-789"></a><span class="hs-comment">--   equality between the same types but in the other &quot;direction&quot;, so</span><span>
</span><a name="line-790"></a><span class="hs-comment">--   a kind of @t1 ~ t2@ becomes the kind @t2 ~ t1@.</span><span>
</span><a name="line-791"></a><span class="hs-identifier">mkSymCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-comment">-- Do a few simple optimizations, but don't bother pushing occurrences</span><span>
</span><a name="line-794"></a><span class="hs-comment">-- of symmetry to the leaves; the optimizer will take care of that.</span><span>
</span><a name="line-795"></a><a name="mkSymCo"><a href="Coercion.html#mkSymCo"><span class="hs-identifier">mkSymCo</span></a></a><span> </span><a name="local-6989586621679407307"><a href="#local-6989586621679407307"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407307"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-796"></a><span class="hs-identifier">mkSymCo</span><span>    </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407308"><a href="#local-6989586621679407308"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407308"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-797"></a><span class="hs-identifier">mkSymCo</span><span>    </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407309"><a href="#local-6989586621679407309"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a href="#local-6989586621679407309"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-798"></a><span class="hs-identifier">mkSymCo</span><span> </span><a name="local-6989586621679407310"><a href="#local-6989586621679407310"><span class="hs-identifier">co</span></a></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a href="#local-6989586621679407310"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span class="hs-comment">-- | Create a new 'Coercion' by composing the two given 'Coercion's transitively.</span><span>
</span><a name="line-801"></a><span class="hs-comment">--   (co1 ; co2)</span><span>
</span><a name="line-802"></a><span class="hs-identifier">mkTransCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-803"></a><a name="mkTransCo"><a href="Coercion.html#mkTransCo"><span class="hs-identifier">mkTransCo</span></a></a><span> </span><a name="local-6989586621679407311"><a href="#local-6989586621679407311"><span class="hs-identifier">co1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407311"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-804"></a><span class="hs-identifier">mkTransCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679407312"><a href="#local-6989586621679407312"><span class="hs-identifier">co2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407312"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-805"></a><span class="hs-identifier">mkTransCo</span><span> </span><a name="local-6989586621679407313"><a href="#local-6989586621679407313"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407314"><a href="#local-6989586621679407314"><span class="hs-identifier">co2</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a href="#local-6989586621679407313"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407314"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span class="hs-comment">-- the Role is the desired one. It is the caller's responsibility to make</span><span>
</span><a name="line-808"></a><span class="hs-comment">-- sure this request is reasonable</span><span>
</span><a name="line-809"></a><span class="hs-identifier">mkNthCoRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-810"></a><a name="mkNthCoRole"><a href="Coercion.html#mkNthCoRole"><span class="hs-identifier">mkNthCoRole</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407316"><a href="#local-6989586621679407316"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407317"><a href="#local-6989586621679407317"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-811"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407319"><span class="hs-identifier hs-var">nth_role</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679407318"><span class="hs-identifier hs-var">nth_co</span></a><span>
</span><a name="line-812"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-813"></a><span>    </span><a name="local-6989586621679407318"><a href="#local-6989586621679407318"><span class="hs-identifier">nth_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><a href="#local-6989586621679407316"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679407317"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-814"></a><span>    </span><a name="local-6989586621679407319"><a href="#local-6989586621679407319"><span class="hs-identifier">nth_role</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a><span> </span><a href="#local-6989586621679407318"><span class="hs-identifier hs-var">nth_co</span></a><span>
</span><a name="line-815"></a><span>
</span><a name="line-816"></a><span class="hs-identifier">mkNthCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-817"></a><a name="mkNthCo"><a href="Coercion.html#mkNthCo"><span class="hs-identifier">mkNthCo</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407320"><a href="#local-6989586621679407320"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407321"><a href="#local-6989586621679407321"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621679407320"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-819"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679407321"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span class="hs-identifier">mkNthCo</span><span> </span><a name="local-6989586621679407322"><a href="#local-6989586621679407322"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407323"><a href="#local-6989586621679407323"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407324"><a href="#local-6989586621679407324"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ok_tc_app</span><span> </span><span class="hs-identifier">ty</span><span> </span><a href="#local-6989586621679407327"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407327"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407327"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>    </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-6989586621679407326"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#tyConAppArgN"><span class="hs-identifier hs-var">tyConAppArgN</span></a><span> </span><a href="#local-6989586621679407322"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679407324"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679407325"><a href="#local-6989586621679407325"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a><span> </span><a href="#local-6989586621679407324"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-824"></a><span>        </span><a name="local-6989586621679407326"><a href="#local-6989586621679407326"><span class="hs-identifier">r'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a><span> </span><a href="#local-6989586621679407323"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407325"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407322"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span>        </span><span class="hs-identifier">ok_tc_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-827"></a><span>        </span><a name="local-6989586621679407327"><a href="#local-6989586621679407327"><span class="hs-identifier">ok_tc_app</span></a></a><span> </span><a name="local-6989586621679407328"><a href="#local-6989586621679407328"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679407329"><a href="#local-6989586621679407329"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-828"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679407330"><a href="#local-6989586621679407330"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407328"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-829"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407330"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407329"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-830"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621679407328"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- nth:0 pulls out a kind coercion from a hetero forall</span><span>
</span><a name="line-831"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407329"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-832"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-833"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-834"></a><span>
</span><a name="line-835"></a><span class="hs-identifier">mkNthCo</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407331"><a href="#local-6989586621679407331"><span class="hs-identifier">kind_co</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407331"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-836"></a><span>  </span><span class="hs-comment">-- If co :: (forall a1:k1. t1) ~ (forall a2:k2. t2)</span><span>
</span><a name="line-837"></a><span>  </span><span class="hs-comment">-- then (nth 0 co :: k1 ~ k2)</span><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span class="hs-identifier">mkNthCo</span><span> </span><a name="local-6989586621679407332"><a href="#local-6989586621679407332"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407333"><a href="#local-6989586621679407333"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407334"><a href="#local-6989586621679407334"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679407335"><a href="#local-6989586621679407335"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-840"></a><span>  </span><span class="hs-comment">-- See Note [Function coercions]</span><span>
</span><a name="line-841"></a><span>  </span><span class="hs-comment">-- If FunCo _ arg_co res_co ::   (s1:TYPE sk1 -&gt; s2:TYPE sk2)</span><span>
</span><a name="line-842"></a><span>  </span><span class="hs-comment">--                             ~ (t1:TYPE tk1 -&gt; t2:TYPE tk2)</span><span>
</span><a name="line-843"></a><span>  </span><span class="hs-comment">-- Then we want to behave as if co was</span><span>
</span><a name="line-844"></a><span>  </span><span class="hs-comment">--    TyConAppCo argk_co resk_co arg_co res_co</span><span>
</span><a name="line-845"></a><span>  </span><span class="hs-comment">-- where</span><span>
</span><a name="line-846"></a><span>  </span><span class="hs-comment">--    argk_co :: sk1 ~ tk1  =  mkNthCo 0 (mkKindCo arg_co)</span><span>
</span><a name="line-847"></a><span>  </span><span class="hs-comment">--    resk_co :: sk2 ~ tk2  =  mkNthCo 0 (mkKindCo res_co)</span><span>
</span><a name="line-848"></a><span>  </span><span class="hs-comment">--                             i.e. mkRuntimeRepCo</span><span>
</span><a name="line-849"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407332"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-850"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a><span> </span><a href="#local-6989586621679407334"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-851"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a><span> </span><a href="#local-6989586621679407335"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-852"></a><span>      </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407334"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-853"></a><span>      </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407335"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-854"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;mkNthCo(FunCo)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407332"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407333"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-855"></a><span>
</span><a name="line-856"></a><span class="hs-identifier">mkNthCo</span><span> </span><a name="local-6989586621679407336"><a href="#local-6989586621679407336"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407337"><a href="#local-6989586621679407337"><span class="hs-identifier">arg_cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407337"><span class="hs-identifier hs-var">arg_cos</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407336"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span class="hs-identifier">mkNthCo</span><span> </span><a name="local-6989586621679407338"><a href="#local-6989586621679407338"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407339"><a href="#local-6989586621679407339"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a href="#local-6989586621679407338"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679407339"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-859"></a><span>
</span><a name="line-860"></a><span class="hs-identifier">mkLRCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-861"></a><a name="mkLRCo"><a href="Coercion.html#mkLRCo"><span class="hs-identifier">mkLRCo</span></a></a><span> </span><a name="local-6989586621679407340"><a href="#local-6989586621679407340"><span class="hs-identifier">lr</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407341"><a href="#local-6989586621679407341"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621679407342"><a href="#local-6989586621679407342"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407341"><span class="hs-identifier hs-var">eq</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a><span> </span><a href="#local-6989586621679407340"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a><span> </span><a href="#local-6989586621679407342"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span class="hs-identifier">mkLRCo</span><span> </span><a name="local-6989586621679407343"><a href="#local-6989586621679407343"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679407344"><a href="#local-6989586621679407344"><span class="hs-identifier">co</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a href="#local-6989586621679407343"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="#local-6989586621679407344"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><span class="hs-comment">-- | Instantiates a 'Coercion'.</span><span>
</span><a name="line-865"></a><span class="hs-identifier">mkInstCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-866"></a><a name="mkInstCo"><a href="Coercion.html#mkInstCo"><span class="hs-identifier">mkInstCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407345"><a href="#local-6989586621679407345"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407346"><a href="#local-6989586621679407346"><span class="hs-identifier">_kind_co</span></a></a><span> </span><a name="local-6989586621679407347"><a href="#local-6989586621679407347"><span class="hs-identifier">body_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407348"><a href="#local-6989586621679407348"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCoWithUnchecked"><span class="hs-identifier hs-var">substCoWithUnchecked</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407345"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407348"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679407347"><span class="hs-identifier hs-var">body_co</span></a><span>
</span><a name="line-868"></a><span class="hs-identifier">mkInstCo</span><span> </span><a name="local-6989586621679407349"><a href="#local-6989586621679407349"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407350"><a href="#local-6989586621679407350"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a href="#local-6989586621679407349"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679407350"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-comment">-- This could work harder to produce Refl coercions, but that would be</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- quite inefficient. Seems better not to try.</span><span>
</span><a name="line-872"></a><span class="hs-identifier">mkCoherenceCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-873"></a><a name="mkCoherenceCo"><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier">mkCoherenceCo</span></a></a><span> </span><a name="local-6989586621679407351"><a href="#local-6989586621679407351"><span class="hs-identifier">co1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407351"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-874"></a><span class="hs-identifier">mkCoherenceCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407352"><a href="#local-6989586621679407352"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407353"><a href="#local-6989586621679407353"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407354"><a href="#local-6989586621679407354"><span class="hs-identifier">co3</span></a></a><span>
</span><a name="line-875"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a href="#local-6989586621679407352"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407353"><span class="hs-identifier hs-var">co2</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407354"><span class="hs-identifier hs-var">co3</span></a><span class="hs-special">)</span><span>
</span><a name="line-876"></a><span class="hs-identifier">mkCoherenceCo</span><span> </span><a name="local-6989586621679407355"><a href="#local-6989586621679407355"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407356"><a href="#local-6989586621679407356"><span class="hs-identifier">co2</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a href="#local-6989586621679407355"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407356"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-877"></a><span>
</span><a name="line-878"></a><span class="hs-comment">-- | A CoherenceCo c1 c2 applies the coercion c2 to the left-hand type</span><span>
</span><a name="line-879"></a><span class="hs-comment">-- in the kind of c1. This function uses sym to get the coercion on the</span><span>
</span><a name="line-880"></a><span class="hs-comment">-- right-hand type of c1. Thus, if c1 :: s ~ t, then mkCoherenceRightCo c1 c2</span><span>
</span><a name="line-881"></a><span class="hs-comment">-- has the kind (s ~ (t |&gt; c2)) down through type constructors.</span><span>
</span><a name="line-882"></a><span class="hs-comment">-- The second coercion must be representational.</span><span>
</span><a name="line-883"></a><span class="hs-identifier">mkCoherenceRightCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-884"></a><a name="mkCoherenceRightCo"><a href="Coercion.html#mkCoherenceRightCo"><span class="hs-identifier">mkCoherenceRightCo</span></a></a><span> </span><a name="local-6989586621679407357"><a href="#local-6989586621679407357"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679407358"><a href="#local-6989586621679407358"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier hs-var">mkCoherenceCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621679407357"><span class="hs-identifier hs-var">c1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407358"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span class="hs-comment">-- | An explicitly directed synonym of mkCoherenceCo. The second</span><span>
</span><a name="line-887"></a><span class="hs-comment">-- coercion must be representational.</span><span>
</span><a name="line-888"></a><span class="hs-identifier">mkCoherenceLeftCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-889"></a><a name="mkCoherenceLeftCo"><a href="Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier">mkCoherenceLeftCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier hs-var">mkCoherenceCo</span></a><span>
</span><a name="line-890"></a><span>
</span><a name="line-891"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mkCoherenceCo</span><span class="hs-special">`</span><span>
</span><a name="line-892"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mkCoherenceRightCo</span><span class="hs-special">`</span><span>
</span><a name="line-893"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mkCoherenceLeftCo</span><span class="hs-special">`</span><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span class="hs-comment">-- | Given @co :: (a :: k) ~ (b :: k')@ produce @co' :: k ~ k'@.</span><span>
</span><a name="line-896"></a><span class="hs-identifier">mkKindCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-897"></a><a name="mkKindCo"><a href="Coercion.html#mkKindCo"><span class="hs-identifier">mkKindCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407359"><a href="#local-6989586621679407359"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407359"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-898"></a><span class="hs-identifier">mkKindCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621679407360"><a href="#local-6989586621679407360"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407360"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-899"></a><span class="hs-identifier">mkKindCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621679407361"><a href="#local-6989586621679407361"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407361"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-900"></a><span class="hs-identifier">mkKindCo</span><span> </span><a name="local-6989586621679407362"><a href="#local-6989586621679407362"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-901"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407363"><a href="#local-6989586621679407363"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407364"><a href="#local-6989586621679407364"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407362"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-902"></a><span>       </span><span class="hs-comment">-- generally, calling coercionKind during coercion creation is a bad idea,</span><span>
</span><a name="line-903"></a><span>       </span><span class="hs-comment">-- as it can lead to exponential behavior. But, we don't have nested mkKindCos,</span><span>
</span><a name="line-904"></a><span>       </span><span class="hs-comment">-- so it's OK here.</span><span>
</span><a name="line-905"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407365"><a href="#local-6989586621679407365"><span class="hs-identifier">tk1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407363"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-906"></a><span>        </span><a name="local-6989586621679407366"><a href="#local-6989586621679407366"><span class="hs-identifier">tk2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407364"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-907"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407365"><span class="hs-identifier hs-var">tk1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407366"><span class="hs-identifier hs-var">tk2</span></a><span>
</span><a name="line-908"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407365"><span class="hs-identifier hs-var">tk1</span></a><span>
</span><a name="line-909"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-910"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a href="#local-6989586621679407362"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-911"></a><span>
</span><a name="line-912"></a><span class="hs-comment">-- input coercion is Nominal; see also Note [Role twiddling functions]</span><span>
</span><a name="line-913"></a><span class="hs-identifier">mkSubCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-914"></a><a name="mkSubCo"><a href="Coercion.html#mkSubCo"><span class="hs-identifier">mkSubCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a name="local-6989586621679407367"><a href="#local-6989586621679407367"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407367"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-915"></a><span class="hs-identifier">mkSubCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a name="local-6989586621679407368"><a href="#local-6989586621679407368"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407369"><a href="#local-6989586621679407369"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-916"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407368"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#applyRoles"><span class="hs-identifier hs-var">applyRoles</span></a><span> </span><a href="#local-6989586621679407368"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407369"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span class="hs-identifier">mkSubCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a name="local-6989586621679407370"><a href="#local-6989586621679407370"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679407371"><a href="#local-6989586621679407371"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-918"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span>
</span><a name="line-919"></a><span>          </span><span class="hs-special">(</span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407370"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-920"></a><span>          </span><span class="hs-special">(</span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407371"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-921"></a><span class="hs-identifier">mkSubCo</span><span> </span><a name="local-6989586621679407372"><a href="#local-6989586621679407372"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">coercionRole</span><span> </span><a href="Coercion.html#coercionRole"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="Coercion.html#coercionRole"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-identifier">Nominal</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">coercionRole</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-922"></a><span>             </span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a href="#local-6989586621679407372"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span class="hs-comment">-- | Changes a role, but only a downgrade. See Note [Role twiddling functions]</span><span>
</span><a name="line-925"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>   </span><span class="hs-comment">-- ^ desired role</span><span>
</span><a name="line-926"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>   </span><span class="hs-comment">-- ^ current role</span><span>
</span><a name="line-927"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-928"></a><span class="hs-comment">-- In (downgradeRole_maybe dr cr co) it's a precondition that</span><span>
</span><a name="line-929"></a><span class="hs-comment">--                                   cr = coercionRole co</span><span>
</span><a name="line-930"></a><a name="downgradeRole_maybe"><a href="Coercion.html#downgradeRole_maybe"><span class="hs-identifier">downgradeRole_maybe</span></a></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a name="local-6989586621679407373"><a href="#local-6989586621679407373"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><a href="#local-6989586621679407373"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-932"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><a name="local-6989586621679407374"><a href="#local-6989586621679407374"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407374"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-933"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><span class="hs-identifier">_</span><span>                </span><a name="local-6989586621679407375"><a href="#local-6989586621679407375"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a><span> </span><a href="#local-6989586621679407375"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>                </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-935"></a><span class="hs-identifier">downgradeRole_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                      </span><a name="local-6989586621679407376"><a href="#local-6989586621679407376"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407376"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span class="hs-comment">-- | Like 'downgradeRole_maybe', but panics if the change isn't a downgrade.</span><span>
</span><a name="line-938"></a><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><a name="line-939"></a><span class="hs-identifier">downgradeRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>  </span><span class="hs-comment">-- desired role</span><span>
</span><a name="line-940"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>  </span><span class="hs-comment">-- current role</span><span>
</span><a name="line-941"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-942"></a><a name="downgradeRole"><a href="Coercion.html#downgradeRole"><span class="hs-identifier">downgradeRole</span></a></a><span> </span><a name="local-6989586621679407377"><a href="#local-6989586621679407377"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679407378"><a href="#local-6989586621679407378"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679407379"><a href="#local-6989586621679407379"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-943"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a><span> </span><a href="#local-6989586621679407377"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679407378"><span class="hs-identifier hs-var">r2</span></a><span> </span><a href="#local-6989586621679407379"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-944"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407380"><a href="#local-6989586621679407380"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407380"><span class="hs-identifier hs-var">co'</span></a><span>
</span><a name="line-945"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;downgradeRole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407379"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-comment">-- | If the EqRel is ReprEq, makes a SubCo; otherwise, does nothing.</span><span>
</span><a name="line-948"></a><span class="hs-comment">-- Note that the input coercion should always be nominal.</span><span>
</span><a name="line-949"></a><span class="hs-identifier">maybeSubCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-950"></a><a name="maybeSubCo"><a href="Coercion.html#maybeSubCo"><span class="hs-identifier">maybeSubCo</span></a></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-951"></a><span class="hs-identifier">maybeSubCo</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span>
</span><a name="line-952"></a><span>
</span><a name="line-953"></a><span>
</span><a name="line-954"></a><span class="hs-identifier">mkAxiomRuleCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiomRule"><span class="hs-identifier hs-type">CoAxiomRule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-955"></a><a name="mkAxiomRuleCo"><a href="Coercion.html#mkAxiomRuleCo"><span class="hs-identifier">mkAxiomRuleCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span class="hs-comment">-- | Make a &quot;coercion between coercions&quot;.</span><span>
</span><a name="line-958"></a><span class="hs-identifier">mkProofIrrelCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>       </span><span class="hs-comment">-- ^ role of the created coercion, &quot;r&quot;</span><span>
</span><a name="line-959"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ :: phi1 ~N phi2</span><span>
</span><a name="line-960"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ g1 :: phi1</span><span>
</span><a name="line-961"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ g2 :: phi2</span><span>
</span><a name="line-962"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ :: g1 ~r g2</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-comment">-- if the two coercion prove the same fact, I just don't care what</span><span>
</span><a name="line-965"></a><span class="hs-comment">-- the individual coercions are.</span><span>
</span><a name="line-966"></a><a name="mkProofIrrelCo"><a href="Coercion.html#mkProofIrrelCo"><span class="hs-identifier">mkProofIrrelCo</span></a></a><span> </span><a name="local-6989586621679407381"><a href="#local-6989586621679407381"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679407382"><a href="#local-6989586621679407382"><span class="hs-identifier">g</span></a></a><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407381"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a href="#local-6989586621679407382"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-967"></a><span class="hs-identifier">mkProofIrrelCo</span><span> </span><a name="local-6989586621679407383"><a href="#local-6989586621679407383"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407384"><a href="#local-6989586621679407384"><span class="hs-identifier">kco</span></a></a><span>       </span><a name="local-6989586621679407385"><a href="#local-6989586621679407385"><span class="hs-identifier">g1</span></a></a><span> </span><a name="local-6989586621679407386"><a href="#local-6989586621679407386"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a href="#local-6989586621679407384"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407383"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-968"></a><span>                                     </span><span class="hs-special">(</span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-6989586621679407385"><span class="hs-identifier hs-var">g1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-6989586621679407386"><span class="hs-identifier hs-var">g2</span></a><span class="hs-special">)</span><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
   Roles
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><span class="hs-comment">-- | Converts a coercion to be nominal, if possible.</span><span>
</span><a name="line-979"></a><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><a name="line-980"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-981"></a><a name="setNominalRole_maybe"><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier">setNominalRole_maybe</span></a></a><span> </span><a name="local-6989586621679407387"><a href="#local-6989586621679407387"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-982"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a><span> </span><a href="#local-6989586621679407387"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407387"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-983"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679407388"><a href="#local-6989586621679407388"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679407388"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-984"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407389"><a href="#local-6989586621679407389"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407389"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-985"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a name="local-6989586621679407390"><a href="#local-6989586621679407390"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407391"><a href="#local-6989586621679407391"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679407392"><a href="#local-6989586621679407392"><span class="hs-identifier">cos'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407391"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-987"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407390"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407392"><span class="hs-identifier hs-var">cos'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-988"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a name="local-6989586621679407393"><a href="#local-6989586621679407393"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407394"><a href="#local-6989586621679407394"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-989"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679407395"><a href="#local-6989586621679407395"><span class="hs-identifier">co1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407393"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-990"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679407396"><a href="#local-6989586621679407396"><span class="hs-identifier">co2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407394"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-991"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407395"><span class="hs-identifier hs-var">co1'</span></a><span> </span><a href="#local-6989586621679407396"><span class="hs-identifier hs-var">co2'</span></a><span>
</span><a name="line-992"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-993"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407397"><a href="#local-6989586621679407397"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-994"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407397"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-995"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679407398"><a href="#local-6989586621679407398"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407399"><a href="#local-6989586621679407399"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-996"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407398"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407399"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-997"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407400"><a href="#local-6989586621679407400"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407401"><a href="#local-6989586621679407401"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-998"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407400"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><a href="#local-6989586621679407401"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-999"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407402"><a href="#local-6989586621679407402"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407403"><a href="#local-6989586621679407403"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621679407404"><a href="#local-6989586621679407404"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a href="#local-6989586621679407402"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679407403"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407404"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1001"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621679407405"><a href="#local-6989586621679407405"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407406"><a href="#local-6989586621679407406"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a href="#local-6989586621679407405"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407406"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1003"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407407"><a href="#local-6989586621679407407"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407408"><a href="#local-6989586621679407408"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407407"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><a href="#local-6989586621679407408"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1005"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407409"><a href="#local-6989586621679407409"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407410"><a href="#local-6989586621679407410"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407409"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><a href="#local-6989586621679407410"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621679407411"><a href="#local-6989586621679407411"><span class="hs-identifier">prov</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407412"><a href="#local-6989586621679407412"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407413"><a href="#local-6989586621679407413"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407411"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-keyword">of</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- it's always unsafe</span><span>
</span><a name="line-1009"></a><span>                 </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- should always be phantom</span><span>
</span><a name="line-1010"></a><span>                 </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- it's always safe</span><span>
</span><a name="line-1011"></a><span>                 </span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- who knows? This choice is conservative.</span><span>
</span><a name="line-1012"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="#local-6989586621679407411"><span class="hs-identifier hs-var">prov</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407412"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679407413"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1013"></a><span class="hs-identifier">setNominalRole_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1014"></a><span>
</span><a name="line-1015"></a><span class="hs-comment">-- | Make a phantom coercion between two types. The coercion passed</span><span>
</span><a name="line-1016"></a><span class="hs-comment">-- in must be a nominal coercion between the kinds of the</span><span>
</span><a name="line-1017"></a><span class="hs-comment">-- types.</span><span>
</span><a name="line-1018"></a><span class="hs-identifier">mkPhantomCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1019"></a><a name="mkPhantomCo"><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier">mkPhantomCo</span></a></a><span> </span><a name="local-6989586621679407414"><a href="#local-6989586621679407414"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679407415"><a href="#local-6989586621679407415"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679407416"><a href="#local-6989586621679407416"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-1020"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a href="#local-6989586621679407414"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><a href="#local-6989586621679407415"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679407416"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span class="hs-comment">-- | Make a phantom coercion between two types of the same kind.</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">mkHomoPhantomCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1024"></a><a name="mkHomoPhantomCo"><a href="Coercion.html#mkHomoPhantomCo"><span class="hs-identifier">mkHomoPhantomCo</span></a></a><span> </span><a name="local-6989586621679407417"><a href="#local-6989586621679407417"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679407418"><a href="#local-6989586621679407418"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-1025"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeKind</span><span> </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1026"></a><span>    </span><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621679407419"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407417"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679407418"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1027"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1028"></a><span>    </span><a name="local-6989586621679407419"><a href="#local-6989586621679407419"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407417"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1029"></a><span>
</span><a name="line-1030"></a><span class="hs-comment">-- takes any coercion and turns it into a Phantom coercion</span><span>
</span><a name="line-1031"></a><span class="hs-identifier">toPhantomCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1032"></a><a name="toPhantomCo"><a href="Coercion.html#toPhantomCo"><span class="hs-identifier">toPhantomCo</span></a></a><span> </span><a name="local-6989586621679407420"><a href="#local-6989586621679407420"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1033"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407420"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407421"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407422"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1034"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407421"><a href="#local-6989586621679407421"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407422"><a href="#local-6989586621679407422"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407420"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span class="hs-comment">-- Convert args to a TyConAppCo Nominal to the same TyConAppCo Representational</span><span>
</span><a name="line-1037"></a><span class="hs-identifier">applyRoles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-1038"></a><a name="applyRoles"><a href="Coercion.html#applyRoles"><span class="hs-identifier">applyRoles</span></a></a><span> </span><a name="local-6989586621679407423"><a href="#local-6989586621679407423"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407424"><a href="#local-6989586621679407424"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-1039"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679407425"><a href="#local-6989586621679407425"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a><span> </span><a href="#local-6989586621679407425"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407423"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407424"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1040"></a><span>
</span><a name="line-1041"></a><span class="hs-comment">-- the Role parameter is the Role of the TyConAppCo</span><span>
</span><a name="line-1042"></a><span class="hs-comment">-- defined here because this is intimiately concerned with the implementation</span><span>
</span><a name="line-1043"></a><span class="hs-comment">-- of TyConAppCo</span><span>
</span><a name="line-1044"></a><span class="hs-identifier">tyConRolesX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>
</span><a name="line-1045"></a><a name="tyConRolesX"><a href="Coercion.html#tyConRolesX"><span class="hs-identifier">tyConRolesX</span></a></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a name="local-6989586621679407426"><a href="#local-6989586621679407426"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407426"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1046"></a><span class="hs-identifier">tyConRolesX</span><span> </span><span class="hs-keyword">role</span><span>             </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-keyword">role</span><span>
</span><a name="line-1047"></a><span>
</span><a name="line-1048"></a><span class="hs-identifier">tyConRolesRepresentational</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>
</span><a name="line-1049"></a><a name="tyConRolesRepresentational"><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier">tyConRolesRepresentational</span></a></a><span> </span><a name="local-6989586621679407428"><a href="#local-6989586621679407428"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-6989586621679407428"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-1050"></a><span>
</span><a name="line-1051"></a><span class="hs-identifier">nthRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-1052"></a><a name="nthRole"><a href="Coercion.html#nthRole"><span class="hs-identifier">nthRole</span></a></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-1053"></a><span class="hs-identifier">nthRole</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>
</span><a name="line-1054"></a><span class="hs-identifier">nthRole</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a name="local-6989586621679407429"><a href="#local-6989586621679407429"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407430"><a href="#local-6989586621679407430"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1055"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679407429"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407430"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span class="hs-identifier">ltRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1058"></a><span class="hs-comment">-- Is one role &quot;less&quot; than another?</span><span>
</span><a name="line-1059"></a><span class="hs-comment">--     Nominal &lt; Representational &lt; Phantom</span><span>
</span><a name="line-1060"></a><a name="ltRole"><a href="Coercion.html#ltRole"><span class="hs-identifier">ltRole</span></a></a><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1061"></a><span class="hs-identifier">ltRole</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1062"></a><span class="hs-identifier">ltRole</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1063"></a><span class="hs-identifier">ltRole</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1064"></a><span class="hs-identifier">ltRole</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1065"></a><span>
</span><a name="line-1066"></a><span class="hs-comment">-------------------------------</span><span>
</span><a name="line-1067"></a><span>
</span><a name="line-1068"></a><span class="hs-comment">-- | like mkKindCo, but aggressively &amp; recursively optimizes to avoid using</span><span>
</span><a name="line-1069"></a><span class="hs-comment">-- a KindCo constructor. The output role is nominal.</span><span>
</span><a name="line-1070"></a><span class="hs-identifier">promoteCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span class="hs-comment">-- First cases handles anything that should yield refl.</span><span>
</span><a name="line-1073"></a><a name="promoteCoercion"><a href="Coercion.html#promoteCoercion"><span class="hs-identifier">promoteCoercion</span></a></a><span> </span><a name="local-6989586621679407431"><a href="#local-6989586621679407431"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407434"><span class="hs-identifier hs-var">ki1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407435"><span class="hs-identifier hs-var">ki2</span></a><span>
</span><a name="line-1076"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407432"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1077"></a><span>     </span><span class="hs-comment">-- no later branch should return refl</span><span>
</span><a name="line-1078"></a><span>     </span><span class="hs-comment">--    The ASSERT( False )s throughout</span><span>
</span><a name="line-1079"></a><span>     </span><span class="hs-comment">-- are these cases explicitly, but they should never fire.</span><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span>    </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407436"><a href="#local-6989586621679407436"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1082"></a><span>                 </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407436"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><span>
</span><a name="line-1084"></a><span>    </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407437"><a href="#local-6989586621679407437"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407438"><a href="#local-6989586621679407438"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1085"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407439"><a href="#local-6989586621679407439"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#instCoercions"><span class="hs-identifier hs-var">instCoercions</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679407437"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407438"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1086"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407439"><span class="hs-identifier hs-var">co'</span></a><span>
</span><a name="line-1087"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1088"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1089"></a><span>
</span><a name="line-1090"></a><span>    </span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407440"><a href="#local-6989586621679407440"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407441"><a href="#local-6989586621679407441"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-1091"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407442"><a href="#local-6989586621679407442"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407440"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>                                 </span><span class="hs-special">(</span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407440"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407441"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1093"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407442"><span class="hs-identifier hs-var">co'</span></a><span>
</span><a name="line-1094"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1095"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1096"></a><span>
</span><a name="line-1097"></a><span>    </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407443"><a href="#local-6989586621679407443"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-1098"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407443"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span>    </span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1101"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span>    </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1104"></a><span>    </span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1105"></a><span>    </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1106"></a><span>    </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1107"></a><span>
</span><a name="line-1108"></a><span>    </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407444"><a href="#local-6989586621679407444"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679407445"><a href="#local-6989586621679407445"><span class="hs-identifier">t2</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkUnsafeCo"><span class="hs-identifier hs-var">mkUnsafeCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407444"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407445"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>    </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621679407446"><a href="#local-6989586621679407446"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407446"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-1110"></a><span>    </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621679407447"><a href="#local-6989586621679407447"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407447"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-1111"></a><span>    </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span>    </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407448"><a href="#local-6989586621679407448"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-1114"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407448"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span>    </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679407449"><a href="#local-6989586621679407449"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407450"><a href="#local-6989586621679407450"><span class="hs-identifier">co2</span></a></a><span>
</span><a name="line-1117"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407449"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407450"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><span>
</span><a name="line-1119"></a><span>    </span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621679407451"><a href="#local-6989586621679407451"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407452"><a href="#local-6989586621679407452"><span class="hs-identifier">co1</span></a></a><span>
</span><a name="line-1120"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679407453"><a href="#local-6989586621679407453"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a><span> </span><a href="#local-6989586621679407452"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1121"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407453"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407451"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1122"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407453"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a><span> </span><a href="#local-6989586621679407451"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1123"></a><span>
</span><a name="line-1124"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1125"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407451"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1126"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mkNomReflCo</span><span> </span><span class="hs-identifier">liftedTypeKind</span><span>
</span><a name="line-1127"></a><span>
</span><a name="line-1128"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1129"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1130"></a><span>
</span><a name="line-1131"></a><span>    </span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621679407454"><a href="#local-6989586621679407454"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679407455"><a href="#local-6989586621679407455"><span class="hs-identifier">co1</span></a></a><span>
</span><a name="line-1132"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407456"><a href="#local-6989586621679407456"><span class="hs-identifier">lco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407457"><a href="#local-6989586621679407457"><span class="hs-identifier">rco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a><span> </span><a href="#local-6989586621679407455"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1133"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407454"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1134"></a><span>           </span><a href="BasicTypes.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407456"><span class="hs-identifier hs-var">lco</span></a><span>
</span><a name="line-1135"></a><span>           </span><a href="BasicTypes.html#CRight"><span class="hs-identifier hs-var">CRight</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407457"><span class="hs-identifier hs-var">rco</span></a><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1138"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1139"></a><span>
</span><a name="line-1140"></a><span>    </span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407458"><a href="#local-6989586621679407458"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1141"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407458"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1142"></a><span>
</span><a name="line-1143"></a><span>    </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407459"><a href="#local-6989586621679407459"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679407460"><a href="#local-6989586621679407460"><span class="hs-identifier">h</span></a></a><span>
</span><a name="line-1144"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621679407460"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407459"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span>    </span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1147"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1148"></a><span>         </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span>    </span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679407461"><a href="#local-6989586621679407461"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-1151"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-6989586621679407461"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1152"></a><span>
</span><a name="line-1153"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1154"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407432"><a href="#local-6989586621679407432"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407433"><a href="#local-6989586621679407433"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407431"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1155"></a><span>    </span><a name="local-6989586621679407434"><a href="#local-6989586621679407434"><span class="hs-identifier">ki1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407432"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1156"></a><span>    </span><a name="local-6989586621679407435"><a href="#local-6989586621679407435"><span class="hs-identifier">ki2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407433"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1157"></a><span>
</span><a name="line-1158"></a><span class="hs-comment">-- | say @g = promoteCoercion h@. Then, @instCoercion g w@ yields @Just g'@,</span><span>
</span><a name="line-1159"></a><span class="hs-comment">-- where @g' = promoteCoercion (h w)@.</span><span>
</span><a name="line-1160"></a><span class="hs-comment">-- fails if this is not possible, if @g@ coerces between a forall and an -&gt;</span><span>
</span><a name="line-1161"></a><span class="hs-comment">-- or if second parameter has a representational role and can't be used</span><span>
</span><a name="line-1162"></a><span class="hs-comment">-- with an InstCo. The result role matches is representational.</span><span>
</span><a name="line-1163"></a><span class="hs-identifier">instCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- type of the first coercion</span><span>
</span><a name="line-1164"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>  </span><span class="hs-comment">-- ^ must be nominal</span><span>
</span><a name="line-1165"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1166"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1167"></a><a name="instCoercion"><a href="Coercion.html#instCoercion"><span class="hs-identifier">instCoercion</span></a></a><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407462"><a href="#local-6989586621679407462"><span class="hs-identifier">lty</span></a></a><span> </span><a name="local-6989586621679407463"><a href="#local-6989586621679407463"><span class="hs-identifier">rty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407464"><a href="#local-6989586621679407464"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679407465"><a href="#local-6989586621679407465"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-1168"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621679407462"><span class="hs-identifier hs-var">lty</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621679407463"><span class="hs-identifier hs-var">rty</span></a><span>
</span><a name="line-1169"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407466"><a href="#local-6989586621679407466"><span class="hs-identifier">w'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a><span> </span><a href="#local-6989586621679407465"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span> </span><a href="#local-6989586621679407464"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679407466"><span class="hs-identifier hs-var">w'</span></a><span>
</span><a name="line-1171"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a><span> </span><a href="#local-6989586621679407462"><span class="hs-identifier hs-var">lty</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a><span> </span><a href="#local-6989586621679407463"><span class="hs-identifier hs-var">rty</span></a><span>
</span><a name="line-1172"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">3</span><span> </span><a href="#local-6989586621679407464"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-comment">-- extract result type, which is the 4th argument to (-&gt;)</span><span>
</span><a name="line-1173"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-comment">-- one forall, one funty...</span><span>
</span><a name="line-1174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1175"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span class="hs-identifier">instCoercions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1178"></a><a name="instCoercions"><a href="Coercion.html#instCoercions"><span class="hs-identifier">instCoercions</span></a></a><span> </span><a name="local-6989586621679407467"><a href="#local-6989586621679407467"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679407468"><a href="#local-6989586621679407468"><span class="hs-identifier">ws</span></a></a><span>
</span><a name="line-1179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407475"><a href="#local-6989586621679407475"><span class="hs-identifier">arg_ty_pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407468"><span class="hs-identifier hs-var">ws</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1180"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-6989586621679407469"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407467"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407467"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-6989586621679407475"><span class="hs-identifier hs-var">arg_ty_pairs</span></a><span> </span><a href="#local-6989586621679407468"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span>
</span><a name="line-1181"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1182"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1183"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1184"></a><span>    </span><a name="local-6989586621679407469"><a href="#local-6989586621679407469"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407470"><a href="#local-6989586621679407470"><span class="hs-identifier">g_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407471"><a href="#local-6989586621679407471"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407472"><a href="#local-6989586621679407472"><span class="hs-identifier">w_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407473"><a href="#local-6989586621679407473"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679407474"><a href="#local-6989586621679407474"><span class="hs-identifier">g'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a><span> </span><a href="#local-6989586621679407470"><span class="hs-identifier hs-var">g_tys</span></a><span> </span><a href="#local-6989586621679407471"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679407473"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1186"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#piResultTy"><span class="hs-identifier hs-var">piResultTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407470"><span class="hs-identifier hs-var">g_tys</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="#local-6989586621679407472"><span class="hs-identifier hs-var">w_tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407474"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1187"></a><span>
</span><a name="line-1188"></a><span class="hs-comment">-- | Creates a new coercion with both of its types casted by different casts</span><span>
</span><a name="line-1189"></a><span class="hs-comment">-- castCoercionKind g h1 h2, where g :: t1 ~ t2, has type (t1 |&gt; h1) ~ (t2 |&gt; h2)</span><span>
</span><a name="line-1190"></a><span class="hs-comment">-- The second and third coercions must be nominal.</span><span>
</span><a name="line-1191"></a><span class="hs-identifier">castCoercionKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1192"></a><a name="castCoercionKind"><a href="Coercion.html#castCoercionKind"><span class="hs-identifier">castCoercionKind</span></a></a><span> </span><a name="local-6989586621679407476"><a href="#local-6989586621679407476"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679407477"><a href="#local-6989586621679407477"><span class="hs-identifier">h1</span></a></a><span> </span><a name="local-6989586621679407478"><a href="#local-6989586621679407478"><span class="hs-identifier">h2</span></a></a><span>
</span><a name="line-1193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407476"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407477"><span class="hs-identifier hs-var">h1</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407478"><span class="hs-identifier hs-var">h2</span></a><span>
</span><a name="line-1194"></a><span>
</span><a name="line-1195"></a><span class="hs-comment">-- See note [Newtype coercions] in TyCon</span><span>
</span><a name="line-1196"></a><span>
</span><a name="line-1197"></a><span class="hs-identifier">mkPiCos</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1198"></a><a name="mkPiCos"><a href="Coercion.html#mkPiCos"><span class="hs-identifier">mkPiCos</span></a></a><span> </span><a name="local-6989586621679407479"><a href="#local-6989586621679407479"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407480"><a href="#local-6989586621679407480"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621679407481"><a href="#local-6989586621679407481"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkPiCo"><span class="hs-identifier hs-var">mkPiCo</span></a><span> </span><a href="#local-6989586621679407479"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407481"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679407480"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1199"></a><span>
</span><a name="line-1200"></a><span class="hs-comment">-- | Make a forall 'Coercion', where both types related by the coercion</span><span>
</span><a name="line-1201"></a><span class="hs-comment">-- are quantified over the same type variable.</span><span>
</span><a name="line-1202"></a><span class="hs-identifier">mkPiCo</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1203"></a><a name="mkPiCo"><a href="Coercion.html#mkPiCo"><span class="hs-identifier">mkPiCo</span></a></a><span> </span><a name="local-6989586621679407482"><a href="#local-6989586621679407482"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407483"><a href="#local-6989586621679407483"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679407484"><a href="#local-6989586621679407484"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679407483"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407483"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679407484"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1204"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621679407482"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-6989586621679407482"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679407483"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407484"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1205"></a><span>
</span><a name="line-1206"></a><span class="hs-comment">-- The second coercion is sometimes lifted (~) and sometimes unlifted (~#).</span><span>
</span><a name="line-1207"></a><span class="hs-comment">-- So, we have to make sure to supply the right parameter to decomposeCo.</span><span>
</span><a name="line-1208"></a><span class="hs-comment">-- mkCoCast (c :: s1 ~# t1) (g :: (s1 ~# s2) ~# (t1 ~# t2)) :: s2 ~# t2</span><span>
</span><a name="line-1209"></a><span class="hs-comment">-- Both coercions *must* have the same role.</span><span>
</span><a name="line-1210"></a><span class="hs-identifier">mkCoCast</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1211"></a><a name="mkCoCast"><a href="Coercion.html#mkCoCast"><span class="hs-identifier">mkCoCast</span></a></a><span> </span><a name="local-6989586621679407485"><a href="#local-6989586621679407485"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679407486"><a href="#local-6989586621679407486"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-1212"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621679407490"><span class="hs-identifier hs-var">g1</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407485"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407491"><span class="hs-identifier hs-var">g2</span></a><span>
</span><a name="line-1213"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1214"></a><span>       </span><span class="hs-comment">-- g  :: (s1 ~# s2) ~# (t1 ~#  t2)</span><span>
</span><a name="line-1215"></a><span>       </span><span class="hs-comment">-- g1 :: s1 ~# t1</span><span>
</span><a name="line-1216"></a><span>       </span><span class="hs-comment">-- g2 :: s2 ~# t2</span><span>
</span><a name="line-1217"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679407487"><a href="#local-6989586621679407487"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407486"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>    </span><a name="local-6989586621679407488"><a href="#local-6989586621679407488"><span class="hs-identifier">n_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679407487"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1219"></a><span>    </span><a name="local-6989586621679407489"><a href="#local-6989586621679407489"><span class="hs-identifier">co_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#decomposeCo"><span class="hs-identifier hs-var">decomposeCo</span></a><span> </span><a href="#local-6989586621679407488"><span class="hs-identifier hs-var">n_args</span></a><span> </span><a href="#local-6989586621679407486"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1220"></a><span>    </span><a name="local-6989586621679407490"><a href="#local-6989586621679407490"><span class="hs-identifier">g1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407489"><span class="hs-identifier hs-var">co_list</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407488"><span class="hs-identifier hs-var">n_args</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1221"></a><span>    </span><a name="local-6989586621679407491"><a href="#local-6989586621679407491"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407489"><span class="hs-identifier hs-var">co_list</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407488"><span class="hs-identifier hs-var">n_args</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>
</span><a name="line-1223"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Newtypes
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1230"></a><span>
</span><a name="line-1231"></a><span class="hs-comment">-- | If @co :: T ts ~ rep_ty@ then:</span><span>
</span><a name="line-1232"></a><span class="hs-comment">--</span><span>
</span><a name="line-1233"></a><span class="hs-comment">-- &gt; instNewTyCon_maybe T ts = Just (rep_ty, co)</span><span>
</span><a name="line-1234"></a><span class="hs-comment">--</span><span>
</span><a name="line-1235"></a><span class="hs-comment">-- Checks for a newtype, and for being saturated</span><span>
</span><a name="line-1236"></a><span class="hs-identifier">instNewTyCon_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><a name="instNewTyCon_maybe"><a href="Coercion.html#instNewTyCon_maybe"><span class="hs-identifier">instNewTyCon_maybe</span></a></a><span> </span><a name="local-6989586621679407492"><a href="#local-6989586621679407492"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407493"><a href="#local-6989586621679407493"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1238"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407494"><a href="#local-6989586621679407494"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407495"><a href="#local-6989586621679407495"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407496"><a href="#local-6989586621679407496"><span class="hs-identifier">co_tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#unwrapNewTyConEtad_maybe"><span class="hs-identifier hs-var">unwrapNewTyConEtad_maybe</span></a><span> </span><a href="#local-6989586621679407492"><span class="hs-identifier hs-var">tc</span></a><span>  </span><span class="hs-comment">-- Check for newtype</span><span>
</span><a name="line-1239"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407494"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#leLength"><span class="hs-identifier hs-var">leLength</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407493"><span class="hs-identifier hs-var">tys</span></a><span>                                    </span><span class="hs-comment">-- Check saturated enough</span><span>
</span><a name="line-1240"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#applyTysX"><span class="hs-identifier hs-var">applyTysX</span></a><span> </span><a href="#local-6989586621679407494"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407495"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679407493"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621679407496"><span class="hs-identifier hs-var">co_tc</span></a><span> </span><a href="#local-6989586621679407493"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1242"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1243"></a><span>
</span><a name="line-1244"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Type normalisation
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1251"></a><span>
</span><a name="line-1252"></a><span class="hs-comment">-- | A function to check if we can reduce a type by one step. Used</span><span>
</span><a name="line-1253"></a><span class="hs-comment">-- with 'topNormaliseTypeX'.</span><span>
</span><a name="line-1254"></a><span class="hs-keyword">type</span><span> </span><a name="NormaliseStepper"><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier">NormaliseStepper</span></a></a><span> </span><a name="local-6989586621679407071"><a href="#local-6989586621679407071"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a><span>
</span><a name="line-1255"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>     </span><span class="hs-comment">-- tc</span><span>
</span><a name="line-1256"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- tys</span><span>
</span><a name="line-1257"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a><span> </span><a href="#local-6989586621679407071"><span class="hs-identifier hs-type">ev</span></a><span>
</span><a name="line-1258"></a><span>
</span><a name="line-1259"></a><span class="hs-comment">-- | The result of stepping in a normalisation function.</span><span>
</span><a name="line-1260"></a><span class="hs-comment">-- See 'topNormaliseTypeX'.</span><span>
</span><a name="line-1261"></a><span class="hs-keyword">data</span><span> </span><a name="NormaliseStepResult"><a href="Coercion.html#NormaliseStepResult"><span class="hs-identifier">NormaliseStepResult</span></a></a><span> </span><a name="local-6989586621679407070"><a href="#local-6989586621679407070"><span class="hs-identifier">ev</span></a></a><span>
</span><a name="line-1262"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NS_Done"><a href="Coercion.html#NS_Done"><span class="hs-identifier">NS_Done</span></a></a><span>   </span><span class="hs-comment">-- ^ Nothing more to do</span><span>
</span><a name="line-1263"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NS_Abort"><a href="Coercion.html#NS_Abort"><span class="hs-identifier">NS_Abort</span></a></a><span>  </span><span class="hs-comment">-- ^ Utter failure. The outer function should fail too.</span><span>
</span><a name="line-1264"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NS_Step"><a href="Coercion.html#NS_Step"><span class="hs-identifier">NS_Step</span></a></a><span> </span><a href="TyCon.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="#local-6989586621679407070"><span class="hs-identifier hs-type">ev</span></a><span>    </span><span class="hs-comment">-- ^ We stepped, yielding new bits;</span><span>
</span><a name="line-1265"></a><span>                                    </span><span class="hs-comment">-- ^ ev is evidence;</span><span>
</span><a name="line-1266"></a><span>                                    </span><span class="hs-comment">-- Usually a co :: old type ~ new type</span><span>
</span><a name="line-1267"></a><span>
</span><a name="line-1268"></a><span class="hs-identifier">mapStepResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407077"><span class="hs-identifier hs-type">ev1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407078"><span class="hs-identifier hs-type">ev2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1269"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a><span> </span><a href="#local-6989586621679407077"><span class="hs-identifier hs-type">ev1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a><span> </span><a href="#local-6989586621679407078"><span class="hs-identifier hs-type">ev2</span></a><span>
</span><a name="line-1270"></a><a name="mapStepResult"><a href="Coercion.html#mapStepResult"><span class="hs-identifier">mapStepResult</span></a></a><span> </span><a name="local-6989586621679407497"><a href="#local-6989586621679407497"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><a name="local-6989586621679407498"><a href="#local-6989586621679407498"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621679407499"><a href="#local-6989586621679407499"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679407500"><a href="#local-6989586621679407500"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><a href="#local-6989586621679407498"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407499"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407497"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679407500"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1271"></a><span class="hs-identifier">mapStepResult</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a><span>
</span><a name="line-1272"></a><span class="hs-identifier">mapStepResult</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-comment">-- | Try one stepper and then try the next, if the first doesn't make</span><span>
</span><a name="line-1275"></a><span class="hs-comment">-- progress.</span><span>
</span><a name="line-1276"></a><span class="hs-comment">-- So if it returns NS_Done, it means that both steppers are satisfied</span><span>
</span><a name="line-1277"></a><span class="hs-identifier">composeSteppers</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span> </span><a href="#local-6989586621679407076"><span class="hs-identifier hs-type">ev</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span> </span><a href="#local-6989586621679407076"><span class="hs-identifier hs-type">ev</span></a><span>
</span><a name="line-1278"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span> </span><a href="#local-6989586621679407076"><span class="hs-identifier hs-type">ev</span></a><span>
</span><a name="line-1279"></a><a name="composeSteppers"><a href="Coercion.html#composeSteppers"><span class="hs-identifier">composeSteppers</span></a></a><span> </span><a name="local-6989586621679407501"><a href="#local-6989586621679407501"><span class="hs-identifier">step1</span></a></a><span> </span><a name="local-6989586621679407502"><a href="#local-6989586621679407502"><span class="hs-identifier">step2</span></a></a><span> </span><a name="local-6989586621679407503"><a href="#local-6989586621679407503"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621679407504"><a href="#local-6989586621679407504"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407505"><a href="#local-6989586621679407505"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1280"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407501"><span class="hs-identifier hs-var">step1</span></a><span> </span><a href="#local-6989586621679407503"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407504"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407505"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1281"></a><span>      </span><a name="local-6989586621679407506"><a href="#local-6989586621679407506"><span class="hs-identifier">success</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407506"><span class="hs-identifier hs-var">success</span></a><span>
</span><a name="line-1282"></a><span>      </span><a href="Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407502"><span class="hs-identifier hs-var">step2</span></a><span> </span><a href="#local-6989586621679407503"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407504"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407505"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1283"></a><span>      </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-comment">-- | A 'NormaliseStepper' that unwraps newtypes, careful not to fall into</span><span>
</span><a name="line-1286"></a><span class="hs-comment">-- a loop. If it would fall into a loop, it produces 'NS_Abort'.</span><span>
</span><a name="line-1287"></a><span class="hs-identifier">unwrapNewTypeStepper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1288"></a><a name="unwrapNewTypeStepper"><a href="Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier">unwrapNewTypeStepper</span></a></a><span> </span><a name="local-6989586621679407507"><a href="#local-6989586621679407507"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621679407508"><a href="#local-6989586621679407508"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407509"><a href="#local-6989586621679407509"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407510"><a href="#local-6989586621679407510"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407511"><a href="#local-6989586621679407511"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var">instNewTyCon_maybe</span></a><span> </span><a href="#local-6989586621679407508"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407509"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1290"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#checkRecTc"><span class="hs-identifier hs-var">checkRecTc</span></a><span> </span><a href="#local-6989586621679407507"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407508"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1291"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407512"><a href="#local-6989586621679407512"><span class="hs-identifier">rec_nts'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><a href="#local-6989586621679407512"><span class="hs-identifier hs-var">rec_nts'</span></a><span> </span><a href="#local-6989586621679407510"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621679407511"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1292"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span class="hs-comment">-- | A general function for normalising the top-level of a type. It continues</span><span>
</span><a name="line-1298"></a><span class="hs-comment">-- to use the provided 'NormaliseStepper' until that function fails, and then</span><span>
</span><a name="line-1299"></a><span class="hs-comment">-- this function returns. The roles of the coercions produced by the</span><span>
</span><a name="line-1300"></a><span class="hs-comment">-- 'NormaliseStepper' must all be the same, which is the role returned from</span><span>
</span><a name="line-1301"></a><span class="hs-comment">-- the call to 'topNormaliseTypeX'.</span><span>
</span><a name="line-1302"></a><span class="hs-comment">--</span><span>
</span><a name="line-1303"></a><span class="hs-comment">-- Typically ev is Coercion.</span><span>
</span><a name="line-1304"></a><span class="hs-comment">--</span><span>
</span><a name="line-1305"></a><span class="hs-comment">-- If topNormaliseTypeX step plus ty = Just (ev, ty')</span><span>
</span><a name="line-1306"></a><span class="hs-comment">-- then ty ~ev1~ t1 ~ev2~ t2 ... ~evn~ ty'</span><span>
</span><a name="line-1307"></a><span class="hs-comment">-- and ev = ev1 `plus` ev2 `plus` ... `plus` evn</span><span>
</span><a name="line-1308"></a><span class="hs-comment">-- If it returns Nothing then no newtype unwrapping could happen</span><span>
</span><a name="line-1309"></a><span class="hs-identifier">topNormaliseTypeX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a><span> </span><a href="#local-6989586621679407075"><span class="hs-identifier hs-type">ev</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407075"><span class="hs-identifier hs-type">ev</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407075"><span class="hs-identifier hs-type">ev</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407075"><span class="hs-identifier hs-type">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407075"><span class="hs-identifier hs-type">ev</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><a name="topNormaliseTypeX"><a href="Coercion.html#topNormaliseTypeX"><span class="hs-identifier">topNormaliseTypeX</span></a></a><span> </span><a name="local-6989586621679407513"><a href="#local-6989586621679407513"><span class="hs-identifier">stepper</span></a></a><span> </span><a name="local-6989586621679407514"><a href="#local-6989586621679407514"><span class="hs-identifier">plus</span></a></a><span> </span><a name="local-6989586621679407515"><a href="#local-6989586621679407515"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1312"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407525"><a href="#local-6989586621679407525"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407526"><a href="#local-6989586621679407526"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407515"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1313"></a><span> </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><a name="local-6989586621679407527"><a href="#local-6989586621679407527"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621679407528"><a href="#local-6989586621679407528"><span class="hs-identifier">ty'</span></a></a><span> </span><a name="local-6989586621679407529"><a href="#local-6989586621679407529"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679407513"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="TyCon.html#initRecTc"><span class="hs-identifier hs-var">initRecTc</span></a><span> </span><a href="#local-6989586621679407525"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407526"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1314"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407516"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407527"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407529"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679407528"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1315"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1316"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1317"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1318"></a><span>    </span><a name="local-6989586621679407516"><a href="#local-6989586621679407516"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679407517"><a href="#local-6989586621679407517"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621679407518"><a href="#local-6989586621679407518"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-6989586621679407519"><a href="#local-6989586621679407519"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1319"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407520"><a href="#local-6989586621679407520"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407521"><a href="#local-6989586621679407521"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679407519"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1320"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679407513"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-6989586621679407517"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621679407520"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679407521"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1321"></a><span>          </span><a href="Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a><span> </span><a name="local-6989586621679407522"><a href="#local-6989586621679407522"><span class="hs-identifier">rec_nts'</span></a></a><span> </span><a name="local-6989586621679407523"><a href="#local-6989586621679407523"><span class="hs-identifier">ty'</span></a></a><span> </span><a name="local-6989586621679407524"><a href="#local-6989586621679407524"><span class="hs-identifier">ev'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407516"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407522"><span class="hs-identifier hs-var">rec_nts'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407518"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679407514"><span class="hs-identifier hs-var">plus</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407524"><span class="hs-identifier hs-var">ev'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407523"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1322"></a><span>          </span><a href="Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407518"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407519"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>          </span><a href="Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1326"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407518"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407519"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-identifier">topNormaliseNewType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span class="hs-comment">-- ^ Sometimes we want to look through a @newtype@ and get its associated coercion.</span><span>
</span><a name="line-1330"></a><span class="hs-comment">-- This function strips off @newtype@ layers enough to reveal something that isn't</span><span>
</span><a name="line-1331"></a><span class="hs-comment">-- a @newtype@.  Specifically, here's the invariant:</span><span>
</span><a name="line-1332"></a><span class="hs-comment">--</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- &gt; topNormaliseNewType_maybe rec_nts ty = Just (co, ty')</span><span>
</span><a name="line-1334"></a><span class="hs-comment">--</span><span>
</span><a name="line-1335"></a><span class="hs-comment">-- then (a)  @co : ty0 ~ ty'@.</span><span>
</span><a name="line-1336"></a><span class="hs-comment">--      (b)  ty' is not a newtype.</span><span>
</span><a name="line-1337"></a><span class="hs-comment">--</span><span>
</span><a name="line-1338"></a><span class="hs-comment">-- The function returns @Nothing@ for non-@newtypes@,</span><span>
</span><a name="line-1339"></a><span class="hs-comment">-- or unsaturated applications</span><span>
</span><a name="line-1340"></a><span class="hs-comment">--</span><span>
</span><a name="line-1341"></a><span class="hs-comment">-- This function does *not* look through type families, because it has no access to</span><span>
</span><a name="line-1342"></a><span class="hs-comment">-- the type family environment. If you do have that at hand, consider to use</span><span>
</span><a name="line-1343"></a><span class="hs-comment">-- topNormaliseType_maybe, which should be a drop-in replacement for</span><span>
</span><a name="line-1344"></a><span class="hs-comment">-- topNormaliseNewType_maybe</span><span>
</span><a name="line-1345"></a><span class="hs-comment">-- If topNormliseNewType_maybe ty = Just (co, ty'), then co : ty ~R ty'</span><span>
</span><a name="line-1346"></a><a name="topNormaliseNewType_maybe"><a href="Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier">topNormaliseNewType_maybe</span></a></a><span> </span><a name="local-6989586621679407530"><a href="#local-6989586621679407530"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1347"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var">topNormaliseTypeX</span></a><span> </span><a href="Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var">unwrapNewTypeStepper</span></a><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span> </span><a href="#local-6989586621679407530"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Comparison of coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1356"></a><span>
</span><a name="line-1357"></a><span class="hs-comment">-- | Syntactic equality of coercions</span><span>
</span><a name="line-1358"></a><span class="hs-identifier">eqCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1359"></a><a name="eqCoercion"><a href="Coercion.html#eqCoercion"><span class="hs-identifier">eqCoercion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span>
</span><a name="line-1360"></a><span>
</span><a name="line-1361"></a><span class="hs-comment">-- | Compare two 'Coercion's, with respect to an RnEnv2</span><span>
</span><a name="line-1362"></a><span class="hs-identifier">eqCoercionX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1363"></a><a name="eqCoercionX"><a href="Coercion.html#eqCoercionX"><span class="hs-identifier">eqCoercionX</span></a></a><span> </span><a name="local-6989586621679407531"><a href="#local-6989586621679407531"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-6989586621679407531"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span>
</span><a name="line-1364"></a><span>
</span><a name="line-1365"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   &quot;Lifting&quot; substitution
           [(TyCoVar,Coercion)] -&gt; Type -&gt; Coercion
%*                                                                      *
%************************************************************************

Note [Lifting coercions over types: liftCoSubst]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The KPUSH rule deals with this situation
   data T a = MkK (a -&gt; Maybe a)
   g :: T t1 ~ K t2
   x :: t1 -&gt; Maybe t1

   case (K @t1 x) |&gt; g of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

We want to push the coercion inside the constructor application.
So we do this

   g' :: t1~t2  =  Nth 0 g

   case K @t2 (x |&gt; g' -&gt; Maybe g') of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

The crucial operation is that we
  * take the type of K's argument: a -&gt; Maybe a
  * and substitute g' for a
thus giving *coercion*.  This is what liftCoSubst does.

In the presence of kind coercions, this is a bit
of a hairy operation. So, we refer you to the paper introducing kind coercions,
available at www.cis.upenn.edu/~sweirich/papers/fckinds-extended.pdf
-}</span><span>
</span><a name="line-1400"></a><span>
</span><a name="line-1401"></a><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><a name="line-1402"></a><span class="hs-comment">-- See Note [Lifting coercions over types: liftCoSubst]</span><span>
</span><a name="line-1403"></a><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><a name="line-1404"></a><span>
</span><a name="line-1405"></a><span class="hs-keyword">data</span><span> </span><a name="LiftingContext"><a href="Coercion.html#LiftingContext"><span class="hs-identifier">LiftingContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LC"><a href="Coercion.html#LC"><span class="hs-identifier">LC</span></a></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1406"></a><span>  </span><span class="hs-comment">-- in optCoercion, we need to lift when optimizing InstCo.</span><span>
</span><a name="line-1407"></a><span>  </span><span class="hs-comment">-- See Note [Optimising InstCo] in OptCoercion</span><span>
</span><a name="line-1408"></a><span>  </span><span class="hs-comment">-- We thus propagate the substitution from OptCoercion here.</span><span>
</span><a name="line-1409"></a><span>
</span><a name="line-1410"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1411"></a><span>  </span><a name="local-8214565720323906373"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407072"><a href="#local-6989586621679407072"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LiftingContext:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407072"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span class="hs-keyword">type</span><span> </span><a name="LiftCoEnv"><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier">LiftCoEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1414"></a><span>     </span><span class="hs-comment">-- Maps *type variables* to *coercions*.</span><span>
</span><a name="line-1415"></a><span>     </span><span class="hs-comment">-- That's the whole point of this function!</span><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span class="hs-comment">-- like liftCoSubstWith, but allows for existentially-bound types as well</span><span>
</span><a name="line-1418"></a><span class="hs-identifier">liftCoSubstWithEx</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>          </span><span class="hs-comment">-- desired role for output coercion</span><span>
</span><a name="line-1419"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- universally quantified tyvars</span><span>
</span><a name="line-1420"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- coercions to substitute for those</span><span>
</span><a name="line-1421"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- existentially quantified tyvars</span><span>
</span><a name="line-1422"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- types to be bound to ex vars</span><span>
</span><a name="line-1423"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (lifting function, converted ex args)</span><span>
</span><a name="line-1424"></a><a name="liftCoSubstWithEx"><a href="Coercion.html#liftCoSubstWithEx"><span class="hs-identifier">liftCoSubstWithEx</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407533"><a href="#local-6989586621679407533"><span class="hs-identifier">univs</span></a></a><span> </span><a name="local-6989586621679407534"><a href="#local-6989586621679407534"><span class="hs-identifier">omegas</span></a></a><span> </span><a name="local-6989586621679407535"><a href="#local-6989586621679407535"><span class="hs-identifier">exs</span></a></a><span> </span><a name="local-6989586621679407536"><a href="#local-6989586621679407536"><span class="hs-identifier">rhos</span></a></a><span>
</span><a name="line-1425"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407537"><a href="#local-6989586621679407537"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;liftCoSubstWithExU&quot;</span><span> </span><a href="#local-6989586621679407533"><span class="hs-identifier hs-var">univs</span></a><span> </span><a href="#local-6989586621679407534"><span class="hs-identifier hs-var">omegas</span></a><span class="hs-special">)</span><span>
</span><a name="line-1426"></a><span>        </span><a name="local-6989586621679407538"><a href="#local-6989586621679407538"><span class="hs-identifier">psi</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a><span> </span><a href="#local-6989586621679407537"><span class="hs-identifier hs-var">theta</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;liftCoSubstWithExX&quot;</span><span> </span><a href="#local-6989586621679407535"><span class="hs-identifier hs-var">exs</span></a><span> </span><a href="#local-6989586621679407536"><span class="hs-identifier hs-var">rhos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a><span> </span><a href="#local-6989586621679407538"><span class="hs-identifier hs-var">psi</span></a><span> </span><span class="hs-keyword">role</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVars"><span class="hs-identifier hs-var">substTyVars</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a><span> </span><a href="#local-6989586621679407538"><span class="hs-identifier hs-var">psi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407535"><span class="hs-identifier hs-var">exs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1428"></a><span>
</span><a name="line-1429"></a><span class="hs-identifier">liftCoSubstWith</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1430"></a><span class="hs-comment">-- NB: This really can be called with CoVars, when optimising axioms.</span><span>
</span><a name="line-1431"></a><a name="liftCoSubstWith"><a href="Coercion.html#liftCoSubstWith"><span class="hs-identifier">liftCoSubstWith</span></a></a><span> </span><a name="local-6989586621679407539"><a href="#local-6989586621679407539"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407540"><a href="#local-6989586621679407540"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621679407541"><a href="#local-6989586621679407541"><span class="hs-identifier">cos</span></a></a><span> </span><a name="local-6989586621679407542"><a href="#local-6989586621679407542"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1432"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a><span> </span><a href="#local-6989586621679407539"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;liftCoSubstWith&quot;</span><span> </span><a href="#local-6989586621679407540"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407541"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407542"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span class="hs-comment">-- | @liftCoSubst role lc ty@ produces a coercion (at role @role@)</span><span>
</span><a name="line-1435"></a><span class="hs-comment">-- that coerces between @lc_left(ty)@ and @lc_right(ty)@, where</span><span>
</span><a name="line-1436"></a><span class="hs-comment">-- @lc_left@ is a substitution mapping type variables to the left-hand</span><span>
</span><a name="line-1437"></a><span class="hs-comment">-- types of the mapped coercions in @lc@, and similar for @lc_right@.</span><span>
</span><a name="line-1438"></a><span class="hs-identifier">liftCoSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1439"></a><a name="liftCoSubst"><a href="Coercion.html#liftCoSubst"><span class="hs-identifier">liftCoSubst</span></a></a><span> </span><a name="local-6989586621679407543"><a href="#local-6989586621679407543"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407544"><a href="#local-6989586621679407544"><span class="hs-identifier">lc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407545"><a href="#local-6989586621679407545"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407546"><a href="#local-6989586621679407546"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407547"><a href="#local-6989586621679407547"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1440"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="VarEnv.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a><span> </span><a href="#local-6989586621679407546"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407543"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621679407545"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407547"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a><span> </span><a href="#local-6989586621679407544"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407543"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407547"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span class="hs-identifier">emptyLiftingContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1444"></a><a name="emptyLiftingContext"><a href="Coercion.html#emptyLiftingContext"><span class="hs-identifier">emptyLiftingContext</span></a></a><span> </span><a name="local-6989586621679407548"><a href="#local-6989586621679407548"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="#local-6989586621679407548"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-identifier">mkLiftingContext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1447"></a><a name="mkLiftingContext"><a href="Coercion.html#mkLiftingContext"><span class="hs-identifier">mkLiftingContext</span></a></a><span> </span><a name="local-6989586621679407549"><a href="#local-6989586621679407549"><span class="hs-identifier">pairs</span></a></a><span>
</span><a name="line-1448"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-6989586621679407549"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>       </span><span class="hs-special">(</span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><a href="#local-6989586621679407549"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1450"></a><span>
</span><a name="line-1451"></a><span class="hs-identifier">mkSubstLiftingContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1452"></a><a name="mkSubstLiftingContext"><a href="Coercion.html#mkSubstLiftingContext"><span class="hs-identifier">mkSubstLiftingContext</span></a></a><span> </span><a name="local-6989586621679407550"><a href="#local-6989586621679407550"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a href="#local-6989586621679407550"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-1453"></a><span>
</span><a name="line-1454"></a><span class="hs-comment">-- | Extend a lifting context with a new /type/ mapping.</span><span>
</span><a name="line-1455"></a><span class="hs-identifier">extendLiftingContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>  </span><span class="hs-comment">-- ^ original LC</span><span>
</span><a name="line-1456"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>           </span><span class="hs-comment">-- ^ new variable to map...</span><span>
</span><a name="line-1457"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>        </span><span class="hs-comment">-- ^ ...to this lifted version</span><span>
</span><a name="line-1458"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1459"></a><a name="extendLiftingContext"><a href="Coercion.html#extendLiftingContext"><span class="hs-identifier">extendLiftingContext</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407551"><a href="#local-6989586621679407551"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407552"><a href="#local-6989586621679407552"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407553"><a href="#local-6989586621679407553"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407554"><a href="#local-6989586621679407554"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-1460"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1461"></a><span>    </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a href="#local-6989586621679407551"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621679407552"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679407553"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679407554"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1462"></a><span>
</span><a name="line-1463"></a><span class="hs-comment">-- | Extend a lifting context with existential-variable bindings.</span><span>
</span><a name="line-1464"></a><span class="hs-comment">-- This follows the lifting context extension definition in the</span><span>
</span><a name="line-1465"></a><span class="hs-comment">-- &quot;FC with Explicit Kind Equality&quot; paper.</span><span>
</span><a name="line-1466"></a><span class="hs-identifier">extendLiftingContextEx</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>    </span><span class="hs-comment">-- ^ original lifting context</span><span>
</span><a name="line-1467"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ ex. var / value pairs</span><span>
</span><a name="line-1468"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1469"></a><span class="hs-comment">-- Note that this is more involved than extendLiftingContext. That function</span><span>
</span><a name="line-1470"></a><span class="hs-comment">-- takes a coercion to extend with, so it's assumed that the caller has taken</span><span>
</span><a name="line-1471"></a><span class="hs-comment">-- into account any of the kind-changing stuff worried about here.</span><span>
</span><a name="line-1472"></a><a name="extendLiftingContextEx"><a href="Coercion.html#extendLiftingContextEx"><span class="hs-identifier">extendLiftingContextEx</span></a></a><span> </span><a name="local-6989586621679407555"><a href="#local-6989586621679407555"><span class="hs-identifier">lc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407555"><span class="hs-identifier hs-var">lc</span></a><span>
</span><a name="line-1473"></a><span class="hs-identifier">extendLiftingContextEx</span><span> </span><a name="local-6989586621679407556"><a href="#local-6989586621679407556"><span class="hs-identifier">lc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407557"><a href="#local-6989586621679407557"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407558"><a href="#local-6989586621679407558"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679407559"><a href="#local-6989586621679407559"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><a name="local-6989586621679407560"><a href="#local-6989586621679407560"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679407561"><a href="#local-6989586621679407561"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1474"></a><span class="hs-comment">-- This function adds bindings for *Nominal* coercions. Why? Because it</span><span>
</span><a name="line-1475"></a><span class="hs-comment">-- works with existentially bound variables, which are considered to have</span><span>
</span><a name="line-1476"></a><span class="hs-comment">-- nominal roles.</span><span>
</span><a name="line-1477"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679407562"><a href="#local-6989586621679407562"><span class="hs-identifier">lc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407557"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621679407560"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><span>                 </span><span class="hs-special">(</span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621679407558"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679407559"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier hs-var">mkCoherenceCo</span></a><span>
</span><a name="line-1479"></a><span>                                         </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621679407560"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1480"></a><span>                                         </span><span class="hs-special">(</span><a href="Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a><span> </span><a href="#local-6989586621679407556"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679407559"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1481"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a><span> </span><a href="#local-6989586621679407562"><span class="hs-identifier hs-var">lc'</span></a><span> </span><a href="#local-6989586621679407561"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1482"></a><span>
</span><a name="line-1483"></a><span class="hs-comment">-- | Erase the environments in a lifting context</span><span>
</span><a name="line-1484"></a><span class="hs-identifier">zapLiftingContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1485"></a><a name="zapLiftingContext"><a href="Coercion.html#zapLiftingContext"><span class="hs-identifier">zapLiftingContext</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407563"><a href="#local-6989586621679407563"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a><span> </span><a href="#local-6989586621679407563"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-1486"></a><span>
</span><a name="line-1487"></a><span class="hs-comment">-- | Like 'substForAllCoBndr', but works on a lifting context</span><span>
</span><a name="line-1488"></a><span class="hs-identifier">substForAllCoBndrCallbackLC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1489"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1491"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><a name="substForAllCoBndrCallbackLC"><a href="Coercion.html#substForAllCoBndrCallbackLC"><span class="hs-identifier">substForAllCoBndrCallbackLC</span></a></a><span> </span><a name="local-6989586621679407564"><a href="#local-6989586621679407564"><span class="hs-identifier">sym</span></a></a><span> </span><a name="local-6989586621679407565"><a href="#local-6989586621679407565"><span class="hs-identifier">sco</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407566"><a href="#local-6989586621679407566"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407567"><a href="#local-6989586621679407567"><span class="hs-identifier">lc_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407568"><a href="#local-6989586621679407568"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407569"><a href="#local-6989586621679407569"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1493"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a href="#local-6989586621679407570"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-6989586621679407567"><span class="hs-identifier hs-var">lc_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407571"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407572"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1495"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407570"><a href="#local-6989586621679407570"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407571"><a href="#local-6989586621679407571"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407572"><a href="#local-6989586621679407572"><span class="hs-identifier">co'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substForAllCoBndrCallback"><span class="hs-identifier hs-var">substForAllCoBndrCallback</span></a><span> </span><a href="#local-6989586621679407564"><span class="hs-identifier hs-var">sym</span></a><span> </span><a href="#local-6989586621679407565"><span class="hs-identifier hs-var">sco</span></a><span> </span><a href="#local-6989586621679407566"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407568"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679407569"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span class="hs-comment">-- | The \&quot;lifting\&quot; operation which substitutes coercions for type</span><span>
</span><a name="line-1498"></a><span class="hs-comment">--   variables in a type to produce a coercion.</span><span>
</span><a name="line-1499"></a><span class="hs-comment">--</span><span>
</span><a name="line-1500"></a><span class="hs-comment">--   For the inverse operation, see 'liftCoMatch'</span><span>
</span><a name="line-1501"></a><span class="hs-identifier">ty_co_subst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1502"></a><a name="ty_co_subst"><a href="Coercion.html#ty_co_subst"><span class="hs-identifier">ty_co_subst</span></a></a><span> </span><a name="local-6989586621679407573"><a href="#local-6989586621679407573"><span class="hs-identifier">lc</span></a></a><span> </span><span class="hs-keyword">role</span><span> </span><a name="local-6989586621679407575"><a href="#local-6989586621679407575"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679407575"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1504"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1505"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1506"></a><span>    </span><a name="local-6989586621679407576"><a href="#local-6989586621679407576"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679407578"><a href="#local-6989586621679407578"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407579"><a href="#local-6989586621679407579"><span class="hs-identifier">ty</span></a></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407580"><a href="#local-6989586621679407580"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621679407579"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1507"></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407578"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407580"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1508"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span> </span><a name="local-6989586621679407581"><a href="#local-6989586621679407581"><span class="hs-identifier">ty</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407577"><span class="hs-identifier hs-var">lift_phantom</span></a><span> </span><a href="#local-6989586621679407581"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1509"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407582"><a href="#local-6989586621679407582"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679407583"><a href="#local-6989586621679407583"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;ty_co_subst bad roles&quot;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1510"></a><span>                             </span><a href="Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var">liftCoSubstTyVar</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407582"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407583"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1511"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407584"><a href="#local-6989586621679407584"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679407585"><a href="#local-6989586621679407585"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407586"><a href="#local-6989586621679407586"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407584"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407585"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407586"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1512"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407587"><a href="#local-6989586621679407587"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679407588"><a href="#local-6989586621679407588"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407589"><a href="#local-6989586621679407589"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-6989586621679407587"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407588"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a><span> </span><a href="#local-6989586621679407587"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407588"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407589"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407590"><a href="#local-6989586621679407590"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679407591"><a href="#local-6989586621679407591"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407592"><a href="#local-6989586621679407592"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621679407590"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407590"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407591"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407590"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407592"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1514"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407593"><a href="#local-6989586621679407593"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679407594"><a href="#local-6989586621679407594"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679407595"><a href="#local-6989586621679407595"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1515"></a><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407596"><a href="#local-6989586621679407596"><span class="hs-identifier">lc'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407597"><a href="#local-6989586621679407597"><span class="hs-identifier">v'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407598"><a href="#local-6989586621679407598"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-var">liftCoSubstVarBndr</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407594"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1516"></a><span>                             </span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span> </span><a href="#local-6989586621679407597"><span class="hs-identifier hs-var">v'</span></a><span> </span><a href="#local-6989586621679407598"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a><span> </span><a href="#local-6989586621679407596"><span class="hs-identifier hs-var">lc'</span></a><span> </span><a href="#local-6989586621679407593"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407595"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1517"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407599"><a href="#local-6989586621679407599"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407600"><a href="#local-6989586621679407600"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>                             </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-6989586621679407599"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407600"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1519"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407601"><a href="#local-6989586621679407601"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679407602"><a href="#local-6989586621679407602"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679407603"><a href="#local-6989586621679407603"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407601"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407602"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407603"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><span>                                                        </span><span class="hs-special">(</span><a href="Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407603"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1521"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407604"><a href="#local-6989586621679407604"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621679407605"><a href="#local-6989586621679407605"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a><span> </span><a href="#local-6989586621679407604"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407606"><span class="hs-identifier hs-var">kco</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407605"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>                                                  </span><span class="hs-special">(</span><a href="Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407605"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679407606"><a href="#local-6989586621679407606"><span class="hs-identifier">kco</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span> </span><a href="#local-6989586621679407605"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>
</span><a name="line-1525"></a><span>    </span><a name="local-6989586621679407577"><a href="#local-6989586621679407577"><span class="hs-identifier">lift_phantom</span></a></a><span> </span><a name="local-6989586621679407607"><a href="#local-6989586621679407607"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407576"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679407607"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1526"></a><span>                                  </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a><span>  </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407607"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1527"></a><span>                                  </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a><span> </span><a href="#local-6989586621679407573"><span class="hs-identifier hs-var">lc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407607"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1528"></a><span>
</span><a name="line-1529"></a><span class="hs-comment">{-
Note [liftCoSubstTyVar]
~~~~~~~~~~~~~~~~~~~~~~~~~
This function can fail if a coercion in the environment is of too low a role.

liftCoSubstTyVar is called from two places: in liftCoSubst (naturally), and
also in matchAxiom in OptCoercion. From liftCoSubst, the so-called lifting
lemma guarantees that the roles work out. If we fail in this
case, we really should panic -- something is deeply wrong. But, in matchAxiom,
failing is fine. matchAxiom is trying to find a set of coercions
that match, but it may fail, and this is healthy behavior.
-}</span><span>
</span><a name="line-1541"></a><span>
</span><a name="line-1542"></a><span class="hs-comment">-- See Note [liftCoSubstTyVar]</span><span>
</span><a name="line-1543"></a><span class="hs-identifier">liftCoSubstTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1544"></a><a name="liftCoSubstTyVar"><a href="Coercion.html#liftCoSubstTyVar"><span class="hs-identifier">liftCoSubstTyVar</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407608"><a href="#local-6989586621679407608"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407609"><a href="#local-6989586621679407609"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407610"><a href="#local-6989586621679407610"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407611"><a href="#local-6989586621679407611"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1545"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407612"><a href="#local-6989586621679407612"><span class="hs-identifier">co_arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-6989586621679407609"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679407611"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1546"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a><span> </span><a href="#local-6989586621679407610"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a><span> </span><a href="#local-6989586621679407612"><span class="hs-identifier hs-var">co_arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407612"><span class="hs-identifier hs-var">co_arg</span></a><span>
</span><a name="line-1547"></a><span>
</span><a name="line-1548"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1549"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-6989586621679407610"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span> </span><a href="#local-6989586621679407608"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407611"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1550"></a><span>
</span><a name="line-1551"></a><span class="hs-identifier">liftCoSubstVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1552"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1553"></a><a name="liftCoSubstVarBndr"><a href="Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier">liftCoSubstVarBndr</span></a></a><span> </span><a name="local-6989586621679407613"><a href="#local-6989586621679407613"><span class="hs-identifier">lc</span></a></a><span> </span><a name="local-6989586621679407614"><a href="#local-6989586621679407614"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1554"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407618"><a href="#local-6989586621679407618"><span class="hs-identifier">lc'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407619"><a href="#local-6989586621679407619"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407620"><a href="#local-6989586621679407620"><span class="hs-identifier">h</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftCoSubstVarBndrCallback"><span class="hs-identifier hs-var">liftCoSubstVarBndrCallback</span></a><span> </span><a href="#local-6989586621679407615"><span class="hs-identifier hs-var">callback</span></a><span> </span><a href="#local-6989586621679407613"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407614"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1555"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679407618"><span class="hs-identifier hs-var">lc'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407619"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407620"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-1556"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1557"></a><span>    </span><a name="local-6989586621679407615"><a href="#local-6989586621679407615"><span class="hs-identifier">callback</span></a></a><span> </span><a name="local-6989586621679407616"><a href="#local-6989586621679407616"><span class="hs-identifier">lc'</span></a></a><span> </span><a name="local-6989586621679407617"><a href="#local-6989586621679407617"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a><span> </span><a href="#local-6989586621679407616"><span class="hs-identifier hs-var">lc'</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-6989586621679407617"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1558"></a><span>
</span><a name="line-1559"></a><span class="hs-comment">-- the callback must produce a nominal coercion</span><span>
</span><a name="line-1560"></a><span class="hs-identifier">liftCoSubstVarBndrCallback</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407074"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1561"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1562"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407074"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><a name="liftCoSubstVarBndrCallback"><a href="Coercion.html#liftCoSubstVarBndrCallback"><span class="hs-identifier">liftCoSubstVarBndrCallback</span></a></a><span> </span><a name="local-6989586621679407621"><a href="#local-6989586621679407621"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679407622"><a href="#local-6989586621679407622"><span class="hs-identifier">lc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407623"><a href="#local-6989586621679407623"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407624"><a href="#local-6989586621679407624"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407625"><a href="#local-6989586621679407625"><span class="hs-identifier">old_var</span></a></a><span>
</span><a name="line-1564"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407623"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407630"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407632"><span class="hs-identifier hs-var">new_cenv</span></a><span>
</span><a name="line-1565"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407630"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407627"><span class="hs-identifier hs-var">eta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407628"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1567"></a><span>    </span><a name="local-6989586621679407626"><a href="#local-6989586621679407626"><span class="hs-identifier">old_kind</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679407625"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-1568"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407627"><a href="#local-6989586621679407627"><span class="hs-identifier">eta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407628"><a href="#local-6989586621679407628"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407621"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679407622"><span class="hs-identifier hs-var">lc</span></a><span> </span><a href="#local-6989586621679407626"><span class="hs-identifier hs-var">old_kind</span></a><span>
</span><a name="line-1569"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407629"><a href="#local-6989586621679407629"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407627"><span class="hs-identifier hs-var">eta</span></a><span>
</span><a name="line-1570"></a><span>    </span><a name="local-6989586621679407630"><a href="#local-6989586621679407630"><span class="hs-identifier">new_var</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a><span> </span><a href="#local-6989586621679407623"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621679407625"><span class="hs-identifier hs-var">old_var</span></a><span> </span><a href="#local-6989586621679407629"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span>    </span><a name="local-6989586621679407631"><a href="#local-6989586621679407631"><span class="hs-identifier">lifted</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-6989586621679407630"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-1573"></a><span>    </span><a name="local-6989586621679407632"><a href="#local-6989586621679407632"><span class="hs-identifier">new_cenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621679407624"><span class="hs-identifier hs-var">cenv</span></a><span> </span><a href="#local-6989586621679407625"><span class="hs-identifier hs-var">old_var</span></a><span> </span><a href="#local-6989586621679407631"><span class="hs-identifier hs-var">lifted</span></a><span>
</span><a name="line-1574"></a><span>
</span><a name="line-1575"></a><span class="hs-comment">-- | Is a var in the domain of a lifting context?</span><span>
</span><a name="line-1576"></a><span class="hs-identifier">isMappedByLC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1577"></a><a name="isMappedByLC"><a href="Coercion.html#isMappedByLC"><span class="hs-identifier">isMappedByLC</span></a></a><span> </span><a name="local-6989586621679407633"><a href="#local-6989586621679407633"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407634"><a href="#local-6989586621679407634"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407633"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#elemVarEnv"><span class="hs-identifier hs-var">elemVarEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407634"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-1578"></a><span>
</span><a name="line-1579"></a><span class="hs-comment">-- If [a |-&gt; g] is in the substitution and g :: t1 ~ t2, substitute a for t1</span><span>
</span><a name="line-1580"></a><span class="hs-comment">-- If [a |-&gt; (g1, g2)] is in the substitution, substitute a for g1</span><span>
</span><a name="line-1581"></a><span class="hs-identifier">substLeftCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1582"></a><a name="substLeftCo"><a href="Coercion.html#substLeftCo"><span class="hs-identifier">substLeftCo</span></a></a><span> </span><a name="local-6989586621679407635"><a href="#local-6989586621679407635"><span class="hs-identifier">lc</span></a></a><span> </span><a name="local-6989586621679407636"><a href="#local-6989586621679407636"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1583"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a><span> </span><a href="#local-6989586621679407635"><span class="hs-identifier hs-var">lc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407636"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1584"></a><span>
</span><a name="line-1585"></a><span class="hs-comment">-- Ditto, but for t2 and g2</span><span>
</span><a name="line-1586"></a><span class="hs-identifier">substRightCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1587"></a><a name="substRightCo"><a href="Coercion.html#substRightCo"><span class="hs-identifier">substRightCo</span></a></a><span> </span><a name="local-6989586621679407637"><a href="#local-6989586621679407637"><span class="hs-identifier">lc</span></a></a><span> </span><a name="local-6989586621679407638"><a href="#local-6989586621679407638"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1588"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a><span> </span><a href="#local-6989586621679407637"><span class="hs-identifier hs-var">lc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407638"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span class="hs-comment">-- | Apply &quot;sym&quot; to all coercions in a 'LiftCoEnv'</span><span>
</span><a name="line-1591"></a><span class="hs-identifier">swapLiftCoEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1592"></a><a name="swapLiftCoEnv"><a href="Coercion.html#swapLiftCoEnv"><span class="hs-identifier">swapLiftCoEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span>
</span><a name="line-1593"></a><span>
</span><a name="line-1594"></a><span class="hs-identifier">lcSubstLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1595"></a><a name="lcSubstLeft"><a href="Coercion.html#lcSubstLeft"><span class="hs-identifier">lcSubstLeft</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407639"><a href="#local-6989586621679407639"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407640"><a href="#local-6989586621679407640"><span class="hs-identifier">lc_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var">liftEnvSubstLeft</span></a><span> </span><a href="#local-6989586621679407639"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407640"><span class="hs-identifier hs-var">lc_env</span></a><span>
</span><a name="line-1596"></a><span>
</span><a name="line-1597"></a><span class="hs-identifier">lcSubstRight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1598"></a><a name="lcSubstRight"><a href="Coercion.html#lcSubstRight"><span class="hs-identifier">lcSubstRight</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407641"><a href="#local-6989586621679407641"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407642"><a href="#local-6989586621679407642"><span class="hs-identifier">lc_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var">liftEnvSubstRight</span></a><span> </span><a href="#local-6989586621679407641"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407642"><span class="hs-identifier hs-var">lc_env</span></a><span>
</span><a name="line-1599"></a><span>
</span><a name="line-1600"></a><span class="hs-identifier">liftEnvSubstLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1601"></a><a name="liftEnvSubstLeft"><a href="Coercion.html#liftEnvSubstLeft"><span class="hs-identifier">liftEnvSubstLeft</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a><span> </span><span class="hs-identifier">pFst</span><span>
</span><a name="line-1602"></a><span>
</span><a name="line-1603"></a><span class="hs-identifier">liftEnvSubstRight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1604"></a><a name="liftEnvSubstRight"><a href="Coercion.html#liftEnvSubstRight"><span class="hs-identifier">liftEnvSubstRight</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a><span> </span><span class="hs-identifier">pSnd</span><span>
</span><a name="line-1605"></a><span>
</span><a name="line-1606"></a><span class="hs-identifier">liftEnvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679407073"><a href="#local-6989586621679407073"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="#local-6989586621679407073"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679407073"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1607"></a><a name="liftEnvSubst"><a href="Coercion.html#liftEnvSubst"><span class="hs-identifier">liftEnvSubst</span></a></a><span> </span><a name="local-6989586621679407643"><a href="#local-6989586621679407643"><span class="hs-identifier">selector</span></a></a><span> </span><a name="local-6989586621679407644"><a href="#local-6989586621679407644"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679407645"><a href="#local-6989586621679407645"><span class="hs-identifier">lc_env</span></a></a><span>
</span><a name="line-1608"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#composeTCvSubst"><span class="hs-identifier hs-var">composeTCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a href="VarEnv.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a><span> </span><a href="#local-6989586621679407649"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-6989586621679407650"><span class="hs-identifier hs-var">cenv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407644"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1609"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1610"></a><span>    </span><a name="local-6989586621679407646"><a href="#local-6989586621679407646"><span class="hs-identifier">pairs</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a><span> </span><a href="#local-6989586621679407645"><span class="hs-identifier hs-var">lc_env</span></a><span>
</span><a name="line-1611"></a><span>                       </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we</span><span>
</span><a name="line-1612"></a><span>                       </span><span class="hs-comment">-- immediately forget the ordering by creating</span><span>
</span><a name="line-1613"></a><span>                       </span><span class="hs-comment">-- a VarEnv</span><span>
</span><a name="line-1614"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679407647"><a href="#local-6989586621679407647"><span class="hs-identifier">tpairs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407648"><a href="#local-6989586621679407648"><span class="hs-identifier">cpairs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-6989586621679407651"><span class="hs-identifier hs-var">ty_or_co</span></a><span> </span><a href="#local-6989586621679407646"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-1615"></a><span>    </span><a name="local-6989586621679407649"><a href="#local-6989586621679407649"><span class="hs-identifier">tenv</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a><span> </span><a href="#local-6989586621679407647"><span class="hs-identifier hs-var">tpairs</span></a><span>
</span><a name="line-1616"></a><span>    </span><a name="local-6989586621679407650"><a href="#local-6989586621679407650"><span class="hs-identifier">cenv</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a><span> </span><a href="#local-6989586621679407648"><span class="hs-identifier hs-var">cpairs</span></a><span>
</span><a name="line-1617"></a><span>
</span><a name="line-1618"></a><span>    </span><span class="hs-identifier">ty_or_co</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1619"></a><span>    </span><a name="local-6989586621679407651"><a href="#local-6989586621679407651"><span class="hs-identifier">ty_or_co</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407652"><a href="#local-6989586621679407652"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407653"><a href="#local-6989586621679407653"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1620"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407655"><a href="#local-6989586621679407655"><span class="hs-identifier">equality_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#isCoercionTy_maybe"><span class="hs-identifier hs-var">isCoercionTy_maybe</span></a><span> </span><a href="#local-6989586621679407654"><span class="hs-identifier hs-var">equality_ty</span></a><span>
</span><a name="line-1621"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407652"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407655"><span class="hs-identifier hs-var">equality_co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1622"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1623"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407652"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407654"><span class="hs-identifier hs-var">equality_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1624"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1625"></a><span>        </span><a name="local-6989586621679407654"><a href="#local-6989586621679407654"><span class="hs-identifier">equality_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407643"><span class="hs-identifier hs-var">selector</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407653"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1626"></a><span>
</span><a name="line-1627"></a><span class="hs-comment">-- | Extract the underlying substitution from the LiftingContext</span><span>
</span><a name="line-1628"></a><span class="hs-identifier">lcTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1629"></a><a name="lcTCvSubst"><a href="Coercion.html#lcTCvSubst"><span class="hs-identifier">lcTCvSubst</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407656"><a href="#local-6989586621679407656"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407656"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span class="hs-comment">-- | Get the 'InScopeSet' from a 'LiftingContext'</span><span>
</span><a name="line-1632"></a><span class="hs-identifier">lcInScopeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a><span>
</span><a name="line-1633"></a><a name="lcInScopeSet"><a href="Coercion.html#lcInScopeSet"><span class="hs-identifier">lcInScopeSet</span></a></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><a name="local-6989586621679407657"><a href="#local-6989586621679407657"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a><span> </span><a href="#local-6989586621679407657"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Sequencing on coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1644"></a><a name="seqCo"><a href="Coercion.html#seqCo"><span class="hs-identifier">seqCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407658"><a href="#local-6989586621679407658"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407659"><a href="#local-6989586621679407659"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407658"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621679407659"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1645"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621679407660"><a href="#local-6989586621679407660"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407661"><a href="#local-6989586621679407661"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407662"><a href="#local-6989586621679407662"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407660"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407661"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a><span> </span><a href="#local-6989586621679407662"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1646"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407663"><a href="#local-6989586621679407663"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407664"><a href="#local-6989586621679407664"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407663"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407664"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1647"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407665"><a href="#local-6989586621679407665"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679407666"><a href="#local-6989586621679407666"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679407667"><a href="#local-6989586621679407667"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679407665"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407666"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1648"></a><span>                                                         </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407667"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1649"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a name="local-6989586621679407668"><a href="#local-6989586621679407668"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407669"><a href="#local-6989586621679407669"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407670"><a href="#local-6989586621679407670"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407668"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407669"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407670"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1650"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679407671"><a href="#local-6989586621679407671"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407671"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1651"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621679407672"><a href="#local-6989586621679407672"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621679407672"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1652"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621679407673"><a href="#local-6989586621679407673"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679407674"><a href="#local-6989586621679407674"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-6989586621679407675"><a href="#local-6989586621679407675"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407673"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407674"><span class="hs-identifier hs-var">ind</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a><span> </span><a href="#local-6989586621679407675"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1653"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621679407676"><a href="#local-6989586621679407676"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679407677"><a href="#local-6989586621679407677"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407678"><a href="#local-6989586621679407678"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679407679"><a href="#local-6989586621679407679"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1654"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqProv"><span class="hs-identifier hs-var">seqProv</span></a><span> </span><a href="#local-6989586621679407676"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407677"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621679407678"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621679407679"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1655"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407680"><a href="#local-6989586621679407680"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407680"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1656"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679407681"><a href="#local-6989586621679407681"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407682"><a href="#local-6989586621679407682"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407681"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407682"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1657"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621679407683"><a href="#local-6989586621679407683"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679407684"><a href="#local-6989586621679407684"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407683"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407684"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1658"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621679407685"><a href="#local-6989586621679407685"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679407686"><a href="#local-6989586621679407686"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407685"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407686"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1659"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407687"><a href="#local-6989586621679407687"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407688"><a href="#local-6989586621679407688"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407687"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407688"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1660"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407689"><a href="#local-6989586621679407689"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407690"><a href="#local-6989586621679407690"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407689"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407690"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1661"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621679407691"><a href="#local-6989586621679407691"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407691"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1662"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679407692"><a href="#local-6989586621679407692"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407692"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1663"></a><span class="hs-identifier">seqCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407693"><a href="#local-6989586621679407693"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a><span> </span><a href="#local-6989586621679407693"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1664"></a><span>
</span><a name="line-1665"></a><span class="hs-identifier">seqProv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1666"></a><a name="seqProv"><a href="Coercion.html#seqProv"><span class="hs-identifier">seqProv</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span class="hs-identifier">seqProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621679407694"><a href="#local-6989586621679407694"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407694"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1668"></a><span class="hs-identifier">seqProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621679407695"><a href="#local-6989586621679407695"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407695"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1669"></a><span class="hs-identifier">seqProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>
</span><a name="line-1671"></a><span class="hs-identifier">seqCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1672"></a><a name="seqCos"><a href="Coercion.html#seqCos"><span class="hs-identifier">seqCos</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1673"></a><span class="hs-identifier">seqCos</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407696"><a href="#local-6989586621679407696"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679407697"><a href="#local-6989586621679407697"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621679407696"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a><span> </span><a href="#local-6989586621679407697"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1674"></a><span>
</span><a name="line-1675"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             The kind of a type, and of a coercion
%*                                                                      *
%************************************************************************

Note [Computing a coercion kind and role]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To compute a coercion's kind is straightforward: see coercionKind.
But to compute a coercion's role, in the case for NthCo we need
its kind as well.  So if we have two separate functions (one for kinds
and one for roles) we can get exponentially bad behaviour, since each
NthCo node makes a separate call to coercionKind, which traverses the
sub-tree again.  This was part of the problem in Trac #9233.

Solution: compute both together; hence coercionKindRole.  We keep a
separate coercionKind function because it's a bit more efficient if
the kind is all you want.
-}</span><span>
</span><a name="line-1695"></a><span>
</span><a name="line-1696"></a><span class="hs-identifier">coercionType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1697"></a><a name="coercionType"><a href="Coercion.html#coercionType"><span class="hs-identifier">coercionType</span></a></a><span> </span><a name="local-6989586621679407698"><a href="#local-6989586621679407698"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a><span> </span><a href="#local-6989586621679407698"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1698"></a><span>  </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407699"><a href="#local-6989586621679407699"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407700"><a href="#local-6989586621679407700"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407701"><a href="#local-6989586621679407701"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a><span> </span><a href="#local-6989586621679407701"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407699"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407700"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1699"></a><span>
</span><a name="line-1700"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-1701"></a><span class="hs-comment">-- | If it is the case that</span><span>
</span><a name="line-1702"></a><span class="hs-comment">--</span><span>
</span><a name="line-1703"></a><span class="hs-comment">-- &gt; c :: (t1 ~ t2)</span><span>
</span><a name="line-1704"></a><span class="hs-comment">--</span><span>
</span><a name="line-1705"></a><span class="hs-comment">-- i.e. the kind of @c@ relates @t1@ and @t2@, then @coercionKind c = Pair t1 t2@.</span><span>
</span><a name="line-1706"></a><span>
</span><a name="line-1707"></a><span class="hs-identifier">coercionKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1708"></a><a name="coercionKind"><a href="Coercion.html#coercionKind"><span class="hs-identifier">coercionKind</span></a></a><span> </span><a name="local-6989586621679407702"><a href="#local-6989586621679407702"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407702"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1710"></a><span>    </span><a name="local-6989586621679407703"><a href="#local-6989586621679407703"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407706"><a href="#local-6989586621679407706"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407706"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679407706"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1711"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407707"><a href="#local-6989586621679407707"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407708"><a href="#local-6989586621679407708"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621679407707"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407708"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1712"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407709"><a href="#local-6989586621679407709"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407710"><a href="#local-6989586621679407710"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407709"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407710"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1713"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407711"><a href="#local-6989586621679407711"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621679407712"><a href="#local-6989586621679407712"><span class="hs-identifier">k_co</span></a></a><span> </span><a name="local-6989586621679407713"><a href="#local-6989586621679407713"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1714"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407714"><a href="#local-6989586621679407714"><span class="hs-identifier">k2</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407712"><span class="hs-identifier hs-var">k_co</span></a><span>
</span><a name="line-1715"></a><span>            </span><a name="local-6989586621679407715"><a href="#local-6989586621679407715"><span class="hs-identifier">tv2</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-6989586621679407711"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679407714"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-1716"></a><span>            </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407716"><a href="#local-6989586621679407716"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407717"><a href="#local-6989586621679407717"><span class="hs-identifier">ty2</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407713"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1717"></a><span>            </span><a name="local-6989586621679407718"><a href="#local-6989586621679407718"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407711"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-6989586621679407715"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679407705"><span class="hs-identifier hs-var">mk_cast_ty</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621679407712"><span class="hs-identifier hs-var">k_co</span></a><span class="hs-special">]</span><span>
</span><a name="line-1718"></a><span>            </span><a name="local-6989586621679407719"><a href="#local-6989586621679407719"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-6989586621679407718"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407717"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1719"></a><span>            </span><span class="hs-comment">-- We need free vars of ty2 in scope to satisfy the invariant</span><span>
</span><a name="line-1720"></a><span>            </span><span class="hs-comment">-- from Note [The substitution invariant]</span><span>
</span><a name="line-1721"></a><span>            </span><span class="hs-comment">-- This is doing repeated substitutions and probably doesn't</span><span>
</span><a name="line-1722"></a><span>            </span><span class="hs-comment">-- need to, see #11735</span><span>
</span><a name="line-1723"></a><span>        </span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407711"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679407715"><span class="hs-identifier hs-var">tv2</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407716"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407719"><span class="hs-identifier hs-var">ty2'</span></a><span>
</span><a name="line-1724"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407720"><a href="#local-6989586621679407720"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407721"><a href="#local-6989586621679407721"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407720"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407721"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1725"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679407722"><a href="#local-6989586621679407722"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a><span> </span><a href="#local-6989586621679407722"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1726"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621679407723"><a href="#local-6989586621679407723"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621679407723"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-1727"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621679407724"><a href="#local-6989586621679407724"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407725"><a href="#local-6989586621679407725"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-6989586621679407726"><a href="#local-6989586621679407726"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1728"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407727"><a href="#local-6989586621679407727"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407728"><a href="#local-6989586621679407728"><span class="hs-identifier">cvs</span></a></a><span>
</span><a name="line-1729"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407729"><a href="#local-6989586621679407729"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679407730"><a href="#local-6989586621679407730"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621679407724"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621679407725"><span class="hs-identifier hs-var">ind</span></a><span>
</span><a name="line-1730"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407731"><a href="#local-6989586621679407731"><span class="hs-identifier">tycos1</span></a></a><span> </span><a name="local-6989586621679407732"><a href="#local-6989586621679407732"><span class="hs-identifier">tycos2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407726"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679407733"><a href="#local-6989586621679407733"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407734"><a href="#local-6989586621679407734"><span class="hs-identifier">cotys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621679407727"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407731"><span class="hs-identifier hs-var">tycos1</span></a><span>
</span><a name="line-1732"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679407735"><a href="#local-6989586621679407735"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407736"><a href="#local-6989586621679407736"><span class="hs-identifier">cotys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621679407727"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407732"><span class="hs-identifier hs-var">tycos2</span></a><span>
</span><a name="line-1733"></a><span>            </span><a name="local-6989586621679407737"><a href="#local-6989586621679407737"><span class="hs-identifier">cos1</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a><span> </span><a href="#local-6989586621679407734"><span class="hs-identifier hs-var">cotys1</span></a><span>
</span><a name="line-1734"></a><span>            </span><a name="local-6989586621679407738"><a href="#local-6989586621679407738"><span class="hs-identifier">cos2</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a><span> </span><a href="#local-6989586621679407736"><span class="hs-identifier hs-var">cotys2</span></a><span>
</span><a name="line-1735"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">cos</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="Util.html#equalLength"><span class="hs-operator hs-var">++</span></a><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">cvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1736"></a><span>                  </span><span class="hs-comment">-- Invariant of AxiomInstCo: cos should</span><span>
</span><a name="line-1737"></a><span>                  </span><span class="hs-comment">-- exactly saturate the axiom branch</span><span>
</span><a name="line-1738"></a><span>        </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><a href="#local-6989586621679407727"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407733"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1739"></a><span>              </span><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a><span> </span><a href="#local-6989586621679407728"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-6989586621679407737"><span class="hs-identifier hs-var">cos1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1740"></a><span>              </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a><span> </span><a href="#local-6989586621679407724"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407729"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1741"></a><span>             </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><a href="#local-6989586621679407727"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679407735"><span class="hs-identifier hs-var">tys2</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1742"></a><span>              </span><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a><span> </span><a href="#local-6989586621679407728"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-6989586621679407738"><span class="hs-identifier hs-var">cos2</span></a><span> </span><a href="#local-6989586621679407730"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1743"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407739"><a href="#local-6989586621679407739"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407740"><a href="#local-6989586621679407740"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407739"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407740"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1744"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407741"><a href="#local-6989586621679407741"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#swap"><span class="hs-identifier hs-var">swap</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407741"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1745"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679407742"><a href="#local-6989586621679407742"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407743"><a href="#local-6989586621679407743"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407742"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pSnd</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407743"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1746"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407744"><a href="#local-6989586621679407744"><span class="hs-identifier">g</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621679407745"><a href="#local-6989586621679407745"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679407746"><a href="#local-6989586621679407746"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1747"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407748"><a href="#local-6989586621679407748"><span class="hs-identifier">argss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span> </span><a href="#local-6989586621679407747"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1748"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">and</span></a><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">lengthExceeds</span><span class="hs-special">`</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">argss</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1749"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407745"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407748"><span class="hs-identifier hs-var">argss</span></a><span>
</span><a name="line-1750"></a><span>
</span><a name="line-1751"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679407745"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1752"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679407749"><a href="#local-6989586621679407749"><span class="hs-identifier">splits</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621679407747"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1753"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407749"><span class="hs-identifier hs-var">splits</span></a><span>
</span><a name="line-1754"></a><span>
</span><a name="line-1755"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1756"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;coercionKind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679407744"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1757"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1758"></a><span>        </span><a name="local-6989586621679407747"><a href="#local-6989586621679407747"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407746"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1759"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621679407750"><a href="#local-6989586621679407750"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679407751"><a href="#local-6989586621679407751"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a><span> </span><a href="#local-6989586621679407750"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407751"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1760"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407752"><a href="#local-6989586621679407752"><span class="hs-identifier">aco</span></a></a><span> </span><a name="local-6989586621679407753"><a href="#local-6989586621679407753"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407704"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679407752"><span class="hs-identifier hs-var">aco</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407753"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1761"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407754"><a href="#local-6989586621679407754"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679407755"><a href="#local-6989586621679407755"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1762"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407756"><a href="#local-6989586621679407756"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407757"><a href="#local-6989586621679407757"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407754"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1763"></a><span>        </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><a href="#local-6989586621679407756"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407755"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407757"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1764"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621679407758"><a href="#local-6989586621679407758"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407758"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1765"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679407759"><a href="#local-6989586621679407759"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407759"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1766"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-6989586621679407760"><a href="#local-6989586621679407760"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621679407761"><a href="#local-6989586621679407761"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;coercionKind&quot;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1767"></a><span>                              </span><span class="hs-identifier">coaxrProves</span><span> </span><a href="#local-6989586621679407760"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407761"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1768"></a><span>
</span><a name="line-1769"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1770"></a><span>    </span><span class="hs-comment">-- Collect up all the arguments and apply all at once</span><span>
</span><a name="line-1771"></a><span>    </span><span class="hs-comment">-- See Note [Nested InstCos]</span><span>
</span><a name="line-1772"></a><span>    </span><a name="local-6989586621679407704"><a href="#local-6989586621679407704"><span class="hs-identifier">go_app</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407762"><a href="#local-6989586621679407762"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407763"><a href="#local-6989586621679407763"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407764"><a href="#local-6989586621679407764"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407704"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679407762"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407763"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679407764"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1773"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><a name="local-6989586621679407765"><a href="#local-6989586621679407765"><span class="hs-identifier">co</span></a></a><span>              </span><a name="local-6989586621679407766"><a href="#local-6989586621679407766"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407765"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679407703"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407766"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span>
</span><a name="line-1775"></a><span>    </span><span class="hs-comment">-- The real mkCastTy is too slow, and we can easily have nested ForAllCos.</span><span>
</span><a name="line-1776"></a><span>    </span><span class="hs-identifier">mk_cast_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1777"></a><span>    </span><a name="local-6989586621679407705"><a href="#local-6989586621679407705"><span class="hs-identifier">mk_cast_ty</span></a></a><span> </span><a name="local-6989586621679407767"><a href="#local-6989586621679407767"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407767"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1778"></a><span>    </span><span class="hs-identifier">mk_cast_ty</span><span> </span><a name="local-6989586621679407768"><a href="#local-6989586621679407768"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679407769"><a href="#local-6989586621679407769"><span class="hs-identifier">co</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a href="#local-6989586621679407768"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679407769"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1779"></a><span>
</span><a name="line-1780"></a><span class="hs-comment">-- | Apply 'coercionKind' to multiple 'Coercion's</span><span>
</span><a name="line-1781"></a><span class="hs-identifier">coercionKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1782"></a><a name="coercionKinds"><a href="Coercion.html#coercionKinds"><span class="hs-identifier">coercionKinds</span></a></a><span> </span><a name="local-6989586621679407770"><a href="#local-6989586621679407770"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407770"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1783"></a><span>
</span><a name="line-1784"></a><span class="hs-comment">-- | Get a coercion's kind and role.</span><span>
</span><a name="line-1785"></a><span class="hs-comment">-- Why both at once?  See Note [Computing a coercion kind and role]</span><span>
</span><a name="line-1786"></a><span class="hs-identifier">coercionKindRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">)</span><span>
</span><a name="line-1787"></a><a name="coercionKindRole"><a href="Coercion.html#coercionKindRole"><span class="hs-identifier">coercionKindRole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-1788"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1789"></a><span>    </span><a name="local-6989586621679407771"><a href="#local-6989586621679407771"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621679407774"><a href="#local-6989586621679407774"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407775"><a href="#local-6989586621679407775"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407775"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679407775"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407774"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1790"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621679407776"><a href="#local-6989586621679407776"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407777"><a href="#local-6989586621679407777"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679407778"><a href="#local-6989586621679407778"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1791"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621679407777"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407778"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407776"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1792"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679407779"><a href="#local-6989586621679407779"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407780"><a href="#local-6989586621679407780"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1793"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407781"><a href="#local-6989586621679407781"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407782"><a href="#local-6989586621679407782"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407779"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1794"></a><span>        </span><span class="hs-special">(</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407781"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407780"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407782"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1795"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679407783"><a href="#local-6989586621679407783"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621679407784"><a href="#local-6989586621679407784"><span class="hs-identifier">k_co</span></a></a><span> </span><a name="local-6989586621679407785"><a href="#local-6989586621679407785"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1796"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407786"><a href="#local-6989586621679407786"><span class="hs-identifier">k2</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407784"><span class="hs-identifier hs-var">k_co</span></a><span>
</span><a name="line-1797"></a><span>            </span><a name="local-6989586621679407787"><a href="#local-6989586621679407787"><span class="hs-identifier">tv2</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-6989586621679407783"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679407786"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-1798"></a><span>            </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407788"><a href="#local-6989586621679407788"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407789"><a href="#local-6989586621679407789"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407790"><a href="#local-6989586621679407790"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407785"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1799"></a><span>            </span><a name="local-6989586621679407791"><a href="#local-6989586621679407791"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407783"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-6989586621679407787"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621679407784"><span class="hs-identifier hs-var">k_co</span></a><span class="hs-special">]</span><span>
</span><a name="line-1800"></a><span>            </span><a name="local-6989586621679407792"><a href="#local-6989586621679407792"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-6989586621679407791"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679407789"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1801"></a><span>            </span><span class="hs-comment">-- We need free vars of ty2 in scope to satisfy the invariant</span><span>
</span><a name="line-1802"></a><span>            </span><span class="hs-comment">-- from Note [The substitution invariant]</span><span>
</span><a name="line-1803"></a><span>            </span><span class="hs-comment">-- This is doing repeated substitutions and probably doesn't</span><span>
</span><a name="line-1804"></a><span>            </span><span class="hs-comment">-- need to, see #11735</span><span>
</span><a name="line-1805"></a><span>        </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407783"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679407787"><span class="hs-identifier hs-var">tv2</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407788"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407792"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407790"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1806"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a name="local-6989586621679407793"><a href="#local-6989586621679407793"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407794"><a href="#local-6989586621679407794"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407795"><a href="#local-6989586621679407795"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1807"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407794"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407795"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407793"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1808"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679407796"><a href="#local-6989586621679407796"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407772"><span class="hs-identifier hs-var">go_var</span></a><span> </span><a href="#local-6989586621679407796"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1809"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621679407797"><a href="#local-6989586621679407797"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407772"><span class="hs-identifier hs-var">go_var</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621679407797"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-1810"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407798"><a href="#local-6989586621679407798"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621679407799"><a href="#local-6989586621679407799"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407798"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#coAxiomRole"><span class="hs-identifier hs-var">coAxiomRole</span></a><span> </span><a href="#local-6989586621679407799"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-1811"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679407800"><a href="#local-6989586621679407800"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679407801"><a href="#local-6989586621679407801"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407802"><a href="#local-6989586621679407802"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407801"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679407802"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407800"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1812"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679407803"><a href="#local-6989586621679407803"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><a href="Pair.html#swap"><span class="hs-identifier hs-var">swap</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407803"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1813"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679407804"><a href="#local-6989586621679407804"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407805"><a href="#local-6989586621679407805"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1814"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407806"><a href="#local-6989586621679407806"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407807"><a href="#local-6989586621679407807"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407804"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1815"></a><span>        </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><a href="#local-6989586621679407806"><span class="hs-identifier hs-var">tys1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pSnd</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407805"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407807"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1816"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621679407808"><a href="#local-6989586621679407808"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679407809"><a href="#local-6989586621679407809"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1817"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679407813"><a href="#local-6989586621679407813"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621679407810"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1818"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1819"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407814"><a href="#local-6989586621679407814"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTy"><span class="hs-identifier hs-var">splitForAllTy</span></a><span> </span><a href="#local-6989586621679407811"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1820"></a><span>        </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407813"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679407814"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-1821"></a><span>
</span><a name="line-1822"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1823"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407815"><a href="#local-6989586621679407815"><span class="hs-identifier">tc1</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679407816"><a href="#local-6989586621679407816"><span class="hs-identifier">args1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a><span> </span><a href="#local-6989586621679407810"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1824"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679407817"><a href="#local-6989586621679407817"><span class="hs-identifier">_tc2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407818"><a href="#local-6989586621679407818"><span class="hs-identifier">args2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a><span> </span><a href="#local-6989586621679407811"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1825"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-1826"></a><span>        </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">_tc2</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407815"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier hs-var">d</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tc1</span><span> </span><span class="hs-operator">$$</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">_tc2</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1827"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407808"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679407816"><span class="hs-identifier hs-var">args1</span></a><span> </span><a href="#local-6989586621679407818"><span class="hs-identifier hs-var">args2</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a><span> </span><a href="#local-6989586621679407812"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679407815"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="#local-6989586621679407808"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1828"></a><span>
</span><a name="line-1829"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1830"></a><span>        </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407810"><a href="#local-6989586621679407810"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679407811"><a href="#local-6989586621679407811"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407812"><a href="#local-6989586621679407812"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407809"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1831"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407819"><a href="#local-6989586621679407819"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407819"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-1832"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407820"><a href="#local-6989586621679407820"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407821"><a href="#local-6989586621679407821"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407773"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679407820"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679407821"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1833"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679407822"><a href="#local-6989586621679407822"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679407823"><a href="#local-6989586621679407823"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1834"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679407824"><a href="#local-6989586621679407824"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679407825"><a href="#local-6989586621679407825"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407826"><a href="#local-6989586621679407826"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407822"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1835"></a><span>        </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407824"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679407823"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679407825"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407826"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407827"><a href="#local-6989586621679407827"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407827"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679407828"><a href="#local-6989586621679407828"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407828"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679407829"><a href="#local-6989586621679407829"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-6989586621679407830"><a href="#local-6989586621679407830"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407829"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">coaxrRole</span><span> </span><a href="#local-6989586621679407830"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-1839"></a><span>
</span><a name="line-1840"></a><span>    </span><span class="hs-comment">-------------</span><span>
</span><a name="line-1841"></a><span>    </span><a name="local-6989586621679407772"><a href="#local-6989586621679407772"><span class="hs-identifier">go_var</span></a></a><span> </span><a name="local-6989586621679407831"><a href="#local-6989586621679407831"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a><span> </span><a href="#local-6989586621679407831"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a><span> </span><a href="#local-6989586621679407831"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1842"></a><span>
</span><a name="line-1843"></a><span>    </span><span class="hs-comment">-------------</span><span>
</span><a name="line-1844"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">)</span><span>
</span><a name="line-1845"></a><span>    </span><span class="hs-comment">-- Collect up all the arguments and apply all at once</span><span>
</span><a name="line-1846"></a><span>    </span><span class="hs-comment">-- See Note [Nested InstCos]</span><span>
</span><a name="line-1847"></a><span>    </span><a name="local-6989586621679407773"><a href="#local-6989586621679407773"><span class="hs-identifier">go_app</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679407832"><a href="#local-6989586621679407832"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679407833"><a href="#local-6989586621679407833"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679407834"><a href="#local-6989586621679407834"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407773"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679407832"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679407833"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679407834"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1848"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><a name="local-6989586621679407835"><a href="#local-6989586621679407835"><span class="hs-identifier">co</span></a></a><span>              </span><a name="local-6989586621679407836"><a href="#local-6989586621679407836"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1849"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679407837"><a href="#local-6989586621679407837"><span class="hs-identifier">pair</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679407838"><a href="#local-6989586621679407838"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679407771"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679407835"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1850"></a><span>        </span><span class="hs-special">(</span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621679407837"><span class="hs-identifier hs-var">pair</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621679407836"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679407838"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1851"></a><span>
</span><a name="line-1852"></a><span class="hs-comment">-- | Retrieve the role from a coercion.</span><span>
</span><a name="line-1853"></a><span class="hs-identifier">coercionRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-1854"></a><a name="coercionRole"><a href="Coercion.html#coercionRole"><span class="hs-identifier">coercionRole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a><span>
</span><a name="line-1855"></a><span>  </span><span class="hs-comment">-- There's not a better way to do this, because NthCo needs the *kind*</span><span>
</span><a name="line-1856"></a><span>  </span><span class="hs-comment">-- and role of its argument. Luckily, laziness should generally avoid</span><span>
</span><a name="line-1857"></a><span>  </span><span class="hs-comment">-- the need for computing kinds in other cases.</span><span>
</span><a name="line-1858"></a><span>
</span><a name="line-1859"></a><span class="hs-comment">{-
Note [Nested InstCos]
~~~~~~~~~~~~~~~~~~~~~
In Trac #5631 we found that 70% of the entire compilation time was
being spent in coercionKind!  The reason was that we had
   (g @ ty1 @ ty2 .. @ ty100)    -- The &quot;@s&quot; are InstCos
where
   g :: forall a1 a2 .. a100. phi
If we deal with the InstCos one at a time, we'll do this:
   1.  Find the kind of (g @ ty1 .. @ ty99) : forall a100. phi'
   2.  Substitute phi'[ ty100/a100 ], a single tyvar-&gt;type subst
But this is a *quadratic* algorithm, and the blew up Trac #5631.
So it's very important to do the substitution simultaneously;
cf Type.piResultTys (which in fact we call here).

-}</span><span>
</span><a name="line-1875"></a></pre></body></html>