<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">BuildTyCl</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>        </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier hs-var">buildPatSyn</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span class="hs-special">(</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span class="hs-special">,</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TysPrim.html#voidPrimTy"><span class="hs-identifier hs-var">voidPrimTy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span class="hs-special">(</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-identifier">mkDataTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-45"></a><a name="mkDataTyConRhs"><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier">mkDataTyConRhs</span></a></a><span> </span><a name="local-6989586621680194206"><a href="#local-6989586621680194206"><span class="hs-identifier">cons</span></a></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-47"></a><span>        </span><span class="hs-identifier">data_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194206"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><span class="hs-identifier">is_enum</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194206"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="#local-6989586621680194207"><span class="hs-identifier hs-var">is_enum_con</span></a><span> </span><a href="#local-6989586621680194206"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-49"></a><span>                  </span><span class="hs-comment">-- See Note [Enumeration types] in TyCon</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>    </span><a name="local-6989586621680194207"><a href="#local-6989586621680194207"><span class="hs-identifier">is_enum_con</span></a></a><span> </span><a name="local-6989586621680194208"><a href="#local-6989586621680194208"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-53"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680194209"><a href="#local-6989586621680194209"><span class="hs-identifier">_univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194210"><a href="#local-6989586621680194210"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194211"><a href="#local-6989586621680194211"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194212"><a href="#local-6989586621680194212"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194213"><a href="#local-6989586621680194213"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194214"><a href="#local-6989586621680194214"><span class="hs-identifier">_res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-6989586621680194208"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-55"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194210"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194211"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194212"><span class="hs-identifier hs-var">theta</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194213"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-identifier">mkNewTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194204"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680194205"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- ^ Monadic because it makes a Name for the coercion TyCon</span><span>
</span><a name="line-60"></a><span class="hs-comment">--   We pass the Name of the parent TyCon, as well as the TyCon itself,</span><span>
</span><a name="line-61"></a><span class="hs-comment">--   because the latter is part of a knot, whereas the former is not.</span><span>
</span><a name="line-62"></a><a name="mkNewTyConRhs"><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier">mkNewTyConRhs</span></a></a><span> </span><a name="local-6989586621680194215"><a href="#local-6989586621680194215"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680194216"><a href="#local-6989586621680194216"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621680194217"><a href="#local-6989586621680194217"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194238"><a href="#local-6989586621680194238"><span class="hs-identifier">co_tycon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194215"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkNewTyCoOcc"><span class="hs-identifier hs-var">mkNewTyCoOcc</span></a><span>
</span><a name="line-64"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680194239"><a href="#local-6989586621680194239"><span class="hs-identifier">nt_ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><a href="#local-6989586621680194238"><span class="hs-identifier hs-var">co_tycon_name</span></a><span> </span><a href="#local-6989586621680194216"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621680194222"><span class="hs-identifier hs-var">etad_tvs</span></a><span> </span><a href="#local-6989586621680194223"><span class="hs-identifier hs-var">etad_roles</span></a><span> </span><a href="#local-6989586621680194224"><span class="hs-identifier hs-var">etad_rhs</span></a><span>
</span><a name="line-65"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;mkNewTyConRhs&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194239"><span class="hs-identifier hs-var">nt_ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194217"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>                             </span><span class="hs-identifier">nt_rhs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194221"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>                             </span><span class="hs-identifier">nt_etad_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194222"><span class="hs-identifier hs-var">etad_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680194224"><span class="hs-identifier hs-var">etad_rhs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>                             </span><span class="hs-identifier">nt_co</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194239"><span class="hs-identifier hs-var">nt_ax</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-70"></a><span>                             </span><span class="hs-comment">-- Coreview looks through newtypes with a Nothing</span><span>
</span><a name="line-71"></a><span>                             </span><span class="hs-comment">-- for nt_co, or uses explicit coercions otherwise</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-73"></a><span>    </span><a name="local-6989586621680194218"><a href="#local-6989586621680194218"><span class="hs-identifier">tvs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621680194216"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621680194219"><a href="#local-6989586621680194219"><span class="hs-identifier">roles</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-6989586621680194216"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-75"></a><span>    </span><a name="local-6989586621680194220"><a href="#local-6989586621680194220"><span class="hs-identifier">con_arg_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a><span> </span><a href="#local-6989586621680194217"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-76"></a><span>                   </span><span class="hs-special">[</span><a name="local-6989586621680194226"><a href="#local-6989586621680194226"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680194226"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-77"></a><span>                   </span><a name="local-6989586621680194227"><a href="#local-6989586621680194227"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;mkNewTyConRhs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194217"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194227"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-6989586621680194221"><a href="#local-6989586621680194221"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a><span> </span><a href="#local-6989586621680194217"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>                         </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-6989586621680194218"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680194220"><span class="hs-identifier hs-var">con_arg_ty</span></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- Instantiate the newtype's RHS with the</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-comment">-- type variables from the tycon</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-comment">-- NB: a newtype DataCon has a type that must look like</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-comment">--        forall tvs.  &lt;arg-ty&gt; -&gt; T tvs</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-comment">-- Note that we *can't* use dataConInstOrigArgTys here because</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- the newtype arising from   class Foo a =&gt; Bar a where {}</span><span>
</span><a name="line-86"></a><span>        </span><span class="hs-comment">-- has a single argument (Foo a) that is a *type class*, so</span><span>
</span><a name="line-87"></a><span>        </span><span class="hs-comment">-- dataConInstOrigArgTys returns [].</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier">etad_tvs</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Matched lazily, so that mkNewTypeCo can</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier">etad_roles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- return a TyCon without pulling on rhs_ty</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier">etad_rhs</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>     </span><span class="hs-comment">-- See Note [Tricky iface loop] in LoadIface</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680194222"><a href="#local-6989586621680194222"><span class="hs-identifier">etad_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194223"><a href="#local-6989586621680194223"><span class="hs-identifier">etad_roles</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194224"><a href="#local-6989586621680194224"><span class="hs-identifier">etad_rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194225"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680194218"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680194219"><span class="hs-identifier hs-var">roles</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680194221"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Reversed</span><span>
</span><a name="line-95"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- also reversed</span><span>
</span><a name="line-96"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>          </span><span class="hs-comment">-- Rhs type</span><span>
</span><a name="line-97"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Eta-reduced version</span><span>
</span><a name="line-98"></a><span>                                           </span><span class="hs-comment">-- (tyvars in normal order)</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-6989586621680194225"><a href="#local-6989586621680194225"><span class="hs-identifier">eta_reduce</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680194228"><a href="#local-6989586621680194228"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680194230"><a href="#local-6989586621680194230"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680194231"><a href="#local-6989586621680194231"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680194232"><a href="#local-6989586621680194232"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194233"><a href="#local-6989586621680194233"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-6989586621680194231"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>                                  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680194234"><a href="#local-6989586621680194234"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-6989586621680194233"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>                                  </span><a href="#local-6989586621680194234"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680194228"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>                                  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194228"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680194232"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>                                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194225"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680194230"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621680194232"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><a name="local-6989586621680194235"><a href="#local-6989586621680194235"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621680194236"><a href="#local-6989586621680194236"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-6989586621680194237"><a href="#local-6989586621680194237"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680194235"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680194236"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680194237"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-107"></a><span class="hs-identifier">buildDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-108"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-109"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                     </span><span class="hs-comment">-- Declared infix</span><span>
</span><a name="line-110"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-111"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsImplBang"><span class="hs-identifier hs-type">HsImplBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>                </span><span class="hs-comment">-- See Note [Bangs on imported data constructors] in MkId</span><span>
</span><a name="line-114"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Field labels</span><span>
</span><a name="line-115"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- Universals</span><span>
</span><a name="line-116"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- Existentials</span><span>
</span><a name="line-117"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- User-written 'TyVarBinder's</span><span>
</span><a name="line-118"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Equality spec</span><span>
</span><a name="line-119"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>                </span><span class="hs-comment">-- Does not include the &quot;stupid theta&quot;</span><span>
</span><a name="line-120"></a><span>                                       </span><span class="hs-comment">-- or the GADT equalities</span><span>
</span><a name="line-121"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>           </span><span class="hs-comment">-- Argument and result types</span><span>
</span><a name="line-122"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>                    </span><span class="hs-comment">-- Rep tycon</span><span>
</span><a name="line-123"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194202"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680194203"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- A wrapper for DataCon.mkDataCon that</span><span>
</span><a name="line-125"></a><span class="hs-comment">--   a) makes the worker Id</span><span>
</span><a name="line-126"></a><span class="hs-comment">--   b) makes the wrapper Id if necessary, including</span><span>
</span><a name="line-127"></a><span class="hs-comment">--      allocating its unique (hence monadic)</span><span>
</span><a name="line-128"></a><a name="buildDataCon"><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier">buildDataCon</span></a></a><span> </span><a name="local-6989586621680194240"><a href="#local-6989586621680194240"><span class="hs-identifier">fam_envs</span></a></a><span> </span><a name="local-6989586621680194241"><a href="#local-6989586621680194241"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-6989586621680194242"><a href="#local-6989586621680194242"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-6989586621680194243"><a href="#local-6989586621680194243"><span class="hs-identifier">prom_info</span></a></a><span> </span><a name="local-6989586621680194244"><a href="#local-6989586621680194244"><span class="hs-identifier">src_bangs</span></a></a><span> </span><a name="local-6989586621680194245"><a href="#local-6989586621680194245"><span class="hs-identifier">impl_bangs</span></a></a><span> </span><a name="local-6989586621680194246"><a href="#local-6989586621680194246"><span class="hs-identifier">field_lbls</span></a></a><span>
</span><a name="line-129"></a><span>             </span><a name="local-6989586621680194247"><a href="#local-6989586621680194247"><span class="hs-identifier">univ_tvs</span></a></a><span> </span><a name="local-6989586621680194248"><a href="#local-6989586621680194248"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><a name="local-6989586621680194249"><a href="#local-6989586621680194249"><span class="hs-identifier">user_tvbs</span></a></a><span> </span><a name="local-6989586621680194250"><a href="#local-6989586621680194250"><span class="hs-identifier">eq_spec</span></a></a><span> </span><a name="local-6989586621680194251"><a href="#local-6989586621680194251"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680194252"><a href="#local-6989586621680194252"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621680194253"><a href="#local-6989586621680194253"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-6989586621680194254"><a href="#local-6989586621680194254"><span class="hs-identifier">rep_tycon</span></a></a><span>
</span><a name="line-130"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194255"><a href="#local-6989586621680194255"><span class="hs-identifier">wrap_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194241"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWrapperOcc"><span class="hs-identifier hs-var">mkDataConWrapperOcc</span></a><span>
</span><a name="line-131"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194256"><a href="#local-6989586621680194256"><span class="hs-identifier">work_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194241"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWorkerOcc"><span class="hs-identifier hs-var">mkDataConWorkerOcc</span></a><span>
</span><a name="line-132"></a><span>        </span><span class="hs-comment">-- This last one takes the name of the data constructor in the source</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- code, which (for Haskell source anyway) will be in the DataName name</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">-- space, and puts it into the VarName name space</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 1&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194241"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194257"><a href="#local-6989586621680194257"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-138"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194258"><a href="#local-6989586621680194258"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-139"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680194259"><a href="#local-6989586621680194259"><span class="hs-identifier">stupid_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier hs-var">mkDataConStupidTheta</span></a><span> </span><a href="#local-6989586621680194254"><span class="hs-identifier hs-var">rep_tycon</span></a><span> </span><a href="#local-6989586621680194252"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621680194247"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-140"></a><span>              </span><a name="local-6989586621680194260"><a href="#local-6989586621680194260"><span class="hs-identifier">data_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#mkDataCon"><span class="hs-identifier hs-var">mkDataCon</span></a><span> </span><a href="#local-6989586621680194241"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-6989586621680194242"><span class="hs-identifier hs-var">declared_infix</span></a><span> </span><a href="#local-6989586621680194243"><span class="hs-identifier hs-var">prom_info</span></a><span>
</span><a name="line-141"></a><span>                                   </span><a href="#local-6989586621680194244"><span class="hs-identifier hs-var">src_bangs</span></a><span> </span><a href="#local-6989586621680194246"><span class="hs-identifier hs-var">field_lbls</span></a><span>
</span><a name="line-142"></a><span>                                   </span><a href="#local-6989586621680194247"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-6989586621680194248"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-6989586621680194249"><span class="hs-identifier hs-var">user_tvbs</span></a><span> </span><a href="#local-6989586621680194250"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><a href="#local-6989586621680194251"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-143"></a><span>                                   </span><a href="#local-6989586621680194252"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621680194253"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="TyCon.html#NoRRI"><span class="hs-identifier hs-var">NoRRI</span></a><span> </span><a href="#local-6989586621680194254"><span class="hs-identifier hs-var">rep_tycon</span></a><span>
</span><a name="line-144"></a><span>                                   </span><a href="#local-6989586621680194259"><span class="hs-identifier hs-var">stupid_ctxt</span></a><span> </span><a href="#local-6989586621680194261"><span class="hs-identifier hs-var">dc_wrk</span></a><span> </span><a href="#local-6989586621680194262"><span class="hs-identifier hs-var">dc_rep</span></a><span>
</span><a name="line-145"></a><span>              </span><a name="local-6989586621680194261"><a href="#local-6989586621680194261"><span class="hs-identifier">dc_wrk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#mkDataConWorkId"><span class="hs-identifier hs-var">mkDataConWorkId</span></a><span> </span><a href="#local-6989586621680194256"><span class="hs-identifier hs-var">work_name</span></a><span> </span><a href="#local-6989586621680194260"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-146"></a><span>              </span><a name="local-6989586621680194262"><a href="#local-6989586621680194262"><span class="hs-identifier">dc_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#initUs_"><span class="hs-identifier hs-var">initUs_</span></a><span> </span><a href="#local-6989586621680194257"><span class="hs-identifier hs-var">us</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDataConRep"><span class="hs-identifier hs-var">mkDataConRep</span></a><span> </span><a href="#local-6989586621680194258"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680194240"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="#local-6989586621680194255"><span class="hs-identifier hs-var">wrap_name</span></a><span>
</span><a name="line-147"></a><span>                                                </span><a href="#local-6989586621680194245"><span class="hs-identifier hs-var">impl_bangs</span></a><span> </span><a href="#local-6989586621680194260"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 2&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194241"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680194260"><span class="hs-identifier hs-var">data_con</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- The stupid context for a data constructor should be limited to</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- the type variables mentioned in the arg_tys</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- ToDo: Or functionally dependent on?</span><span>
</span><a name="line-156"></a><span class="hs-comment">--       This whole stupid theta thing is, well, stupid.</span><span>
</span><a name="line-157"></a><span class="hs-identifier">mkDataConStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-158"></a><a name="mkDataConStupidTheta"><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier">mkDataConStupidTheta</span></a></a><span> </span><a name="local-6989586621680194263"><a href="#local-6989586621680194263"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621680194264"><a href="#local-6989586621680194264"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621680194265"><a href="#local-6989586621680194265"><span class="hs-identifier">univ_tvs</span></a></a><span>
</span><a name="line-159"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680194267"><span class="hs-identifier hs-var">stupid_theta</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- The common case</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-6989586621680194269"><span class="hs-identifier hs-var">in_arg_tys</span></a><span> </span><a href="#local-6989586621680194267"><span class="hs-identifier hs-var">stupid_theta</span></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-162"></a><span>    </span><a name="local-6989586621680194266"><a href="#local-6989586621680194266"><span class="hs-identifier">tc_subst</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621680194263"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>                              </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-6989586621680194265"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-6989586621680194267"><a href="#local-6989586621680194267"><span class="hs-identifier">stupid_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><a href="#local-6989586621680194266"><span class="hs-identifier hs-var">tc_subst</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-6989586621680194263"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-comment">-- Start by instantiating the master copy of the</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-comment">-- stupid theta, taken from the TyCon</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>    </span><a name="local-6989586621680194268"><a href="#local-6989586621680194268"><span class="hs-identifier">arg_tyvars</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-6989586621680194264"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-169"></a><span>    </span><a name="local-6989586621680194269"><a href="#local-6989586621680194269"><span class="hs-identifier">in_arg_tys</span></a></a><span> </span><a name="local-6989586621680194270"><a href="#local-6989586621680194270"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-170"></a><span>                      </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680194270"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectVarSet"><span class="hs-identifier hs-var">intersectVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680194268"><span class="hs-identifier hs-var">arg_tyvars</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-174"></a><span class="hs-identifier">buildPatSyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-175"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Univ and req</span><span>
</span><a name="line-177"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Ex and prov</span><span>
</span><a name="line-178"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ Argument types</span><span>
</span><a name="line-179"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                 </span><span class="hs-comment">-- ^ Result type</span><span>
</span><a name="line-180"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Field labels for</span><span>
</span><a name="line-181"></a><span>                                    </span><span class="hs-comment">--   a record pattern synonym</span><span>
</span><a name="line-182"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span>
</span><a name="line-183"></a><a name="buildPatSyn"><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier">buildPatSyn</span></a></a><span> </span><a name="local-6989586621680194271"><a href="#local-6989586621680194271"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-6989586621680194272"><a href="#local-6989586621680194272"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-6989586621680194273"><a href="#local-6989586621680194273"><span class="hs-identifier">matcher</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680194274"><a href="#local-6989586621680194274"><span class="hs-identifier">matcher_id</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680194275"><a href="#local-6989586621680194275"><span class="hs-identifier">builder</span></a></a><span>
</span><a name="line-184"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680194276"><a href="#local-6989586621680194276"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194277"><a href="#local-6989586621680194277"><span class="hs-identifier">req_theta</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680194278"><a href="#local-6989586621680194278"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194279"><a href="#local-6989586621680194279"><span class="hs-identifier">prov_theta</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680194280"><a href="#local-6989586621680194280"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-185"></a><span>            </span><a name="local-6989586621680194281"><a href="#local-6989586621680194281"><span class="hs-identifier">pat_ty</span></a></a><span> </span><a name="local-6989586621680194282"><a href="#local-6989586621680194282"><span class="hs-identifier">field_labels</span></a></a><span>
</span><a name="line-186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The assertion checks that the matcher is</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-comment">-- compatible with the pattern synonym</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">and</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">univ_tvs1</span></a><span>
</span><a name="line-189"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-190"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTy</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-191"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-192"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-193"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">compareArgTys</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">arg_tys1</span><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>                 </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs1</span><span>
</span><a name="line-196"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-197"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-198"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-199"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-200"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys1</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>    </span><a href="PatSyn.html#mkPatSyn"><span class="hs-identifier hs-var">mkPatSyn</span></a><span> </span><a href="#local-6989586621680194271"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-6989586621680194272"><span class="hs-identifier hs-var">declared_infix</span></a><span>
</span><a name="line-202"></a><span>             </span><span class="hs-special">(</span><a href="#local-6989586621680194276"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680194277"><span class="hs-identifier hs-var">req_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194278"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680194279"><span class="hs-identifier hs-var">prov_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>             </span><a href="#local-6989586621680194280"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621680194281"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-204"></a><span>             </span><a href="#local-6989586621680194273"><span class="hs-identifier hs-var">matcher</span></a><span> </span><a href="#local-6989586621680194275"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-6989586621680194282"><span class="hs-identifier hs-var">field_labels</span></a><span>
</span><a name="line-205"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680194283"><a href="#local-6989586621680194283"><span class="hs-identifier">univ_tvs1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680194284"><a href="#local-6989586621680194284"><span class="hs-identifier">req_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194285"><a href="#local-6989586621680194285"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621680194274"><span class="hs-identifier hs-var">matcher_id</span></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-6989586621680194286"><a href="#local-6989586621680194286"><span class="hs-identifier">pat_ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194287"><a href="#local-6989586621680194287"><span class="hs-identifier">cont_sigma</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-6989586621680194285"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680194288"><a href="#local-6989586621680194288"><span class="hs-identifier">ex_tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194289"><a href="#local-6989586621680194289"><span class="hs-identifier">prov_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194290"><a href="#local-6989586621680194290"><span class="hs-identifier">cont_tau</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="#local-6989586621680194287"><span class="hs-identifier hs-var">cont_sigma</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680194291"><a href="#local-6989586621680194291"><span class="hs-identifier">arg_tys1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-6989586621680194290"><span class="hs-identifier hs-var">cont_tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621680194292"><a href="#local-6989586621680194292"><span class="hs-identifier">twiddle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621680194293"><a href="#local-6989586621680194293"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194283"><span class="hs-identifier hs-var">univ_tvs1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680194288"><span class="hs-identifier hs-var">ex_tvs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>                       </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194276"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680194278"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-comment">-- For a nullary pattern synonym we add a single void argument to the</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-comment">-- matcher to preserve laziness in the case of unlifted types.</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-comment">-- See #12746</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-identifier">compareArgTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-218"></a><span>    </span><a name="local-6989586621680194294"><a href="#local-6989586621680194294"><span class="hs-identifier">compareArgTys</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680194295"><a href="#local-6989586621680194295"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194295"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="TysPrim.html#voidPrimTy"><span class="hs-identifier hs-var">voidPrimTy</span></a><span>
</span><a name="line-219"></a><span>    </span><span class="hs-identifier">compareArgTys</span><span> </span><a name="local-6989586621680194296"><a href="#local-6989586621680194296"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621680194297"><a href="#local-6989586621680194297"><span class="hs-identifier">matcher_arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194296"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqTypes"><span class="hs-identifier hs-var">eqTypes</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680194297"><span class="hs-identifier hs-var">matcher_arg_tys</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-223"></a><span class="hs-keyword">type</span><span> </span><a name="TcMethInfo"><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier">TcMethInfo</span></a></a><span>     </span><span class="hs-comment">-- A temporary intermediate, to communicate</span><span>
</span><a name="line-224"></a><span>                    </span><span class="hs-comment">-- between tcClassSigs and buildClass.</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>   </span><span class="hs-comment">-- Name of the class op</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>   </span><span class="hs-comment">-- Type of the class op</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>         </span><span class="hs-comment">-- Nothing                    =&gt; no default method</span><span>
</span><a name="line-229"></a><span>         </span><span class="hs-comment">--</span><span>
</span><a name="line-230"></a><span>         </span><span class="hs-comment">-- Just VanillaDM             =&gt; There is an ordinary</span><span>
</span><a name="line-231"></a><span>         </span><span class="hs-comment">--                               polymorphic default method</span><span>
</span><a name="line-232"></a><span>         </span><span class="hs-comment">--</span><span>
</span><a name="line-233"></a><span>         </span><span class="hs-comment">-- Just (GenericDM (loc, ty)) =&gt; There is a generic default metho</span><span>
</span><a name="line-234"></a><span>         </span><span class="hs-comment">--                               Here is its type, and the location</span><span>
</span><a name="line-235"></a><span>         </span><span class="hs-comment">--                               of the type signature</span><span>
</span><a name="line-236"></a><span>         </span><span class="hs-comment">--    We need that location /only/ to attach it to the</span><span>
</span><a name="line-237"></a><span>         </span><span class="hs-comment">--    generic default method's Name; and we need /that/</span><span>
</span><a name="line-238"></a><span>         </span><span class="hs-comment">--    only to give the right location of an ambiguity error</span><span>
</span><a name="line-239"></a><span>         </span><span class="hs-comment">--    for the generic default method, spat out by checkValidClass</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-identifier">buildClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>  </span><span class="hs-comment">-- Name of the class/tycon (they have the same Name)</span><span>
</span><a name="line-242"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Of the tycon</span><span>
</span><a name="line-243"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>
</span><a name="line-244"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Functional dependencies</span><span>
</span><a name="line-245"></a><span>           </span><span class="hs-comment">-- Super classes, associated types, method info, minimal complete def.</span><span>
</span><a name="line-246"></a><span>           </span><span class="hs-comment">-- This is Nothing if the class is abstract.</span><span>
</span><a name="line-247"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Class.html#ClassMinimalDef"><span class="hs-identifier hs-type">ClassMinimalDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194200"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680194201"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><a name="buildClass"><a href="BuildTyCl.html#buildClass"><span class="hs-identifier">buildClass</span></a></a><span> </span><a name="local-6989586621680194298"><a href="#local-6989586621680194298"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680194299"><a href="#local-6989586621680194299"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-6989586621680194300"><a href="#local-6989586621680194300"><span class="hs-identifier">roles</span></a></a><span> </span><a name="local-6989586621680194301"><a href="#local-6989586621680194301"><span class="hs-identifier">fds</span></a></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-251"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680194302"><a href="#local-6989586621680194302"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194303"><a href="#local-6989586621680194303"><span class="hs-identifier">tc_rep_name</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621680194298"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-255"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680194304"><a href="#local-6989586621680194304"><span class="hs-identifier">univ_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConTyVarBinders"><span class="hs-identifier hs-var">tyConTyVarBinders</span></a><span> </span><a href="#local-6989586621680194299"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-256"></a><span>              </span><a name="local-6989586621680194305"><a href="#local-6989586621680194305"><span class="hs-identifier">univ_tvs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a><span> </span><a href="#local-6989586621680194304"><span class="hs-identifier hs-var">univ_bndrs</span></a><span>
</span><a name="line-257"></a><span>              </span><a name="local-6989586621680194306"><a href="#local-6989586621680194306"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a><span> </span><a href="#local-6989586621680194298"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680194299"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-6989586621680194300"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-258"></a><span>                                   </span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><a href="#local-6989586621680194302"><span class="hs-identifier hs-var">rec_clas</span></a><span> </span><a href="#local-6989586621680194303"><span class="hs-identifier hs-var">tc_rep_name</span></a><span>
</span><a name="line-259"></a><span>              </span><a name="local-6989586621680194307"><a href="#local-6989586621680194307"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#mkAbstractClass"><span class="hs-identifier hs-var">mkAbstractClass</span></a><span> </span><a href="#local-6989586621680194298"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680194305"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-6989586621680194301"><span class="hs-identifier hs-var">fds</span></a><span> </span><a href="#local-6989586621680194306"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-260"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194306"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680194307"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">buildClass</span><span> </span><a name="local-6989586621680194308"><a href="#local-6989586621680194308"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680194309"><a href="#local-6989586621680194309"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-6989586621680194310"><a href="#local-6989586621680194310"><span class="hs-identifier">roles</span></a></a><span> </span><a name="local-6989586621680194311"><a href="#local-6989586621680194311"><span class="hs-identifier">fds</span></a></a><span>
</span><a name="line-264"></a><span>           </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680194312"><a href="#local-6989586621680194312"><span class="hs-identifier">sc_theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194313"><a href="#local-6989586621680194313"><span class="hs-identifier">at_items</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194314"><a href="#local-6989586621680194314"><span class="hs-identifier">sig_stuff</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194315"><a href="#local-6989586621680194315"><span class="hs-identifier">mindef</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680194333"><a href="#local-6989586621680194333"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194334"><a href="#local-6989586621680194334"><span class="hs-identifier">datacon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkClassDataConOcc"><span class="hs-identifier hs-var">mkClassDataConOcc</span></a><span>
</span><a name="line-269"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194335"><a href="#local-6989586621680194335"><span class="hs-identifier">tc_rep_name</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194336"><a href="#local-6989586621680194336"><span class="hs-identifier">op_items</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194317"><span class="hs-identifier hs-var">mk_op_item</span></a><span> </span><a href="#local-6989586621680194333"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680194314"><span class="hs-identifier hs-var">sig_stuff</span></a><span>
</span><a name="line-272"></a><span>                        </span><span class="hs-comment">-- Build the selector id and default method id</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span>              </span><span class="hs-comment">-- Make selectors for the superclasses</span><span>
</span><a name="line-275"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194337"><a href="#local-6989586621680194337"><span class="hs-identifier">sc_sel_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span>  </span><span class="hs-special">(</span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="OccName.html#mkSuperDictSelOcc"><span class="hs-identifier hs-var">mkSuperDictSelOcc</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>                                </span><span class="hs-special">(</span><a href="Util.html#takeList"><span class="hs-identifier hs-var">takeList</span></a><span> </span><a href="#local-6989586621680194312"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><span class="hs-special">[</span><a href="BasicTypes.html#fIRST_TAG"><span class="hs-identifier hs-var">fIRST_TAG</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680194338"><a href="#local-6989586621680194338"><span class="hs-identifier">sc_sel_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-6989586621680194339"><span class="hs-identifier hs-var">sc_name</span></a><span> </span><a href="#local-6989586621680194333"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-278"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680194339"><a href="#local-6989586621680194339"><span class="hs-identifier">sc_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680194337"><span class="hs-identifier hs-var">sc_sel_names</span></a><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>              </span><span class="hs-comment">-- We number off the Dict superclass selectors, 1, 2, 3 etc so that we</span><span>
</span><a name="line-280"></a><span>              </span><span class="hs-comment">-- can construct names for the selectors. Thus</span><span>
</span><a name="line-281"></a><span>              </span><span class="hs-comment">--      class (C a, C b) =&gt; D a b where ...</span><span>
</span><a name="line-282"></a><span>              </span><span class="hs-comment">-- gives superclass selectors</span><span>
</span><a name="line-283"></a><span>              </span><span class="hs-comment">--      D_sc1, D_sc2</span><span>
</span><a name="line-284"></a><span>              </span><span class="hs-comment">-- (We used to call them D_C, but now we can have two different</span><span>
</span><a name="line-285"></a><span>              </span><span class="hs-comment">--  superclasses both called C!)</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680194340"><a href="#local-6989586621680194340"><span class="hs-identifier">use_newtype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a><span> </span><a href="#local-6989586621680194344"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-288"></a><span>                </span><span class="hs-comment">-- Use a newtype if the data constructor</span><span>
</span><a name="line-289"></a><span>                </span><span class="hs-comment">--   (a) has exactly one value field</span><span>
</span><a name="line-290"></a><span>                </span><span class="hs-comment">--       i.e. exactly one operation or superclass taken together</span><span>
</span><a name="line-291"></a><span>                </span><span class="hs-comment">--   (b) that value is of lifted type (which they always are, because</span><span>
</span><a name="line-292"></a><span>                </span><span class="hs-comment">--       we box equality superclasses)</span><span>
</span><a name="line-293"></a><span>                </span><span class="hs-comment">-- See note [Class newtypes and equality predicates]</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>                </span><span class="hs-comment">-- We treat the dictionary superclasses as ordinary arguments.</span><span>
</span><a name="line-296"></a><span>                </span><span class="hs-comment">-- That means that in the case of</span><span>
</span><a name="line-297"></a><span>                </span><span class="hs-comment">--     class C a =&gt; D a</span><span>
</span><a name="line-298"></a><span>                </span><span class="hs-comment">-- we don't get a newtype with no arguments!</span><span>
</span><a name="line-299"></a><span>              </span><a name="local-6989586621680194341"><a href="#local-6989586621680194341"><span class="hs-identifier">args</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194337"><span class="hs-identifier hs-var">sc_sel_names</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680194343"><span class="hs-identifier hs-var">op_names</span></a><span>
</span><a name="line-300"></a><span>              </span><a name="local-6989586621680194342"><a href="#local-6989586621680194342"><span class="hs-identifier">op_tys</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680194348"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680194348"><a href="#local-6989586621680194348"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680194314"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-301"></a><span>              </span><a name="local-6989586621680194343"><a href="#local-6989586621680194343"><span class="hs-identifier">op_names</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680194349"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680194349"><a href="#local-6989586621680194349"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680194314"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-302"></a><span>              </span><a name="local-6989586621680194344"><a href="#local-6989586621680194344"><span class="hs-identifier">arg_tys</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194312"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680194342"><span class="hs-identifier hs-var">op_tys</span></a><span>
</span><a name="line-303"></a><span>              </span><a name="local-6989586621680194345"><a href="#local-6989586621680194345"><span class="hs-identifier">rec_tycon</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621680194333"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-304"></a><span>              </span><a name="local-6989586621680194346"><a href="#local-6989586621680194346"><span class="hs-identifier">univ_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConTyVarBinders"><span class="hs-identifier hs-var">tyConTyVarBinders</span></a><span> </span><a href="#local-6989586621680194309"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-305"></a><span>              </span><a name="local-6989586621680194347"><a href="#local-6989586621680194347"><span class="hs-identifier">univ_tvs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a><span> </span><a href="#local-6989586621680194346"><span class="hs-identifier hs-var">univ_bndrs</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194350"><a href="#local-6989586621680194350"><span class="hs-identifier">rep_nm</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621680194334"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-308"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194351"><a href="#local-6989586621680194351"><span class="hs-identifier">dict_con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;buildClass: FamInstEnvs&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>                                   </span><a href="#local-6989586621680194334"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-310"></a><span>                                   </span><span class="hs-identifier hs-var">False</span><span>        </span><span class="hs-comment">-- Not declared infix</span><span>
</span><a name="line-311"></a><span>                                   </span><a href="#local-6989586621680194350"><span class="hs-identifier hs-var">rep_nm</span></a><span>
</span><a name="line-312"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-6989586621680194316"><span class="hs-identifier hs-var">no_bang</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680194341"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680194341"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No fields -}</span><span class="hs-special">]</span><span>
</span><a name="line-315"></a><span>                                   </span><a href="#local-6989586621680194347"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-316"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- no existentials -}</span><span class="hs-special">]</span><span>
</span><a name="line-317"></a><span>                                   </span><a href="#local-6989586621680194346"><span class="hs-identifier hs-var">univ_bndrs</span></a><span>
</span><a name="line-318"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No GADT equalities -}</span><span class="hs-special">]</span><span>
</span><a name="line-319"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No theta -}</span><span class="hs-special">]</span><span>
</span><a name="line-320"></a><span>                                   </span><a href="#local-6989586621680194344"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-321"></a><span>                                   </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621680194345"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-6989586621680194347"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>                                   </span><a href="#local-6989586621680194345"><span class="hs-identifier hs-var">rec_tycon</span></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194352"><a href="#local-6989586621680194352"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680194340"><span class="hs-identifier hs-var">use_newtype</span></a><span>
</span><a name="line-326"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680194345"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><a href="#local-6989586621680194351"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-327"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-328"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TupleTyCon"><span class="hs-identifier hs-var">TupleTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194351"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-329"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tup_sort</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-331"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680194351"><span class="hs-identifier hs-var">dict_con</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194353"><a href="#local-6989586621680194353"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680194309"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-6989586621680194310"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-334"></a><span>                                     </span><a href="#local-6989586621680194352"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621680194333"><span class="hs-identifier hs-var">rec_clas</span></a><span> </span><a href="#local-6989586621680194335"><span class="hs-identifier hs-var">tc_rep_name</span></a><span>
</span><a name="line-335"></a><span>                </span><span class="hs-comment">-- A class can be recursive, and in the case of newtypes</span><span>
</span><a name="line-336"></a><span>                </span><span class="hs-comment">-- this matters.  For example</span><span>
</span><a name="line-337"></a><span>                </span><span class="hs-comment">--      class C a where { op :: C b =&gt; a -&gt; b -&gt; Int }</span><span>
</span><a name="line-338"></a><span>                </span><span class="hs-comment">-- Because C has only one operation, it is represented by</span><span>
</span><a name="line-339"></a><span>                </span><span class="hs-comment">-- a newtype, and it should be a *recursive* newtype.</span><span>
</span><a name="line-340"></a><span>                </span><span class="hs-comment">-- [If we don't make it a recursive newtype, we'll expand the</span><span>
</span><a name="line-341"></a><span>                </span><span class="hs-comment">-- newtype like a synonym, but that will lead to an infinite</span><span>
</span><a name="line-342"></a><span>                </span><span class="hs-comment">-- type]</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680194354"><a href="#local-6989586621680194354"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#mkClass"><span class="hs-identifier hs-var">mkClass</span></a><span> </span><a href="#local-6989586621680194308"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680194347"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-6989586621680194311"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-345"></a><span>                                 </span><a href="#local-6989586621680194312"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="#local-6989586621680194338"><span class="hs-identifier hs-var">sc_sel_ids</span></a><span> </span><a href="#local-6989586621680194313"><span class="hs-identifier hs-var">at_items</span></a><span>
</span><a name="line-346"></a><span>                                 </span><a href="#local-6989586621680194336"><span class="hs-identifier hs-var">op_items</span></a><span> </span><a href="#local-6989586621680194315"><span class="hs-identifier hs-var">mindef</span></a><span> </span><a href="#local-6989586621680194353"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-347"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680194353"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680194354"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>    </span><a name="local-6989586621680194316"><a href="#local-6989586621680194316"><span class="hs-identifier">no_bang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><a href="BasicTypes.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a><span> </span><a href="DataCon.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a><span> </span><a href="DataCon.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>    </span><span class="hs-identifier">mk_op_item</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194319"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621680194320"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a><span>
</span><a name="line-354"></a><span>    </span><a name="local-6989586621680194317"><a href="#local-6989586621680194317"><span class="hs-identifier">mk_op_item</span></a></a><span> </span><a name="local-6989586621680194323"><a href="#local-6989586621680194323"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680194324"><a href="#local-6989586621680194324"><span class="hs-identifier">op_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680194325"><a href="#local-6989586621680194325"><span class="hs-identifier">dm_spec</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194326"><a href="#local-6989586621680194326"><span class="hs-identifier">dm_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680194318"><span class="hs-identifier hs-var">mk_dm_info</span></a><span> </span><a href="#local-6989586621680194324"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="#local-6989586621680194325"><span class="hs-identifier hs-var">dm_spec</span></a><span>
</span><a name="line-356"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-6989586621680194324"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="#local-6989586621680194323"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680194326"><span class="hs-identifier hs-var">dm_info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span>    </span><span class="hs-identifier">mk_dm_info</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194321"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621680194322"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span>    </span><a name="local-6989586621680194318"><a href="#local-6989586621680194318"><span class="hs-identifier">mk_dm_info</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-361"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-362"></a><span>    </span><span class="hs-identifier">mk_dm_info</span><span> </span><a name="local-6989586621680194327"><a href="#local-6989586621680194327"><span class="hs-identifier">op_name</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194328"><a href="#local-6989586621680194328"><span class="hs-identifier">dm_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194327"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="OccName.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a><span>
</span><a name="line-364"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194328"><span class="hs-identifier hs-var">dm_name</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-365"></a><span>    </span><span class="hs-identifier">mk_dm_info</span><span> </span><a name="local-6989586621680194329"><a href="#local-6989586621680194329"><span class="hs-identifier">op_name</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680194330"><a href="#local-6989586621680194330"><span class="hs-identifier">loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194331"><a href="#local-6989586621680194331"><span class="hs-identifier">dm_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194332"><a href="#local-6989586621680194332"><span class="hs-identifier">dm_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinderLoc"><span class="hs-identifier hs-var">newImplicitBinderLoc</span></a><span> </span><a href="#local-6989586621680194329"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="OccName.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a><span> </span><a href="#local-6989586621680194330"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-367"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680194332"><span class="hs-identifier hs-var">dm_name</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><a href="#local-6989586621680194331"><span class="hs-identifier hs-var">dm_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">{-
Note [Class newtypes and equality predicates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        class (a ~ F b) =&gt; C a b where
          op :: a -&gt; b

We cannot represent this by a newtype, even though it's not
existential, because there are two value fields (the equality
predicate and op. See Trac #2238

Moreover,
          class (a ~ F b) =&gt; C a b where {}
Here we can't use a newtype either, even though there is only
one field, because equality predicates are unboxed, and classes
are boxed.
-}</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-identifier">newImplicitBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><a name="line-388"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><a name="line-389"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194198"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680194199"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- Called in BuildTyCl to allocate the implicit binders of type/class decls</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- For source type/class decls, this is the first occurrence</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- For iface ones, the LoadIface has already allocated a suitable name in the cache</span><span>
</span><a name="line-393"></a><a name="newImplicitBinder"><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier">newImplicitBinder</span></a></a><span> </span><a name="local-6989586621680194355"><a href="#local-6989586621680194355"><span class="hs-identifier">base_name</span></a></a><span> </span><a name="local-6989586621680194356"><a href="#local-6989586621680194356"><span class="hs-identifier">mk_sys_occ</span></a></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#newImplicitBinderLoc"><span class="hs-identifier hs-var">newImplicitBinderLoc</span></a><span> </span><a href="#local-6989586621680194355"><span class="hs-identifier hs-var">base_name</span></a><span> </span><a href="#local-6989586621680194356"><span class="hs-identifier hs-var">mk_sys_occ</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-6989586621680194355"><span class="hs-identifier hs-var">base_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-identifier">newImplicitBinderLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><a name="line-397"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><a name="line-398"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-399"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194196"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680194197"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- Just the same, but lets you specify the SrcSpan</span><span>
</span><a name="line-401"></a><a name="newImplicitBinderLoc"><a href="BuildTyCl.html#newImplicitBinderLoc"><span class="hs-identifier">newImplicitBinderLoc</span></a></a><span> </span><a name="local-6989586621680194357"><a href="#local-6989586621680194357"><span class="hs-identifier">base_name</span></a></a><span> </span><a name="local-6989586621680194358"><a href="#local-6989586621680194358"><span class="hs-identifier">mk_sys_occ</span></a></a><span> </span><a name="local-6989586621680194359"><a href="#local-6989586621680194359"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680194361"><a href="#local-6989586621680194361"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621680194357"><span class="hs-identifier hs-var">base_name</span></a><span>
</span><a name="line-403"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-6989586621680194361"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621680194360"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-6989586621680194359"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-404"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-comment">-- When typechecking a [d| decl bracket |],</span><span>
</span><a name="line-405"></a><span>                        </span><span class="hs-comment">-- TH generates types, classes etc with Internal names,</span><span>
</span><a name="line-406"></a><span>                        </span><span class="hs-comment">-- so we follow suit for the implicit binders</span><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680194362"><a href="#local-6989586621680194362"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-408"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621680194362"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621680194360"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-6989586621680194359"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-409"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-410"></a><span>    </span><a name="local-6989586621680194360"><a href="#local-6989586621680194360"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680194358"><span class="hs-identifier hs-var">mk_sys_occ</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621680194357"><span class="hs-identifier hs-var">base_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-comment">-- | Make the 'TyConRepName' for this 'TyCon'</span><span>
</span><a name="line-413"></a><span class="hs-identifier">newTyConRepName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621680194194"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621680194195"><span class="hs-identifier hs-type">lcl</span></a><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-414"></a><a name="newTyConRepName"><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier">newTyConRepName</span></a></a><span> </span><a name="local-6989586621680194363"><a href="#local-6989586621680194363"><span class="hs-identifier">tc_name</span></a></a><span>
</span><a name="line-415"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680194364"><a href="#local-6989586621680194364"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621680194363"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-416"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680194365"><a href="#local-6989586621680194365"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680194366"><a href="#local-6989586621680194366"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConRepModOcc"><span class="hs-identifier hs-var">tyConRepModOcc</span></a><span> </span><a href="#local-6989586621680194364"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621680194363"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-6989586621680194365"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621680194366"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span>
</span><a name="line-418"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-419"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-6989586621680194363"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="OccName.html#mkTyConRepOcc"><span class="hs-identifier hs-var">mkTyConRepOcc</span></a><span>
</span><a name="line-420"></a></pre></body></html>