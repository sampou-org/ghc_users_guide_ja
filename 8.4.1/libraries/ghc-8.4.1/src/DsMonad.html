<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


@DsMonad@: monadery used in desugaring
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances, FlexibleContexts #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>  </span><span class="hs-comment">-- instance MonadThings is necessarily an orphan</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>        </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="DsMonad.html#initDs"><span class="hs-identifier hs-var">initDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#initDsTc"><span class="hs-identifier hs-var">initDsTc</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#initDsWithModGuts"><span class="hs-identifier hs-var">initDsWithModGuts</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#fixDs"><span class="hs-identifier hs-var">fixDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="MonadUtils.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#whenGOptM"><span class="hs-identifier hs-var">whenGOptM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#unsetGOptM"><span class="hs-identifier hs-var">unsetGOptM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#unsetWOptM"><span class="hs-identifier hs-var">unsetWOptM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><a href="DsMonad.html#duplicateLocalDs"><span class="hs-identifier hs-var">duplicateLocalDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#newSysLocalDsNoLP"><span class="hs-identifier hs-var">newSysLocalDsNoLP</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="DsMonad.html#newSysLocalsDsNoLP"><span class="hs-identifier hs-var">newSysLocalsDsNoLP</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#newSysLocalsDs"><span class="hs-identifier hs-var">newSysLocalsDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#newUniqueId"><span class="hs-identifier hs-var">newUniqueId</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="DsMonad.html#newFailLocalDs"><span class="hs-identifier hs-var">newFailLocalDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#newPredVarDs"><span class="hs-identifier hs-var">newPredVarDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="DsMonad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="DsMonad.html#mkPrintUnqualifiedDs"><span class="hs-identifier hs-var">mkPrintUnqualifiedDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="DsMonad.html#getGhcModeDs"><span class="hs-identifier hs-var">getGhcModeDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsDPHBuiltin"><span class="hs-identifier hs-var">dsDPHBuiltin</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="DsMonad.html#dsLookupDataCon"><span class="hs-identifier hs-var">dsLookupDataCon</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsLookupConLike"><span class="hs-identifier hs-var">dsLookupConLike</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><a href="TcRnTypes.html#PArrBuiltin"><span class="hs-identifier hs-type">PArrBuiltin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="DsMonad.html#dsLookupDPHRdrEnv"><span class="hs-identifier hs-var">dsLookupDPHRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsLookupDPHRdrEnv_maybe"><span class="hs-identifier hs-var">dsLookupDPHRdrEnv_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="DsMonad.html#dsInitPArrBuiltin"><span class="hs-identifier hs-var">dsInitPArrBuiltin</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>        </span><a href="TcRnTypes.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsGetMetaEnv"><span class="hs-identifier hs-var">dsGetMetaEnv</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsLookupMetaEnv"><span class="hs-identifier hs-var">dsLookupMetaEnv</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsExtendMetaEnv"><span class="hs-identifier hs-var">dsExtendMetaEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>        </span><span class="hs-comment">-- Getting and setting EvVars and term constraints in local environment</span><span>
</span><a name="line-36"></a><span>        </span><a href="DsMonad.html#getDictsDs"><span class="hs-identifier hs-var">getDictsDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#addDictsDs"><span class="hs-identifier hs-var">addDictsDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#getTmCsDs"><span class="hs-identifier hs-var">getTmCsDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#addTmCsDs"><span class="hs-identifier hs-var">addTmCsDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-comment">-- Iterations for pm checking</span><span>
</span><a name="line-39"></a><span>        </span><a href="DsMonad.html#incrCheckPmIterDs"><span class="hs-identifier hs-var">incrCheckPmIterDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#resetPmIterDs"><span class="hs-identifier hs-var">resetPmIterDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsGetCompleteMatches"><span class="hs-identifier hs-var">dsGetCompleteMatches</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>        </span><span class="hs-comment">-- Warnings and errors</span><span>
</span><a name="line-42"></a><span>        </span><a href="DsMonad.html#DsWarning"><span class="hs-identifier hs-type">DsWarning</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#warnIfSetDs"><span class="hs-identifier hs-var">warnIfSetDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#errDs"><span class="hs-identifier hs-var">errDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#errDsCoreExpr"><span class="hs-identifier hs-var">errDsCoreExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="DsMonad.html#failWithDs"><span class="hs-identifier hs-var">failWithDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#failDs"><span class="hs-identifier hs-var">failDs</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#discardWarningsDs"><span class="hs-identifier hs-var">discardWarningsDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="DsMonad.html#askNoErrsDs"><span class="hs-identifier hs-var">askNoErrsDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-comment">-- Data types</span><span>
</span><a name="line-47"></a><span>        </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DsMonad.html#DsWrapper"><span class="hs-identifier hs-type">DsWrapper</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#idDsWrapper"><span class="hs-identifier hs-var">idDsWrapper</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="DsMonad.html#CanItFail"><span class="hs-identifier hs-type">CanItFail</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DsMonad.html#orFail"><span class="hs-identifier hs-var">orFail</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>        </span><span class="hs-comment">-- Levity polymorphism</span><span>
</span><a name="line-52"></a><span>        </span><a href="DsMonad.html#dsNoLevPoly"><span class="hs-identifier hs-var">dsNoLevPoly</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsNoLevPolyExpr"><span class="hs-identifier hs-var">dsNoLevPolyExpr</span></a><span class="hs-special">,</span><span> </span><a href="DsMonad.html#dsWhenNoErrs"><span class="hs-identifier hs-var">dsWhenNoErrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>        </span><span class="hs-comment">-- Trace injection</span><span>
</span><a name="line-55"></a><span>        </span><a href="DsMonad.html#pprRuntimeTrace"><span class="hs-identifier hs-var">pprRuntimeTrace</span></a><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="MkCore.html"><span class="hs-identifier">MkCore</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="MkCore.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="CoreUtils.html"><span class="hs-identifier">CoreUtils</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#isExprLevPoly"><span class="hs-identifier hs-var">isExprLevPoly</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="TcIface.html"><span class="hs-identifier">TcIface</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcMType.html#checkForLevPolyX"><span class="hs-identifier hs-var">checkForLevPolyX</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#formatLevPolyErr"><span class="hs-identifier hs-var">formatLevPolyErr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="LoadIface.html"><span class="hs-identifier">LoadIface</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Finder.html"><span class="hs-identifier">Finder</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="PmExpr.html"><span class="hs-identifier">PmExpr</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.4.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="UniqFM.html#lookupWithDefaultUFM"><span class="hs-identifier hs-var">lookupWithDefaultUFM</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="Literal.html"><span class="hs-identifier">Literal</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Literal.html#mkMachString"><span class="hs-identifier hs-var">mkMachString</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Data types for the desugarer
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">data</span><span> </span><a name="DsMatchContext"><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier">DsMatchContext</span></a></a><span>
</span><a name="line-107"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DsMatchContext"><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier">DsMatchContext</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>  </span><a name="local-8214565720323906373"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a name="local-6989586621680236426"><a href="#local-6989586621680236426"><span class="hs-identifier">hs_match</span></a></a><span> </span><a name="local-6989586621680236427"><a href="#local-6989586621680236427"><span class="hs-identifier">ss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236427"><span class="hs-identifier hs-var">ss</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="HsExpr.html#pprMatchContext"><span class="hs-identifier hs-var">pprMatchContext</span></a><span> </span><a href="#local-6989586621680236426"><span class="hs-identifier hs-var">hs_match</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-keyword">data</span><span> </span><a name="EquationInfo"><a href="DsMonad.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EqnInfo"><a href="DsMonad.html#EqnInfo"><span class="hs-identifier">EqnInfo</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="eqn_pats"><a href="DsMonad.html#eqn_pats"><span class="hs-identifier">eqn_pats</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsPat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The patterns for an eqn</span><span>
</span><a name="line-115"></a><span>              </span><a name="eqn_rhs"><a href="DsMonad.html#eqn_rhs"><span class="hs-identifier">eqn_rhs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- What to do after match</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><a name="local-8214565720323906373"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#EqnInfo"><span class="hs-identifier hs-var">EqnInfo</span></a><span> </span><a name="local-6989586621680236425"><a href="#local-6989586621680236425"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236425"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-keyword">type</span><span> </span><a name="DsWrapper"><a href="DsMonad.html#DsWrapper"><span class="hs-identifier">DsWrapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-121"></a><span class="hs-identifier">idDsWrapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DsMonad.html#DsWrapper"><span class="hs-identifier hs-type">DsWrapper</span></a><span>
</span><a name="line-122"></a><a name="idDsWrapper"><a href="DsMonad.html#idDsWrapper"><span class="hs-identifier">idDsWrapper</span></a></a><span> </span><a name="local-6989586621680236449"><a href="#local-6989586621680236449"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236449"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- The semantics of (match vs (EqnInfo wrap pats rhs)) is the MatchResult</span><span>
</span><a name="line-125"></a><span class="hs-comment">--      \fail. wrap (case vs of { pats -&gt; rhs fail })</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- where vs are not bound by wrap</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- A MatchResult is an expression with a hole in it</span><span>
</span><a name="line-130"></a><span class="hs-keyword">data</span><span> </span><a name="MatchResult"><a href="DsMonad.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></a><span>
</span><a name="line-131"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="MatchResult"><a href="DsMonad.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></a><span>
</span><a name="line-132"></a><span>        </span><a href="DsMonad.html#CanItFail"><span class="hs-identifier hs-type">CanItFail</span></a><span>       </span><span class="hs-comment">-- Tells whether the failure expression is used</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>                        </span><span class="hs-comment">-- Takes a expression to plug in at the</span><span>
</span><a name="line-135"></a><span>                        </span><span class="hs-comment">-- failure point(s). The expression should</span><span>
</span><a name="line-136"></a><span>                        </span><span class="hs-comment">-- be duplicatable!</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-keyword">data</span><span> </span><a name="CanItFail"><a href="DsMonad.html#CanItFail"><span class="hs-identifier">CanItFail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CanFail"><a href="DsMonad.html#CanFail"><span class="hs-identifier">CanFail</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="CantFail"><a href="DsMonad.html#CantFail"><span class="hs-identifier">CantFail</span></a></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">orFail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DsMonad.html#CanItFail"><span class="hs-identifier hs-type">CanItFail</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#CanItFail"><span class="hs-identifier hs-type">CanItFail</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#CanItFail"><span class="hs-identifier hs-type">CanItFail</span></a><span>
</span><a name="line-141"></a><a name="orFail"><a href="DsMonad.html#orFail"><span class="hs-identifier">orFail</span></a></a><span> </span><a href="DsMonad.html#CantFail"><span class="hs-identifier hs-var">CantFail</span></a><span> </span><a href="DsMonad.html#CantFail"><span class="hs-identifier hs-var">CantFail</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#CantFail"><span class="hs-identifier hs-var">CantFail</span></a><span>
</span><a name="line-142"></a><span class="hs-identifier">orFail</span><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#CanFail"><span class="hs-identifier hs-var">CanFail</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Monad functions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-- Compatibility functions</span><span>
</span><a name="line-153"></a><span class="hs-identifier">fixDs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236448"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236448"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236448"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-154"></a><a name="fixDs"><a href="DsMonad.html#fixDs"><span class="hs-identifier">fixDs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-keyword">type</span><span> </span><a name="DsWarning"><a href="DsMonad.html#DsWarning"><span class="hs-identifier">DsWarning</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-comment">-- Not quite the same as a WarnMsg, we have an SDoc here</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-comment">-- and we'll do the print_unqual stuff later on to turn it</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-comment">-- into a Doc.</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Run a 'DsM' action inside the 'TcM' monad.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">initDsTc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236447"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680236447"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-163"></a><a name="initDsTc"><a href="DsMonad.html#initDsTc"><span class="hs-identifier">initDsTc</span></a></a><span> </span><a name="local-6989586621680236450"><a href="#local-6989586621680236450"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-164"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236451"><a href="#local-6989586621680236451"><span class="hs-identifier">tcg_env</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-165"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236452"><a href="#local-6989586621680236452"><span class="hs-identifier">msg_var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a><span>
</span><a name="line-166"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236453"><a href="#local-6989586621680236453"><span class="hs-identifier">hsc_env</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-167"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236454"><a href="#local-6989586621680236454"><span class="hs-identifier">envs</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var">mkDsEnvsFromTcGbl</span></a><span> </span><a href="#local-6989586621680236453"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236452"><span class="hs-identifier hs-var">msg_var</span></a><span> </span><a href="#local-6989586621680236451"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-168"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-6989586621680236454"><span class="hs-identifier hs-var">envs</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DsMonad.html#initDPH"><span class="hs-identifier hs-var">initDPH</span></a><span> </span><a href="#local-6989586621680236450"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-169"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">-- | Run a 'DsM' action inside the 'IO' monad.</span><span>
</span><a name="line-172"></a><span class="hs-identifier">initDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236446"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-6989586621680236446"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><a name="initDs"><a href="DsMonad.html#initDs"><span class="hs-identifier">initDs</span></a></a><span> </span><a name="local-6989586621680236455"><a href="#local-6989586621680236455"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621680236456"><a href="#local-6989586621680236456"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-6989586621680236457"><a href="#local-6989586621680236457"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236458"><a href="#local-6989586621680236458"><span class="hs-identifier">msg_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><a href="ErrUtils.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a><span>
</span><a name="line-175"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236459"><a href="#local-6989586621680236459"><span class="hs-identifier">envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var">mkDsEnvsFromTcGbl</span></a><span> </span><a href="#local-6989586621680236455"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236458"><span class="hs-identifier hs-var">msg_var</span></a><span> </span><a href="#local-6989586621680236456"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-176"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="DsMonad.html#runDs"><span class="hs-identifier hs-var">runDs</span></a><span> </span><a href="#local-6989586621680236455"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236459"><span class="hs-identifier hs-var">envs</span></a><span> </span><a href="#local-6989586621680236457"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-177"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- | Build a set of desugarer environments derived from a 'TcGblEnv'.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">mkDsEnvsFromTcGbl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="#local-6989586621680236445"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-181"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-182"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236445"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><a name="mkDsEnvsFromTcGbl"><a href="DsMonad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier">mkDsEnvsFromTcGbl</span></a></a><span> </span><a name="local-6989586621680236460"><a href="#local-6989586621680236460"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621680236461"><a href="#local-6989586621680236461"><span class="hs-identifier">msg_var</span></a></a><span> </span><a name="local-6989586621680236462"><a href="#local-6989586621680236462"><span class="hs-identifier">tcg_env</span></a></a><span>
</span><a name="line-184"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236463"><a href="#local-6989586621680236463"><span class="hs-identifier">pm_iter_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-185"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236464"><a href="#local-6989586621680236464"><span class="hs-identifier">dflags</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621680236460"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-186"></a><span>             </span><a name="local-6989586621680236465"><a href="#local-6989586621680236465"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><a href="#local-6989586621680236462"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-187"></a><span>             </span><a name="local-6989586621680236466"><a href="#local-6989586621680236466"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_type_env</span><span> </span><a href="#local-6989586621680236462"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-188"></a><span>             </span><a name="local-6989586621680236467"><a href="#local-6989586621680236467"><span class="hs-identifier">rdr_env</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-6989586621680236462"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-189"></a><span>             </span><a name="local-6989586621680236468"><a href="#local-6989586621680236468"><span class="hs-identifier">fam_inst_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><a href="#local-6989586621680236462"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-190"></a><span>             </span><a name="local-6989586621680236469"><a href="#local-6989586621680236469"><span class="hs-identifier">complete_matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a><span> </span><a href="#local-6989586621680236460"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-191"></a><span>                                </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">tcg_complete_matches</span><span> </span><a href="#local-6989586621680236462"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-192"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DsMonad.html#mkDsEnvs"><span class="hs-identifier hs-var">mkDsEnvs</span></a><span> </span><a href="#local-6989586621680236464"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236465"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-6989586621680236467"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621680236466"><span class="hs-identifier hs-var">type_env</span></a><span> </span><a href="#local-6989586621680236468"><span class="hs-identifier hs-var">fam_inst_env</span></a><span>
</span><a name="line-193"></a><span>                           </span><a href="#local-6989586621680236461"><span class="hs-identifier hs-var">msg_var</span></a><span> </span><a href="#local-6989586621680236463"><span class="hs-identifier hs-var">pm_iter_var</span></a><span> </span><a href="#local-6989586621680236469"><span class="hs-identifier hs-var">complete_matches</span></a><span>
</span><a name="line-194"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-identifier">runDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236444"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-6989586621680236444"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><a name="runDs"><a href="DsMonad.html#runDs"><span class="hs-identifier">runDs</span></a></a><span> </span><a name="local-6989586621680236470"><a href="#local-6989586621680236470"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680236471"><a href="#local-6989586621680236471"><span class="hs-identifier">ds_gbl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680236472"><a href="#local-6989586621680236472"><span class="hs-identifier">ds_lcl</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680236473"><a href="#local-6989586621680236473"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-198"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236475"><a href="#local-6989586621680236475"><span class="hs-identifier">res</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a><span> </span><span class="hs-char">'d'</span><span> </span><a href="#local-6989586621680236470"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236471"><span class="hs-identifier hs-var">ds_gbl</span></a><span> </span><a href="#local-6989586621680236472"><span class="hs-identifier hs-var">ds_lcl</span></a><span>
</span><a name="line-199"></a><span>                              </span><span class="hs-special">(</span><a href="DsMonad.html#initDPH"><span class="hs-identifier hs-var">initDPH</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a><span> </span><a href="#local-6989586621680236473"><span class="hs-identifier hs-var">thing_inside</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236476"><a href="#local-6989586621680236476"><span class="hs-identifier">msgs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236471"><span class="hs-identifier hs-var">ds_gbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236477"><a href="#local-6989586621680236477"><span class="hs-identifier">final_res</span></a></a><span>
</span><a name="line-202"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="ErrUtils.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a><span> </span><a href="#local-6989586621680236474"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236476"><span class="hs-identifier hs-var">msgs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-203"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a name="local-6989586621680236478"><a href="#local-6989586621680236478"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236475"><span class="hs-identifier hs-var">res</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680236478"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-204"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;initDs&quot;</span><span>
</span><a name="line-205"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236476"><span class="hs-identifier hs-var">msgs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236477"><span class="hs-identifier hs-var">final_res</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680236474"><a href="#local-6989586621680236474"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621680236470"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Run a 'DsM' action in the context of an existing 'ModGuts'</span><span>
</span><a name="line-210"></a><span class="hs-identifier">initDsWithModGuts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236443"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-6989586621680236443"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><a name="initDsWithModGuts"><a href="DsMonad.html#initDsWithModGuts"><span class="hs-identifier">initDsWithModGuts</span></a></a><span> </span><a name="local-6989586621680236479"><a href="#local-6989586621680236479"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621680236480"><a href="#local-6989586621680236480"><span class="hs-identifier">guts</span></a></a><span> </span><a name="local-6989586621680236481"><a href="#local-6989586621680236481"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236482"><a href="#local-6989586621680236482"><span class="hs-identifier">pm_iter_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-213"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236483"><a href="#local-6989586621680236483"><span class="hs-identifier">msg_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><a href="ErrUtils.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a><span>
</span><a name="line-214"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236484"><a href="#local-6989586621680236484"><span class="hs-identifier">dflags</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621680236479"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-215"></a><span>             </span><a name="local-6989586621680236485"><a href="#local-6989586621680236485"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#typeEnvFromEntities"><span class="hs-identifier hs-var">typeEnvFromEntities</span></a><span> </span><a href="#local-6989586621680236491"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_tcs</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_fam_insts</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>             </span><a name="local-6989586621680236486"><a href="#local-6989586621680236486"><span class="hs-identifier">rdr_env</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mg_rdr_env</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-217"></a><span>             </span><a name="local-6989586621680236487"><a href="#local-6989586621680236487"><span class="hs-identifier">fam_inst_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mg_fam_inst_env</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-218"></a><span>             </span><a name="local-6989586621680236488"><a href="#local-6989586621680236488"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mg_module</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-219"></a><span>             </span><a name="local-6989586621680236489"><a href="#local-6989586621680236489"><span class="hs-identifier">complete_matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a><span> </span><a href="#local-6989586621680236479"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-220"></a><span>                                </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">mg_complete_sigs</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>             </span><a name="local-6989586621680236490"><a href="#local-6989586621680236490"><span class="hs-identifier">bindsToIds</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a><span> </span><a name="local-6989586621680236493"><a href="#local-6989586621680236493"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680236493"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>             </span><span class="hs-identifier">bindsToIds</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Rec"><span class="hs-identifier hs-var">Rec</span></a><span>    </span><a name="local-6989586621680236494"><a href="#local-6989586621680236494"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621680236494"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-224"></a><span>             </span><a name="local-6989586621680236491"><a href="#local-6989586621680236491"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="#local-6989586621680236490"><span class="hs-identifier hs-var">bindsToIds</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_binds</span><span> </span><a href="#local-6989586621680236480"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>             </span><a name="local-6989586621680236492"><a href="#local-6989586621680236492"><span class="hs-identifier">envs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#mkDsEnvs"><span class="hs-identifier hs-var">mkDsEnvs</span></a><span> </span><a href="#local-6989586621680236484"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236488"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-6989586621680236486"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621680236485"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-227"></a><span>                              </span><a href="#local-6989586621680236487"><span class="hs-identifier hs-var">fam_inst_env</span></a><span> </span><a href="#local-6989586621680236483"><span class="hs-identifier hs-var">msg_var</span></a><span> </span><a href="#local-6989586621680236482"><span class="hs-identifier hs-var">pm_iter_var</span></a><span>
</span><a name="line-228"></a><span>                              </span><a href="#local-6989586621680236489"><span class="hs-identifier hs-var">complete_matches</span></a><span>
</span><a name="line-229"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="DsMonad.html#runDs"><span class="hs-identifier hs-var">runDs</span></a><span> </span><a href="#local-6989586621680236479"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236492"><span class="hs-identifier hs-var">envs</span></a><span> </span><a href="#local-6989586621680236481"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-230"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">initTcDsForSolver</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680236442"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-6989586621680236442"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- Spin up a TcM context so that we can run the constraint solver</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- Returns any error messages generated by the constraint solver</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- and (Just res) if no error happened; Nothing if an error happened</span><span>
</span><a name="line-236"></a><span class="hs-comment">--</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- Simon says: I'm not very happy about this.  We spin up a complete TcM monad</span><span>
</span><a name="line-238"></a><span class="hs-comment">--             only to immediately refine it to a TcS monad.</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- Better perhaps to make TcS into its own monad, rather than building on TcS</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- But that may in turn interact with plugins</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><a name="initTcDsForSolver"><a href="DsMonad.html#initTcDsForSolver"><span class="hs-identifier">initTcDsForSolver</span></a></a><span> </span><a name="local-6989586621680236495"><a href="#local-6989586621680236495"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-243"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680236496"><a href="#local-6989586621680236496"><span class="hs-identifier">gbl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680236497"><a href="#local-6989586621680236497"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a><span>
</span><a name="line-244"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236498"><a href="#local-6989586621680236498"><span class="hs-identifier">hsc_env</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-var">DsGblEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ds_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680236499"><a href="#local-6989586621680236499"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-247"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680236500"><a href="#local-6989586621680236500"><span class="hs-identifier">fam_inst_env</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236496"><span class="hs-identifier hs-var">gbl</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>             </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-var">DsLclEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dsl_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680236501"><a href="#local-6989586621680236501"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236497"><span class="hs-identifier hs-var">lcl</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a><span> </span><a href="#local-6989586621680236498"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="DriverPhases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680236499"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621680236501"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-252"></a><span>         </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236502"><a href="#local-6989586621680236502"><span class="hs-identifier">tc_gbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236502"><span class="hs-identifier hs-var">tc_gbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236500"><span class="hs-identifier hs-var">fam_inst_env</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-253"></a><span>         </span><a href="#local-6989586621680236495"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-identifier">mkDsEnvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span>
</span><a name="line-256"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-257"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><a name="mkDsEnvs"><a href="DsMonad.html#mkDsEnvs"><span class="hs-identifier">mkDsEnvs</span></a></a><span> </span><a name="local-6989586621680236503"><a href="#local-6989586621680236503"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680236504"><a href="#local-6989586621680236504"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621680236505"><a href="#local-6989586621680236505"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621680236506"><a href="#local-6989586621680236506"><span class="hs-identifier">type_env</span></a></a><span> </span><a name="local-6989586621680236507"><a href="#local-6989586621680236507"><span class="hs-identifier">fam_inst_env</span></a></a><span> </span><a name="local-6989586621680236508"><a href="#local-6989586621680236508"><span class="hs-identifier">msg_var</span></a></a><span> </span><a name="local-6989586621680236509"><a href="#local-6989586621680236509"><span class="hs-identifier">pmvar</span></a></a><span>
</span><a name="line-259"></a><span>         </span><a name="local-6989586621680236510"><a href="#local-6989586621680236510"><span class="hs-identifier">complete_matches</span></a></a><span>
</span><a name="line-260"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236511"><a href="#local-6989586621680236511"><span class="hs-identifier">if_genv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier hs-var">IfGblEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">if_doc</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;mkDsEnvs&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-261"></a><span>                             </span><span class="hs-identifier">if_rec_types</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236504"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680236506"><span class="hs-identifier hs-var">type_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-262"></a><span>        </span><a name="local-6989586621680236512"><a href="#local-6989586621680236512"><span class="hs-identifier">if_lenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a><span> </span><a href="#local-6989586621680236504"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;GHC error in desugarer lookup in&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236504"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>                             </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- not boot!</span><span>
</span><a name="line-264"></a><span>        </span><a name="local-6989586621680236513"><a href="#local-6989586621680236513"><span class="hs-identifier">real_span</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680236504"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>        </span><a name="local-6989586621680236514"><a href="#local-6989586621680236514"><span class="hs-identifier">completeMatchMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkCompleteMatchMap"><span class="hs-identifier hs-var">mkCompleteMatchMap</span></a><span> </span><a href="#local-6989586621680236510"><span class="hs-identifier hs-var">complete_matches</span></a><span>
</span><a name="line-266"></a><span>        </span><a name="local-6989586621680236515"><a href="#local-6989586621680236515"><span class="hs-identifier">gbl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-var">DsGblEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ds_mod</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236504"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-267"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236507"><span class="hs-identifier hs-var">fam_inst_env</span></a><span>
</span><a name="line-268"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_if_env</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236511"><span class="hs-identifier hs-var">if_genv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236512"><span class="hs-identifier hs-var">if_lenv</span></a><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_unqual</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkPrintUnqualified"><span class="hs-identifier hs-var">mkPrintUnqualified</span></a><span> </span><a href="#local-6989586621680236503"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236505"><span class="hs-identifier hs-var">rdr_env</span></a><span>
</span><a name="line-270"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_msgs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236508"><span class="hs-identifier hs-var">msg_var</span></a><span>
</span><a name="line-271"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_dph_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span>
</span><a name="line-272"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_parr_bi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;DsMonad: uninitialised ds_parr_bi&quot;</span><span>
</span><a name="line-273"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_complete_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236514"><span class="hs-identifier hs-var">completeMatchMap</span></a><span>
</span><a name="line-274"></a><span>                           </span><span class="hs-special">}</span><span>
</span><a name="line-275"></a><span>        </span><a name="local-6989586621680236516"><a href="#local-6989586621680236516"><span class="hs-identifier">lcl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-var">DsLclEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dsl_meta</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-276"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dsl_loc</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236513"><span class="hs-identifier hs-var">real_span</span></a><span>
</span><a name="line-277"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dsl_dicts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-278"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dsl_tm_cs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-279"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dsl_pm_iter</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236509"><span class="hs-identifier hs-var">pmvar</span></a><span>
</span><a name="line-280"></a><span>                           </span><span class="hs-special">}</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236515"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236516"><span class="hs-identifier hs-var">lcl_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Operations in the monad
*                                                                      *
************************************************************************

And all this mysterious stuff is so we can occasionally reach out and
grab one or more names.  @newLocalDs@ isn't exported---exported
functions are defined with it.  The difference in name-strings makes
it easier to read debugging output.

Note [Levity polymorphism checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
According to the &quot;Levity Polymorphism&quot; paper (PLDI '17), levity
polymorphism is forbidden in precisely two places: in the type of a bound
term-level argument and in the type of an argument to a function. The paper
explains it more fully, but briefly: expressions in these contexts need to be
stored in registers, and it's hard (read, impossible) to store something
that's levity polymorphic.

We cannot check for bad levity polymorphism conveniently in the type checker,
because we can't tell, a priori, which levity metavariables will be solved.
At one point, I (Richard) thought we could check in the zonker, but it's hard
to know where precisely are the abstracted variables and the arguments. So
we check in the desugarer, the only place where we can see the Core code and
still report respectable syntax to the user. This covers the vast majority
of cases; see calls to DsMonad.dsNoLevPoly and friends.

Levity polymorphism is also prohibited in the types of binders, and the
desugarer checks for this in GHC-generated Ids. (The zonker handles
the user-writted ids in zonkIdBndr.) This is done in newSysLocalDsNoLP.
The newSysLocalDs variant is used in the vast majority of cases where
the binder is obviously not levity polymorphic, omitting the check.
It would be nice to ASSERT that there is no levity polymorphism here,
but we can't, because of the fixM in DsArrows. It's all OK, though:
Core Lint will catch an error here.

However, the desugarer is the wrong place for certain checks. In particular,
the desugarer can't report a sensible error message if an HsWrapper is malformed.
After all, GHC itself produced the HsWrapper. So we store some message text
in the appropriate HsWrappers (e.g. WpFun) that we can print out in the
desugarer.

There are a few more checks in places where Core is generated outside the
desugarer. For example, in datatype and class declarations, where levity
polymorphism is checked for during validity checking. It would be nice to
have one central place for all this, but that doesn't seem possible while
still reporting nice error messages.

-}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- Make a new Id with the same print name, but different type, and new unique</span><span>
</span><a name="line-337"></a><span class="hs-identifier">newUniqueId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-338"></a><a name="newUniqueId"><a href="DsMonad.html#newUniqueId"><span class="hs-identifier">newUniqueId</span></a></a><span> </span><a name="local-6989586621680236517"><a href="#local-6989586621680236517"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#mk_local"><span class="hs-identifier hs-var">mk_local</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621680236517"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-identifier">duplicateLocalDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-341"></a><a name="duplicateLocalDs"><a href="DsMonad.html#duplicateLocalDs"><span class="hs-identifier">duplicateLocalDs</span></a></a><span> </span><a name="local-6989586621680236518"><a href="#local-6989586621680236518"><span class="hs-identifier">old_local</span></a></a><span>
</span><a name="line-342"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236519"><a href="#local-6989586621680236519"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-343"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#setIdUnique"><span class="hs-identifier hs-var">setIdUnique</span></a><span> </span><a href="#local-6989586621680236518"><span class="hs-identifier hs-var">old_local</span></a><span> </span><a href="#local-6989586621680236519"><span class="hs-identifier hs-var">uniq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-identifier">newPredVarDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>
</span><a name="line-346"></a><a name="newPredVarDs"><a href="DsMonad.html#newPredVarDs"><span class="hs-identifier">newPredVarDs</span></a></a><span> </span><a name="local-6989586621680236520"><a href="#local-6989586621680236520"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-347"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a><span> </span><a href="#local-6989586621680236520"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-identifier">newSysLocalDsNoLP</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newSysLocalDs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newFailLocalDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-350"></a><a name="newSysLocalDsNoLP"><a href="DsMonad.html#newSysLocalDsNoLP"><span class="hs-identifier">newSysLocalDsNoLP</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#mk_local"><span class="hs-identifier hs-var">mk_local</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ds&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-comment">-- this variant should be used when the caller can be sure that the variable type</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- is not levity-polymorphic. It is necessary when the type is knot-tied because</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- of the fixM used in DsArrows. See Note [Levity polymorphism checking]</span><span>
</span><a name="line-355"></a><a name="newSysLocalDs"><a href="DsMonad.html#newSysLocalDs"><span class="hs-identifier">newSysLocalDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ds&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-356"></a><a name="newFailLocalDs"><a href="DsMonad.html#newFailLocalDs"><span class="hs-identifier">newFailLocalDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;fail&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>  </span><span class="hs-comment">-- the fail variable is used only in a situation where we can tell that</span><span>
</span><a name="line-358"></a><span>  </span><span class="hs-comment">-- levity-polymorphism is impossible.</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-identifier">newSysLocalsDsNoLP</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newSysLocalsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-361"></a><a name="newSysLocalsDsNoLP"><a href="DsMonad.html#newSysLocalsDsNoLP"><span class="hs-identifier">newSysLocalsDsNoLP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="DsMonad.html#newSysLocalDsNoLP"><span class="hs-identifier hs-var">newSysLocalDsNoLP</span></a><span>
</span><a name="line-362"></a><a name="newSysLocalsDs"><a href="DsMonad.html#newSysLocalsDs"><span class="hs-identifier">newSysLocalsDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="DsMonad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span class="hs-identifier">mk_local</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-365"></a><a name="mk_local"><a href="DsMonad.html#mk_local"><span class="hs-identifier">mk_local</span></a></a><span> </span><a name="local-6989586621680236521"><a href="#local-6989586621680236521"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621680236522"><a href="#local-6989586621680236522"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="DsMonad.html#dsNoLevPoly"><span class="hs-identifier hs-var">dsNoLevPoly</span></a><span> </span><a href="#local-6989586621680236522"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When trying to create a variable of type:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-366"></a><span>                                      </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236522"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- could improve the msg with another</span><span>
</span><a name="line-367"></a><span>                                               </span><span class="hs-comment">-- parameter indicating context</span><span>
</span><a name="line-368"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a><span> </span><a href="#local-6989586621680236521"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621680236522"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">{-
We can also reach out and either set/grab location information from
the @SrcSpan@ being carried around.
-}</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-identifier">getGhcModeDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="DynFlags.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a><span>
</span><a name="line-376"></a><a name="getGhcModeDs"><a href="DsMonad.html#getGhcModeDs"><span class="hs-identifier">getGhcModeDs</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ghcMode</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- | Get in-scope type constraints (pm check)</span><span>
</span><a name="line-379"></a><span class="hs-identifier">getDictsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><a name="getDictsDs"><a href="DsMonad.html#getDictsDs"><span class="hs-identifier">getDictsDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236523"><a href="#local-6989586621680236523"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_dicts</span><span> </span><a href="#local-6989586621680236523"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- | Add in-scope type constraints (pm check)</span><span>
</span><a name="line-383"></a><span class="hs-identifier">addDictsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236441"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236441"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-384"></a><a name="addDictsDs"><a href="DsMonad.html#addDictsDs"><span class="hs-identifier">addDictsDs</span></a></a><span> </span><a name="local-6989586621680236524"><a href="#local-6989586621680236524"><span class="hs-identifier">ev_vars</span></a></a><span>
</span><a name="line-385"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236525"><a href="#local-6989586621680236525"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236525"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dsl_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span> </span><a href="#local-6989586621680236524"><span class="hs-identifier hs-var">ev_vars</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_dicts</span><span> </span><a href="#local-6989586621680236525"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- | Get in-scope term constraints (pm check)</span><span>
</span><a name="line-388"></a><span class="hs-identifier">getTmCsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="PmExpr.html#SimpleEq"><span class="hs-identifier hs-type">SimpleEq</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><a name="getTmCsDs"><a href="DsMonad.html#getTmCsDs"><span class="hs-identifier">getTmCsDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236526"><a href="#local-6989586621680236526"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_tm_cs</span><span> </span><a href="#local-6989586621680236526"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-- | Add in-scope term constraints (pm check)</span><span>
</span><a name="line-392"></a><span class="hs-identifier">addTmCsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="PmExpr.html#SimpleEq"><span class="hs-identifier hs-type">SimpleEq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236440"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236440"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-393"></a><a name="addTmCsDs"><a href="DsMonad.html#addTmCsDs"><span class="hs-identifier">addTmCsDs</span></a></a><span> </span><a name="local-6989586621680236527"><a href="#local-6989586621680236527"><span class="hs-identifier">tm_cs</span></a></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236528"><a href="#local-6989586621680236528"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236528"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dsl_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span> </span><a href="#local-6989586621680236527"><span class="hs-identifier hs-var">tm_cs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_tm_cs</span><span> </span><a href="#local-6989586621680236528"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-comment">-- | Increase the counter for elapsed pattern match check iterations.</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- If the current counter is already over the limit, fail</span><span>
</span><a name="line-398"></a><span class="hs-identifier">incrCheckPmIterDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-399"></a><a name="incrCheckPmIterDs"><a href="DsMonad.html#incrCheckPmIterDs"><span class="hs-identifier">incrCheckPmIterDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-400"></a><span>  </span><a name="local-6989586621680236529"><a href="#local-6989586621680236529"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-401"></a><span>  </span><a name="local-6989586621680236530"><a href="#local-6989586621680236530"><span class="hs-identifier">cnt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_pm_iter</span><span> </span><a href="#local-6989586621680236529"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>  </span><a name="local-6989586621680236531"><a href="#local-6989586621680236531"><span class="hs-identifier">max_iters</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maxPmCheckIterations</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-403"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680236530"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621680236531"><span class="hs-identifier hs-var">max_iters</span></a><span>
</span><a name="line-404"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span>
</span><a name="line-405"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="TcRnMonad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_pm_iter</span><span> </span><a href="#local-6989586621680236529"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680236530"><span class="hs-identifier hs-var">cnt</span></a><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- | Reset the counter for pattern match check iterations to zero</span><span>
</span><a name="line-409"></a><span class="hs-identifier">resetPmIterDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-410"></a><a name="resetPmIterDs"><a href="DsMonad.html#resetPmIterDs"><span class="hs-identifier">resetPmIterDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236532"><a href="#local-6989586621680236532"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_pm_iter</span><span> </span><a href="#local-6989586621680236532"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-identifier">getSrcSpanDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-413"></a><a name="getSrcSpanDs"><a href="DsMonad.html#getSrcSpanDs"><span class="hs-identifier">getSrcSpanDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236533"><a href="#local-6989586621680236533"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-414"></a><span>                  </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_loc</span><span> </span><a href="#local-6989586621680236533"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-identifier">putSrcSpanDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236439"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236439"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-417"></a><a name="putSrcSpanDs"><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier">putSrcSpanDs</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-var">UnhelpfulSpan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680236534"><a href="#local-6989586621680236534"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-418"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236534"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-419"></a><span class="hs-identifier">putSrcSpanDs</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a><span> </span><a name="local-6989586621680236535"><a href="#local-6989586621680236535"><span class="hs-identifier">real_span</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680236536"><a href="#local-6989586621680236536"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-420"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680236537"><a href="#local-6989586621680236537"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236537"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">dsl_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236535"><span class="hs-identifier hs-var">real_span</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236536"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-comment">-- | Emit a warning for the current source location</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- NB: Warns whether or not -Wxyz is set</span><span>
</span><a name="line-424"></a><span class="hs-identifier">warnDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-425"></a><a name="warnDs"><a href="DsMonad.html#warnDs"><span class="hs-identifier">warnDs</span></a></a><span> </span><a name="local-6989586621680236538"><a href="#local-6989586621680236538"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-6989586621680236539"><a href="#local-6989586621680236539"><span class="hs-identifier">warn</span></a></a><span>
</span><a name="line-426"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236540"><a href="#local-6989586621680236540"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-427"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236541"><a href="#local-6989586621680236541"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a><span>
</span><a name="line-428"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236542"><a href="#local-6989586621680236542"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-429"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236543"><a href="#local-6989586621680236543"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a><span> </span><a href="#local-6989586621680236538"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-430"></a><span>                   </span><a href="ErrUtils.html#mkWarnMsg"><span class="hs-identifier hs-var">mkWarnMsg</span></a><span> </span><a href="#local-6989586621680236542"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236541"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_unqual</span><span> </span><a href="#local-6989586621680236540"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236539"><span class="hs-identifier hs-var">warn</span></a><span>
</span><a name="line-431"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#updMutVar"><span class="hs-identifier hs-var">updMutVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236540"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680236544"><a href="#local-6989586621680236544"><span class="hs-identifier">w</span></a></a><span class="hs-special">,</span><a name="local-6989586621680236545"><a href="#local-6989586621680236545"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236544"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236543"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236545"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-comment">-- | Emit a warning only if the correct WarnReason is set in the DynFlags</span><span>
</span><a name="line-434"></a><span class="hs-identifier">warnIfSetDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-435"></a><a name="warnIfSetDs"><a href="DsMonad.html#warnIfSetDs"><span class="hs-identifier">warnIfSetDs</span></a></a><span> </span><a name="local-6989586621680236546"><a href="#local-6989586621680236546"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621680236547"><a href="#local-6989586621680236547"><span class="hs-identifier">warn</span></a></a><span>
</span><a name="line-436"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="#local-6989586621680236546"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-437"></a><span>    </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-6989586621680236546"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236547"><span class="hs-identifier hs-var">warn</span></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">errDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-440"></a><a name="errDs"><a href="DsMonad.html#errDs"><span class="hs-identifier">errDs</span></a></a><span> </span><a name="local-6989586621680236548"><a href="#local-6989586621680236548"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-441"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236549"><a href="#local-6989586621680236549"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-442"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236550"><a href="#local-6989586621680236550"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a><span>
</span><a name="line-443"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236551"><a href="#local-6989586621680236551"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-444"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236552"><a href="#local-6989586621680236552"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#mkErrMsg"><span class="hs-identifier hs-var">mkErrMsg</span></a><span> </span><a href="#local-6989586621680236551"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236550"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_unqual</span><span> </span><a href="#local-6989586621680236549"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236548"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-445"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#updMutVar"><span class="hs-identifier hs-var">updMutVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236549"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680236553"><a href="#local-6989586621680236553"><span class="hs-identifier">w</span></a></a><span class="hs-special">,</span><a name="local-6989586621680236554"><a href="#local-6989586621680236554"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236553"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236554"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236552"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- | Issue an error, but return the expression for (), so that we can continue</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- reporting errors.</span><span>
</span><a name="line-449"></a><span class="hs-identifier">errDsCoreExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-450"></a><a name="errDsCoreExpr"><a href="DsMonad.html#errDsCoreExpr"><span class="hs-identifier">errDsCoreExpr</span></a></a><span> </span><a name="local-6989586621680236555"><a href="#local-6989586621680236555"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-451"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="DsMonad.html#errDs"><span class="hs-identifier hs-var">errDs</span></a><span> </span><a href="#local-6989586621680236555"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-452"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkCore.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-identifier">failWithDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236438"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-455"></a><a name="failWithDs"><a href="DsMonad.html#failWithDs"><span class="hs-identifier">failWithDs</span></a></a><span> </span><a name="local-6989586621680236556"><a href="#local-6989586621680236556"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-456"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="DsMonad.html#errDs"><span class="hs-identifier hs-var">errDs</span></a><span> </span><a href="#local-6989586621680236556"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-457"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-identifier">failDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236437"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-460"></a><a name="failDs"><a href="DsMonad.html#failDs"><span class="hs-identifier">failDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">-- (askNoErrsDs m) runs m</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- If m fails,</span><span>
</span><a name="line-464"></a><span class="hs-comment">--    then (askNoErrsDs m) fails</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- If m succeeds with result r,</span><span>
</span><a name="line-466"></a><span class="hs-comment">--    then (askNoErrsDs m) succeeds with result (r, b),</span><span>
</span><a name="line-467"></a><span class="hs-comment">--         where b is True iff m generated no errors</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- Regardless of success or failure,</span><span>
</span><a name="line-469"></a><span class="hs-comment">--   propagate any errors/warnings generated by m</span><span>
</span><a name="line-470"></a><span class="hs-comment">--</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- c.f. TcRnMonad.askNoErrs</span><span>
</span><a name="line-472"></a><span class="hs-identifier">askNoErrsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236436"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236436"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-473"></a><a name="askNoErrsDs"><a href="DsMonad.html#askNoErrsDs"><span class="hs-identifier">askNoErrsDs</span></a></a><span> </span><a name="local-6989586621680236557"><a href="#local-6989586621680236557"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-474"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236558"><a href="#local-6989586621680236558"><span class="hs-identifier">errs_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="ErrUtils.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a><span>
</span><a name="line-475"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236559"><a href="#local-6989586621680236559"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-476"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236560"><a href="#local-6989586621680236560"><span class="hs-identifier">mb_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>  </span><span class="hs-comment">-- Be careful to catch exceptions</span><span>
</span><a name="line-477"></a><span>                          </span><span class="hs-comment">-- so that we propagate errors correctly</span><span>
</span><a name="line-478"></a><span>                          </span><span class="hs-comment">-- (Trac #13642)</span><span>
</span><a name="line-479"></a><span>                  </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236559"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ds_msgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236558"><span class="hs-identifier hs-var">errs_var</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-480"></a><span>                  </span><a href="#local-6989586621680236557"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span>      </span><span class="hs-comment">-- Propagate errors</span><span>
</span><a name="line-483"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236561"><a href="#local-6989586621680236561"><span class="hs-identifier">msgs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680236562"><a href="#local-6989586621680236562"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680236563"><a href="#local-6989586621680236563"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621680236558"><span class="hs-identifier hs-var">errs_var</span></a><span>
</span><a name="line-484"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#updMutVar"><span class="hs-identifier hs-var">updMutVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236559"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680236564"><a href="#local-6989586621680236564"><span class="hs-identifier">w</span></a></a><span class="hs-special">,</span><a name="local-6989586621680236565"><a href="#local-6989586621680236565"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236564"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236562"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236565"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236563"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span>      </span><span class="hs-comment">-- And return</span><span>
</span><a name="line-487"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680236560"><span class="hs-identifier hs-var">mb_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-488"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span>
</span><a name="line-489"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a name="local-6989586621680236566"><a href="#local-6989586621680236566"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236567"><a href="#local-6989586621680236567"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-490"></a><span>                           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236568"><a href="#local-6989586621680236568"><span class="hs-identifier">errs_found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a><span> </span><a href="#local-6989586621680236567"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680236561"><span class="hs-identifier hs-var">msgs</span></a><span>
</span><a name="line-491"></a><span>                           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236566"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680236568"><span class="hs-identifier hs-var">errs_found</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-identifier">mkPrintUnqualifiedDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-494"></a><a name="mkPrintUnqualifiedDs"><a href="DsMonad.html#mkPrintUnqualifiedDs"><span class="hs-identifier">mkPrintUnqualifiedDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ds_unqual</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-keyword">instance</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><span class="hs-special">(</span><a href="IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-497"></a><span>    </span><a name="local-8214565720324543143"><a href="HscTypes.html#lookupThing"><span class="hs-identifier">lookupThing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- | Attempt to load the given module and return its exported entities if</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- successful.</span><span>
</span><a name="line-501"></a><span class="hs-identifier">dsLoadModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-502"></a><a name="dsLoadModule"><a href="DsMonad.html#dsLoadModule"><span class="hs-identifier">dsLoadModule</span></a></a><span> </span><a name="local-6989586621680236569"><a href="#local-6989586621680236569"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621680236570"><a href="#local-6989586621680236570"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236574"><a href="#local-6989586621680236574"><span class="hs-identifier">env</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-504"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_if_env</span><span> </span><a href="#local-6989586621680236574"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-505"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236575"><a href="#local-6989586621680236575"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadInterface"><span class="hs-identifier hs-var">loadInterface</span></a><span> </span><a href="#local-6989586621680236569"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621680236570"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="TcRnTypes.html#ImportBySystem"><span class="hs-identifier hs-var">ImportBySystem</span></a><span>
</span><a name="line-506"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680236575"><span class="hs-identifier hs-var">iface</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-507"></a><span>           </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><a name="local-6989586621680236576"><a href="#local-6989586621680236576"><span class="hs-identifier">err</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;DsMonad.dsLoadModule: failed to load&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236576"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236569"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>           </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><a name="local-6989586621680236577"><a href="#local-6989586621680236577"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RdrName.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="RdrName.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a><span> </span><a href="#local-6989586621680236571"><span class="hs-identifier hs-var">prov</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">mi_exports</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680236577"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-509"></a><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-510"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-511"></a><span>    </span><a name="local-6989586621680236571"><a href="#local-6989586621680236571"><span class="hs-identifier">prov</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236572"><span class="hs-identifier hs-var">imp_spec</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_item</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span>    </span><a name="local-6989586621680236572"><a href="#local-6989586621680236572"><span class="hs-identifier">imp_spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-var">ImpDeclSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236573"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-513"></a><span>                             </span><span class="hs-identifier">is_dloc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#wiredInSrcSpan"><span class="hs-identifier hs-var">wiredInSrcSpan</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236573"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-514"></a><span>    </span><a name="local-6989586621680236573"><a href="#local-6989586621680236573"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680236570"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">dsLookupGlobal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-517"></a><span class="hs-comment">-- Very like TcEnv.tcLookupGlobal</span><span>
</span><a name="line-518"></a><a name="dsLookupGlobal"><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier">dsLookupGlobal</span></a></a><span> </span><a name="local-6989586621680236578"><a href="#local-6989586621680236578"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-519"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236579"><a href="#local-6989586621680236579"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-520"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_if_env</span><span> </span><a href="#local-6989586621680236579"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>                  </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621680236578"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span class="hs-identifier">dsLookupGlobalId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-524"></a><a name="dsLookupGlobalId"><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier">dsLookupGlobalId</span></a></a><span> </span><a name="local-6989586621680236580"><a href="#local-6989586621680236580"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-525"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#tyThingId"><span class="hs-identifier hs-var">tyThingId</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span> </span><a href="#local-6989586621680236580"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span class="hs-identifier">dsLookupTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-528"></a><a name="dsLookupTyCon"><a href="DsMonad.html#dsLookupTyCon"><span class="hs-identifier">dsLookupTyCon</span></a></a><span> </span><a name="local-6989586621680236581"><a href="#local-6989586621680236581"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-529"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#tyThingTyCon"><span class="hs-identifier hs-var">tyThingTyCon</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span> </span><a href="#local-6989586621680236581"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-identifier">dsLookupDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-532"></a><a name="dsLookupDataCon"><a href="DsMonad.html#dsLookupDataCon"><span class="hs-identifier">dsLookupDataCon</span></a></a><span> </span><a name="local-6989586621680236582"><a href="#local-6989586621680236582"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-533"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#tyThingDataCon"><span class="hs-identifier hs-var">tyThingDataCon</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span> </span><a href="#local-6989586621680236582"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-identifier">dsLookupConLike</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span>
</span><a name="line-536"></a><a name="dsLookupConLike"><a href="DsMonad.html#dsLookupConLike"><span class="hs-identifier">dsLookupConLike</span></a></a><span> </span><a name="local-6989586621680236583"><a href="#local-6989586621680236583"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-537"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#tyThingConLike"><span class="hs-identifier hs-var">tyThingConLike</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="DsMonad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a><span> </span><a href="#local-6989586621680236583"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-identifier">dsGetFamInstEnvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-541"></a><span class="hs-comment">-- Gets both the external-package inst-env</span><span>
</span><a name="line-542"></a><span class="hs-comment">-- and the home-pkg inst env (includes module being compiled)</span><span>
</span><a name="line-543"></a><a name="dsGetFamInstEnvs"><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier">dsGetFamInstEnvs</span></a></a><span>
</span><a name="line-544"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236584"><a href="#local-6989586621680236584"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621680236585"><a href="#local-6989586621680236585"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-545"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">eps_fam_inst_env</span><span> </span><a href="#local-6989586621680236584"><span class="hs-identifier hs-var">eps</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ds_fam_inst_env</span><span> </span><a href="#local-6989586621680236585"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-identifier">dsGetMetaEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><a name="dsGetMetaEnv"><a href="DsMonad.html#dsGetMetaEnv"><span class="hs-identifier">dsGetMetaEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236586"><a href="#local-6989586621680236586"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_meta</span><span> </span><a href="#local-6989586621680236586"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-comment">-- | The @COMPLETE@ pragams provided by the user for a given `TyCon`.</span><span>
</span><a name="line-551"></a><span class="hs-identifier">dsGetCompleteMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-552"></a><a name="dsGetCompleteMatches"><a href="DsMonad.html#dsGetCompleteMatches"><span class="hs-identifier">dsGetCompleteMatches</span></a></a><span> </span><a name="local-6989586621680236587"><a href="#local-6989586621680236587"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-553"></a><span>  </span><a name="local-6989586621680236588"><a href="#local-6989586621680236588"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a><span>
</span><a name="line-554"></a><span>  </span><a name="local-6989586621680236589"><a href="#local-6989586621680236589"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-555"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236590"><a href="#local-6989586621680236590"><span class="hs-identifier">lookup_completes</span></a></a><span> </span><a name="local-6989586621680236593"><a href="#local-6989586621680236593"><span class="hs-identifier">ufm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#lookupWithDefaultUFM"><span class="hs-identifier hs-var">lookupWithDefaultUFM</span></a><span> </span><a href="#local-6989586621680236593"><span class="hs-identifier hs-var">ufm</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680236587"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-556"></a><span>      </span><a name="local-6989586621680236591"><a href="#local-6989586621680236591"><span class="hs-identifier">eps_matches_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236590"><span class="hs-identifier hs-var">lookup_completes</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">eps_complete_matches</span><span> </span><a href="#local-6989586621680236588"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-557"></a><span>      </span><a name="local-6989586621680236592"><a href="#local-6989586621680236592"><span class="hs-identifier">env_matches_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236590"><span class="hs-identifier hs-var">lookup_completes</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">ds_complete_matches</span><span> </span><a href="#local-6989586621680236589"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-558"></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680236591"><span class="hs-identifier hs-var">eps_matches_list</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680236592"><span class="hs-identifier hs-var">env_matches_list</span></a><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span class="hs-identifier">dsLookupMetaEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a><span class="hs-special">)</span><span>
</span><a name="line-561"></a><a name="dsLookupMetaEnv"><a href="DsMonad.html#dsLookupMetaEnv"><span class="hs-identifier">dsLookupMetaEnv</span></a></a><span> </span><a name="local-6989586621680236594"><a href="#local-6989586621680236594"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236595"><a href="#local-6989586621680236595"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsl_meta</span><span> </span><a href="#local-6989586621680236595"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236594"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-identifier">dsExtendMetaEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236435"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236435"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-564"></a><a name="dsExtendMetaEnv"><a href="DsMonad.html#dsExtendMetaEnv"><span class="hs-identifier">dsExtendMetaEnv</span></a></a><span> </span><a name="local-6989586621680236596"><a href="#local-6989586621680236596"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-6989586621680236597"><a href="#local-6989586621680236597"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-565"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236598"><a href="#local-6989586621680236598"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236598"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dsl_meta</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dsl_meta</span><span> </span><a href="#local-6989586621680236598"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">`</span><a href="NameEnv.html#plusNameEnv"><span class="hs-identifier hs-var">plusNameEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236596"><span class="hs-identifier hs-var">menv</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236597"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-identifier">discardWarningsDs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236434"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236434"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-568"></a><span class="hs-comment">-- Ignore warnings inside the thing inside;</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- used to ignore inaccessable cases etc. inside generated code</span><span>
</span><a name="line-570"></a><a name="discardWarningsDs"><a href="DsMonad.html#discardWarningsDs"><span class="hs-identifier">discardWarningsDs</span></a></a><span> </span><a name="local-6989586621680236599"><a href="#local-6989586621680236599"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-571"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236600"><a href="#local-6989586621680236600"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-572"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236601"><a href="#local-6989586621680236601"><span class="hs-identifier">old_msgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236600"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236602"><a href="#local-6989586621680236602"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236599"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span>        </span><span class="hs-comment">-- Revert messages to old_msgs</span><span>
</span><a name="line-577"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ds_msgs</span><span> </span><a href="#local-6989586621680236600"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236601"><span class="hs-identifier hs-var">old_msgs</span></a><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680236602"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span class="hs-comment">-- | Fail with an error message if the type is levity polymorphic.</span><span>
</span><a name="line-582"></a><span class="hs-identifier">dsNoLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span class="hs-comment">-- See Note [Levity polymorphism checking]</span><span>
</span><a name="line-584"></a><a name="dsNoLevPoly"><a href="DsMonad.html#dsNoLevPoly"><span class="hs-identifier">dsNoLevPoly</span></a></a><span> </span><a name="local-6989586621680236603"><a href="#local-6989586621680236603"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680236604"><a href="#local-6989586621680236604"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#checkForLevPolyX"><span class="hs-identifier hs-var">checkForLevPolyX</span></a><span> </span><a href="DsMonad.html#errDs"><span class="hs-identifier hs-var">errDs</span></a><span> </span><a href="#local-6989586621680236604"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621680236603"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">-- | Check an expression for levity polymorphism, failing if it is</span><span>
</span><a name="line-587"></a><span class="hs-comment">-- levity polymorphic.</span><span>
</span><a name="line-588"></a><span class="hs-identifier">dsNoLevPolyExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span class="hs-comment">-- See Note [Levity polymorphism checking]</span><span>
</span><a name="line-590"></a><a name="dsNoLevPolyExpr"><a href="DsMonad.html#dsNoLevPolyExpr"><span class="hs-identifier">dsNoLevPolyExpr</span></a></a><span> </span><a name="local-6989586621680236605"><a href="#local-6989586621680236605"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680236606"><a href="#local-6989586621680236606"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-591"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="CoreUtils.html#isExprLevPoly"><span class="hs-identifier hs-var">isExprLevPoly</span></a><span> </span><a href="#local-6989586621680236605"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#errDs"><span class="hs-identifier hs-var">errDs</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#formatLevPolyErr"><span class="hs-identifier hs-var">formatLevPolyErr</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621680236605"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236606"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span class="hs-comment">-- | Runs the thing_inside. If there are no errors, then returns the expr</span><span>
</span><a name="line-595"></a><span class="hs-comment">-- given. Otherwise, returns unitExpr. This is useful for doing a bunch</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- of levity polymorphism checks and then avoiding making a core App.</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- (If we make a core App on a levity polymorphic argument, detecting how</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- to handle the let/app invariant might call isUnliftedType, which panics</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- on a levity polymorphic type.)</span><span>
</span><a name="line-600"></a><span class="hs-comment">-- See #12709 for an example of why this machinery is necessary.</span><span>
</span><a name="line-601"></a><span class="hs-identifier">dsWhenNoErrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236433"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236433"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-602"></a><a name="dsWhenNoErrs"><a href="DsMonad.html#dsWhenNoErrs"><span class="hs-identifier">dsWhenNoErrs</span></a></a><span> </span><a name="local-6989586621680236607"><a href="#local-6989586621680236607"><span class="hs-identifier">thing_inside</span></a></a><span> </span><a name="local-6989586621680236608"><a href="#local-6989586621680236608"><span class="hs-identifier">mk_expr</span></a></a><span>
</span><a name="line-603"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680236609"><a href="#local-6989586621680236609"><span class="hs-identifier">result</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680236610"><a href="#local-6989586621680236610"><span class="hs-identifier">no_errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#askNoErrsDs"><span class="hs-identifier hs-var">askNoErrsDs</span></a><span> </span><a href="#local-6989586621680236607"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-604"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680236610"><span class="hs-identifier hs-var">no_errs</span></a><span>
</span><a name="line-605"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680236608"><span class="hs-identifier hs-var">mk_expr</span></a><span> </span><a href="#local-6989586621680236609"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-606"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><a href="MkCore.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-607"></a><span>
</span><a name="line-608"></a><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><a name="line-609"></a><span class="hs-comment">--                  Data Parallel Haskell</span><span>
</span><a name="line-610"></a><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span class="hs-comment">-- | Run a 'DsM' with DPH things in scope if necessary.</span><span>
</span><a name="line-613"></a><span class="hs-identifier">initDPH</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236432"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236432"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-614"></a><a name="initDPH"><a href="DsMonad.html#initDPH"><span class="hs-identifier">initDPH</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#loadDAP"><span class="hs-identifier hs-var">loadDAP</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="DsMonad.html#initDPHBuiltins"><span class="hs-identifier hs-var">initDPHBuiltins</span></a><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-comment">-- | Extend the global environment with a 'GlobalRdrEnv' containing the exported</span><span>
</span><a name="line-617"></a><span class="hs-comment">-- entities of,</span><span>
</span><a name="line-618"></a><span class="hs-comment">--</span><span>
</span><a name="line-619"></a><span class="hs-comment">--   * 'Data.Array.Parallel'      iff '-XParallelArrays' specified (see also 'checkLoadDAP').</span><span>
</span><a name="line-620"></a><span class="hs-comment">--   * 'Data.Array.Parallel.Prim' iff '-fvectorise' specified.</span><span>
</span><a name="line-621"></a><span class="hs-identifier">loadDAP</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236431"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236431"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-622"></a><a name="loadDAP"><a href="DsMonad.html#loadDAP"><span class="hs-identifier">loadDAP</span></a></a><span> </span><a name="local-6989586621680236611"><a href="#local-6989586621680236611"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-623"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236625"><a href="#local-6989586621680236625"><span class="hs-identifier">dapEnv</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236612"><span class="hs-identifier hs-var">loadOneModule</span></a><span> </span><a href="PrelNames.html#dATA_ARRAY_PARALLEL_NAME"><span class="hs-identifier hs-var">dATA_ARRAY_PARALLEL_NAME</span></a><span>      </span><a href="DsMonad.html#checkLoadDAP"><span class="hs-identifier hs-var">checkLoadDAP</span></a><span>          </span><a href="#local-6989586621680236613"><span class="hs-identifier hs-var">paErr</span></a><span>
</span><a name="line-624"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236626"><a href="#local-6989586621680236626"><span class="hs-identifier">dappEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236612"><span class="hs-identifier hs-var">loadOneModule</span></a><span> </span><a href="PrelNames.html#dATA_ARRAY_PARALLEL_PRIM_NAME"><span class="hs-identifier hs-var">dATA_ARRAY_PARALLEL_PRIM_NAME</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a><span> </span><a href="DynFlags.html#Opt_Vectorise"><span class="hs-identifier hs-var">Opt_Vectorise</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236614"><span class="hs-identifier hs-var">veErr</span></a><span>
</span><a name="line-625"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236627"><a href="#local-6989586621680236627"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236627"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ds_dph_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236625"><span class="hs-identifier hs-var">dapEnv</span></a><span> </span><span class="hs-special">`</span><a href="OccName.html#plusOccEnv"><span class="hs-identifier hs-var">plusOccEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680236626"><span class="hs-identifier hs-var">dappEnv</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680236611"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-626"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-627"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-628"></a><span>    </span><span class="hs-identifier">loadOneModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>           </span><span class="hs-comment">-- the module to load</span><span>
</span><a name="line-629"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>             </span><span class="hs-comment">-- under which condition</span><span>
</span><a name="line-630"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>               </span><span class="hs-comment">-- error message if module not found</span><span>
</span><a name="line-631"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>     </span><span class="hs-comment">-- empty if condition 'False'</span><span>
</span><a name="line-632"></a><span>    </span><a name="local-6989586621680236612"><a href="#local-6989586621680236612"><span class="hs-identifier">loadOneModule</span></a></a><span> </span><a name="local-6989586621680236618"><a href="#local-6989586621680236618"><span class="hs-identifier">modname</span></a></a><span> </span><a name="local-6989586621680236619"><a href="#local-6989586621680236619"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621680236620"><a href="#local-6989586621680236620"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-633"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236621"><a href="#local-6989586621680236621"><span class="hs-identifier">doLoad</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236619"><span class="hs-identifier hs-var">check</span></a><span>
</span><a name="line-634"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680236621"><span class="hs-identifier hs-var">doLoad</span></a><span>
</span><a name="line-635"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span>
</span><a name="line-636"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-637"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236622"><a href="#local-6989586621680236622"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-638"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236623"><a href="#local-6989586621680236623"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Finder.html#findImportedModule"><span class="hs-identifier hs-var">findImportedModule</span></a><span> </span><a href="#local-6989586621680236622"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621680236618"><span class="hs-identifier hs-var">modname</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-639"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680236623"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-640"></a><span>               </span><a href="HscTypes.html#Found"><span class="hs-identifier hs-var">Found</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680236624"><a href="#local-6989586621680236624"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#dsLoadModule"><span class="hs-identifier hs-var">dsLoadModule</span></a><span> </span><a href="#local-6989586621680236620"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="#local-6989586621680236624"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-641"></a><span>               </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPgmError"><span class="hs-identifier hs-var">pprPgmError</span></a><span> </span><span class="hs-string">&quot;Unable to use Data Parallel Haskell (DPH):&quot;</span><span> </span><a href="#local-6989586621680236620"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-642"></a><span>           </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span>    </span><a name="local-6989586621680236613"><a href="#local-6989586621680236613"><span class="hs-identifier">paErr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To use ParallelArrays,&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621680236615"><span class="hs-identifier hs-var">specBackend</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236616"><span class="hs-identifier hs-var">hint1</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236617"><span class="hs-identifier hs-var">hint2</span></a><span>
</span><a name="line-645"></a><span>    </span><a name="local-6989586621680236614"><a href="#local-6989586621680236614"><span class="hs-identifier">veErr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To use -fvectorise,&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621680236615"><span class="hs-identifier hs-var">specBackend</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236616"><span class="hs-identifier hs-var">hint1</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621680236617"><span class="hs-identifier hs-var">hint2</span></a><span>
</span><a name="line-646"></a><span>    </span><a name="local-6989586621680236615"><a href="#local-6989586621680236615"><span class="hs-identifier">specBackend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;you must specify a DPH backend package&quot;</span><span>
</span><a name="line-647"></a><span>    </span><a name="local-6989586621680236616"><a href="#local-6989586621680236616"><span class="hs-identifier">hint1</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Look for packages named 'dph-lifted-*' with 'ghc-pkg'&quot;</span><span>
</span><a name="line-648"></a><span>    </span><a name="local-6989586621680236617"><a href="#local-6989586621680236617"><span class="hs-identifier">hint2</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You may need to install them with 'cabal install dph-examples'&quot;</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-comment">-- | If '-XParallelArrays' given, we populate the builtin table for desugaring</span><span>
</span><a name="line-651"></a><span class="hs-comment">-- those.</span><span>
</span><a name="line-652"></a><span class="hs-identifier">initDPHBuiltins</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236430"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236430"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-653"></a><a name="initDPHBuiltins"><a href="DsMonad.html#initDPHBuiltins"><span class="hs-identifier">initDPHBuiltins</span></a></a><span> </span><a name="local-6989586621680236628"><a href="#local-6989586621680236628"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236629"><a href="#local-6989586621680236629"><span class="hs-identifier">doInitBuiltins</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#checkLoadDAP"><span class="hs-identifier hs-var">checkLoadDAP</span></a><span>
</span><a name="line-655"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680236629"><span class="hs-identifier hs-var">doInitBuiltins</span></a><span>
</span><a name="line-656"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="DsMonad.html#dsInitPArrBuiltin"><span class="hs-identifier hs-var">dsInitPArrBuiltin</span></a><span> </span><a href="#local-6989586621680236628"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-657"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680236628"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-658"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-identifier">checkLoadDAP</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-661"></a><a name="checkLoadDAP"><a href="DsMonad.html#checkLoadDAP"><span class="hs-identifier">checkLoadDAP</span></a></a><span>
</span><a name="line-662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236630"><a href="#local-6989586621680236630"><span class="hs-identifier">paEnabled</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.4.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#ParallelArrays"><span class="hs-identifier hs-var">LangExt.ParallelArrays</span></a><span>
</span><a name="line-663"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236631"><a href="#local-6989586621680236631"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span>
</span><a name="line-664"></a><span>         </span><span class="hs-comment">-- do not load 'Data.Array.Parallel' iff compiling 'base:GHC.PArr' or a</span><span>
</span><a name="line-665"></a><span>         </span><span class="hs-comment">-- module called 'dATA_ARRAY_PARALLEL_NAME'; see also the comments at the top</span><span>
</span><a name="line-666"></a><span>         </span><span class="hs-comment">-- of 'base:GHC.PArr' and 'Data.Array.Parallel' in the DPH libraries</span><span>
</span><a name="line-667"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680236630"><span class="hs-identifier hs-var">paEnabled</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-668"></a><span>                  </span><a href="#local-6989586621680236631"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="PrelNames.html#gHC_PARR%27"><span class="hs-identifier hs-var">gHC_PARR'</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-669"></a><span>                  </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680236631"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="PrelNames.html#dATA_ARRAY_PARALLEL_NAME"><span class="hs-identifier hs-var">dATA_ARRAY_PARALLEL_NAME</span></a><span>
</span><a name="line-670"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">-- | Populate 'ds_parr_bi' from 'ds_dph_env'.</span><span>
</span><a name="line-673"></a><span class="hs-comment">--</span><span>
</span><a name="line-674"></a><span class="hs-identifier">dsInitPArrBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236429"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236429"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-675"></a><a name="dsInitPArrBuiltin"><a href="DsMonad.html#dsInitPArrBuiltin"><span class="hs-identifier">dsInitPArrBuiltin</span></a></a><span> </span><a name="local-6989586621680236632"><a href="#local-6989586621680236632"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-676"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236636"><a href="#local-6989586621680236636"><span class="hs-identifier">lengthPVar</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;lengthP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236637"><a href="#local-6989586621680236637"><span class="hs-identifier">replicatePVar</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;replicateP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236638"><a href="#local-6989586621680236638"><span class="hs-identifier">singletonPVar</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;singletonP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-679"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236639"><a href="#local-6989586621680236639"><span class="hs-identifier">mapPVar</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;mapP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236640"><a href="#local-6989586621680236640"><span class="hs-identifier">filterPVar</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;filterP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236641"><a href="#local-6989586621680236641"><span class="hs-identifier">zipPVar</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;zipP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-682"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236642"><a href="#local-6989586621680236642"><span class="hs-identifier">crossMapPVar</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;crossMapP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236643"><a href="#local-6989586621680236643"><span class="hs-identifier">indexPVar</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;!:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236644"><a href="#local-6989586621680236644"><span class="hs-identifier">emptyPVar</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;emptyP&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-685"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236645"><a href="#local-6989586621680236645"><span class="hs-identifier">appPVar</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680236633"><span class="hs-identifier hs-var">externalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;+:+&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>       </span><span class="hs-comment">-- ; enumFromToPVar     &lt;- externalVar (fsLit &quot;enumFromToP&quot;)</span><span>
</span><a name="line-687"></a><span>       </span><span class="hs-comment">-- ; enumFromThenToPVar &lt;- externalVar (fsLit &quot;enumFromThenToP&quot;)</span><span>
</span><a name="line-688"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236646"><a href="#local-6989586621680236646"><span class="hs-identifier">enumFromToPVar</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680236634"><span class="hs-identifier hs-var">arithErr</span></a><span>
</span><a name="line-689"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680236647"><a href="#local-6989586621680236647"><span class="hs-identifier">enumFromThenToPVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680236634"><span class="hs-identifier hs-var">arithErr</span></a><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680236648"><a href="#local-6989586621680236648"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236648"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ds_parr_bi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#PArrBuiltin"><span class="hs-identifier hs-var">PArrBuiltin</span></a><span>
</span><a name="line-692"></a><span>                                              </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lengthPVar</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236636"><span class="hs-identifier hs-var">lengthPVar</span></a><span>
</span><a name="line-693"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">replicatePVar</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236637"><span class="hs-identifier hs-var">replicatePVar</span></a><span>
</span><a name="line-694"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">singletonPVar</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236638"><span class="hs-identifier hs-var">singletonPVar</span></a><span>
</span><a name="line-695"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mapPVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236639"><span class="hs-identifier hs-var">mapPVar</span></a><span>
</span><a name="line-696"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">filterPVar</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236640"><span class="hs-identifier hs-var">filterPVar</span></a><span>
</span><a name="line-697"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">zipPVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236641"><span class="hs-identifier hs-var">zipPVar</span></a><span>
</span><a name="line-698"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">crossMapPVar</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236642"><span class="hs-identifier hs-var">crossMapPVar</span></a><span>
</span><a name="line-699"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">indexPVar</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236643"><span class="hs-identifier hs-var">indexPVar</span></a><span>
</span><a name="line-700"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">emptyPVar</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236644"><span class="hs-identifier hs-var">emptyPVar</span></a><span>
</span><a name="line-701"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">appPVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236645"><span class="hs-identifier hs-var">appPVar</span></a><span>
</span><a name="line-702"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">enumFromToPVar</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236646"><span class="hs-identifier hs-var">enumFromToPVar</span></a><span>
</span><a name="line-703"></a><span>                                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">enumFromThenToPVar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680236647"><span class="hs-identifier hs-var">enumFromThenToPVar</span></a><span>
</span><a name="line-704"></a><span>                                              </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span>                   </span><a href="#local-6989586621680236632"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-706"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-707"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-708"></a><span>    </span><span class="hs-identifier">externalVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>
</span><a name="line-709"></a><span>    </span><a name="local-6989586621680236633"><a href="#local-6989586621680236633"><span class="hs-identifier">externalVar</span></a></a><span> </span><a name="local-6989586621680236635"><a href="#local-6989586621680236635"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#dsLookupDPHRdrEnv"><span class="hs-identifier hs-var">dsLookupDPHRdrEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><a href="#local-6989586621680236635"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span>    </span><a name="local-6989586621680236634"><a href="#local-6989586621680236634"><span class="hs-identifier">arithErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;Arithmetic sequences have to wait until we support type classes&quot;</span><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span class="hs-comment">-- |Get a name from &quot;Data.Array.Parallel&quot; for the desugarer, from the</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- 'ds_parr_bi' component of the global desugerar environment.</span><span>
</span><a name="line-715"></a><span class="hs-comment">--</span><span>
</span><a name="line-716"></a><span class="hs-identifier">dsDPHBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#PArrBuiltin"><span class="hs-identifier hs-type">PArrBuiltin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680236428"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="#local-6989586621680236428"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-717"></a><a name="dsDPHBuiltin"><a href="DsMonad.html#dsDPHBuiltin"><span class="hs-identifier">dsDPHBuiltin</span></a></a><span> </span><a name="local-6989586621680236649"><a href="#local-6989586621680236649"><span class="hs-identifier">sel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680236649"><span class="hs-identifier hs-var">sel</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ds_parr_bi</span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-718"></a><span>
</span><a name="line-719"></a><span class="hs-comment">-- |Lookup a name exported by 'Data.Array.Parallel.Prim' or 'Data.Array.Parallel.Prim'.</span><span>
</span><a name="line-720"></a><span class="hs-comment">--  Panic if there isn't one, or if it is defined multiple times.</span><span>
</span><a name="line-721"></a><span class="hs-identifier">dsLookupDPHRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-722"></a><a name="dsLookupDPHRdrEnv"><a href="DsMonad.html#dsLookupDPHRdrEnv"><span class="hs-identifier">dsLookupDPHRdrEnv</span></a></a><span> </span><a name="local-6989586621680236650"><a href="#local-6989586621680236650"><span class="hs-identifier">occ</span></a></a><span>
</span><a name="line-723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><a href="#local-6989586621680236651"><span class="hs-identifier hs-var">nameNotFound</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236650"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DsMonad.html#dsLookupDPHRdrEnv_maybe"><span class="hs-identifier hs-var">dsLookupDPHRdrEnv_maybe</span></a><span> </span><a href="#local-6989586621680236650"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-725"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680236651"><a href="#local-6989586621680236651"><span class="hs-identifier">nameNotFound</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Name not found in 'Data.Array.Parallel' or 'Data.Array.Parallel.Prim':&quot;</span><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span class="hs-comment">-- |Lookup a name exported by 'Data.Array.Parallel.Prim' or 'Data.Array.Parallel.Prim',</span><span>
</span><a name="line-728"></a><span class="hs-comment">--  returning `Nothing` if it's not defined. Panic if it's defined multiple times.</span><span>
</span><a name="line-729"></a><span class="hs-identifier">dsLookupDPHRdrEnv_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><a name="dsLookupDPHRdrEnv_maybe"><a href="DsMonad.html#dsLookupDPHRdrEnv_maybe"><span class="hs-identifier">dsLookupDPHRdrEnv_maybe</span></a></a><span> </span><a name="local-6989586621680236652"><a href="#local-6989586621680236652"><span class="hs-identifier">occ</span></a></a><span>
</span><a name="line-731"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680236654"><a href="#local-6989586621680236654"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ds_dph_env</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-732"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680236655"><a href="#local-6989586621680236655"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier hs-var">lookupGlobalRdrEnv</span></a><span> </span><a href="#local-6989586621680236654"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621680236652"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-733"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680236655"><span class="hs-identifier hs-var">gres</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-734"></a><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-735"></a><span>           </span><span class="hs-special">[</span><a name="local-6989586621680236656"><a href="#local-6989586621680236656"><span class="hs-identifier">gre</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621680236656"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-736"></a><span>           </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><a href="#local-6989586621680236653"><span class="hs-identifier hs-var">multipleNames</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680236652"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-737"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-738"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680236653"><a href="#local-6989586621680236653"><span class="hs-identifier">multipleNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Multiple definitions in 'Data.Array.Parallel' and 'Data.Array.Parallel.Prim':&quot;</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-comment">-- | Inject a trace message into the compiled program. Whereas</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- pprTrace prints out information *while compiling*, pprRuntimeTrace</span><span>
</span><a name="line-742"></a><span class="hs-comment">-- captures that information and causes it to be printed *at runtime*</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- using Debug.Trace.trace.</span><span>
</span><a name="line-744"></a><span class="hs-comment">--</span><span>
</span><a name="line-745"></a><span class="hs-comment">--   pprRuntimeTrace hdr doc expr</span><span>
</span><a name="line-746"></a><span class="hs-comment">--</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- will produce an expression that looks like</span><span>
</span><a name="line-748"></a><span class="hs-comment">--</span><span>
</span><a name="line-749"></a><span class="hs-comment">--   trace (hdr + doc) expr</span><span>
</span><a name="line-750"></a><span class="hs-comment">--</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- When using this to debug a module that Debug.Trace depends on,</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- it is necessary to import {-# SOURCE #-} Debug.Trace () in that</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- module. We could avoid this inconvenience by wiring in Debug.Trace.trace,</span><span>
</span><a name="line-754"></a><span class="hs-comment">-- but that doesn't seem worth the effort and maintenance cost.</span><span>
</span><a name="line-755"></a><span class="hs-identifier">pprRuntimeTrace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>   </span><span class="hs-comment">-- ^ header</span><span>
</span><a name="line-756"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>     </span><span class="hs-comment">-- ^ information to output</span><span>
</span><a name="line-757"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-comment">-- ^ expression</span><span>
</span><a name="line-758"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-759"></a><a name="pprRuntimeTrace"><a href="DsMonad.html#pprRuntimeTrace"><span class="hs-identifier">pprRuntimeTrace</span></a></a><span> </span><a name="local-6989586621680236657"><a href="#local-6989586621680236657"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621680236658"><a href="#local-6989586621680236658"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621680236659"><a href="#local-6989586621680236659"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-760"></a><span>  </span><a name="local-6989586621680236660"><a href="#local-6989586621680236660"><span class="hs-identifier">traceId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a><span> </span><a href="PrelNames.html#traceName"><span class="hs-identifier hs-var">traceName</span></a><span>
</span><a name="line-761"></a><span>  </span><a name="local-6989586621680236661"><a href="#local-6989586621680236661"><span class="hs-identifier">unpackCStringId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a><span> </span><a href="PrelNames.html#unpackCStringName"><span class="hs-identifier hs-var">unpackCStringName</span></a><span>
</span><a name="line-762"></a><span>  </span><a name="local-6989586621680236662"><a href="#local-6989586621680236662"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-763"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">message</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-764"></a><span>      </span><a name="local-6989586621680236663"><a href="#local-6989586621680236663"><span class="hs-identifier">message</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621680236661"><span class="hs-identifier hs-var">unpackCStringId</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-765"></a><span>                </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Literal.html#mkMachString"><span class="hs-identifier hs-var">mkMachString</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-6989586621680236662"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621680236657"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><a href="#local-6989586621680236658"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621680236660"><span class="hs-identifier hs-var">traceId</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621680236659"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236663"><span class="hs-identifier hs-var">message</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680236659"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">]</span><span>
</span><a name="line-767"></a></pre></body></html>