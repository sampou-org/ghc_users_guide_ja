<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[StgStats]{Gathers statistical information about programs}


The program gather statistics about
\begin{enumerate}
\item number of boxed cases
\item number of unboxed cases
\item number of let-no-escapes
\item number of non-updatable lets
\item number of updatable lets
\item number of applications
\item number of primitive applications
\item number of closures (does not include lets bound to constructors)
\item number of free variables in closures
%\item number of top-level functions
%\item number of top-level CAFs
\item number of constructors
\end{enumerate}
-}</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">StgStats</span><span> </span><span class="hs-special">(</span><span> </span><a href="StgStats.html#showStgStats"><span class="hs-identifier hs-var">showStgStats</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="StgSyn.html"><span class="hs-identifier">StgSyn</span></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data.Map</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data.Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="CounterType"><a href="StgStats.html#CounterType"><span class="hs-identifier">CounterType</span></a></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Literals"><a href="StgStats.html#Literals"><span class="hs-identifier">Literals</span></a></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Applications"><a href="StgStats.html#Applications"><span class="hs-identifier">Applications</span></a></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ConstructorApps"><a href="StgStats.html#ConstructorApps"><span class="hs-identifier">ConstructorApps</span></a></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PrimitiveApps"><a href="StgStats.html#PrimitiveApps"><span class="hs-identifier">PrimitiveApps</span></a></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LetNoEscapes"><a href="StgStats.html#LetNoEscapes"><span class="hs-identifier">LetNoEscapes</span></a></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgCases"><a href="StgStats.html#StgCases"><span class="hs-identifier">StgCases</span></a></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FreeVariables"><a href="StgStats.html#FreeVariables"><span class="hs-identifier">FreeVariables</span></a></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ConstructorBinds"><a href="StgStats.html#ConstructorBinds"><span class="hs-identifier">ConstructorBinds</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-comment">{-True&lt;=&gt;top-level-}</span><span>
</span><a name="line-49"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ReEntrantBinds"><a href="StgStats.html#ReEntrantBinds"><span class="hs-identifier">ReEntrantBinds</span></a></a><span>   </span><span class="hs-identifier hs-type">Bool</span><span class="hs-comment">{-ditto-}</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SingleEntryBinds"><a href="StgStats.html#SingleEntryBinds"><span class="hs-identifier">SingleEntryBinds</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-comment">{-ditto-}</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UpdatableBinds"><a href="StgStats.html#UpdatableBinds"><span class="hs-identifier">UpdatableBinds</span></a></a><span>   </span><span class="hs-identifier hs-type">Bool</span><span class="hs-comment">{-ditto-}</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">type</span><span> </span><a name="Count"><a href="StgStats.html#Count"><span class="hs-identifier">Count</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-55"></a><span class="hs-keyword">type</span><span> </span><a name="StatEnv"><a href="StgStats.html#StatEnv"><span class="hs-identifier">StatEnv</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="StgStats.html#CounterType"><span class="hs-identifier hs-type">CounterType</span></a><span> </span><a href="StgStats.html#Count"><span class="hs-identifier hs-type">Count</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-identifier">emptySE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-58"></a><a name="emptySE"><a href="StgStats.html#emptySE"><span class="hs-identifier">emptySE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-identifier">combineSE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-61"></a><a name="combineSE"><a href="StgStats.html#combineSE"><span class="hs-identifier">combineSE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#unionWith"><span class="hs-identifier hs-var">Map.unionWith</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">combineSEs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-64"></a><a name="combineSEs"><a href="StgStats.html#combineSEs"><span class="hs-identifier">combineSEs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span> </span><a href="StgStats.html#emptySE"><span class="hs-identifier hs-var">emptySE</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-identifier">countOne</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgStats.html#CounterType"><span class="hs-identifier hs-type">CounterType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-67"></a><a name="countOne"><a href="StgStats.html#countOne"><span class="hs-identifier">countOne</span></a></a><span> </span><a name="local-6989586621679490445"><a href="#local-6989586621679490445"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a><span> </span><a href="#local-6989586621679490445"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-identifier">countN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgStats.html#CounterType"><span class="hs-identifier hs-type">CounterType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-70"></a><a name="countN"><a href="StgStats.html#countN"><span class="hs-identifier">countN</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Top-level list of bindings (a ``program'')}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">showStgStats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><a name="showStgStats"><a href="StgStats.html#showStgStats"><span class="hs-identifier">showStgStats</span></a></a><span> </span><a name="local-6989586621679490446"><a href="#local-6989586621679490446"><span class="hs-identifier">prog</span></a></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;STG Statistics:\n\n&quot;</span><span>
</span><a name="line-84"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679490447"><span class="hs-identifier hs-var">showc</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.11.0/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a><span> </span><span class="hs-special">(</span><a href="StgStats.html#gatherStgStats"><span class="hs-identifier hs-var">gatherStgStats</span></a><span> </span><a href="#local-6989586621679490446"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-86"></a><span>    </span><a name="local-6989586621679490447"><a href="#local-6989586621679490447"><span class="hs-identifier">showc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679490449"><a href="#local-6989586621679490449"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679490450"><a href="#local-6989586621679490450"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679490448"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679490449"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679490450"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>    </span><a name="local-6989586621679490448"><a href="#local-6989586621679490448"><span class="hs-identifier">s</span></a></a><span> </span><a href="StgStats.html#Literals"><span class="hs-identifier hs-var">Literals</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Literals                   &quot;</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#Applications"><span class="hs-identifier hs-var">Applications</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Applications               &quot;</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#ConstructorApps"><span class="hs-identifier hs-var">ConstructorApps</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ConstructorApps            &quot;</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#PrimitiveApps"><span class="hs-identifier hs-var">PrimitiveApps</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;PrimitiveApps              &quot;</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#LetNoEscapes"><span class="hs-identifier hs-var">LetNoEscapes</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;LetNoEscapes               &quot;</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#StgCases"><span class="hs-identifier hs-var">StgCases</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;StgCases                   &quot;</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-identifier">s</span><span> </span><a href="StgStats.html#FreeVariables"><span class="hs-identifier hs-var">FreeVariables</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;FreeVariables              &quot;</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#ConstructorBinds"><span class="hs-identifier hs-var">ConstructorBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ConstructorBinds_Top       &quot;</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#ReEntrantBinds"><span class="hs-identifier hs-var">ReEntrantBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ReEntrantBinds_Top         &quot;</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#SingleEntryBinds"><span class="hs-identifier hs-var">SingleEntryBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;SingleEntryBinds_Top       &quot;</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#UpdatableBinds"><span class="hs-identifier hs-var">UpdatableBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UpdatableBinds_Top         &quot;</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#ConstructorBinds"><span class="hs-identifier hs-var">ConstructorBinds</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ConstructorBinds_Nested    &quot;</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#ReEntrantBinds"><span class="hs-identifier hs-var">ReEntrantBinds</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ReEntrantBindsBinds_Nested &quot;</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#SingleEntryBinds"><span class="hs-identifier hs-var">SingleEntryBinds</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;SingleEntryBinds_Nested    &quot;</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><a href="StgStats.html#UpdatableBinds"><span class="hs-identifier hs-var">UpdatableBinds</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UpdatableBinds_Nested      &quot;</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-identifier">gatherStgStats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-105"></a><a name="gatherStgStats"><a href="StgStats.html#gatherStgStats"><span class="hs-identifier">gatherStgStats</span></a></a><span> </span><a name="local-6989586621679490451"><a href="#local-6989586621679490451"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#combineSEs"><span class="hs-identifier hs-var">combineSEs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="StgStats.html#statTopBinding"><span class="hs-identifier hs-var">statTopBinding</span></a><span> </span><a href="#local-6989586621679490451"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Bindings}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">statTopBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-116"></a><a name="statTopBinding"><a href="StgStats.html#statTopBinding"><span class="hs-identifier">statTopBinding</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#Literals"><span class="hs-identifier hs-var">Literals</span></a><span>
</span><a name="line-117"></a><span class="hs-identifier">statTopBinding</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a><span> </span><a name="local-6989586621679490452"><a href="#local-6989586621679490452"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statBinding"><span class="hs-identifier hs-var">statBinding</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679490452"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">statBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- True &lt;=&gt; top-level; False &lt;=&gt; nested</span><span>
</span><a name="line-120"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgSyn.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a><span>
</span><a name="line-121"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><a name="statBinding"><a href="StgStats.html#statBinding"><span class="hs-identifier">statBinding</span></a></a><span> </span><a name="local-6989586621679490453"><a href="#local-6989586621679490453"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a><span> </span><a name="local-6989586621679490454"><a href="#local-6989586621679490454"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679490455"><a href="#local-6989586621679490455"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statRhs"><span class="hs-identifier hs-var">statRhs</span></a><span> </span><a href="#local-6989586621679490453"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679490454"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679490455"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">statBinding</span><span> </span><a name="local-6989586621679490456"><a href="#local-6989586621679490456"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a><span> </span><a name="local-6989586621679490457"><a href="#local-6989586621679490457"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#combineSEs"><span class="hs-identifier hs-var">combineSEs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="StgStats.html#statRhs"><span class="hs-identifier hs-var">statRhs</span></a><span> </span><a href="#local-6989586621679490456"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679490457"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">statRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><a name="statRhs"><a href="StgStats.html#statRhs"><span class="hs-identifier">statRhs</span></a></a><span> </span><a name="local-6989586621679490458"><a href="#local-6989586621679490458"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><span class="hs-special">(</span><a href="StgStats.html#ConstructorBinds"><span class="hs-identifier hs-var">ConstructorBinds</span></a><span> </span><a href="#local-6989586621679490458"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">statRhs</span><span> </span><a name="local-6989586621679490459"><a href="#local-6989586621679490459"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679490460"><a href="#local-6989586621679490460"><span class="hs-identifier">fv</span></a></a><span> </span><a name="local-6989586621679490461"><a href="#local-6989586621679490461"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679490462"><a href="#local-6989586621679490462"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><a href="#local-6989586621679490462"><span class="hs-identifier hs-var">body</span></a><span>                       </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-136"></a><span>    </span><a href="StgStats.html#countN"><span class="hs-identifier hs-var">countN</span></a><span> </span><a href="StgStats.html#FreeVariables"><span class="hs-identifier hs-var">FreeVariables</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679490460"><span class="hs-identifier hs-var">fv</span></a><span class="hs-special">)</span><span>    </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-137"></a><span>    </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-138"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679490461"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-139"></a><span>        </span><a href="StgSyn.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#ReEntrantBinds"><span class="hs-identifier hs-var">ReEntrantBinds</span></a><span>   </span><a href="#local-6989586621679490459"><span class="hs-identifier hs-var">top</span></a><span>
</span><a name="line-140"></a><span>        </span><a href="StgSyn.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#UpdatableBinds"><span class="hs-identifier hs-var">UpdatableBinds</span></a><span>   </span><a href="#local-6989586621679490459"><span class="hs-identifier hs-var">top</span></a><span>
</span><a name="line-141"></a><span>        </span><a href="StgSyn.html#SingleEntry"><span class="hs-identifier hs-var">SingleEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#SingleEntryBinds"><span class="hs-identifier hs-var">SingleEntryBinds</span></a><span> </span><a href="#local-6989586621679490459"><span class="hs-identifier hs-var">top</span></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Expressions}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgStats.html#StatEnv"><span class="hs-identifier hs-type">StatEnv</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><a name="statExpr"><a href="StgStats.html#statExpr"><span class="hs-identifier">statExpr</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#Applications"><span class="hs-identifier hs-var">Applications</span></a><span>
</span><a name="line-155"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#Literals"><span class="hs-identifier hs-var">Literals</span></a><span>
</span><a name="line-156"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#ConstructorApps"><span class="hs-identifier hs-var">ConstructorApps</span></a><span>
</span><a name="line-157"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#PrimitiveApps"><span class="hs-identifier hs-var">PrimitiveApps</span></a><span>
</span><a name="line-158"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679490463"><a href="#local-6989586621679490463"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><a href="#local-6989586621679490463"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a><span> </span><a name="local-6989586621679490464"><a href="#local-6989586621679490464"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621679490465"><a href="#local-6989586621679490465"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statBinding"><span class="hs-identifier hs-var">statBinding</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{-not top-level-}</span><span> </span><a href="#local-6989586621679490464"><span class="hs-identifier hs-var">binds</span></a><span>    </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-162"></a><span>    </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><a href="#local-6989586621679490465"><span class="hs-identifier hs-var">body</span></a><span>                               </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-163"></a><span>    </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#LetNoEscapes"><span class="hs-identifier hs-var">LetNoEscapes</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a><span> </span><a name="local-6989586621679490466"><a href="#local-6989586621679490466"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621679490467"><a href="#local-6989586621679490467"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statBinding"><span class="hs-identifier hs-var">statBinding</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{-not top-level-}</span><span> </span><a href="#local-6989586621679490466"><span class="hs-identifier hs-var">binds</span></a><span>    </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-167"></a><span>    </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><a href="#local-6989586621679490467"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a><span> </span><a name="local-6989586621679490468"><a href="#local-6989586621679490468"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679490469"><a href="#local-6989586621679490469"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><a href="#local-6989586621679490468"><span class="hs-identifier hs-var">expr</span></a><span>       </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-171"></a><span>    </span><a href="#local-6989586621679490470"><span class="hs-identifier hs-var">stat_alts</span></a><span> </span><a href="#local-6989586621679490469"><span class="hs-identifier hs-var">alts</span></a><span>      </span><span class="hs-special">`</span><a href="StgStats.html#combineSE"><span class="hs-identifier hs-var">combineSE</span></a><span class="hs-special">`</span><span>
</span><a name="line-172"></a><span>    </span><a href="StgStats.html#countOne"><span class="hs-identifier hs-var">countOne</span></a><span> </span><a href="StgStats.html#StgCases"><span class="hs-identifier hs-var">StgCases</span></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679490470"><a href="#local-6989586621679490470"><span class="hs-identifier">stat_alts</span></a></a><span> </span><a name="local-6989586621679490471"><a href="#local-6989586621679490471"><span class="hs-identifier">alts</span></a></a><span>
</span><a name="line-175"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgStats.html#combineSEs"><span class="hs-identifier hs-var">combineSEs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="StgStats.html#statExpr"><span class="hs-identifier hs-var">statExpr</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679490472"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679490472"><a href="#local-6989586621679490472"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679490471"><span class="hs-identifier hs-var">alts</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">statExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLam"><span class="hs-identifier hs-var">StgLam</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;statExpr StgLam&quot;</span><span>
</span><a name="line-178"></a></pre></body></html>