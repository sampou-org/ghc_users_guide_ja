<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- | This module manages storing the various GHC option flags in a modules</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- interface file as part of the recompilation checking infrastructure.</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">FlagChecker</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>        </span><a href="FlagChecker.html#fingerprintDynFlags"><span class="hs-identifier hs-var">fingerprintDynFlags</span></a><span>
</span><a name="line-7"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="FlagChecker.html#fingerprintOptFlags"><span class="hs-identifier hs-var">fingerprintOptFlags</span></a><span>
</span><a name="line-8"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="FlagChecker.html#fingerprintHpcFlags"><span class="hs-identifier hs-var">fingerprintHpcFlags</span></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="BinIface.html"><span class="hs-identifier">BinIface</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Fingerprint.html"><span class="hs-identifier">Fingerprint</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="BinFingerprint.html"><span class="hs-identifier">BinFingerprint</span></a><span>
</span><a name="line-21"></a><span class="hs-comment">-- import Outputable</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="EnumSet.html"><span class="hs-identifier">EnumSet</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="../filepath-1.4.2/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.2/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">normalise</span></a><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- | Produce a fingerprint of a @DynFlags@ value. We only base</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- the finger print on important fields in @DynFlags@ so that</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- the recompilation checker can use this fingerprint.</span><span>
</span><a name="line-29"></a><span class="hs-comment">--</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- NB: The 'Module' parameter is the 'Module' recorded by the</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- *interface* file, not the actual 'Module' according to our</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- 'DynFlags'.</span><span>
</span><a name="line-33"></a><span class="hs-identifier">fingerprintDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-34"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Binary.html#BinHandle"><span class="hs-identifier hs-type">BinHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><a name="fingerprintDynFlags"><a href="FlagChecker.html#fingerprintDynFlags"><span class="hs-identifier">fingerprintDynFlags</span></a></a><span> </span><a name="local-6989586621679984643"><a href="#local-6989586621679984643"><span class="hs-identifier">dflags</span></a></a><span class="hs-glyph">@</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-var">DynFlags</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679984788"><a href="#local-6989586621679984788"><span class="hs-identifier">this_mod</span></a></a><span> </span><a name="local-6989586621679984789"><a href="#local-6989586621679984789"><span class="hs-identifier">nameio</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679984790"><a href="#local-6989586621679984790"><span class="hs-identifier">mainis</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679984671"><span class="hs-identifier hs-var">mainModIs</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679984788"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679984672"><span class="hs-identifier hs-var">mainFunIs</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-39"></a><span>                      </span><span class="hs-comment">-- see #5878</span><span>
</span><a name="line-40"></a><span>        </span><span class="hs-comment">-- pkgopts  = (thisPackage dflags, sort $ packageFlags dflags)</span><span>
</span><a name="line-41"></a><span>        </span><a name="local-6989586621679984791"><a href="#local-6989586621679984791"><span class="hs-identifier">safeHs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="#local-6989586621679984732"><span class="hs-identifier hs-var">safeHaskell</span></a><span>
</span><a name="line-42"></a><span>        </span><span class="hs-comment">-- oflags   = sort $ filter filterOFlags $ flags dflags</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>        </span><span class="hs-comment">-- *all* the extension flags and the language</span><span>
</span><a name="line-45"></a><span>        </span><a name="local-6989586621679984792"><a href="#local-6989586621679984792"><span class="hs-identifier">lang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a><span> </span><a href="#local-6989586621679984731"><span class="hs-identifier hs-var">language</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>                </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="EnumSet.html#toList"><span class="hs-identifier hs-var">EnumSet.toList</span></a><span> </span><a href="#local-6989586621679984744"><span class="hs-identifier hs-var">extensionFlags</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>        </span><span class="hs-comment">-- -I, -D and -U flags affect CPP</span><span>
</span><a name="line-49"></a><span>        </span><a name="local-6989586621679984793"><a href="#local-6989586621679984793"><span class="hs-identifier">cpp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../filepath-1.4.2/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#normalise"><span class="hs-identifier hs-var">normalise</span></a><span> </span><a href="#local-6989586621679984699"><span class="hs-identifier hs-var">includePaths</span></a><span class="hs-special">,</span><span> </span><a href="DynFlags.html#opt_P"><span class="hs-identifier hs-var">opt_P</span></a><span> </span><a href="#local-6989586621679984643"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="DynFlags.html#picPOpts"><span class="hs-identifier hs-var">picPOpts</span></a><span> </span><a href="#local-6989586621679984643"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>            </span><span class="hs-comment">-- normalise: eliminate spurious differences due to &quot;./foo&quot; vs &quot;foo&quot;</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>        </span><span class="hs-comment">-- Note [path flags and recompilation]</span><span>
</span><a name="line-53"></a><span>        </span><a name="local-6989586621679984794"><a href="#local-6989586621679984794"><span class="hs-identifier">paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679984687"><span class="hs-identifier hs-var">hcSuf</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>        </span><span class="hs-comment">-- -fprof-auto etc.</span><span>
</span><a name="line-56"></a><span>        </span><a name="local-6989586621679984795"><a href="#local-6989586621679984795"><span class="hs-identifier">prof</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_SccProfilingOn"><span class="hs-identifier hs-var">Opt_SccProfilingOn</span></a><span> </span><a href="#local-6989586621679984643"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a><span> </span><a href="#local-6989586621679984768"><span class="hs-identifier hs-var">profAuto</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>        </span><a name="local-6989586621679984796"><a href="#local-6989586621679984796"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679984790"><span class="hs-identifier hs-var">mainis</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679984791"><span class="hs-identifier hs-var">safeHs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679984792"><span class="hs-identifier hs-var">lang</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679984793"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679984794"><span class="hs-identifier hs-var">paths</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679984795"><span class="hs-identifier hs-var">prof</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- pprTrace &quot;flags&quot; (ppr flags) $</span><span>
</span><a name="line-61"></a><span>       </span><a href="BinFingerprint.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="#local-6989586621679984789"><span class="hs-identifier hs-var">nameio</span></a><span> </span><a href="#local-6989586621679984796"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- Fingerprint the optimisation info. We keep this separate from the rest of</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- the flags because GHCi users (especially) may wish to ignore changes in</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- optimisation level or optimisation flags so as to use as many pre-existing</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- object files as they can.</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- See Note [Ignoring some flag changes]</span><span>
</span><a name="line-68"></a><span class="hs-identifier">fingerprintOptFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-69"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Binary.html#BinHandle"><span class="hs-identifier hs-type">BinHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>
</span><a name="line-71"></a><a name="fingerprintOptFlags"><a href="FlagChecker.html#fingerprintOptFlags"><span class="hs-identifier">fingerprintOptFlags</span></a></a><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-var">DynFlags</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679984941"><a href="#local-6989586621679984941"><span class="hs-identifier">nameio</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-72"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-73"></a><span>        </span><span class="hs-comment">-- See https://ghc.haskell.org/trac/ghc/ticket/10923</span><span>
</span><a name="line-74"></a><span>        </span><span class="hs-comment">-- We used to fingerprint the optimisation level, but as Joachim</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-comment">-- Breitner pointed out in comment 9 on that ticket, it's better</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-comment">-- to ignore that and just look at the individual optimisation flags.</span><span>
</span><a name="line-77"></a><span>        </span><a name="local-6989586621679984942"><a href="#local-6989586621679984942"><span class="hs-identifier">opt_flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="EnumSet.html#member"><span class="hs-identifier hs-var">EnumSet.member</span></a><span class="hs-special">`</span><span> </span><a href="DynFlags.html#optimisationFlags"><span class="hs-identifier hs-var">optimisationFlags</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>                                          </span><span class="hs-special">(</span><a href="EnumSet.html#toList"><span class="hs-identifier hs-var">EnumSet.toList</span></a><span> </span><a href="#local-6989586621679984881"><span class="hs-identifier hs-var">generalFlags</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="BinFingerprint.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="#local-6989586621679984941"><span class="hs-identifier hs-var">nameio</span></a><span> </span><a href="#local-6989586621679984942"><span class="hs-identifier hs-var">opt_flags</span></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- Fingerprint the HPC info. We keep this separate from the rest of</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- the flags because GHCi users (especially) may wish to use an object</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- file compiled for HPC when not actually using HPC.</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- See Note [Ignoring some flag changes]</span><span>
</span><a name="line-86"></a><span class="hs-identifier">fingerprintHpcFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-87"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Binary.html#BinHandle"><span class="hs-identifier hs-type">BinHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>
</span><a name="line-89"></a><a name="fingerprintHpcFlags"><a href="FlagChecker.html#fingerprintHpcFlags"><span class="hs-identifier">fingerprintHpcFlags</span></a></a><span> </span><a name="local-6989586621679984943"><a href="#local-6989586621679984943"><span class="hs-identifier">dflags</span></a></a><span class="hs-glyph">@</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-var">DynFlags</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679985088"><a href="#local-6989586621679985088"><span class="hs-identifier">nameio</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-90"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-91"></a><span>        </span><span class="hs-comment">-- -fhpc, see https://ghc.haskell.org/trac/ghc/ticket/11798</span><span>
</span><a name="line-92"></a><span>        </span><span class="hs-comment">-- hpcDir is output-only, so we should recompile if it changes</span><span>
</span><a name="line-93"></a><span>        </span><a name="local-6989586621679985089"><a href="#local-6989586621679985089"><span class="hs-identifier">hpc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_Hpc"><span class="hs-identifier hs-var">Opt_Hpc</span></a><span> </span><a href="#local-6989586621679984943"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679985006"><span class="hs-identifier hs-var">hpcDir</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="BinFingerprint.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="#local-6989586621679985088"><span class="hs-identifier hs-var">nameio</span></a><span> </span><a href="#local-6989586621679985089"><span class="hs-identifier hs-var">hpc</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">{- Note [path flags and recompilation]

There are several flags that we deliberately omit from the
recompilation check; here we explain why.

-osuf, -odir, -hisuf, -hidir
  If GHC decides that it does not need to recompile, then
  it must have found an up-to-date .hi file and .o file.
  There is no point recording these flags - the user must
  have passed the correct ones.  Indeed, the user may
  have compiled the source file in one-shot mode using
  -o to specify the .o file, and then loaded it in GHCi
  using -odir.

-stubdir
  We omit this one because it is automatically set by -outputdir, and
  we don't want changes in -outputdir to automatically trigger
  recompilation.  This could be wrong, but only in very rare cases.

-i (importPaths)
  For the same reason as -osuf etc. above: if GHC decides not to
  recompile, then it must have already checked all the .hi files on
  which the current module depends, so it must have found them
  successfully.  It is occasionally useful to be able to cd to a
  different directory and use -i flags to enable GHC to find the .hi
  files; we don't want this to force recompilation.

The only path-related flag left is -hcsuf.
-}</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">{- Note [Ignoring some flag changes]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Normally, --make tries to reuse only compilation products that are
the same as those that would have been produced compiling from
scratch. Sometimes, however, users would like to be more aggressive
about recompilation avoidance. This is particularly likely when
developing using GHCi (see #13604). Currently, we allow users to
ignore optimisation changes using -fignore-optim-changes, and to
ignore HPC option changes using -fignore-hpc-changes. If there's a
demand for it, we could also allow changes to -fprof-auto-* flags
(although we can't allow -prof flags to differ). The key thing about
these options is that we can still successfully link a library or
executable when some of its components differ in these ways.

The way we accomplish this is to leave the optimization and HPC
options out of the flag hash, hashing them separately.
-}</span><span>
</span><a name="line-146"></a></pre></body></html>