<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">DebuggerUtils</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-4"></a><span>       </span><a href="DebuggerUtils.html#dataConInfoPtrToName"><span class="hs-identifier hs-var">dataConInfoPtrToName</span></a><span class="hs-special">,</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="../ghci-8.4.3/src/%{MODULE/./-}.html#%{NAME}/GHCi.InfoTable.html"><span class="hs-identifier">GHCi.InfoTable</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="CmmInfo.html"><span class="hs-identifier">CmmInfo</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="CmmInfo.html#stdInfoTableSizeB"><span class="hs-identifier hs-var">stdInfoTableSizeB</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnTypes.html"><span class="hs-identifier">TcRnTypes</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="OccName.html"><span class="hs-identifier">OccName</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Char.html"><span class="hs-identifier">Data.Char</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.html"><span class="hs-identifier">Foreign</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data.List</span></a><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- | Given a data constructor in the heap, find its Name.</span><span>
</span><a name="line-29"></a><span class="hs-comment">--   The info tables for data constructors have a field which records</span><span>
</span><a name="line-30"></a><span class="hs-comment">--   the source name of the constructor as a Ptr Word8 (UTF-8 encoded</span><span>
</span><a name="line-31"></a><span class="hs-comment">--   string). The format is:</span><span>
</span><a name="line-32"></a><span class="hs-comment">--</span><span>
</span><a name="line-33"></a><span class="hs-comment">--   &gt; Package:Module.Name</span><span>
</span><a name="line-34"></a><span class="hs-comment">--</span><span>
</span><a name="line-35"></a><span class="hs-comment">--   We use this string to lookup the interpreter's internal representation of the name</span><span>
</span><a name="line-36"></a><span class="hs-comment">--   using the lookupOrig.</span><span>
</span><a name="line-37"></a><span class="hs-comment">--</span><span>
</span><a name="line-38"></a><span class="hs-identifier">dataConInfoPtrToName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-39"></a><a name="dataConInfoPtrToName"><a href="DebuggerUtils.html#dataConInfoPtrToName"><span class="hs-identifier">dataConInfoPtrToName</span></a></a><span> </span><a name="local-6989586621679822900"><a href="#local-6989586621679822900"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-40"></a><span>   </span><a name="local-6989586621679822924"><a href="#local-6989586621679822924"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-41"></a><span>   </span><a name="local-6989586621679822927"><a href="#local-6989586621679822927"><span class="hs-identifier">theString</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-42"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679822925"><a href="#local-6989586621679822925"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621679822900"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="../ghci-8.4.3/src/%{MODULE/./-}.html#%{NAME}/GHCi.InfoTable.html#StgInfoTable"><span class="hs-identifier hs-type">StgInfoTable</span></a><span>
</span><a name="line-43"></a><span>      </span><a name="local-6989586621679822926"><a href="#local-6989586621679822926"><span class="hs-identifier">conDescAddress</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679822901"><span class="hs-identifier hs-var">getConDescAddress</span></a><span> </span><a href="#local-6989586621679822924"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679822925"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-44"></a><span>      </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.Marshal.Array.html#peekArray0"><span class="hs-identifier hs-var">peekArray0</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679822926"><span class="hs-identifier hs-var">conDescAddress</span></a><span>
</span><a name="line-45"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679822928"><a href="#local-6989586621679822928"><span class="hs-identifier">pkg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679822929"><a href="#local-6989586621679822929"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679822930"><a href="#local-6989586621679822930"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679822902"><span class="hs-identifier hs-var">parse</span></a><span> </span><a href="#local-6989586621679822927"><span class="hs-identifier hs-var">theString</span></a><span>
</span><a name="line-46"></a><span>       </span><a name="local-6989586621679822931"><a href="#local-6989586621679822931"><span class="hs-identifier">pkgFS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#mkFastStringByteList"><span class="hs-identifier hs-var">mkFastStringByteList</span></a><span> </span><a href="#local-6989586621679822928"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-47"></a><span>       </span><a name="local-6989586621679822932"><a href="#local-6989586621679822932"><span class="hs-identifier">modFS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#mkFastStringByteList"><span class="hs-identifier hs-var">mkFastStringByteList</span></a><span> </span><a href="#local-6989586621679822929"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-48"></a><span>       </span><a name="local-6989586621679822933"><a href="#local-6989586621679822933"><span class="hs-identifier">occFS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#mkFastStringByteList"><span class="hs-identifier hs-var">mkFastStringByteList</span></a><span> </span><a href="#local-6989586621679822930"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-49"></a><span>       </span><a name="local-6989586621679822934"><a href="#local-6989586621679822934"><span class="hs-identifier">occName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccNameFS"><span class="hs-identifier hs-var">mkOccNameFS</span></a><span> </span><a href="OccName.html#dataName"><span class="hs-identifier hs-var">OccName.dataName</span></a><span> </span><a href="#local-6989586621679822933"><span class="hs-identifier hs-var">occFS</span></a><span>
</span><a name="line-50"></a><span>       </span><a name="local-6989586621679822935"><a href="#local-6989586621679822935"><span class="hs-identifier">modName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><a href="#local-6989586621679822931"><span class="hs-identifier hs-var">pkgFS</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Module.html#mkModuleNameFS"><span class="hs-identifier hs-var">mkModuleNameFS</span></a><span> </span><a href="#local-6989586621679822932"><span class="hs-identifier hs-var">modFS</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>   </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-6989586621679822924"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679822935"><span class="hs-identifier hs-var">modName</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#dot"><span class="hs-identifier hs-var">dot</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679822934"><span class="hs-identifier hs-var">occName</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">`</span><a href="TcRnMonad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="IfaceEnv.html#lookupOrig"><span class="hs-identifier hs-var">lookupOrig</span></a><span> </span><a href="#local-6989586621679822935"><span class="hs-identifier hs-var">modName</span></a><span> </span><a href="#local-6989586621679822934"><span class="hs-identifier hs-var">occName</span></a><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>   </span><span class="hs-comment">{- To find the string in the constructor's info table we need to consider
      the layout of info tables relative to the entry code for a closure.

      An info table can be next to the entry code for the closure, or it can
      be separate. The former (faster) is used in registerised versions of ghc,
      and the latter (portable) is for non-registerised versions.

      The diagrams below show where the string is to be found relative to
      the normal info table of the closure.

      1) Code next to table:

         --------------
         |            |   &lt;- pointer to the start of the string
         --------------
         |            |   &lt;- the (start of the) info table structure
         |            |
         |            |
         --------------
         | entry code |
         |    ....    |

         In this case the pointer to the start of the string can be found in
         the memory location _one word before_ the first entry in the normal info
         table.

      2) Code NOT next to table:

                                 --------------
         info table structure -&gt; |     *------------------&gt; --------------
                                 |            |             | entry code |
                                 |            |             |    ....    |
                                 --------------
         ptr to start of str -&gt;  |            |
                                 --------------

         In this case the pointer to the start of the string can be found
         in the memory location: info_table_ptr + info_table_size
   -}</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>   </span><span class="hs-identifier">getConDescAddress</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="../ghci-8.4.3/src/%{MODULE/./-}.html#%{NAME}/GHCi.InfoTable.html#StgInfoTable"><span class="hs-identifier hs-type">StgInfoTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>   </span><a name="local-6989586621679822901"><a href="#local-6989586621679822901"><span class="hs-identifier">getConDescAddress</span></a></a><span> </span><a name="local-6989586621679822903"><a href="#local-6989586621679822903"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679822904"><a href="#local-6989586621679822904"><span class="hs-identifier">ptr</span></a></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#ghciTablesNextToCode"><span class="hs-identifier hs-var">ghciTablesNextToCode</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-99"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679822905"><a href="#local-6989586621679822905"><span class="hs-identifier">ptr'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679822904"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#plusPtr"><span class="hs-identifier hs-var">plusPtr</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621679822903"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>       </span><span class="hs-comment">-- NB. the offset must be read as an Int32 not a Word32, so</span><span>
</span><a name="line-101"></a><span>       </span><span class="hs-comment">-- that the sign is preserved when converting to an Int.</span><span>
</span><a name="line-102"></a><span>       </span><a name="local-6989586621679822906"><a href="#local-6989586621679822906"><span class="hs-identifier">offsetToString</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.Storable.html#peek"><span class="hs-identifier hs-var">peek</span></a><span> </span><a href="#local-6989586621679822905"><span class="hs-identifier hs-var">ptr'</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Int.html#Int32"><span class="hs-identifier hs-type">Int32</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>       </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679822904"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#plusPtr"><span class="hs-identifier hs-var">plusPtr</span></a><span class="hs-special">`</span><span> </span><a href="CmmInfo.html#stdInfoTableSizeB"><span class="hs-identifier hs-var">stdInfoTableSizeB</span></a><span> </span><a href="#local-6989586621679822903"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#plusPtr"><span class="hs-identifier hs-var">plusPtr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679822906"><span class="hs-identifier hs-var">offsetToString</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>       </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.Storable.html#peek"><span class="hs-identifier hs-var">peek</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.Ptr.html#intPtrToPtr"><span class="hs-identifier hs-var">intPtrToPtr</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Foreign.Ptr.html#ptrToIntPtr"><span class="hs-identifier hs-var">ptrToIntPtr</span></a><span> </span><a href="#local-6989586621679822904"><span class="hs-identifier hs-var">ptr</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="CmmInfo.html#stdInfoTableSizeB"><span class="hs-identifier hs-var">stdInfoTableSizeB</span></a><span> </span><a href="#local-6989586621679822903"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>   </span><span class="hs-comment">-- parsing names is a little bit fiddly because we have a string in the form:</span><span>
</span><a name="line-107"></a><span>   </span><span class="hs-comment">-- pkg:A.B.C.foo, and we want to split it into three parts: (&quot;pkg&quot;, &quot;A.B.C&quot;, &quot;foo&quot;).</span><span>
</span><a name="line-108"></a><span>   </span><span class="hs-comment">-- Thus we split at the leftmost colon and the rightmost occurrence of the dot.</span><span>
</span><a name="line-109"></a><span>   </span><span class="hs-comment">-- It would be easier if the string was in the form pkg:A.B.C:foo, but alas</span><span>
</span><a name="line-110"></a><span>   </span><span class="hs-comment">-- this is not the conventional way of writing Haskell names. We stick with</span><span>
</span><a name="line-111"></a><span>   </span><span class="hs-comment">-- convention, even though it makes the parsing code more troublesome.</span><span>
</span><a name="line-112"></a><span>   </span><span class="hs-comment">-- Warning: this code assumes that the string is well formed.</span><span>
</span><a name="line-113"></a><span>   </span><span class="hs-identifier">parse</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>   </span><a name="local-6989586621679822902"><a href="#local-6989586621679822902"><span class="hs-identifier">parse</span></a></a><span> </span><a name="local-6989586621679822907"><a href="#local-6989586621679822907"><span class="hs-identifier">input</span></a></a><span>
</span><a name="line-115"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">occ</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mod</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">occ</span><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-117"></a><span>      </span><a name="local-6989586621679822908"><a href="#local-6989586621679822908"><span class="hs-identifier">dot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><span class="hs-char">'.'</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679822909"><a href="#local-6989586621679822909"><span class="hs-identifier">pkg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679822910"><a href="#local-6989586621679822910"><span class="hs-identifier">rest1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><span class="hs-char">':'</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679822907"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-119"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679822911"><a href="#local-6989586621679822911"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679822912"><a href="#local-6989586621679822912"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679822908"><span class="hs-identifier hs-var">dot</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621679822914"><span class="hs-identifier hs-var">modWords</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679822915"><span class="hs-identifier hs-var">occWord</span></a><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>         </span><span class="hs-special">(</span><a name="local-6989586621679822914"><a href="#local-6989586621679822914"><span class="hs-identifier">modWords</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679822915"><a href="#local-6989586621679822915"><span class="hs-identifier">occWord</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">rest1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">parseModOcc</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tail</span><span> </span><a href="Panic.html#assertPanic"><span class="hs-identifier hs-var">rest1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>      </span><span class="hs-identifier">parseModOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>      </span><span class="hs-comment">-- We only look for dots if str could start with a module name,</span><span>
</span><a name="line-125"></a><span>      </span><span class="hs-comment">-- i.e. if it starts with an upper case character.</span><span>
</span><a name="line-126"></a><span>      </span><span class="hs-comment">-- Otherwise we might think that &quot;X.:-&gt;&quot; is the module name in</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-comment">-- &quot;X.:-&gt;.+&quot;, whereas actually &quot;X&quot; is the module name and</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-comment">-- &quot;:-&gt;.+&quot; is a constructor name.</span><span>
</span><a name="line-129"></a><span>      </span><a name="local-6989586621679822913"><a href="#local-6989586621679822913"><span class="hs-identifier">parseModOcc</span></a></a><span> </span><a name="local-6989586621679822916"><a href="#local-6989586621679822916"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679822917"><a href="#local-6989586621679822917"><span class="hs-identifier">str</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679822918"><a href="#local-6989586621679822918"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#isUpper"><span class="hs-identifier hs-var">isUpper</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Char.html#chr"><span class="hs-identifier hs-var">chr</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><a href="#local-6989586621679822918"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-131"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#break"><span class="hs-identifier hs-var">break</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679822908"><span class="hs-identifier hs-var">dot</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679822917"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-132"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679822919"><a href="#local-6989586621679822919"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679822916"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679822919"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679822920"><a href="#local-6989586621679822920"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679822921"><a href="#local-6989586621679822921"><span class="hs-identifier">bot</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679822913"><span class="hs-identifier hs-var">parseModOcc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679822920"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679822916"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679822921"><span class="hs-identifier hs-var">bot</span></a><span>
</span><a name="line-134"></a><span>      </span><span class="hs-identifier">parseModOcc</span><span> </span><a name="local-6989586621679822922"><a href="#local-6989586621679822922"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679822923"><a href="#local-6989586621679822923"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679822922"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679822923"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a></pre></body></html>