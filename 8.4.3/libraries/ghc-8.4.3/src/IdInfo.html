<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1993-1998

\section[IdInfo]{@IdInfos@: Non-essential information about @Ids@}

(And a pretty good illustration of quite a few things wrong with
Haskell. [WDP 94/11])
-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IdInfo</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>        </span><span class="hs-comment">-- * The IdDetails type</span><span>
</span><a name="line-16"></a><span>        </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="IdInfo.html#pprIdDetails"><span class="hs-identifier hs-var">pprIdDetails</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#coVarDetails"><span class="hs-identifier hs-var">coVarDetails</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#isCoVarDetails"><span class="hs-identifier hs-var">isCoVarDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#isJoinIdDetails_maybe"><span class="hs-identifier hs-var">isJoinIdDetails_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="IdInfo.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>        </span><span class="hs-comment">-- * The IdInfo type</span><span>
</span><a name="line-21"></a><span>        </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Abstract</span><span>
</span><a name="line-22"></a><span>        </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#noCafIdInfo"><span class="hs-identifier hs-var">noCafIdInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>        </span><span class="hs-comment">-- ** The OneShotInfo type</span><span>
</span><a name="line-25"></a><span>        </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="IdInfo.html#oneShotInfo"><span class="hs-identifier hs-var">oneShotInfo</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#noOneShotInfo"><span class="hs-identifier hs-var">noOneShotInfo</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#hasNoOneShotInfo"><span class="hs-identifier hs-var">hasNoOneShotInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier hs-var">setOneShotInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><span class="hs-comment">-- ** Zapping various forms of Info</span><span>
</span><a name="line-30"></a><span>        </span><a href="IdInfo.html#zapLamInfo"><span class="hs-identifier hs-var">zapLamInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#zapFragileInfo"><span class="hs-identifier hs-var">zapFragileInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="IdInfo.html#zapDemandInfo"><span class="hs-identifier hs-var">zapDemandInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#zapUsageInfo"><span class="hs-identifier hs-var">zapUsageInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#zapUsageEnvInfo"><span class="hs-identifier hs-var">zapUsageEnvInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#zapUsedOnceInfo"><span class="hs-identifier hs-var">zapUsedOnceInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="IdInfo.html#zapTailCallInfo"><span class="hs-identifier hs-var">zapTailCallInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#zapCallArityInfo"><span class="hs-identifier hs-var">zapCallArityInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><span class="hs-comment">-- ** The ArityInfo type</span><span>
</span><a name="line-35"></a><span>        </span><a href="IdInfo.html#ArityInfo"><span class="hs-identifier hs-type">ArityInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="IdInfo.html#unknownArity"><span class="hs-identifier hs-var">unknownArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="IdInfo.html#arityInfo"><span class="hs-identifier hs-var">arityInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#ppArityInfo"><span class="hs-identifier hs-var">ppArityInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>        </span><a href="IdInfo.html#callArityInfo"><span class="hs-identifier hs-var">callArityInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setCallArityInfo"><span class="hs-identifier hs-var">setCallArityInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>        </span><span class="hs-comment">-- ** Demand and strictness Info</span><span>
</span><a name="line-42"></a><span>        </span><a href="IdInfo.html#strictnessInfo"><span class="hs-identifier hs-var">strictnessInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="IdInfo.html#demandInfo"><span class="hs-identifier hs-var">demandInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setDemandInfo"><span class="hs-identifier hs-var">setDemandInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#pprStrictness"><span class="hs-identifier hs-var">pprStrictness</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-comment">-- ** Unfolding Info</span><span>
</span><a name="line-46"></a><span>        </span><a href="IdInfo.html#unfoldingInfo"><span class="hs-identifier hs-var">unfoldingInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setUnfoldingInfo"><span class="hs-identifier hs-var">setUnfoldingInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>        </span><span class="hs-comment">-- ** The InlinePragInfo type</span><span>
</span><a name="line-49"></a><span>        </span><a href="IdInfo.html#InlinePragInfo"><span class="hs-identifier hs-type">InlinePragInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="IdInfo.html#inlinePragInfo"><span class="hs-identifier hs-var">inlinePragInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier hs-var">setInlinePragInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>        </span><span class="hs-comment">-- ** The OccInfo type</span><span>
</span><a name="line-53"></a><span>        </span><a href="BasicTypes.html#OccInfo"><span class="hs-identifier hs-type">OccInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="BasicTypes.html#isDeadOcc"><span class="hs-identifier hs-var">isDeadOcc</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#isStrongLoopBreaker"><span class="hs-identifier hs-var">isStrongLoopBreaker</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#isWeakLoopBreaker"><span class="hs-identifier hs-var">isWeakLoopBreaker</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="IdInfo.html#occInfo"><span class="hs-identifier hs-var">occInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setOccInfo"><span class="hs-identifier hs-var">setOccInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>        </span><a href="BasicTypes.html#InsideLam"><span class="hs-identifier hs-type">InsideLam</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#OneBranch"><span class="hs-identifier hs-type">OneBranch</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="BasicTypes.html#insideLam"><span class="hs-identifier hs-var">insideLam</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#notInsideLam"><span class="hs-identifier hs-var">notInsideLam</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#oneBranch"><span class="hs-identifier hs-var">oneBranch</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#notOneBranch"><span class="hs-identifier hs-var">notOneBranch</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>        </span><a href="BasicTypes.html#TailCallInfo"><span class="hs-identifier hs-type">TailCallInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="BasicTypes.html#tailCallInfo"><span class="hs-identifier hs-var">tailCallInfo</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#isAlwaysTailCalled"><span class="hs-identifier hs-var">isAlwaysTailCalled</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>        </span><span class="hs-comment">-- ** The RuleInfo type</span><span>
</span><a name="line-64"></a><span>        </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="IdInfo.html#emptyRuleInfo"><span class="hs-identifier hs-var">emptyRuleInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><a href="IdInfo.html#isEmptyRuleInfo"><span class="hs-identifier hs-var">isEmptyRuleInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#ruleInfoFreeVars"><span class="hs-identifier hs-var">ruleInfoFreeVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>        </span><a href="IdInfo.html#ruleInfoRules"><span class="hs-identifier hs-var">ruleInfoRules</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setRuleInfoHead"><span class="hs-identifier hs-var">setRuleInfoHead</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="IdInfo.html#ruleInfo"><span class="hs-identifier hs-var">ruleInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setRuleInfo"><span class="hs-identifier hs-var">setRuleInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span>        </span><span class="hs-comment">-- ** The CAFInfo type</span><span>
</span><a name="line-71"></a><span>        </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="IdInfo.html#ppCafInfo"><span class="hs-identifier hs-var">ppCafInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#mayHaveCafRefs"><span class="hs-identifier hs-var">mayHaveCafRefs</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>        </span><a href="IdInfo.html#cafInfo"><span class="hs-identifier hs-var">cafInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setCafInfo"><span class="hs-identifier hs-var">setCafInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span>        </span><span class="hs-comment">-- ** Tick-box Info</span><span>
</span><a name="line-76"></a><span>        </span><a href="IdInfo.html#TickBoxOp"><span class="hs-identifier hs-type">TickBoxOp</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="IdInfo.html#TickBoxId"><span class="hs-identifier hs-type">TickBoxId</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>        </span><span class="hs-comment">-- ** Levity info</span><span>
</span><a name="line-79"></a><span>        </span><a href="IdInfo.html#LevityInfo"><span class="hs-identifier hs-type">LevityInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#levityInfo"><span class="hs-identifier hs-var">levityInfo</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setNeverLevPoly"><span class="hs-identifier hs-var">setNeverLevPoly</span></a><span class="hs-special">,</span><span> </span><a href="IdInfo.html#setLevityInfoWithType"><span class="hs-identifier hs-var">setLevityInfoWithType</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>        </span><a href="IdInfo.html#isNeverLevPolyIdInfo"><span class="hs-identifier hs-var">isNeverLevPolyIdInfo</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="PrimOp.html"><span class="hs-identifier">PrimOp</span></a><span> </span><span class="hs-special">(</span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="ForeignCall.html"><span class="hs-identifier">ForeignCall</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="Demand.html"><span class="hs-identifier">Demand</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- infixl so you can say (id `set` a `set` b)</span><span>
</span><a name="line-105"></a><span class="hs-keyword">infixl</span><span>  </span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><a name="setRuleInfo"><a href="IdInfo.html#setRuleInfo"><span class="hs-identifier">setRuleInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>          </span><span class="hs-special">`</span><a name="setArityInfo"><a href="IdInfo.html#setArityInfo"><span class="hs-identifier">setArityInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>          </span><span class="hs-special">`</span><a name="setInlinePragInfo"><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier">setInlinePragInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>          </span><span class="hs-special">`</span><a name="setUnfoldingInfo"><a href="IdInfo.html#setUnfoldingInfo"><span class="hs-identifier">setUnfoldingInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>          </span><span class="hs-special">`</span><a name="setOneShotInfo"><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier">setOneShotInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>          </span><span class="hs-special">`</span><a name="setOccInfo"><a href="IdInfo.html#setOccInfo"><span class="hs-identifier">setOccInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>          </span><span class="hs-special">`</span><a name="setCafInfo"><a href="IdInfo.html#setCafInfo"><span class="hs-identifier">setCafInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>          </span><span class="hs-special">`</span><a name="setStrictnessInfo"><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier">setStrictnessInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>          </span><span class="hs-special">`</span><a name="setDemandInfo"><a href="IdInfo.html#setDemandInfo"><span class="hs-identifier">setDemandInfo</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>          </span><span class="hs-special">`</span><a name="setNeverLevPoly"><a href="IdInfo.html#setNeverLevPoly"><span class="hs-identifier">setNeverLevPoly</span></a></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>          </span><span class="hs-special">`</span><a name="setLevityInfoWithType"><a href="IdInfo.html#setLevityInfoWithType"><span class="hs-identifier">setLevityInfoWithType</span></a></a><span class="hs-special">`</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     IdDetails
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | Identifier Details</span><span>
</span><a name="line-126"></a><span class="hs-comment">--</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- The 'IdDetails' of an 'Id' give stable, and necessary,</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- information about the Id.</span><span>
</span><a name="line-129"></a><span class="hs-keyword">data</span><span> </span><a name="IdDetails"><a href="IdInfo.html#IdDetails"><span class="hs-identifier">IdDetails</span></a></a><span>
</span><a name="line-130"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="VanillaId"><a href="IdInfo.html#VanillaId"><span class="hs-identifier">VanillaId</span></a></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>  </span><span class="hs-comment">-- | The 'Id' for a record selector</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecSelId"><a href="IdInfo.html#RecSelId"><span class="hs-identifier">RecSelId</span></a></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="sel_tycon"><a href="IdInfo.html#sel_tycon"><span class="hs-identifier">sel_tycon</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a><span>
</span><a name="line-135"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="sel_naughty"><a href="IdInfo.html#sel_naughty"><span class="hs-identifier">sel_naughty</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>       </span><span class="hs-comment">-- True &lt;=&gt; a &quot;naughty&quot; selector which can't actually exist, for example @x@ in:</span><span>
</span><a name="line-136"></a><span>                                </span><span class="hs-comment">--    data T = forall a. MkT { x :: a }</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">}</span><span>                           </span><span class="hs-comment">-- See Note [Naughty record selectors] in TcTyClsDecls</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DataConWorkId"><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier">DataConWorkId</span></a></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>       </span><span class="hs-comment">-- ^ The 'Id' is for a data constructor /worker/</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DataConWrapId"><a href="IdInfo.html#DataConWrapId"><span class="hs-identifier">DataConWrapId</span></a></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>       </span><span class="hs-comment">-- ^ The 'Id' is for a data constructor /wrapper/</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>                                </span><span class="hs-comment">-- [the only reasons we need to know is so that</span><span>
</span><a name="line-143"></a><span>                                </span><span class="hs-comment">--  a) to support isImplicitId</span><span>
</span><a name="line-144"></a><span>                                </span><span class="hs-comment">--  b) when desugaring a RecordCon we can get</span><span>
</span><a name="line-145"></a><span>                                </span><span class="hs-comment">--     from the Id back to the data con]</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClassOpId"><a href="IdInfo.html#ClassOpId"><span class="hs-identifier">ClassOpId</span></a></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>             </span><span class="hs-comment">-- ^ The 'Id' is a superclass selector,</span><span>
</span><a name="line-147"></a><span>                                </span><span class="hs-comment">-- or class operation of a class</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PrimOpId"><a href="IdInfo.html#PrimOpId"><span class="hs-identifier">PrimOpId</span></a></a><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span>             </span><span class="hs-comment">-- ^ The 'Id' is for a primitive operator</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FCallId"><a href="IdInfo.html#FCallId"><span class="hs-identifier">FCallId</span></a></a><span> </span><a href="ForeignCall.html#ForeignCall"><span class="hs-identifier hs-type">ForeignCall</span></a><span>         </span><span class="hs-comment">-- ^ The 'Id' is for a foreign call.</span><span>
</span><a name="line-151"></a><span>                                </span><span class="hs-comment">-- Type will be simple: no type families, newtypes, etc</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TickBoxOpId"><a href="IdInfo.html#TickBoxOpId"><span class="hs-identifier">TickBoxOpId</span></a></a><span> </span><a href="IdInfo.html#TickBoxOp"><span class="hs-identifier hs-type">TickBoxOp</span></a><span>       </span><span class="hs-comment">-- ^ The 'Id' is for a HPC tick box (both traditional and binary)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DFunId"><a href="IdInfo.html#DFunId"><span class="hs-identifier">DFunId</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                 </span><span class="hs-comment">-- ^ A dictionary function.</span><span>
</span><a name="line-156"></a><span>       </span><span class="hs-comment">-- Bool = True &lt;=&gt; the class has only one method, so may be</span><span>
</span><a name="line-157"></a><span>       </span><span class="hs-comment">--                  implemented with a newtype, so it might be bad</span><span>
</span><a name="line-158"></a><span>       </span><span class="hs-comment">--                  to be strict on this dictionary</span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoVarId"><a href="IdInfo.html#CoVarId"><span class="hs-identifier">CoVarId</span></a></a><span>    </span><span class="hs-comment">-- ^ A coercion variable</span><span>
</span><a name="line-161"></a><span>               </span><span class="hs-comment">-- This only covers /un-lifted/ coercions, of type</span><span>
</span><a name="line-162"></a><span>               </span><span class="hs-comment">-- (t1 ~# t2) or (t1 ~R# t2), not their lifted variants</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="JoinId"><a href="IdInfo.html#JoinId"><span class="hs-identifier">JoinId</span></a></a><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span>           </span><span class="hs-comment">-- ^ An 'Id' for a join point taking n arguments</span><span>
</span><a name="line-164"></a><span>       </span><span class="hs-comment">-- Note [Join points] in CoreSyn</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- | Recursive Selector Parent</span><span>
</span><a name="line-167"></a><span class="hs-keyword">data</span><span> </span><a name="RecSelParent"><a href="IdInfo.html#RecSelParent"><span class="hs-identifier">RecSelParent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RecSelData"><a href="IdInfo.html#RecSelData"><span class="hs-identifier">RecSelData</span></a></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="RecSelPatSyn"><a href="IdInfo.html#RecSelPatSyn"><span class="hs-identifier">RecSelPatSyn</span></a></a><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-comment">-- Either `TyCon` or `PatSyn` depending</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-comment">-- on the origin of the record selector.</span><span>
</span><a name="line-170"></a><span>  </span><span class="hs-comment">-- For a data type family, this is the</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-comment">-- /instance/ 'TyCon' not the family 'TyCon'</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="IdInfo.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>  </span><a name="local-8214565720323905451"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621679448771"><a href="#local-6989586621679448771"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679448771"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-175"></a><span>            </span><a href="IdInfo.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a><span> </span><a name="local-6989586621679448772"><a href="#local-6989586621679448772"><span class="hs-identifier">ty_con</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679448772"><span class="hs-identifier hs-var">ty_con</span></a><span>
</span><a name="line-176"></a><span>            </span><a href="IdInfo.html#RecSelPatSyn"><span class="hs-identifier hs-var">RecSelPatSyn</span></a><span> </span><a name="local-6989586621679448773"><a href="#local-6989586621679448773"><span class="hs-identifier">ps</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679448773"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- | Just a synonym for 'CoVarId'. Written separately so it can be</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- exported in the hs-boot file.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">coVarDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span>
</span><a name="line-181"></a><a name="coVarDetails"><a href="IdInfo.html#coVarDetails"><span class="hs-identifier">coVarDetails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#CoVarId"><span class="hs-identifier hs-var">CoVarId</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- | Check if an 'IdDetails' says 'CoVarId'.</span><span>
</span><a name="line-184"></a><span class="hs-identifier">isCoVarDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-185"></a><a name="isCoVarDetails"><a href="IdInfo.html#isCoVarDetails"><span class="hs-identifier">isCoVarDetails</span></a></a><span> </span><a href="IdInfo.html#CoVarId"><span class="hs-identifier hs-var">CoVarId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-186"></a><span class="hs-identifier">isCoVarDetails</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-identifier">isJoinIdDetails_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span>
</span><a name="line-189"></a><a name="isJoinIdDetails_maybe"><a href="IdInfo.html#isJoinIdDetails_maybe"><span class="hs-identifier">isJoinIdDetails_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><a name="local-6989586621679448774"><a href="#local-6989586621679448774"><span class="hs-identifier">join_arity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679448774"><span class="hs-identifier hs-var">join_arity</span></a><span>
</span><a name="line-190"></a><span class="hs-identifier">isJoinIdDetails_maybe</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-8214565720323905451"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#pprIdDetails"><span class="hs-identifier hs-var">pprIdDetails</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">pprIdDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-196"></a><a name="pprIdDetails"><a href="IdInfo.html#pprIdDetails"><span class="hs-identifier">pprIdDetails</span></a></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-197"></a><span class="hs-identifier">pprIdDetails</span><span> </span><a name="local-6989586621679448775"><a href="#local-6989586621679448775"><span class="hs-identifier">other</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448776"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-6989586621679448775"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-199"></a><span>   </span><a name="local-6989586621679448776"><a href="#local-6989586621679448776"><span class="hs-identifier">pp</span></a></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;pprIdDetails&quot;</span><span>
</span><a name="line-200"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DataCon&quot;</span><span>
</span><a name="line-201"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#DataConWrapId"><span class="hs-identifier hs-var">DataConWrapId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DataConWrapper&quot;</span><span>
</span><a name="line-202"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#ClassOpId"><span class="hs-identifier hs-var">ClassOpId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ClassOp&quot;</span><span>
</span><a name="line-203"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#PrimOpId"><span class="hs-identifier hs-var">PrimOpId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;PrimOp&quot;</span><span>
</span><a name="line-204"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#FCallId"><span class="hs-identifier hs-var">FCallId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ForeignCall&quot;</span><span>
</span><a name="line-205"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#TickBoxOpId"><span class="hs-identifier hs-var">TickBoxOpId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TickBoxOp&quot;</span><span>
</span><a name="line-206"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#DFunId"><span class="hs-identifier hs-var">DFunId</span></a><span> </span><a name="local-6989586621679448777"><a href="#local-6989586621679448777"><span class="hs-identifier">nt</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DFunId&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><a href="#local-6989586621679448777"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(nt)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_naughty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448778"><a href="#local-6989586621679448778"><span class="hs-identifier">is_naughty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;RecSel&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-209"></a><span>                                           </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><a href="#local-6989586621679448778"><span class="hs-identifier hs-var">is_naughty</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(naughty)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><a href="IdInfo.html#CoVarId"><span class="hs-identifier hs-var">CoVarId</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CoVarId&quot;</span><span>
</span><a name="line-211"></a><span>   </span><span class="hs-identifier">pp</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><a name="local-6989586621679448779"><a href="#local-6989586621679448779"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;JoinId&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621679448779"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{The main IdInfo type}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | Identifier Information</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- An 'IdInfo' gives /optional/ information about an 'Id'.  If</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- present it never lies, but it may not be present, in which case there</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- is always a conservative assumption which can be made.</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- Two 'Id's may have different info even though they have the same</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- 'Unique' (and are hence the same 'Id'); for example, one might lack</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- the properties attached to the other.</span><span>
</span><a name="line-230"></a><span class="hs-comment">--</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- Most of the 'IdInfo' gives information about the value, or definition, of</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- the 'Id', independent of its usage. Exceptions to this</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- are 'demandInfo', 'occInfo', 'oneShotInfo' and 'callArityInfo'.</span><span>
</span><a name="line-234"></a><span class="hs-comment">--</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- Performance note: when we update 'IdInfo', we have to reallocate this</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- entire record, so it is a good idea not to let this data structure get</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- too big.</span><span>
</span><a name="line-238"></a><span class="hs-keyword">data</span><span> </span><a name="IdInfo"><a href="IdInfo.html#IdInfo"><span class="hs-identifier">IdInfo</span></a></a><span>
</span><a name="line-239"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IdInfo"><a href="IdInfo.html#IdInfo"><span class="hs-identifier">IdInfo</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-240"></a><span>        </span><a name="arityInfo"><a href="IdInfo.html#arityInfo"><span class="hs-identifier">arityInfo</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="IdInfo.html#ArityInfo"><span class="hs-identifier hs-type">ArityInfo</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ^ 'Id' arity</span><span>
</span><a name="line-241"></a><span>        </span><a name="ruleInfo"><a href="IdInfo.html#ruleInfo"><span class="hs-identifier">ruleInfo</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- ^ Specialisations of the 'Id's function which exist</span><span>
</span><a name="line-242"></a><span>                                                </span><span class="hs-comment">-- See Note [Specialisations and RULES in IdInfo]</span><span>
</span><a name="line-243"></a><span>        </span><a name="unfoldingInfo"><a href="IdInfo.html#unfoldingInfo"><span class="hs-identifier">unfoldingInfo</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ^ The 'Id's unfolding</span><span>
</span><a name="line-244"></a><span>        </span><a name="cafInfo"><a href="IdInfo.html#cafInfo"><span class="hs-identifier">cafInfo</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- ^ 'Id' CAF info</span><span>
</span><a name="line-245"></a><span>        </span><a name="oneShotInfo"><a href="IdInfo.html#oneShotInfo"><span class="hs-identifier">oneShotInfo</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- ^ Info about a lambda-bound variable, if the 'Id' is one</span><span>
</span><a name="line-246"></a><span>        </span><a name="inlinePragInfo"><a href="IdInfo.html#inlinePragInfo"><span class="hs-identifier">inlinePragInfo</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Any inline pragma atached to the 'Id'</span><span>
</span><a name="line-247"></a><span>        </span><a name="occInfo"><a href="IdInfo.html#occInfo"><span class="hs-identifier">occInfo</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#OccInfo"><span class="hs-identifier hs-type">OccInfo</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- ^ How the 'Id' occurs in the program</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>        </span><a name="strictnessInfo"><a href="IdInfo.html#strictnessInfo"><span class="hs-identifier">strictnessInfo</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a><span class="hs-special">,</span><span>      </span><span class="hs-comment">--  ^ A strictness signature</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>        </span><a name="demandInfo"><a href="IdInfo.html#demandInfo"><span class="hs-identifier">demandInfo</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ ID demand information</span><span>
</span><a name="line-252"></a><span>        </span><a name="callArityInfo"><a href="IdInfo.html#callArityInfo"><span class="hs-identifier">callArityInfo</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="IdInfo.html#ArityInfo"><span class="hs-identifier hs-type">ArityInfo</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ How this is called.</span><span>
</span><a name="line-253"></a><span>                                         </span><span class="hs-comment">-- n &lt;=&gt; all calls have at least n arguments</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>        </span><a name="levityInfo"><a href="IdInfo.html#levityInfo"><span class="hs-identifier">levityInfo</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#LevityInfo"><span class="hs-identifier hs-type">LevityInfo</span></a><span>    </span><span class="hs-comment">-- ^ when applied, will this Id ever have a levity-polymorphic type?</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- Setters</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-identifier">setRuleInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-261"></a><a name="setRuleInfo"><a href="IdInfo.html#setRuleInfo"><span class="hs-identifier">setRuleInfo</span></a></a><span>       </span><a name="local-6989586621679448780"><a href="#local-6989586621679448780"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448781"><a href="#local-6989586621679448781"><span class="hs-identifier">sp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448781"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448780"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ruleInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448781"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-262"></a><span class="hs-identifier">setInlinePragInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-263"></a><a name="setInlinePragInfo"><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier">setInlinePragInfo</span></a></a><span> </span><a name="local-6989586621679448782"><a href="#local-6989586621679448782"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448783"><a href="#local-6989586621679448783"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448783"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448782"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inlinePragInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448783"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-264"></a><span class="hs-identifier">setOccInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OccInfo"><span class="hs-identifier hs-type">OccInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-265"></a><a name="setOccInfo"><a href="IdInfo.html#setOccInfo"><span class="hs-identifier">setOccInfo</span></a></a><span>        </span><a name="local-6989586621679448784"><a href="#local-6989586621679448784"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448785"><a href="#local-6989586621679448785"><span class="hs-identifier">oc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448785"><span class="hs-identifier hs-var">oc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448784"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448785"><span class="hs-identifier hs-var">oc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-266"></a><span>        </span><span class="hs-comment">-- Try to avoid spack leaks by seq'ing</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-identifier">setUnfoldingInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-269"></a><a name="setUnfoldingInfo"><a href="IdInfo.html#setUnfoldingInfo"><span class="hs-identifier">setUnfoldingInfo</span></a></a><span> </span><a name="local-6989586621679448786"><a href="#local-6989586621679448786"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448787"><a href="#local-6989586621679448787"><span class="hs-identifier">uf</span></a></a><span>
</span><a name="line-270"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- We don't seq the unfolding, as we generate intermediate</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-comment">-- unfoldings which are just thrown away, so evaluating them is a</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-comment">-- waste of time.</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-comment">-- seqUnfolding uf `seq`</span><span>
</span><a name="line-274"></a><span>    </span><a href="#local-6989586621679448786"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">unfoldingInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448787"><span class="hs-identifier hs-var">uf</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-identifier">setArityInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#ArityInfo"><span class="hs-identifier hs-type">ArityInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-277"></a><a name="setArityInfo"><a href="IdInfo.html#setArityInfo"><span class="hs-identifier">setArityInfo</span></a></a><span>      </span><a name="local-6989586621679448788"><a href="#local-6989586621679448788"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448789"><a href="#local-6989586621679448789"><span class="hs-identifier">ar</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448788"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">arityInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448789"><span class="hs-identifier hs-var">ar</span></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-278"></a><span class="hs-identifier">setCallArityInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#ArityInfo"><span class="hs-identifier hs-type">ArityInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-279"></a><a name="setCallArityInfo"><a href="IdInfo.html#setCallArityInfo"><span class="hs-identifier">setCallArityInfo</span></a></a><span> </span><a name="local-6989586621679448790"><a href="#local-6989586621679448790"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448791"><a href="#local-6989586621679448791"><span class="hs-identifier">ar</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448790"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">callArityInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448791"><span class="hs-identifier hs-var">ar</span></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-280"></a><span class="hs-identifier">setCafInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-281"></a><a name="setCafInfo"><a href="IdInfo.html#setCafInfo"><span class="hs-identifier">setCafInfo</span></a></a><span>        </span><a name="local-6989586621679448792"><a href="#local-6989586621679448792"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448793"><a href="#local-6989586621679448793"><span class="hs-identifier">caf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448792"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cafInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448793"><span class="hs-identifier hs-var">caf</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">setOneShotInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-284"></a><a name="setOneShotInfo"><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier">setOneShotInfo</span></a></a><span>      </span><a name="local-6989586621679448794"><a href="#local-6989586621679448794"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448795"><a href="#local-6989586621679448795"><span class="hs-identifier">lb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{-lb `seq`-}</span><span> </span><a href="#local-6989586621679448794"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">oneShotInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448795"><span class="hs-identifier hs-var">lb</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-identifier">setDemandInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-287"></a><a name="setDemandInfo"><a href="IdInfo.html#setDemandInfo"><span class="hs-identifier">setDemandInfo</span></a></a><span> </span><a name="local-6989586621679448796"><a href="#local-6989586621679448796"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448797"><a href="#local-6989586621679448797"><span class="hs-identifier">dd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448797"><span class="hs-identifier hs-var">dd</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448796"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448797"><span class="hs-identifier hs-var">dd</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-identifier">setStrictnessInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-290"></a><a name="setStrictnessInfo"><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier">setStrictnessInfo</span></a></a><span> </span><a name="local-6989586621679448798"><a href="#local-6989586621679448798"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448799"><a href="#local-6989586621679448799"><span class="hs-identifier">dd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448799"><span class="hs-identifier hs-var">dd</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448798"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448799"><span class="hs-identifier hs-var">dd</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">-- | Basic 'IdInfo' that carries no useful information whatsoever</span><span>
</span><a name="line-293"></a><span class="hs-identifier">vanillaIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-294"></a><a name="vanillaIdInfo"><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier">vanillaIdInfo</span></a></a><span>
</span><a name="line-295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-var">IdInfo</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-296"></a><span>            </span><span class="hs-identifier">cafInfo</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#vanillaCafInfo"><span class="hs-identifier hs-var">vanillaCafInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-297"></a><span>            </span><span class="hs-identifier">arityInfo</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#unknownArity"><span class="hs-identifier hs-var">unknownArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-298"></a><span>            </span><span class="hs-identifier">ruleInfo</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#emptyRuleInfo"><span class="hs-identifier hs-var">emptyRuleInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-299"></a><span>            </span><span class="hs-identifier">unfoldingInfo</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#noUnfolding"><span class="hs-identifier hs-var">noUnfolding</span></a><span class="hs-special">,</span><span>
</span><a name="line-300"></a><span>            </span><span class="hs-identifier">oneShotInfo</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-301"></a><span>            </span><span class="hs-identifier">inlinePragInfo</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#defaultInlinePragma"><span class="hs-identifier hs-var">defaultInlinePragma</span></a><span class="hs-special">,</span><span>
</span><a name="line-302"></a><span>            </span><span class="hs-identifier">occInfo</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#noOccInfo"><span class="hs-identifier hs-var">noOccInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-303"></a><span>            </span><span class="hs-identifier">demandInfo</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a><span class="hs-special">,</span><span>
</span><a name="line-304"></a><span>            </span><span class="hs-identifier">strictnessInfo</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#nopSig"><span class="hs-identifier hs-var">nopSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-305"></a><span>            </span><span class="hs-identifier">callArityInfo</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#unknownArity"><span class="hs-identifier hs-var">unknownArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-306"></a><span>            </span><span class="hs-identifier">levityInfo</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#NoLevityInfo"><span class="hs-identifier hs-var">NoLevityInfo</span></a><span>
</span><a name="line-307"></a><span>           </span><span class="hs-special">}</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | More informative 'IdInfo' we can use when we know the 'Id' has no CAF references</span><span>
</span><a name="line-310"></a><span class="hs-identifier">noCafIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-311"></a><a name="noCafIdInfo"><a href="IdInfo.html#noCafIdInfo"><span class="hs-identifier">noCafIdInfo</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setCafInfo"><span class="hs-identifier hs-var">setCafInfo</span></a><span class="hs-special">`</span><span>    </span><a href="IdInfo.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a><span>
</span><a name="line-312"></a><span>        </span><span class="hs-comment">-- Used for built-in type Ids in MkId.</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[arity-IdInfo]{Arity info about an @Id@}
*                                                                      *
************************************************************************

For locally-defined Ids, the code generator maintains its own notion
of their arities; so it should not be asking...  (but other things
besides the code-generator need arity info!)
-}</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Arity Information</span><span>
</span><a name="line-327"></a><span class="hs-comment">--</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- An 'ArityInfo' of @n@ tells us that partial application of this</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- 'Id' to up to @n-1@ value arguments does essentially no work.</span><span>
</span><a name="line-330"></a><span class="hs-comment">--</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- That is not necessarily the same as saying that it has @n@ leading</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- lambdas, because coerces may get in the way.</span><span>
</span><a name="line-333"></a><span class="hs-comment">--</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- The arity might increase later in the compilation process, if</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- an extra lambda floats up to the binding site.</span><span>
</span><a name="line-336"></a><span class="hs-keyword">type</span><span> </span><a name="ArityInfo"><a href="IdInfo.html#ArityInfo"><span class="hs-identifier">ArityInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">-- | It is always safe to assume that an 'Id' has an arity of 0</span><span>
</span><a name="line-339"></a><span class="hs-identifier">unknownArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-340"></a><a name="unknownArity"><a href="IdInfo.html#unknownArity"><span class="hs-identifier">unknownArity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-identifier">ppArityInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-343"></a><a name="ppArityInfo"><a href="IdInfo.html#ppArityInfo"><span class="hs-identifier">ppArityInfo</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-344"></a><span class="hs-identifier">ppArityInfo</span><span> </span><a name="local-6989586621679448800"><a href="#local-6989586621679448800"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Arity&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621679448800"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Inline-pragma information}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Inline Pragma Information</span><span>
</span><a name="line-355"></a><span class="hs-comment">--</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- Tells when the inlining is active.</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- When it is active the thing may be inlined, depending on how</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- big it is.</span><span>
</span><a name="line-359"></a><span class="hs-comment">--</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- If there was an @INLINE@ pragma, then as a separate matter, the</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- RHS will have been made to look small with a Core inline 'Note'</span><span>
</span><a name="line-362"></a><span class="hs-comment">--</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- The default 'InlinePragInfo' is 'AlwaysActive', so the info serves</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- entirely as a way to inhibit inlining until we want it</span><span>
</span><a name="line-365"></a><span class="hs-keyword">type</span><span> </span><a name="InlinePragInfo"><a href="IdInfo.html#InlinePragInfo"><span class="hs-identifier">InlinePragInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
               Strictness
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-identifier">pprStrictness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-376"></a><a name="pprStrictness"><a href="IdInfo.html#pprStrictness"><span class="hs-identifier">pprStrictness</span></a></a><span> </span><a name="local-6989586621679448801"><a href="#local-6989586621679448801"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679448801"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        RuleInfo
*                                                                      *
************************************************************************

Note [Specialisations and RULES in IdInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Generally speaking, a GlobalId has an *empty* RuleInfo.  All their
RULES are contained in the globally-built rule-base.  In principle,
one could attach the to M.f the RULES for M.f that are defined in M.
But we don't do that for instance declarations and so we just treat
them all uniformly.

The EXCEPTION is PrimOpIds, which do have rules in their IdInfo. That is
jsut for convenience really.

However, LocalIds may have non-empty RuleInfo.  We treat them
differently because:
  a) they might be nested, in which case a global table won't work
  b) the RULE might mention free variables, which we use to keep things alive

In TidyPgm, when the LocalId becomes a GlobalId, its RULES are stripped off
and put in the global list.
-}</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-comment">-- | Rule Information</span><span>
</span><a name="line-406"></a><span class="hs-comment">--</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- Records the specializations of this 'Id' that we know about</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- in the form of rewrite 'CoreRule's that target them</span><span>
</span><a name="line-409"></a><span class="hs-keyword">data</span><span> </span><a name="RuleInfo"><a href="IdInfo.html#RuleInfo"><span class="hs-identifier">RuleInfo</span></a></a><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RuleInfo"><a href="IdInfo.html#RuleInfo"><span class="hs-identifier">RuleInfo</span></a></a><span>
</span><a name="line-411"></a><span>        </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-412"></a><span>        </span><a href="VarSet.html#DVarSet"><span class="hs-identifier hs-type">DVarSet</span></a><span>         </span><span class="hs-comment">-- Locally-defined free vars of *both* LHS and RHS</span><span>
</span><a name="line-413"></a><span>                        </span><span class="hs-comment">-- of rules.  I don't think it needs to include the</span><span>
</span><a name="line-414"></a><span>                        </span><span class="hs-comment">-- ru_fn though.</span><span>
</span><a name="line-415"></a><span>                        </span><span class="hs-comment">-- Note [Rule dependency info] in OccurAnal</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-comment">-- | Assume that no specilizations exist: always safe</span><span>
</span><a name="line-418"></a><span class="hs-identifier">emptyRuleInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span>
</span><a name="line-419"></a><a name="emptyRuleInfo"><a href="IdInfo.html#emptyRuleInfo"><span class="hs-identifier">emptyRuleInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="VarSet.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-identifier">isEmptyRuleInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-422"></a><a name="isEmptyRuleInfo"><a href="IdInfo.html#isEmptyRuleInfo"><span class="hs-identifier">isEmptyRuleInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><a name="local-6989586621679448802"><a href="#local-6989586621679448802"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679448802"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">-- | Retrieve the locally-defined free variables of both the left and</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- right hand sides of the specialization rules</span><span>
</span><a name="line-426"></a><span class="hs-identifier">ruleInfoFreeVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#DVarSet"><span class="hs-identifier hs-type">DVarSet</span></a><span>
</span><a name="line-427"></a><a name="ruleInfoFreeVars"><a href="IdInfo.html#ruleInfoFreeVars"><span class="hs-identifier">ruleInfoFreeVars</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679448803"><a href="#local-6989586621679448803"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448803"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span class="hs-identifier">ruleInfoRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-430"></a><a name="ruleInfoRules"><a href="IdInfo.html#ruleInfoRules"><span class="hs-identifier">ruleInfoRules</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><a name="local-6989586621679448804"><a href="#local-6989586621679448804"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448804"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | Change the name of the function the rule is keyed on on all of the 'CoreRule's</span><span>
</span><a name="line-433"></a><span class="hs-identifier">setRuleInfoHead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span>
</span><a name="line-434"></a><a name="setRuleInfoHead"><a href="IdInfo.html#setRuleInfoHead"><span class="hs-identifier">setRuleInfoHead</span></a></a><span> </span><a name="local-6989586621679448805"><a href="#local-6989586621679448805"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><a name="local-6989586621679448806"><a href="#local-6989586621679448806"><span class="hs-identifier">rules</span></a></a><span> </span><a name="local-6989586621679448807"><a href="#local-6989586621679448807"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-var">RuleInfo</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#setRuleIdName"><span class="hs-identifier hs-var">setRuleIdName</span></a><span> </span><a href="#local-6989586621679448805"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679448806"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679448807"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[CG-IdInfo]{Code generator-related information}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-comment">-- CafInfo is used to build Static Reference Tables (see simplStg/SRT.hs).</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- | Constant applicative form Information</span><span>
</span><a name="line-448"></a><span class="hs-comment">--</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- Records whether an 'Id' makes Constant Applicative Form references</span><span>
</span><a name="line-450"></a><span class="hs-keyword">data</span><span> </span><a name="CafInfo"><a href="IdInfo.html#CafInfo"><span class="hs-identifier">CafInfo</span></a></a><span>
</span><a name="line-451"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="MayHaveCafRefs"><a href="IdInfo.html#MayHaveCafRefs"><span class="hs-identifier">MayHaveCafRefs</span></a></a><span>                </span><span class="hs-comment">-- ^ Indicates that the 'Id' is for either:</span><span>
</span><a name="line-452"></a><span>                                        </span><span class="hs-comment">--</span><span>
</span><a name="line-453"></a><span>                                        </span><span class="hs-comment">-- 1. A function or static constructor</span><span>
</span><a name="line-454"></a><span>                                        </span><span class="hs-comment">--    that refers to one or more CAFs, or</span><span>
</span><a name="line-455"></a><span>                                        </span><span class="hs-comment">--</span><span>
</span><a name="line-456"></a><span>                                        </span><span class="hs-comment">-- 2. A real live CAF</span><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="NoCafRefs"><a href="IdInfo.html#NoCafRefs"><span class="hs-identifier">NoCafRefs</span></a></a><span>                     </span><span class="hs-comment">-- ^ A function or static constructor</span><span>
</span><a name="line-459"></a><span>                                        </span><span class="hs-comment">-- that refers to no CAFs.</span><span>
</span><a name="line-460"></a><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">-- | Assumes that the 'Id' has CAF references: definitely safe</span><span>
</span><a name="line-463"></a><span class="hs-identifier">vanillaCafInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span>
</span><a name="line-464"></a><a name="vanillaCafInfo"><a href="IdInfo.html#vanillaCafInfo"><span class="hs-identifier">vanillaCafInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-identifier">mayHaveCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-467"></a><a name="mayHaveCafRefs"><a href="IdInfo.html#mayHaveCafRefs"><span class="hs-identifier">mayHaveCafRefs</span></a></a><span>  </span><a href="IdInfo.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-468"></a><span class="hs-identifier">mayHaveCafRefs</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-471"></a><span>   </span><a name="local-8214565720323905451"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#ppCafInfo"><span class="hs-identifier hs-var">ppCafInfo</span></a><span>
</span><a name="line-472"></a><span>
</span><a name="line-473"></a><span class="hs-identifier">ppCafInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-474"></a><a name="ppCafInfo"><a href="IdInfo.html#ppCafInfo"><span class="hs-identifier">ppCafInfo</span></a></a><span> </span><a href="IdInfo.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NoCafRefs&quot;</span><span>
</span><a name="line-475"></a><span class="hs-identifier">ppCafInfo</span><span> </span><a href="IdInfo.html#MayHaveCafRefs"><span class="hs-identifier hs-var">MayHaveCafRefs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Bulk operations on IdInfo}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | This is used to remove information on lambda binders that we have</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- setup as part of a lambda group, assuming they will be applied all at once,</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- but turn out to be part of an unsaturated lambda as in e.g:</span><span>
</span><a name="line-488"></a><span class="hs-comment">--</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- &gt; (\x1. \x2. e) arg1</span><span>
</span><a name="line-490"></a><span class="hs-identifier">zapLamInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-491"></a><a name="zapLamInfo"><a href="IdInfo.html#zapLamInfo"><span class="hs-identifier">zapLamInfo</span></a></a><span> </span><a name="local-6989586621679448808"><a href="#local-6989586621679448808"><span class="hs-identifier">info</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-var">IdInfo</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">occInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448809"><a href="#local-6989586621679448809"><span class="hs-identifier">occ</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448810"><a href="#local-6989586621679448810"><span class="hs-identifier">demand</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679448811"><span class="hs-identifier hs-var">is_safe_occ</span></a><span> </span><a href="#local-6989586621679448809"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679448813"><span class="hs-identifier hs-var">is_safe_dmd</span></a><span> </span><a href="#local-6989586621679448810"><span class="hs-identifier hs-var">demand</span></a><span>
</span><a name="line-493"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-494"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-495"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448808"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">occInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448812"><span class="hs-identifier hs-var">safe_occ</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-497"></a><span>        </span><span class="hs-comment">-- The &quot;unsafe&quot; occ info is the ones that say I'm not in a lambda</span><span>
</span><a name="line-498"></a><span>        </span><span class="hs-comment">-- because that might not be true for an unsaturated lambda</span><span>
</span><a name="line-499"></a><span>    </span><a name="local-6989586621679448811"><a href="#local-6989586621679448811"><span class="hs-identifier">is_safe_occ</span></a></a><span> </span><a name="local-6989586621679448814"><a href="#local-6989586621679448814"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#isAlwaysTailCalled"><span class="hs-identifier hs-var">isAlwaysTailCalled</span></a><span> </span><a href="#local-6989586621679448814"><span class="hs-identifier hs-var">occ</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-identifier">is_safe_occ</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#OneOcc"><span class="hs-identifier hs-var">OneOcc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occ_in_lam</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448815"><a href="#local-6989586621679448815"><span class="hs-identifier">in_lam</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448815"><span class="hs-identifier hs-var">in_lam</span></a><span>
</span><a name="line-501"></a><span>    </span><span class="hs-identifier">is_safe_occ</span><span> </span><a name="local-6989586621679448816"><a href="#local-6989586621679448816"><span class="hs-identifier">_other</span></a></a><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span>    </span><a name="local-6989586621679448812"><a href="#local-6989586621679448812"><span class="hs-identifier">safe_occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679448809"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-504"></a><span>                 </span><a href="BasicTypes.html#OneOcc"><span class="hs-identifier hs-var">OneOcc</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679448809"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occ_in_lam</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-505"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">occ_tail</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NoTailCallInfo"><span class="hs-identifier hs-var">NoTailCallInfo</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-506"></a><span>                 </span><a href="BasicTypes.html#IAmALoopBreaker"><span class="hs-identifier hs-var">IAmALoopBreaker</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-507"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679448809"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occ_tail</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NoTailCallInfo"><span class="hs-identifier hs-var">NoTailCallInfo</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-508"></a><span>                 </span><a name="local-6989586621679448817"><a href="#local-6989586621679448817"><span class="hs-identifier">_other</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679448809"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span>    </span><a name="local-6989586621679448813"><a href="#local-6989586621679448813"><span class="hs-identifier">is_safe_dmd</span></a></a><span> </span><a name="local-6989586621679448818"><a href="#local-6989586621679448818"><span class="hs-identifier">dmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Demand.html#isStrictDmd"><span class="hs-identifier hs-var">isStrictDmd</span></a><span> </span><a href="#local-6989586621679448818"><span class="hs-identifier hs-var">dmd</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">-- | Remove all demand info on the 'IdInfo'</span><span>
</span><a name="line-513"></a><span class="hs-identifier">zapDemandInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-514"></a><a name="zapDemandInfo"><a href="IdInfo.html#zapDemandInfo"><span class="hs-identifier">zapDemandInfo</span></a></a><span> </span><a name="local-6989586621679448819"><a href="#local-6989586621679448819"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448819"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-comment">-- | Remove usage (but not strictness) info on the 'IdInfo'</span><span>
</span><a name="line-517"></a><span class="hs-identifier">zapUsageInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-518"></a><a name="zapUsageInfo"><a href="IdInfo.html#zapUsageInfo"><span class="hs-identifier">zapUsageInfo</span></a></a><span> </span><a name="local-6989586621679448820"><a href="#local-6989586621679448820"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448820"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#zapUsageDemand"><span class="hs-identifier hs-var">zapUsageDemand</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">demandInfo</span><span> </span><a href="#local-6989586621679448820"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-comment">-- | Remove usage environment info from the strictness signature on the 'IdInfo'</span><span>
</span><a name="line-521"></a><span class="hs-identifier">zapUsageEnvInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-522"></a><a name="zapUsageEnvInfo"><a href="IdInfo.html#zapUsageEnvInfo"><span class="hs-identifier">zapUsageEnvInfo</span></a></a><span> </span><a name="local-6989586621679448821"><a href="#local-6989586621679448821"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-523"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Demand.html#hasDemandEnvSig"><span class="hs-identifier hs-var">hasDemandEnvSig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-6989586621679448821"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448821"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">strictnessInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#zapUsageEnvSig"><span class="hs-identifier hs-var">zapUsageEnvSig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-6989586621679448821"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-526"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-identifier">zapUsedOnceInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-529"></a><a name="zapUsedOnceInfo"><a href="IdInfo.html#zapUsedOnceInfo"><span class="hs-identifier">zapUsedOnceInfo</span></a></a><span> </span><a name="local-6989586621679448822"><a href="#local-6989586621679448822"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-530"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679448822"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#zapUsedOnceSig"><span class="hs-identifier hs-var">zapUsedOnceSig</span></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-6989586621679448822"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">demandInfo</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-var">zapUsedOnceDemand</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">demandInfo</span><span>     </span><a href="#local-6989586621679448822"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-identifier">zapFragileInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-534"></a><span class="hs-comment">-- ^ Zap info that depends on free variables</span><span>
</span><a name="line-535"></a><a name="zapFragileInfo"><a href="IdInfo.html#zapFragileInfo"><span class="hs-identifier">zapFragileInfo</span></a></a><span> </span><a name="local-6989586621679448823"><a href="#local-6989586621679448823"><span class="hs-identifier">info</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-var">IdInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448824"><a href="#local-6989586621679448824"><span class="hs-identifier">occ</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">unfoldingInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679448825"><a href="#local-6989586621679448825"><span class="hs-identifier">unf</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448826"><span class="hs-identifier hs-var">new_unf</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span>  </span><span class="hs-comment">-- The unfolding field is not (currently) strict, so we</span><span>
</span><a name="line-537"></a><span>                   </span><span class="hs-comment">-- force it here to avoid a (zapFragileUnfolding unf) thunk</span><span>
</span><a name="line-538"></a><span>                   </span><span class="hs-comment">-- which might leak space</span><span>
</span><a name="line-539"></a><span>    </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448823"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setRuleInfo"><span class="hs-identifier hs-var">setRuleInfo</span></a><span class="hs-special">`</span><span> </span><a href="IdInfo.html#emptyRuleInfo"><span class="hs-identifier hs-var">emptyRuleInfo</span></a><span>
</span><a name="line-540"></a><span>               </span><span class="hs-special">`</span><a href="IdInfo.html#setUnfoldingInfo"><span class="hs-identifier hs-var">setUnfoldingInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448826"><span class="hs-identifier hs-var">new_unf</span></a><span>
</span><a name="line-541"></a><span>               </span><span class="hs-special">`</span><a href="IdInfo.html#setOccInfo"><span class="hs-identifier hs-var">setOccInfo</span></a><span class="hs-special">`</span><span>       </span><a href="BasicTypes.html#zapFragileOcc"><span class="hs-identifier hs-var">zapFragileOcc</span></a><span> </span><a href="#local-6989586621679448824"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-543"></a><span>    </span><a name="local-6989586621679448826"><a href="#local-6989586621679448826"><span class="hs-identifier">new_unf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#zapFragileUnfolding"><span class="hs-identifier hs-var">zapFragileUnfolding</span></a><span> </span><a href="#local-6989586621679448825"><span class="hs-identifier hs-var">unf</span></a><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-identifier">zapFragileUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span>
</span><a name="line-546"></a><a name="zapFragileUnfolding"><a href="IdInfo.html#zapFragileUnfolding"><span class="hs-identifier">zapFragileUnfolding</span></a></a><span> </span><a name="local-6989586621679448827"><a href="#local-6989586621679448827"><span class="hs-identifier">unf</span></a></a><span>
</span><a name="line-547"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#isFragileUnfolding"><span class="hs-identifier hs-var">isFragileUnfolding</span></a><span> </span><a href="#local-6989586621679448827"><span class="hs-identifier hs-var">unf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#noUnfolding"><span class="hs-identifier hs-var">noUnfolding</span></a><span>
</span><a name="line-548"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448827"><span class="hs-identifier hs-var">unf</span></a><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-identifier">zapTailCallInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-551"></a><a name="zapTailCallInfo"><a href="IdInfo.html#zapTailCallInfo"><span class="hs-identifier">zapTailCallInfo</span></a></a><span> </span><a name="local-6989586621679448828"><a href="#local-6989586621679448828"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-552"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">occInfo</span><span> </span><a href="#local-6989586621679448828"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-553"></a><span>      </span><a name="local-6989586621679448829"><a href="#local-6989586621679448829"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#isAlwaysTailCalled"><span class="hs-identifier hs-var">isAlwaysTailCalled</span></a><span> </span><a href="#local-6989586621679448829"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448828"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setOccInfo"><span class="hs-identifier hs-var">setOccInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679448830"><span class="hs-identifier hs-var">safe_occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-555"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-556"></a><span>          </span><a name="local-6989586621679448830"><a href="#local-6989586621679448830"><span class="hs-identifier">safe_occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448829"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">occ_tail</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NoTailCallInfo"><span class="hs-identifier hs-var">NoTailCallInfo</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-identifier">zapCallArityInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-559"></a><a name="zapCallArityInfo"><a href="IdInfo.html#zapCallArityInfo"><span class="hs-identifier">zapCallArityInfo</span></a></a><span> </span><a name="local-6989586621679448831"><a href="#local-6989586621679448831"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#setCallArityInfo"><span class="hs-identifier hs-var">setCallArityInfo</span></a><span> </span><a href="#local-6989586621679448831"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{TickBoxOp}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span class="hs-keyword">type</span><span> </span><a name="TickBoxId"><a href="IdInfo.html#TickBoxId"><span class="hs-identifier">TickBoxId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-comment">-- | Tick box for Hpc-style coverage</span><span>
</span><a name="line-572"></a><span class="hs-keyword">data</span><span> </span><a name="TickBoxOp"><a href="IdInfo.html#TickBoxOp"><span class="hs-identifier">TickBoxOp</span></a></a><span>
</span><a name="line-573"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="TickBox"><a href="IdInfo.html#TickBox"><span class="hs-identifier">TickBox</span></a></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><a href="IdInfo.html#TickBoxId"><span class="hs-identifier hs-type">TickBoxId</span></a><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="IdInfo.html#TickBoxOp"><span class="hs-identifier hs-type">TickBoxOp</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-576"></a><span>    </span><a name="local-8214565720323905451"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="IdInfo.html#TickBox"><span class="hs-identifier hs-var">TickBox</span></a><span> </span><a name="local-6989586621679448769"><a href="#local-6989586621679448769"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621679448770"><a href="#local-6989586621679448770"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tick&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679448769"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><a href="#local-6989586621679448770"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>
</span><a name="line-578"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
   Levity
*                                                                      *
************************************************************************

Note [Levity info]
~~~~~~~~~~~~~~~~~~

Ids store whether or not they can be levity-polymorphic at any amount
of saturation. This is helpful in optimizing the levity-polymorphism check
done in the desugarer, where we can usually learn that something is not
levity-polymorphic without actually figuring out its type. See
isExprLevPoly in CoreUtils for where this info is used. Storing
this is required to prevent perf/compiler/T5631 from blowing up.

-}</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-comment">-- See Note [Levity info]</span><span>
</span><a name="line-598"></a><span class="hs-keyword">data</span><span> </span><a name="LevityInfo"><a href="IdInfo.html#LevityInfo"><span class="hs-identifier">LevityInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NoLevityInfo"><a href="IdInfo.html#NoLevityInfo"><span class="hs-identifier">NoLevityInfo</span></a></a><span>  </span><span class="hs-comment">-- always safe</span><span>
</span><a name="line-599"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="NeverLevityPolymorphic"><a href="IdInfo.html#NeverLevityPolymorphic"><span class="hs-identifier">NeverLevityPolymorphic</span></a></a><span>
</span><a name="line-600"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="IdInfo.html#LevityInfo"><span class="hs-identifier hs-type">LevityInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-603"></a><span>  </span><a name="local-8214565720323905451"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="IdInfo.html#NoLevityInfo"><span class="hs-identifier hs-var">NoLevityInfo</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NoLevityInfo&quot;</span><span>
</span><a name="line-604"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="IdInfo.html#NeverLevityPolymorphic"><span class="hs-identifier hs-var">NeverLevityPolymorphic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NeverLevityPolymorphic&quot;</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-comment">-- | Marks an IdInfo describing an Id that is never levity polymorphic (even when</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- applied). The Type is only there for checking that it's really never levity</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- polymorphic</span><span>
</span><a name="line-609"></a><span class="hs-identifier">setNeverLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-610"></a><a name="setNeverLevPoly"><a href="IdInfo.html#setNeverLevPoly"><span class="hs-identifier">setNeverLevPoly</span></a></a><span> </span><a name="local-6989586621679448832"><a href="#local-6989586621679448832"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448833"><a href="#local-6989586621679448833"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-611"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">resultIsLevPoly</span><span> </span><a href="Type.html#resultIsLevPoly"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Type.html#resultIsLevPoly"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Type.html#resultIsLevPoly"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-612"></a><span>    </span><a href="#local-6989586621679448832"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">levityInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#NeverLevityPolymorphic"><span class="hs-identifier hs-var">NeverLevityPolymorphic</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-identifier">setLevityInfoWithType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span>
</span><a name="line-615"></a><a name="setLevityInfoWithType"><a href="IdInfo.html#setLevityInfoWithType"><span class="hs-identifier">setLevityInfoWithType</span></a></a><span> </span><a name="local-6989586621679448834"><a href="#local-6989586621679448834"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679448835"><a href="#local-6989586621679448835"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-616"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#resultIsLevPoly"><span class="hs-identifier hs-var">resultIsLevPoly</span></a><span> </span><a href="#local-6989586621679448835"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448834"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">levityInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#NeverLevityPolymorphic"><span class="hs-identifier hs-var">NeverLevityPolymorphic</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-618"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-619"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679448834"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-identifier">isNeverLevPolyIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-622"></a><a name="isNeverLevPolyIdInfo"><a href="IdInfo.html#isNeverLevPolyIdInfo"><span class="hs-identifier">isNeverLevPolyIdInfo</span></a></a><span> </span><a name="local-6989586621679448836"><a href="#local-6989586621679448836"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-623"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="IdInfo.html#NeverLevityPolymorphic"><span class="hs-identifier hs-var">NeverLevityPolymorphic</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">levityInfo</span><span> </span><a href="#local-6989586621679448836"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-624"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.1.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-625"></a></pre></body></html>